/*1323107313,169775811*/

if (window.CavalryLogger) { CavalryLogger.start_js(["8PKAL"]); }

OauthLogin=function(b,a){this.provider=b;this.endpoint=a;return this;};OauthLogin.prototype.login=function(d,e,b){var c=WindowComm.makeHandler(function(h){this._closePopup();var g=this.provider+'..'+h.oauth_token+'..'+h.oauth_token_secret;setCookie('tpa',g,0,'/');if(b)OauthLogin._refreshLoginStatus();d&&d();}.bind(this));var a=WindowComm.makeHandler(function(g){this._closePopup();new Dialog().setTitle("Ruh roh!").setBody(_tx("We're having trouble talking to {provider}.\u003cbr \/>Either login to Facebook directly or try again later.",{provider:this.provider})).setHandler(function(){e&&e();}).setButtons(Dialog.OK).show();}.bind(this));var f=new URI(this.endpoint);f.setQueryData({provider:this.provider,next:c,channel_url:a,cancel_url:a,display:'popup'});this._popup=PopupResizer.open(f.toString(),416,468);};OauthLogin.prototype._closePopup=function(){if(this._popup){this._popup.close();this._popup=null;}};OauthLogin._refreshLoginStatus=function(){try{XD.send({type:'refreshThirdPartyAuthStatus'});}catch(a){window.location.reload();}};
OpenIDLogin={login:function(d,b,c,a){OpenIDRequest.context='tpa';new OpenIDRequest().setThirdPartyLogin(true).setSuccessHandler(function(f){var e='OpenID'+'..'+f.oid+'..'+f.secret;setCookie('tpa',e,0,'/');if(!!a)OpenIDLogin._refreshLoginStatus();b&&b();}).setErrorHandler(function(e){new Dialog().setTitle("Ruh roh!").setBody(_tx("We're having trouble talking to {provider}.\u003cbr \/>Either login to Facebook directly or try again later.",{provider:d})).setButtons(Dialog.OK).setHandler(function(){c&&c();}).show();}).setOpenIDUrl(d).send();},_refreshLoginStatus:function(){try{XD.send({type:'refreshThirdPartyAuthStatus'});}catch(a){window.location.reload();}}};
MultiLoginPopup={provider:'facebook',formSubmissionInterceptors:[],init:function(){Arbiter.subscribe('platform/socialplugins/login',function(a){MultiLoginPopup.loggedIn=!!a.user;});Selector.subscribe('close',function(a,b){Selector.setSelected(b.selector,Selector.getValue(b.selector),false);});},setProvider:function(a){MultiLoginPopup.provider=a;},interceptFormSubmission:function(b,e,d,a){var c=function(f){if(f){MultiLoginPopup.detachExistingSubmissionInterceptors();if(f.formUserCheck&&f.fbDtsg){Env.fb_dtsg=f.fbDtsg;Env.user=f.user;var g=DOM.scry(document,'input[name="post_form_id"]');if(g.length){for(var h=0;h<g.length;h++)DOM.replace(g[h],HTML(f.formUserCheck));}else DOM.appendContent(DOM.find(document,'body'),HTML(f.formUserCheck));}if(f.isThirdParty==="0"){DOM.scry(document.documentElement,'.postToProfile').forEach(function(i){CSS.show(i);});DOM.scry(document.documentElement,'.postToProfileCheckbox').forEach(function(i){if(f.postToProfileChecked==="0"){i.removeAttribute('checked');}else i.setAttribute('checked','checked');});DOM.scry(document.documentElement,'.viewerProfileHref').forEach(function(i){i.href=f.profileUrl;i.onclick='';});DOM.scry(document.documentElement,'.commentas').forEach(function(l){var n=l.id;DOM.replace(l,HTML(f.commentAsMarkup));var m=$(f.commentAsMarkupID);m.id=n;var k=DOM.scry(m,'a.commentaschange');if(k.length==1){var j=k[0];var i=new URI(j.getAttribute('ajaxify'));i.addQueryData({uniqid:n});j.setAttribute('ajaxify',i.toString());}});}else DOM.scry(document.documentElement,'.commentas').forEach(function(i){var k=i.id;DOM.replace(i,HTML(f.commentAsMarkup));var j=$(f.commentAsMarkupID);j.id=k;});DOM.scry(document.documentElement,'.viewerProfilePic').forEach(function(i){i.src=f.profilePic;});DOM.scry(document.documentElement,'.fbCommentAfterLoginButton').forEach(CSS.hide);DOM.scry(document.documentElement,'.fbCommentButton').forEach(CSS.show);DOM.scry(document.documentElement,'.fbReplyAfterLoginButton').forEach(CSS.hide);DOM.scry(document.documentElement,'.fbReplyButton').forEach(CSS.show);DOM.scry(document.documentElement,'.fbUpDownVoteAfterLogin').forEach(CSS.hide);DOM.scry(document.documentElement,'.fbUpDownVoteOption').forEach(CSS.show);DOM.scry(document.documentElement,'.closeButtonAfterLogin').forEach(CSS.hide);DOM.scry(document.documentElement,'.closeButton').forEach(CSS.show);CommentAdminPanelController.setLoggedIn(parseInt(f.user,10));Arbiter.inform('platform/socialplugins/login',{user:f.user},Arbiter.BEHAVIOR_STATE);WidgetArbiter.inform('platform/socialplugins/login',{user:f.user},Arbiter.BEHAVIOR_STATE);}};MultiLoginPopup.login(a,b,e,d,c);return false;},attachAllFormsToLogin:function(b,a){MultiLoginPopup.formSubmissionInterceptors=[];MultiLoginPopup.popupTitle=b;MultiLoginPopup.params=a;MultiLoginPopup.reattachLoginInterceptors();},reattachLoginInterceptors:function(){MultiLoginPopup.detachExistingSubmissionInterceptors();var a=['composer','fbUpDownVoteAfterLogin','closeButtonAfterLogin'];var e=MultiLoginPopup.popupTitle;var d=MultiLoginPopup.params;var c=function(f){var g=f.getTarget();if(g.tagName.toLowerCase()==='form'&&a.some(CSS.hasClass.curry(g)))return MultiLoginPopup.interceptFormSubmission(g,e,d);};var b=Event.listen(document.documentElement,'submit',c,Event.Priority.URGENT);MultiLoginPopup.formSubmissionInterceptors.push(b);},detachExistingSubmissionInterceptors:function(){var b=MultiLoginPopup.formSubmissionInterceptors.length;for(var a=0;a<b;a++)MultiLoginPopup.formSubmissionInterceptors[a].remove();MultiLoginPopup.formSubmissionInterceptors=[];},login:function(b,a,e,d,c){if(!MultiLoginPopup.loggedIn)MultiLoginPopup._openPopup(d,c);},doOpenIDLogin:function(c,b,a){OpenIDLogin.login(c,MultiLoginPopup.tpaLoginCallback(b),MultiLoginPopup.tpaLoginCallback(a),false);},doOauthWrapLogin:function(d,c,a){var b=new OauthLogin(d,'/connect/oauthwrap_login.php');return b.login(MultiLoginPopup.tpaLoginCallback(c),MultiLoginPopup.tpaLoginCallback(a),false);},doTwitterLogin:function(c,a){var b=new OauthLogin('Twitter','/connect/twitter_login.php');return b.login();},tpaLoginCallback:function(a){return function(d,b){var c=$N('iframe',{src:d,className:'hidden_elem'});DOM.appendContent(DOM.find(b.documentElement,'body'),c);}.curry(a,document);},loggedIn:false,_popup:null,_openPopup:function(g,f){var i=MultiLoginPopup.provider==='facebook'?'opener':'parent';var e=WindowComm.makeHandler(function(l){MultiLoginPopup._closePopup();f&&f(l);},i);var a=WindowComm.makeHandler(function(l){MultiLoginPopup._closePopup();},i);var j;if(MultiLoginPopup.provider==='facebook'){j=new URI('/login.php');j.setQueryData(copy_properties(g,{social_plugin:'multi_login',cancel_url:a,next:e,provider:MultiLoginPopup.provider}));var d=450;var k=700;this._popup=PopupResizer.open(j.toString(),d,k);}else{j=new URI('/plugins/multi_login_popup_loggedin.php');j.setQueryData({original_next:e,original_cancel:a,iframe_src:g.iframe_src});e=j.toString();if(MultiLoginPopup.provider==='twitter'){MultiLoginPopup.doTwitterLogin(e,a);}else if(MultiLoginPopup.provider==='microsoft'){MultiLoginPopup.doOauthWrapLogin(MultiLoginPopup.provider,e,a);}else if(MultiLoginPopup.provider==='openid'){var b=new Dialog();var c=function(m){var l=b.getFormData();MultiLoginPopup.doOpenIDLogin(l.openid_url,e,a);b.hide();if(m.kill)m.kill();return false;};b.setContentWidth(350).setTitle('OpenID').setBody($N('form',{onsubmit:c},$N('input',{type:'text',size:60,name:'openid_url'}))).setHandler(c).setButtons([Dialog.CONFIRM,Dialog.CANCEL]).show();}else{var h=MultiLoginPopup.provider+'.com';MultiLoginPopup.doOpenIDLogin(h,e,a);}}},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}}};