/*1327706284,169776066*/

if (window.CavalryLogger) { CavalryLogger.start_js(["RJC\/c"]); }

__d("ObjectUtils",["copyProperties","hasArrayNature"],function(d,g,h,f,c){var b=g("copyProperties");var e=g("hasArrayNature");var a={object:function(j){var i=new Function();i.prototype=j;return new i();},isScalar:function(i){return (/string|number|boolean/).test(typeof i);},getKeys:function(k){var j=[];for(var i in k)j.push(i);return j;},getValues:function(j){var k=[];for(var i in j)k.push(j[i]);return k;},countKeys:function(k){var i=0;for(var j in k)i++;return i;},areEqual:function(i,j){return JSON.stringify(i)==JSON.stringify(j);},merge:function(){var j={};for(var i=0;i<arguments.length;i++)b(j,arguments[i]);return j;},coalesce:function(){for(var i=0;i<arguments.length;++i)if(arguments[i]!=null)return arguments[i];return null;},createFrom:function(k,m){var l={};var j=e(m);if(typeof m=='undefined')m=true;for(var i=k.length;i--;)l[k[i]]=j?m[i]:m;return l;}};f.exports=a;});
__d("object-extensions",["ObjectUtils"],function(c,e,f,d,b){var a=e('ObjectUtils');c.are_equal=a.areEqual;c.coalesce=a.coalesce;c.count=a.countKeys;c.is_scalar=a.isScalar;c.keys=a.getKeys;c.merge=a.merge;c.object=a.object;c.values=a.getValues;Object.from=a.createFrom;},3);
__d("legacy:util",["Util"],function(a,b,c){a.Util=b('Util');},3);
__d("ua",[],function(b,d,e,c,a){var f={ie:function(){return f._populate()||this._ie;},ie64:function(){return f.ie()&&this._win64;},firefox:function(){return f._populate()||this._firefox;},opera:function(){return f._populate()||this._opera;},safari:function(){return f._populate()||this._safari;},chrome:function(){return f._populate()||this._chrome;},windows:function(){return f._populate()||this._windows;},osx:function(){return f._populate()||this._osx;},linux:function(){return f._populate()||this._linux;},iphone:function(){return f._populate()||this._iphone;},_populated:false,_populate:function(){if(f._populated)return;f._populated=true;var j=navigator.userAgent;var g=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(j);var i=/(Mac OS X)|(Windows)|(Linux)/.exec(j);var h=/\b(iPhone|iP[ao]d)/.exec(j);f._win64=!!(/Win64/.exec(j));if(g){f._ie=g[1]?parseFloat(g[1]):NaN;if(f._ie&&document.documentMode)f._ie=document.documentMode;f._firefox=g[2]?parseFloat(g[2]):NaN;f._opera=g[3]?parseFloat(g[3]):NaN;f._safari=g[4]?parseFloat(g[4]):NaN;if(f._safari){g=/(?:Chrome\/(\d+\.\d+))/.exec(j);f._chrome=g&&g[1]?parseFloat(g[1]):NaN;}else f._chrome=NaN;}else f._ie=f._firefox=f._opera=f._chrome=f._safari=NaN;if(i){if(i[1]){var k=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(j);f._osx=k?parseFloat(k[1].replace('_','.')):true;}else f._osx=false;f._windows=!!i[2];f._linux=!!i[3];}else f._osx=f._windows=f._linux=false;f._iphone=h;}};b.ua=c.exports=f;},3);
__d("SystemEvents",["Arbiter","Env","ua","Util","copyProperties"],function(s,w,x,u,r){var a=w('Arbiter');var c=w('Env');var z=w('ua');var e=w('Util');var q=w('copyProperties');var d=new a();var g=[],b=1000;setInterval(function(){for(var za=0;za<g.length;za++)g[za]();},b,false);function i(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var m=c.user;var l=navigator.onLine;g.push(function(){var za=navigator.onLine;if(l!=za){d.inform(d.ONLINE,za);l=za;}});var p=m;g.push(function(){var za=i();if(p!=za){d.inform(d.USER,za);p=za;}});var n=Date.now();function f(){var zc=Date.now();var za=zc-n;var zb=za<0||za>10000;n=zc;if(zb)d.inform(d.TIME_TRAVEL,za);return zb;}g.push(f);function v(za){var zb=za?{line:za.lineNumber||za.line,message:za.message,name:za.name,script:za.fileName||za.sourceURL,stack:za.stackTrace||za.stack}:{};if(z.chrome()&&za.stack&&/(\w{3,5}:\/\/[^:]+):(\d+)/.test(za.stack)){zb.script=RegExp.$1;zb.line=parseInt(RegExp.$2,10);}for(var zc in zb)if(zb[zc]==null)delete zb[zc];return zb;}var h=null;var o=false;function y(zb,za){if(z.ie())return zb;if(/nocatch/.test(location.search))return zb;return function(){if(o)return zb.apply(this,arguments);try{o=true;var res=zb.apply(this,arguments);o=false;return res;}catch(zc){o=false;h=d.normalizeError(zc);if(za)za(h);throw zc;}};}function t(za){if(za instanceof Error)za=v(za);d.inform(d.ERROR,za);}function j(zc,zd,zb){var za=h||{message:zc,script:zd,line:zb};h=null;za.script=za.script||zd;za.line=za.line||zb;t(za);}function k(){window.onerror=j;}a.setErrorHandler(d.informError);k();g.push(k);s.SystemEvents=u.exports=q(d,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',ERROR:'SystemEvents/ERROR',trapError:y,normalizeError:v,informError:t,isPageOwner:function(za){return za||i()==m;},checkTimeTravel:f});},3);
function _onloadHook(){!window.loaded&&window.CavalryLogger&&CavalryLogger.getInstance().setTimeStamp('t_prehooks');_runHooks('onloadhooks');!window.loaded&&window.CavalryLogger&&CavalryLogger.getInstance().setTimeStamp('t_hooks');window.loaded=true;Arbiter.inform('uipage_onload',true,Arbiter.BEHAVIOR_STATE);}function _onafterloadHook(){_runHooks('onafterloadhooks');window.afterloaded=true;}function _runHook(b,c){if(/nocatch/.test(location.search))return b();try{return b();}catch(a){var err=SystemEvents.normalizeError(a);err.event_type=c;err.category='runhook';SystemEvents.informError(err);}}function _runHooks(b){var d=b=='onbeforeleavehooks'||b=='onbeforeunloadhooks';var e=null;do{var a=window[b];if(!d)window[b]=null;if(!a)break;for(var c=0;c<a.length;c++)if(d){e=e||_runHook(a[c],b);}else _runHook(a[c],b);if(d)break;}while(window[b]);if(d&&e)return e;}function keep_window_set_as_loaded(){if(window.loaded==false){window.loaded=true;_runHooks('onloadhooks');}if(window.afterloaded==false){window.afterloaded=true;_runHooks('onafterloadhooks');}}Arbiter.registerCallback(_onloadHook,[OnloadEvent.ONLOAD_DOMCONTENT_CALLBACK,InitialJSLoader.INITIAL_JS_READY]);Arbiter.registerCallback(_onafterloadHook,[OnloadEvent.ONLOAD_DOMCONTENT_CALLBACK,OnloadEvent.ONLOAD_CALLBACK,InitialJSLoader.INITIAL_JS_READY]);Arbiter.subscribe(OnloadEvent.ONBEFOREUNLOAD,function(b,a){a.warn=_runHooks('onbeforeleavehooks')||_runHooks('onbeforeunloadhooks');if(!a.warn){window.loaded=false;window.afterloaded=false;}},Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe(OnloadEvent.ONUNLOAD,function(b,a){_runHooks('onunloadhooks');},Arbiter.SUBSCRIBE_NEW);
void(0);
__d("DataStore",[],function(i,k,l,j,h){var f={};var c={};var g=1;var b=1;function d(m){var n;if(typeof m=='string'){n='str_'+m;}else{n='elem_'+(m.__FB_TOKEN||(m.__FB_TOKEN=[g++]))[0];c[n]=m;}return f[n]||(f[n]={});}function e(m){if(!m.nodeName)return false;try{if(null!=m.offsetParent)return false;}catch(n){}if(document.documentElement.contains){return !document.documentElement.contains(m);}else return (document.documentElement.compareDocumentPosition(m)&b);}var a={set:function(o,n,p){var m=d(o);m[n]=p;return o;},get:function(q,p,o){var n=d(q),r=n[p];if(typeof r==='undefined'&&q.getAttribute){var m=q.getAttribute('data-'+p);r=(null===m)?undefined:m;}if((o!==undefined)&&(r===undefined))r=n[p]=o;return r;},remove:function(o,n){var m=d(o),p=m[n];delete m[n];return p;},cleanup:function(){var n,m;for(n in c){m=c[n];if(e(m)){delete f[n];delete c[n];}}}};j.exports=a;});
__d("string-extensions",[],function(b,d,e,c,a){String.prototype.trim=function(){if(this==window)return null;return this.replace(/^\s*|\s*$/g,'');};a.trim=b.trim=function(g){try{return String(g.toString()).trim();}catch(f){return '';}};String.prototype.startsWith=function(f){if(this==window)return null;return this.substring(0,f.length)==f;};String.prototype.endsWith=function(f){if(this==window)return null;return this.length>=f.length&&this.substring(this.length-f.length)==f;};String.prototype.split=(function(f){return function(m,j){var g="";if(m===null||j===null){return [];}else if(typeof m=='string'){return f.call(this,m,j);}else if(m===undefined){return [this.toString()];}else if(m instanceof RegExp){if(!m._2||!m._1){g=m.toString().replace(/^[\S\s]+\//,"");if(!m._1)if(!m.global){m._1=new RegExp(m.source,"g"+g);}else m._1=1;}separator1=m._1===1?m:m._1;var n=(m._2?m._2:m._2=new RegExp("^"+separator1.source+"$",g));if(j===undefined||j<0){j=false;}else{j=Math.floor(j);if(!j)return [];}var k,l=[],i=0,h=0;while((j?h++<=j:true)&&(k=separator1.exec(this))){if((k[0].length===0)&&(separator1.lastIndex>k.index))separator1.lastIndex--;if(separator1.lastIndex>i){if(k.length>1)k[0].replace(n,function(){for(var o=1;o<arguments.length-2;o++)if(arguments[o]===undefined)k[o]=undefined;});l=l.concat(this.substring(i,k.index),(k.index===this.length?[]:k.slice(1)));i=separator1.lastIndex;}if(k[0].length===0)separator1.lastIndex++;}return (i===this.length)?(separator1.test("")?l:l.concat("")):(j?l:l.concat(this.substring(i)));}else return f.call(this,m,j);};})(String.prototype.split);},3);
__d("evalGlobal",[],function(c,e,f,d,b){function a(i){if('string'!=typeof(i)){throw new Error('JS sent to eval_global is not a string.  Only strings '+'are permitted.');}else if(''==i)return;var j=document.createElement('script');j.type='text/javascript';try{j.appendChild(document.createTextNode(i));}catch(g){j.text=i;}var h=(document.getElementsByTagName("head")[0]||document.documentElement);h.appendChild(j);h.removeChild(j);}d.exports=a;});
__d("HTML",["function-extensions","string-extensions","ArrayUtils","ua","copyProperties","evalGlobal"],function(f,h,i,g,e){h("function-extensions");h("string-extensions");var a=h("ArrayUtils");var j=h("ua");var c=h("copyProperties");var d=h("evalGlobal");function b(k){if(k&&k.__html)k=k.__html;if(!(this instanceof b)){if(k instanceof b)return k;return new b(k);}this._content=k;this._defer=false;this._extra_action='';this._nodes=null;this._inline_js=bagofholding;this._ie_clone_bug=false;return this;}b.isHTML=function(k){return k&&(k instanceof b||k.__html!==undefined);};b.replaceJSONWrapper=function(k){return k&&k.__html!==undefined?new b(k.__html):k;};c(b.prototype,{toString:function(){var k=this._content||'';if(this._extra_action)k+='<script type="text/javascript">'+this._extra_action+'</scr'+'ipt>';return k;},setAction:function(k){this._extra_action=k;return this;},getAction:function(){this._fillCache();var k=function(){this._inline_js();d(this._extra_action);}.bind(this);if(this.getDeferred()){return k.defer.bind(k);}else return k;},setDeferred:function(k){this._defer=!!k;return this;},getDeferred:function(){return this._defer;},getContent:function(){return this._content;},getNodes:function(){this._fillCache();return this._nodes;},getRootNode:function(){return this.getNodes()[0];},ieCloneBug:function(){this._fillCache();return this._ie_clone_bug;},_fillCache:function(){if(null!==this._nodes)return;var n=this._content;if(!n){this._nodes=[];return;}n=n.replace(/(<(\w+)[^>]*?)\/>/g,function(v,w,x){return x.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?v:w+'></'+x+'>';});var r=n.trim().toLowerCase(),u=document.createElement('div'),l=false;var t=(!r.indexOf('<opt')&&[1,'<select multiple="multiple" class="__WRAPPER">','</select>'])||(!r.indexOf('<leg')&&[1,'<fieldset class="__WRAPPER">','</fieldset>'])||(r.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,'<table class="__WRAPPER">','</table>'])||(!r.indexOf('<tr')&&[2,'<table><tbody class="__WRAPPER">','</tbody></table>'])||((!r.indexOf('<td')||!r.indexOf('<th'))&&[3,'<table><tbody><tr class="__WRAPPER">','</tr></tbody></table>'])||(!r.indexOf('<col')&&[2,'<table><tbody></tbody><colgroup class="__WRAPPER">','</colgroup></table>'])||null;if(null===t){u.className='__WRAPPER';if(j.ie()){t=[0,'<span style="display:none">&nbsp;</span>',''];l=true;}else t=[0,'',''];}u.innerHTML=t[1]+n+t[2];while(t[0]--)u=u.lastChild;if(l)u.removeChild(u.firstChild);u.className!='__WRAPPER';if(0!==u.getElementsByTagName('option').length||0!==u.getElementsByTagName('object').length)this._ie_clone_bug=true;if(j.ie()){var s;if(!r.indexOf('<table')&&-1==r.indexOf('<tbody')){s=u.firstChild&&u.firstChild.childNodes;}else if(t[1]=='<table>'&&-1==r.indexOf('<tbody')){s=u.childNodes;}else s=[];for(var p=s.length-1;p>=0;--p)if(s[p].nodeName&&s[p].nodeName.toLowerCase()=='tbody'&&s[p].childNodes.length==0)s[p].parentNode.removeChild(s[p]);}var q=u.getElementsByTagName('script');var k=[];for(var o=0;o<q.length;o++)if(q[o].src){k.push(Bootloader.requestResource.bind(Bootloader,'js',q[o].src));}else k.push(d.bind(null,q[o].innerHTML));for(var o=q.length-1;o>=0;o--)q[o].parentNode.removeChild(q[o]);var m=function(){for(var v=0;v<k.length;v++)k[v]();};this._nodes=a.createFrom(u.childNodes);this._inline_js=m;}});g.exports=b;});
__d("dom",["ArrayUtils","css-core","HTML","ObjectUtils","dom-core","copyProperties","ua","tx","_tx"],function(m,o,p,n,k){var c=o('ArrayUtils');var d=o('css-core');var f=o('HTML');var g=o('ObjectUtils');var a=o('dom-core').$;var j=o('copyProperties');var l=o('dom-core').ge;var r=o('ua');var q=o('tx');var h=o('_tx');function i(s){function t(u){return e.create('div',{},u).innerHTML;}return function(x,u){var v={};if(u)for(var w in u)v[w]=t(u[w]);return f(s(x,v));};}var e={find:function(s,u){var t=e.scry(s,u);return t[0];},scry:function(zb,zn){if(!zb||!zb.getElementsByTagName)return [];var zo=zn.split(' ');var v=[zb];var za=!!zb.documentElement;for(var ze=0;ze<zo.length;ze++){if(v.length==0)break;if(zo[ze]=='')continue;var zm=zo[ze];var zk=[];var zv=false;if(zm.charAt(0)=='^')if(ze==0){zv=true;zm=zm.slice(1);}else return [];zm=zm.replace(/\./g,' .');zm=zm.replace(/\#/g,' #');zm=zm.replace(/\[/g,' [');var zr=zm.split(' ');var zs=zr[0]||'*';var zf=zr[1]&&zr[1].charAt(0)=='#';if(zf){var z=l(zr[1].slice(1),true);if(z&&('*'==zs||z.tagName.toLowerCase()==zs))for(var zi=0;zi<v.length;zi++)if(zv&&e.contains(z,v[zi])){zk=[z];break;}else if(document==v[zi]||e.contains(v[zi],z)){zk=[z];break;}}else{var zu=[];var u=v.length;for(var zg=0;zg<u;zg++){if(zv){var zc=[];var y=v[zg].parentNode;var s=zs=='*';while(e.isElementNode(y)){if(s||y.tagName.toLowerCase()==zs)zc.push(y);y=y.parentNode;}}else var zc=v[zg].getElementsByTagName(zs);var zd=zc.length;for(var zj=0;zj<zd;zj++)zu.push(zc[zj]);}for(var zp=1;zp<zr.length;zp++){var zq=zr[zp];var zh=zq.charAt(0)=='.';var w=zq.substring(1);for(var zg=0;zg<zu.length;zg++){var zt=zu[zg];if(!zt)continue;if(zh){if(!d.hasClass(zt,w))delete zu[zg];continue;}else{var x=zq.slice(1,zq.length-1);if(x.indexOf('=')==-1){if(zt.getAttribute(x)===null){delete zu[zg];continue;}}else{var zl=x.split('=');var t=zl[0];var zw=zl[1];zw=zw.slice(1,zw.length-1);if(zt.getAttribute(t)!=zw){delete zu[zg];continue;}}}}}for(var zg=0;zg<zu.length;zg++)if(zu[zg]){zk.push(zu[zg]);if(zv)break;}}v=zk;}return v;},getText:(function(){var s=document.createElement('div'),t=s.textContent!=null?'textContent':'innerText';return function(u){if(!u){return '';}else if(e.isTextNode(u)){return u.data;}else return u[t];};})(),getSelection:function(){var t=window.getSelection,s=document.selection;if(t){return t()+'';}else if(s)return s.createRange().text;return null;},create:function(u,s,t){u=document.createElement(u);if(s){s=j({},s);if(s.style){j(u.style,s.style);delete s.style;}for(var v in s)if(v.toLowerCase().indexOf('on')==0){if(!(typeof s[v]!='function'))if(window.Event&&Event.listen){Event.listen(u,v.substr(2),s[v]);}else u[v]=s[v];delete s[v];}j(u,s);}if(t!=undefined)e.setContent(u,t);return u;},prependContent:function(u,t){if(!e.isNode(u))throw new Error('DOM.prependContent: reference element is not a node');var s=function(v){if(u.firstChild){u.insertBefore(v,u.firstChild);}else u.appendChild(v);};return e._addContent(t,s,u);},insertAfter:function(u,t){if(!e.isNode(u)||!u.parentNode)throw new Error('DOM.insertAfter: reference element is not a node');var s=function(v){if(u.nextSibling){u.parentNode.insertBefore(v,u.nextSibling);}else u.parentNode.appendChild(v);};return e._addContent(t,s,u.parentNode);},insertBefore:function(t,u){if(!e.isNode(u)||!u.parentNode)throw new Error('DOM.insertBefore: reference element is not a node or '+'does not have a parent.');var s=function(v){u.parentNode.insertBefore(v,u);};return e._addContent(t,s,u.parentNode);},setContent:function(t,s){if(!e.isNode(t))throw new Error('DOM.setContent: reference element is not a node');e.empty(t);return e.appendContent(t,s);},appendContent:function(u,t){if(!e.isNode(u))throw new Error('DOM.appendContent: reference element is not a node');var s=function(v){u.appendChild(v);};return e._addContent(t,s,u);},replace:function(u,t){if(!e.isNode(u)||!u.parentNode)throw new Error('DOM.replace: reference element must be a node with a'+' parent');var s=function(v){u.parentNode.replaceChild(v,u);};return e._addContent(t,s,u.parentNode);},remove:function(s){s=a(s);if(s.parentNode)s.parentNode.removeChild(s);},empty:function(s){s=a(s);while(s.firstChild)e.remove(s.firstChild);},contains:function(t,s){t=l(t);s=l(s);if(!t||!s){return false;}else if(t===s){return true;}else if(e.isTextNode(t)){return false;}else if(e.isTextNode(s)){return e.contains(t,s.parentNode);}else if(t.contains){return t.contains(s);}else if(t.compareDocumentPosition){return !!(t.compareDocumentPosition(s)&16);}else return false;},getRootElement:function(){var s=null;if(window.Quickling&&Quickling.isActive())s=l('content');return s||document.body;},isNode:function(s){return !!(s&&(typeof Node=='object'?s instanceof Node:typeof s=="object"&&typeof s.nodeType=='number'&&typeof s.nodeName=='string'));},isNodeOfType:function(t,u){var v=c.createFrom(u).join('|').toUpperCase().split('|');var s=g.createFrom(v);return e.isNode(t)&&t.nodeName in s;},isElementNode:function(s){return e.isNode(s)&&s.nodeType==1;},isTextNode:function(s){return e.isNode(s)&&s.nodeType==3;},_addContent:function(v,s,ze){v=f.replaceJSONWrapper(v);if(v instanceof f&&-1==v.toString().indexOf('<scr'+'ipt')&&''==ze.innerHTML){var y=r.ie();if(!y||(y>7&&!e.isNodeOfType(ze,['table','tbody','thead','tfoot','tr','select','fieldset']))){var z=y?"<em style=\"display:none;\">&nbsp;</em>":"";ze.innerHTML=z+v;y&&ze.removeChild(ze.firstChild);return c.createFrom(ze.childNodes);}}else if(e.isTextNode(ze)){ze.data=v;return [v];}var zb,w=[],t=[];var x=document.createDocumentFragment();if(!(v instanceof Array))v=[v];for(var za=0;za<v.length;za++){zb=f.replaceJSONWrapper(v[za]);if(zb instanceof f){t.push(zb.getAction());var zd=zb.getNodes(),u;for(var zc=0;zc<zd.length;zc++){u=(r.safari()||(r.ie()&&zb.ieCloneBug()))?zd[zc]:zd[zc].cloneNode(true);w.push(u);x.appendChild(u);}}else if(g.isScalar(zb)){var zf=document.createTextNode(zb);w.push(zf);x.appendChild(zf);}else if(e.isNode(zb)){w.push(zb);x.appendChild(zb);}else if(!(zb instanceof Array))zb!==null;}s(x);for(var za=0;za<t.length;za++)t[za]();return w;},getDocumentScrollElement:function(s){s=s||document;if(d.hasClass(s.documentElement,'wrapped')){var t=s.getElementById('body');if(t)return t;}return !(r.chrome()||r.safari())&&s.compatMode==='CSS1Compat'?s.documentElement:s.body;},getDocumentBodyElement:function(s){s=s||document;if(d.hasClass(s.documentElement,'wrapped')){var t=s.getElementById('body');if(t)return t;}return s.body;},tx:i(q),_tx:i(h)};function b(u,s,t){if(typeof s!='object'||e.isNode(s)||s instanceof Array||f.isHTML(s)){t=s;s=null;}return e.create(u,s,t);}m.$N=e.$N=b;m.DOM=n.exports=e;},3);
__d("event-extensions",["event-form-bubbling","DataStore","dom","ObjectUtils","Parent","SystemEvents","ua","dom-core","copyProperties","userAction"],function(m,s,t,q,l){s('event-form-bubbling');var e=s('DataStore');var d=s('dom');var g=s('ObjectUtils');var h=s('Parent');var i=s('SystemEvents');var v=s('ua');var a=s('dom-core').$;var k=s('copyProperties');var w=s('userAction');Event.DATASTORE_KEY='Event.listeners';if(!Event.prototype)Event.prototype={};function c(y,z,x){this.target=y;this.type=z;this.data=x;}c.prototype={getData:function(){this.data=this.data||{};return this.data;},stop:function(){this.cancelBubble=true;this.stopPropagation&&this.stopPropagation();return this;},prevent:function(){this.returnValue=false;this.preventDefault&&this.preventDefault();return this;},kill:function(){this.stop().prevent();return false;},getTarget:function(){var x=this.target||this.srcElement;return x?a(x):null;}};function b(x){if(x instanceof c)return x;x=x||window.event||{};if(!x._inherits_from_prototype)for(var z in Event.prototype)try{x[z]=Event.prototype[z];}catch(y){}return x;}k(Event.prototype,{_inherits_from_prototype:true,getRelatedTarget:function(){var x=this.relatedTarget||(this.fromElement===this.srcElement?this.toElement:this.fromElement);return x?a(x):null;},getModifiers:function(){var x={control:!!this.ctrlKey,shift:!!this.shiftKey,alt:!!this.altKey,meta:!!this.metaKey};x.access=v.osx()?x.control:x.alt;x.any=x.control||x.shift||x.alt||x.meta;return x;}});k(Event.prototype,c.prototype);k(Event,{listen:function(y,zi,za,ze){if(typeof y=='string')y=a(y);if(typeof ze=='undefined')ze=Event.Priority.NORMAL;if(typeof zi=='object'){var z={};for(var zh in zi)z[zh]=Event.listen(y,zh,zi[zh],ze);return z;}if(zi.match(/^on/i))throw new TypeError("Bad event name `"+event+"': use `click', not `onclick'.");if(y.nodeName=='LABEL'&&zi=='click'){var zd=y.getElementsByTagName('input');y=zd.length==1?zd[0]:y;}else if(y===window&&zi==='scroll'){var zg=d.getDocumentScrollElement();if(zg!==document.documentElement&&zg!==document.body)y=zg;}var zb=e.get(y,n,{});if(u[zi]){var x=u[zi];zi=x.base;za=x.wrap(za);}j(y,zi);var zj=zb[zi];if(!(ze in zj))zj[ze]=[];var zc=zj[ze].length,zf=new f(za,zj[ze],zc);zj[ze].push(zf);return zf;},stop:function(x){return b(x).stop();},prevent:function(x){return b(x).prevent();},kill:function(x){return b(x).kill();},getKeyCode:function(event){event=b(event);if(!event)return false;switch(event.keyCode){case 63232:return 38;case 63233:return 40;case 63234:return 37;case 63235:return 39;case 63272:case 63273:case 63275:return null;case 63276:return 33;case 63277:return 34;}if(event.shiftKey)switch(event.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:return null;}return event.keyCode;},getPriorities:function(){if(!r){var x=g.getValues(Event.Priority);x.sort(function(y,z){return y-z;});r=x;}return r;},fire:function(za,zc,x){var y=new c(za,zc,x);var zb;do{var z=Event.__getHandler(za,zc);if(z)zb=z(y);za=za.parentNode;}while(za&&zb!==false&&!y.cancelBubble);return zb!==false;},__fire:function(x,z,event){var y=Event.__getHandler(x,z);if(y)return y(b(event));},__getHandler:function(x,y){return e.get(x,Event.DATASTORE_KEY+y);}});var r=null,n=Event.DATASTORE_KEY;var o=function(x){return function(y){if(!d.contains(this,y.getRelatedTarget()))return x.call(this,y);};};var u={mouseenter:{base:'mouseover',wrap:o},mouseleave:{base:'mouseout',wrap:o}};var j=function(x,zd){var y='on'+zd;var zb=p.bind(x);var za=e.get(x,n);if(zd in za)return;za[zd]={};if(x.addEventListener){x.addEventListener(zd,zb,false);}else if(x.attachEvent)x.attachEvent(y,zb);e.set(x,n+zd,zb);if(x[y]){var zc=x===document.documentElement?Event.Priority._BUBBLE:Event.Priority.TRADITIONAL;var z=x[y];x[y]=null;Event.listen(x,zd,z,zc);}if(x.nodeName==='FORM'&&zd==='submit')Event.listen(x,zd,Event.__bubbleSubmit.curry(x),Event.Priority._BUBBLE);};var p=function(event){event=b(event);var ze=event.type;if(!e.get(this,n))throw new Error("Bad listenHandler context.");var zf=e.get(this,n)[ze];if(!zf)throw new Error("No registered handlers for `"+ze+"'.");if(ze=='click'){var z=h.byTag(event.getTarget(),'a');var zg=w('click',z,event).set_namespace('evt_ext');if(window.ArbiterMonitor)ArbiterMonitor.initUA(zg,[z]);}var zb=Event.getPriorities();for(var za=0;za<zb.length;za++){var zc=zb[za];if(zc in zf){var x=zf[zc];for(var y=0;y<x.length;y++){if(!x[y])continue;var zd=x[y].fire(this,event);if(zd===false){return event.kill();}else if(event.cancelBubble)event.stop();}}}return event.returnValue;};Event.Priority={URGENT:-20,TRADITIONAL:-10,NORMAL:0,_BUBBLE:1000};function f(y,x,z){this._handler=y;this._container=x;this._index=z;}f.prototype={remove:function(){delete this._handler;delete this._container[this._index];},fire:function(x,event){var y=i.trapError(this._handler,function(z){z.event_type=event.type;z.dom_element=x.name||x.id;z.category='eventhandler';});return y.call(x,event);}};m.$E=l.$E=b;});
__d("css",["dom","css-core","copyProperties"],function(e,g,h,f,d){var b=g('dom');var a=g('css-core');var c=g('copyProperties');c(a,{shown:function(i){return !a.hasClass(i,'hidden_elem');},toggle:function(i){a.conditionShow(i,!a.shown(i));},setClass:function(j,i){$(j).className=i||'';return j;},setStyle:function(i,j,k){switch(j){case 'opacity':i.style.opacity=k;i.style.filter=k!==''?'alpha(opacity='+k*100+')':'';break;case 'float':i.style.cssFloat=i.style.styleFloat=k;break;default:j=j.replace(/-(.)/g,function(l,m){return m.toUpperCase();});i.style[j]=k;}return i;},getStyle:function(j,l){j=$(j);l=l.replace(/-(.)/g,function(m,n){return n.toUpperCase();});function k(m){return m.replace(/([A-Z])/g,'-$1').toLowerCase();}if(window.getComputedStyle){var i=window.getComputedStyle(j,null);if(i)return i.getPropertyValue(k(l));}if(document.defaultView&&document.defaultView.getComputedStyle){var i=document.defaultView.getComputedStyle(j,null);if(i)return i.getPropertyValue(k(l));if(l=="display")return "none";}if(j.currentStyle)return j.currentStyle[l];return j.style&&j.style[l];},getStyleFloat:function(i,j){return parseFloat(a.getStyle(i,j),10);},getOpacity:function(i){i=$(i);var j=a.getStyle(i,'filter');var k=null;if(j&&(k=/(\d+(?:\.\d+)?)/.exec(j))){return parseFloat(k.pop())/100;}else if(j=a.getStyle(i,'opacity')){return parseFloat(j);}else return 1;},isFixed:function(i){while(i&&i!==document.documentElement){if(a.getStyle(i,'position')==='fixed')return true;i=i.parentNode;}return false;},getScrollParent:(function(){function i(j,l){var k=a.getStyle(j,l);return (k==='auto'||k==='scroll');}return function(j){if(!j)return null;while(j!==document.body){if(i(j,'overflow')||i(j,'overflowY')||i(j,'overflowX'))return j;j=j.parentNode;}return window;};})()});f.exports=a;},3);
__d("AsyncDOM",["css","dom","onload"],function(f,h,i,g,e){var b=h("css");var c=h("dom");var d=h("onload");var a={invoke:function(o,q){for(var m=0;m<o.length;++m){var n=o[m];var j=n[0];var r=n[1];var p=n[2];var k=n[3];var l=(p&&q)||null;if(r)l=c.scry(l||document.documentElement,r)[0];switch(j){case 'eval':(new Function(k)).apply(l);break;case 'hide':b.hide(l);break;case 'show':b.show(l);break;case 'setContent':c.setContent(l,k);break;case 'appendContent':c.appendContent(l,k);break;case 'prependContent':c.prependContent(l,k);break;case 'insertAfter':c.insertAfter(l,k);break;case 'insertBefore':c.insertBefore(k,l);break;case 'remove':c.remove(l);break;case 'replace':c.replace(l,k);break;default:}}}};g.exports=a;});
__d("AsyncResponse",["Env","copyProperties","tx"],function(e,g,h,f,d){var b=g("Env");var c=g("copyProperties");e.tx=g("tx");function a(j,i){c(this,{error:0,errorSummary:null,errorDescription:null,onload:null,replay:false,payload:i||null,request:j||null,silentError:false,is_last:true});return this;}c(a,{defaultErrorHandler:function(j){try{if(!j.silentError){a.verboseErrorHandler(j);}else j.logErrorByGroup('silent',10);}catch(i){alert(j);}},verboseErrorHandler:function(j){try{var summary=j.getErrorSummary();var desc=j.getErrorDescription();j.logErrorByGroup('popup',10);if(j.silentError&&desc=='')desc="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";Bootloader.loadComponents('dialog',function(){new Dialog().setTitle(summary).setBody(desc).setButtons([Dialog.OK]).setModal(true).setCausalElement(this.relativeTo).show();});}catch(i){alert(j);}}});c(a.prototype,{getRequest:function(){return this.request;},getPayload:function(){return this.payload;},getError:function(){return this.error;},getErrorSummary:function(){return this.errorSummary;},setErrorSummary:function(i){i=(i===undefined?null:i);this.errorSummary=i;return this;},getErrorDescription:function(){return this.errorDescription;},getErrorIsWarning:function(){return this.errorIsWarning;},logError:function(i,k){if(window.send_error_signal){var j={err_code:this.error,vip:(b.vip||'-')};if(k!==undefined){j.duration=k.duration;j.xfb_ip=k.xfb_ip;}var l=this.request.getURI();j.path=l||'-';j.aid=this.request.userActionID;if(l&&l.indexOf('scribe_endpoint.php')!=-1)i='async_error_double';send_error_signal(i,JSON.stringify(j));}},logErrorByGroup:function(j,i){if(Math.floor(Math.random()*i)==0)if(this.error==1357010||this.error<15000){this.logError('async_error_oops_'+j);}else this.logError('async_error_logic_'+j);}});f.exports=a;});
__d("Cookie",["Env"],function(d,f,g,e,c){var b=f("Env");var a={set:function(h,i,k,l,m){if(b.no_cookies&&h!='tpa')return;var j;if(k){var n=new Date();j=new Date();j.setTime(n.getTime()+k);}document.cookie=h+"="+encodeURIComponent(i)+"; "+(k?"expires="+j.toGMTString()+"; ":"")+"path="+(l||'/')+"; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1')+(m?"; secure":"");},clear:function(h){document.cookie=h+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; "+"path=/; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1');},get:function(k){var l=k+"=";var i=document.cookie.split(';');for(var j=0;j<i.length;j++){var h=i[j];while(h.charAt(0)==' ')h=h.substring(1,h.length);if(h.indexOf(l)===0)return decodeURIComponent(h.substring(l.length,h.length));}return null;}};e.exports=a;});
__d("URI",["copyProperties"],function(d,f,g,e,c){var b=f("copyProperties");function a(h){if(!(this instanceof a))return new a(h||window.location.href);this.parse(h||'');}b(a,{getRequestURI:function(h,i){h=h===undefined||h;if(h&&window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getCurrentURI(!!i).getQualifiedURI();}else return new a(window.location.href);},getMostRecentURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getMostRecentURI().getQualifiedURI();}else return new a(window.location.href);},getNextURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getNextURI().getQualifiedURI();}else return new a(window.location.href);},expression:/(((\w+):\/\/)([^\/:]*)(:(\d+))?)?([^#?]*)(\?([^#]*))?(#(.*))?/,arrayQueryExpression:/^(\w+)((?:\[\w*\])+)=?(.*)/,explodeQuery:function(n){if(!n)return {};var o={};n=n.replace(/%5B/ig,'[').replace(/%5D/ig,']');n=n.split('&');for(var i=0,k=n.length;i<k;i++){var l=n[i].match(a.arrayQueryExpression);if(!l){var q=n[i].split('=');o[a.decodeComponent(q[0])]=q[1]===undefined?null:a.decodeComponent(q[1]);}else{var j=l[2].split(/\]\[|\[|\]/).slice(0,-1);var m=l[1];var r=a.decodeComponent(l[3]||'');j[0]=m;var p=o;for(var h=0;h<j.length-1;h++)if(j[h]){if(p[j[h]]===undefined)if(j[h+1]&&!j[h+1].match(/^\d+$/)){p[j[h]]={};}else p[j[h]]=[];p=p[j[h]];}else{if(j[h+1]&&!j[h+1].match(/^\d+$/)){p.push({});}else p.push([]);p=p[p.length-1];}if(p instanceof Array&&j[j.length-1]===''){p.push(r);}else p[j[j.length-1]]=r;}}return o;},implodeQuery:function(m,l,h){l=l||'';if(h===undefined)h=true;var n=[];if(m===null||m===undefined){n.push(h?a.encodeComponent(l):l);}else if(m instanceof Array){for(var j=0;j<m.length;++j)try{if(m[j]!==undefined)n.push(a.implodeQuery(m[j],l?(l+'['+j+']'):j));}catch(i){}}else if(typeof(m)=='object'){if(('nodeName' in m)&&('nodeType' in m)){n.push('{node}');}else for(var k in m)try{if(m[k]!==undefined)n.push(a.implodeQuery(m[k],l?(l+'['+k+']'):k));}catch(i){}}else if(h){n.push(a.encodeComponent(l)+'='+a.encodeComponent(m));}else n.push(l+'='+m);return n.join('&');},encodeComponent:function(k){var j=String(k).split(/([\[\]])/);for(var h=0,i=j.length;h<i;h+=2)j[h]=encodeURIComponent(j[h]);return j.join('');},decodeComponent:function(h){return decodeURIComponent(h.replace(/\+/g,' '));},INVALID_DOMAIN:'invalid.invalid',sanitizeDomain:function(h){var i=new RegExp('[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f'+'\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF'+'\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]');if(i.test(h)){return a.INVALID_DOMAIN;}else return h;}});b(a.prototype,{parse:function(i){var h=i.toString().match(a.expression);b(this,{protocol:h[3]||'',domain:a.sanitizeDomain(h[4]||''),port:h[6]||'',path:h[7]||'',query_s:h[9]||'',fragment:h[11]||''});return this;},setProtocol:function(h){this.protocol=h;return this;},getProtocol:function(){return this.protocol;},setQueryData:function(h){this.query_s=a.implodeQuery(h);return this;},addQueryData:function(h){return this.setQueryData(b(this.getQueryData(),h));},removeQueryData:function(i){if(!(i instanceof Array))i=[i];var k=this.getQueryData();for(var h=0,j=i.length;h<j;++h)delete k[i[h]];return this.setQueryData(k);},getQueryData:function(){return a.explodeQuery(this.query_s);},setFragment:function(h){this.fragment=h;return this;},getFragment:function(){return this.fragment;},setDomain:function(h){this.domain=a.sanitizeDomain(h);return this;},getDomain:function(){return this.domain;},setPort:function(h){this.port=h;return this;},getPort:function(){return this.port;},setPath:function(h){this.path=h;return this;},getPath:function(){return this.path.replace(/^\/+/,'/');},isEmpty:function(){return !(this.path||this.protocol||this.domain||this.port||this.query_s||this.fragment);},toString:function(){var h='';this.protocol&&(h+=this.protocol+'://');this.domain&&(h+=this.domain);this.port&&(h+=':'+this.port);if(this.domain&&!this.path)h+='/';this.path&&(h+=this.path);this.query_s&&(h+='?'+this.query_s);this.fragment&&(h+='#'+this.fragment);return h;},valueOf:function(){return this.toString();},isFacebookURI:function(){if(!a._facebookURIRegex)a._facebookURIRegex=new RegExp('(^|\\.)facebook\\.com([^.]*)$','i');return (!this.domain||a._facebookURIRegex.test(this.domain));},isQuicklingEnabled:function(){return window.Quickling&&Quickling.isActive()&&Quickling.isPageActive(this);},getRegisteredDomain:function(){if(!this.domain)return '';if(!this.isFacebookURI())return null;var i=this.domain.split('.');var h=i.indexOf('facebook');return i.slice(h).join('.');},getUnqualifiedURI:function(){return new a(this).setProtocol(null).setDomain(null).setPort(null);},getQualifiedURI:function(){var i=new a(this);if(!i.getDomain()){var h=a();i.setProtocol(h.getProtocol()).setDomain(h.getDomain()).setPort(h.getPort());}return i;},isSameOrigin:function(h){var i=h||window.location.href;if(!(i instanceof a))i=new a(i.toString());if(this.getProtocol()&&this.getProtocol()!=i.getProtocol())return false;if(this.getDomain()&&this.getDomain()!=i.getDomain())return false;return true;},go:function(h){goURI(this,h);},setSubdomain:function(i){var j=new a(this).getQualifiedURI();var h=j.getDomain().split('.');if(h.length<=2){h.unshift(i);}else h[0]=i;return j.setDomain(h.join('.'));},getSubdomain:function(){if(!this.getDomain())return '';var h=this.getDomain().split('.');if(h.length<=2){return '';}else return h[0];},setSecure:function(h){return this.setProtocol(h?'https':'http');},isSecure:function(){return this.getProtocol()=='https';}});e.exports=a;});
__d("AsyncRequest",["array-extensions","event-extensions","json","Arbiter","AsyncDOM","AsyncResponse","bootloader","Cookie","css-core","dom","Env","JSCC","Parent","URI","Util","bind","copyProperties","evalGlobal","goURI","invokeCallbacks","isEmpty"],function(global,require,requireLazy,module,exports){require("array-extensions");require("event-extensions");require("json");var Arbiter=require("Arbiter");var AsyncDOM=require("AsyncDOM");var AsyncResponse=require("AsyncResponse");var Bootloader=require("bootloader");var Cookie=require("Cookie");var CSS=require("css-core");var DOM=require("dom");var Env=require("Env");var JSCC=require("JSCC");var Parent=require("Parent");var URI=require("URI");var Util=require("Util");var bind=require("bind");var copyProperties=require("copyProperties");var evalGlobal=require("evalGlobal");var goURI=require("goURI");var invokeCallbacks=require("invokeCallbacks");var isEmpty=require("isEmpty");function AsyncRequest(uri){var dispatchResponse=bind(this,function(asyncResponse){try{this.clearStatusIndicator();if(!this.isRelevant()){invokeErrorHandler(1010);return;}if(this.initialHandler(asyncResponse)!==false){clearTimeout(this.timer);if(asyncResponse.jscc_map){var jscc_map=eval(asyncResponse.jscc_map);JSCC.init(jscc_map);}if(this.handler)try{var suppress_onload=this.handler(asyncResponse);}catch(exception){asyncResponse.is_last&&this.finallyHandler(asyncResponse);throw exception;}if(suppress_onload!==AsyncRequest.suppressOnloadToken){var domOps=asyncResponse.domops;if(domOps)AsyncDOM.invoke(domOps,this.getRelativeTo());asyncResponse.jscalls&&invokeCallbacks([asyncResponse.jscalls]);var onload=asyncResponse.onload;if(onload)for(var ii=0;ii<onload.length;ii++)try{(new Function(onload[ii])).apply(this);}catch(exception){}if(this.lid)Arbiter.inform('tti_ajax',{s:this.lid,d:[this._sendTimeStamp||0,(this._sendTimeStamp&&this._responseTime)?(this._responseTime-this._sendTimeStamp):0]},Arbiter.BEHAVIOR_EVENT);var onafterload=asyncResponse.onafterload;if(onafterload)for(var ii=0;ii<onafterload.length;ii++)try{(new Function(onafterload[ii])).apply(this);}catch(exception){}}asyncResponse.is_last&&this.finallyHandler(asyncResponse);}}catch(exception){}});var dispatchErrorResponse=bind(this,function(asyncResponse,isTransport){try{this.clearStatusIndicator();var async_error=asyncResponse.getError();if(this._sendTimeStamp){var _duration=Date.now()-this._sendTimeStamp;var xfb_ip=this._xFbServer||'-';asyncResponse.logError('async_error',{duration:_duration,xfb_ip:xfb_ip});}else asyncResponse.logError('async_error');if((!this.isRelevant())||async_error===1010)return;if(async_error==1357008||async_error==1357007||async_error==1442002||async_error==1357001){var is_confirmation=false;if(async_error==1357008||async_error==1357007)is_confirmation=true;var payload=asyncResponse.getPayload();this._displayServerDialog(payload.__dialog,is_confirmation);}else if(this.initialHandler(asyncResponse)!==false){clearTimeout(this.timer);try{if(isTransport){this.transportErrorHandler(asyncResponse);}else this.errorHandler(asyncResponse);}catch(exception){this.finallyHandler(asyncResponse);throw exception;}this.finallyHandler(asyncResponse);}}catch(exception){}});var _interpretTransportResponse=bind(this,function(){if(this.getOption('suppressEvaluation')){var r=new AsyncResponse(this,this.transport);return {asyncResponse:r};}var _sendError=function(p,error_code,str){if(!window.send_error_signal)return;if(this._xFbServer){error_code='1008_'+error_code;}else error_code='1012_'+error_code;send_error_signal('async_xport_resp',error_code+':'+(this._xFbServer||'-')+':'+p.getURI()+':'+str.length+':'+str.substr(0,1600));};var shield="for (;;);";var shieldlen=shield.length;var text=this.transport.responseText;if(text.length<=shieldlen){_sendError(this,'empty',text);return {transportError:'Response too short on async to '+this.getURI()};}var offset=0;while(text.charAt(offset)==" "||text.charAt(offset)=="\n")offset++;offset&&text.substring(offset,offset+shieldlen)==shield;var safeResponse=text.substring(offset+shieldlen);try{var response=eval('('+safeResponse+')');}catch(exception){_sendError(this,'excep',text);return {transportError:'eval() failed on async to '+this.getURI()};}return interpretResponse(response);});var interpretResponse=bind(this,function(response){if(response.redirect)return {redirect:response.redirect};var r=new AsyncResponse(this);if(response.__ar!=1){r.payload=response;}else{copyProperties(r,response);if(response.tplts)if(window.DynaTemplate)DynaTemplate.registerTemplates(response.tplts);}return {asyncResponse:r};});var invokeResponseHandler=bind(this,function(interp){if(typeof(interp.redirect)!='undefined'){(function(){this.setURI(interp.redirect).send();}).bind(this).defer();return;}if(this.handler||this.errorHandler||this.transportErrorHandler)if(typeof(interp.asyncResponse)!='undefined'){var r=interp.asyncResponse;if(!this.isRelevant()){invokeErrorHandler(1010);return;}if(r.inlinejs)evalGlobal(r.inlinejs);if(r.lid){this._responseTime=Date.now();if(window.CavalryLogger)this.cavalry=CavalryLogger.getInstance(r.lid);this.lid=r.lid;}if(r.getError()&&!r.getErrorIsWarning()){var fn=dispatchErrorResponse;}else var fn=dispatchResponse;Bootloader.setResourceMap(r.resource_map);if(r.bootloadable)Bootloader.enableBootload(r.bootloadable);fn=fn.shield(null,r);fn=fn.defer.bind(fn);var is_transitional=false;if(this.preBootloadHandler)is_transitional=this.preBootloadHandler(r);r.css=r.css||[];r.js=r.js||[];Bootloader.loadResources(r.css.concat(r.js),fn,is_transitional,this.getURI());}else if(typeof(interp.transportError)!='undefined'){if(this._xFbServer){invokeErrorHandler(1008);}else invokeErrorHandler(1012);}else invokeErrorHandler(1007);});var invokeErrorHandler=bind(this,function(explicitError){try{if(!window.loaded&&!this.getOption('handleErrorAfterUnload'))return;}catch(ex){return;}var r=new AsyncResponse(this);var err;try{err=explicitError||this.transport.status||1004;}catch(ex){err=1005;}if(this._requestAborted)err=1011;try{if(this.responseText=='')err=1002;}catch(ignore){}if(this.transportErrorHandler){var desc,summary;var silent=true;if(false===navigator.onLine){summary="No Network Connection";desc="Your browser appears to be offline. Please check your internet connection and try again.";err=1006;}else if(err>=300&&err<=399){summary="Redirection";desc="Your access to Facebook was redirected or blocked by a third party at this time, please contact your ISP or reload. ";redir_url=this.transport.getResponseHeader("Location");if(redir_url)goURI(redir_url,true);silent=true;}else{summary="Oops!";desc="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";}!this.getOption('suppressErrorAlerts');copyProperties(r,{error:err,errorSummary:summary,errorDescription:desc,silentError:silent});dispatchErrorResponse(r,true);}});var handleResponse=function(response){var asyncResponse=this.interpretResponse(response);this.invokeResponseHandler(asyncResponse);};var onStateChange=function(){try{if(this.transport.readyState==4){AsyncRequest._inflightPurge();try{if(typeof(this.transport.getResponseHeader)!='undefined'&&this.transport.getResponseHeader('X-FB-Debug'))this._xFbServer=this.transport.getResponseHeader('X-FB-Debug');}catch(ex){}if(this.transport.status>=200&&this.transport.status<300){AsyncRequest.lastSuccessTime=Date.now();invokeResponseHandler(_interpretTransportResponse());}else if(ua.safari()&&(typeof(this.transport.status)=='undefined')){invokeErrorHandler(1002);}else if(window.Env&&window.Env.retry_ajax_on_network_error&&this.transport.status in {0:1,12029:1,12030:1,12031:1,12152:1}&&this.remainingRetries>0){--this.remainingRetries;delete this.transport;this.send(true);return;}else invokeErrorHandler();if(this.getOption('asynchronous')!==false)delete this.transport;}}catch(exception){try{if(!window.loaded)return;}catch(ex){return;}delete this.transport;if(this.remainingRetries>0){--this.remainingRetries;this.send(true);}else{!this.getOption('suppressErrorAlerts');if(window.send_error_signal)send_error_signal('async_xport_resp','1007:'+(this._xFbServer||'-')+':'+this.getURI()+':'+exception.message);invokeErrorHandler(1007);}}};var onJSONPResponse=function(data,more_chunked_response){var is_first=(this.is_first===undefined);this.is_first=is_first;if(this.transportIframe&&!more_chunked_response){if(this.cavalry)this.cavalry.collectBrowserTiming(this.transportIframe.contentWindow);(function(x){document.body.removeChild(x);}).bind(null,this.transportIframe).defer();}if(ua.ie()>=9&&window.JSON)data=window.JSON.parse(window.JSON.stringify(data));var r=this.interpretResponse(data);r.asyncResponse.is_first=is_first;r.asyncResponse.is_last=!more_chunked_response;this.invokeResponseHandler(r);return more_chunked_response;};copyProperties(this,{onstatechange:onStateChange,onjsonpresponse:onJSONPResponse,invokeResponseHandler:invokeResponseHandler,interpretResponse:interpretResponse,handleResponse:handleResponse,transport:null,method:'POST',uri:'',timeout:null,timer:null,initialHandler:bagofholding,handler:null,errorHandler:null,transportErrorHandler:null,timeoutHandler:null,finallyHandler:bagofholding,serverDialogCancelHandler:bagofholding,relativeTo:null,statusElement:null,statusClass:'',data:{},file:null,context:{},readOnly:false,writeRequiredParams:['post_form_id'],remainingRetries:0,option:{asynchronous:true,suppressErrorHandlerWarning:false,suppressEvaluation:false,suppressErrorAlerts:false,retries:0,jsonp:false,bundle:false,useIframeTransport:false,tfbEndpoint:true,handleErrorAfterUnload:false},userActionID:'-'});this.errorHandler=AsyncResponse.defaultErrorHandler;this.transportErrorHandler=bind(this,'errorHandler');if(uri!=undefined)this.setURI(uri);return this;}Arbiter.subscribe("page_transition",function(type,message){AsyncRequest._id_threshold=message.id;});copyProperties(AsyncRequest,{receiveJSONPResponse:function(id,data,more_chunked_response){if(this._JSONPReceivers[id]){if(!this._JSONPReceivers[id](data,more_chunked_response))delete this._JSONPReceivers[id];}else if(window.logJSError&&!more_chunked_response){var uri=(data.payload&&data.payload.uri)||'';logJSError('ajax',{error:'UnexpectedJsonResponse',extra:{id:id,uri:uri}});}},_bundleRequest:function(request){if(request.getOption('jsonp')||request.getOption('useIframeTransport')){request.setOption('bundle',false);return false;}else if(!request.uri.isFacebookURI()){request.setOption('bundle',false);return false;}else if(!request.getOption('asynchronous')){request.setOption('bundle',false);return false;}var path=request.uri.getPath();if(!AsyncRequest._bundleTimer)AsyncRequest._bundleTimer=setTimeout(function(){AsyncRequest._sendBundledRequests();},0);AsyncRequest._allBundledRequests.push([path,request]);return true;},_sendBundledRequests:function(){clearTimeout(AsyncRequest._bundleTimer);AsyncRequest._bundleTimer=null;var bundled_requests=AsyncRequest._allBundledRequests;AsyncRequest._allBundledRequests=[];if(bundled_requests.length==1){var request=bundled_requests[0][1];request.setOption('bundle',false).send();return request;}if(bundled_requests.length===0)return null;var data=[];for(var ii=0;ii<bundled_requests.length;ii++)data.push([bundled_requests[ii][0],URI.implodeQuery(bundled_requests[ii][1].data)]);var query_data={data:data};var request=new AsyncRequest();request.setURI('/ajax/proxy.php').setData(query_data).setMethod('POST').setInitialHandler(bagof(true)).setAllowCrossPageTransition(true).setHandler(function(r){var payload=r.getPayload();var responses=payload.responses;if(responses.length!=bundled_requests.length){return;}else for(var ii=0;ii<bundled_requests.length;ii++){var path=bundled_requests[ii][0];var request=bundled_requests[ii][1];request.id=this.id;if(responses[ii][0]!=path){request.invokeResponseHandler({transportError:'Wrong response order in bundled request to '+path});continue;}var asyncResponse=request.interpretResponse(responses[ii][1]);request.invokeResponseHandler(asyncResponse);}}).setTransportErrorHandler(function(response){var paths=[];var interp={transportError:response.errorDescription};for(var ii=0;ii<bundled_requests.length;ii++){var path=bundled_requests[ii][0];var request=bundled_requests[ii][1];paths.push(path);request.id=this.id;request.invokeResponseHandler(interp);}}).send();return request;},bootstrap:function(href,elem,is_post){var method='GET';var readonly=true;var data={};if(is_post||elem&&(elem.rel=='async-post'||elem.getAttribute&&elem.getAttribute('forcemethod')=='post')){method='POST';readonly=false;if(href){href=URI(href);data=href.getQueryData();href.setQueryData({});}}var status_elem=Parent.byClass(elem,'stat_elem')||elem;if(status_elem&&CSS.hasClass(status_elem,'async_saving'))return false;var async=new AsyncRequest(href).setReadOnly(readonly).setMethod(method).setData(data).setNectarModuleDataSafe(elem).setRelativeTo(elem).setHandler(function(response){Event.fire(elem,'success',{response:response});}).setErrorHandler(function(response){if(Event.fire(elem,'error',{response:response})!==false)AsyncResponse.defaultErrorHandler(response);});if(status_elem){async.setStatusElement(status_elem);var status_class=status_elem.getAttribute('data-status-class');status_class&&async.setStatusClass(status_class);}async.send();return false;},post:function(href,data){new AsyncRequest(href).setReadOnly(false).setMethod('POST').setData(data).send();return false;},getLastId:function(){return AsyncRequest._last_id;},_JSONPReceivers:{},_allBundledRequests:[],_bundleTimer:null,suppressOnloadToken:{},_last_id:2,_id_threshold:2,_inflight:[],_inflightAdd:bagofholding,_inflightPurge:bagofholding,_inflightEnable:function(){if(ua.ie()){copyProperties(AsyncRequest,{_inflightAdd:function(ar){this._inflight.push(ar);},_inflightPurge:function(){AsyncRequest._inflight=AsyncRequest._inflight.filter(function(ar){return ar.transport&&ar.transport.readyState<4;});}});onunloadRegister(function(){AsyncRequest._inflight.each(function(ar){if(ar.transport&&ar.transport.readyState<4){ar.transport.abort();delete ar.transport;}});});}}});copyProperties(AsyncRequest.prototype,{setMethod:function(m){this.method=m.toString().toUpperCase();return this;},getMethod:function(){return this.method;},setData:function(obj){this.data=obj;return this;},_setDataHash:function(){if(this.method!='POST'||!this.getOption('tfbEndpoint')||this.data.phstamp)return;var input_len=URI.implodeQuery(this.data).length;var numeric_csrf_value='';for(var ii=0;ii<this.data.fb_dtsg.length;ii++)numeric_csrf_value+=this.data.fb_dtsg.charCodeAt(ii);this.data.phstamp='1'+numeric_csrf_value+input_len;},setFile:function(file){this.file=file;return this;},getData:function(){return this.data;},setContextData:function(key,value,enabled){enabled=enabled===undefined?true:enabled;if(enabled)this.context['_log_'+key]=value;return this;},_setUserActionID:function(){var ue=window.ArbiterMonitor&&ArbiterMonitor.getUE()||'-';this.userActionID=(window.EagleEye&&EagleEye.getSessionID()||'-')+'/'+ue;},setURI:function(uri){var uri_obj=URI(uri);if(this.getOption('useIframeTransport')&&!uri_obj.isFacebookURI())return this;if(!this.getOption('jsonp')&&!this.getOption('useIframeTransport')&&!uri_obj.isSameOrigin())return this;this._setUserActionID();if(!uri||uri_obj.isEmpty()){if(window.send_error_signal&&window.get_error_stack){var data={err_code:1013,vip:'-',duration:0,xfb_ip:'-',path:window.location.href,aid:this.userActionID};send_error_signal('async_error',JSON.stringify(data));send_error_signal('async_xport_stack','1013:'+window.location.href+'::'+get_error_stack());}return this;}this.uri=uri_obj;return this;},getURI:function(){return this.uri.toString();},setInitialHandler:function(fn){this.initialHandler=fn;return this;},setHandler:function(fn){if(!(typeof(fn)!='function'))this.handler=fn;return this;},getHandler:function(){return this.handler;},setErrorHandler:function(fn){if(!(typeof(fn)!='function'))this.errorHandler=fn;return this;},setTransportErrorHandler:function(fn){this.transportErrorHandler=fn;return this;},getErrorHandler:function(){return this.errorHandler;},getTransportErrorHandler:function(){return this.transportErrorHandler;},setTimeoutHandler:function(timeout,fn){if(!(typeof(fn)!='function')){this.timeout=timeout;this.timeoutHandler=fn;}return this;},resetTimeout:function(timeout){if(!(this.timeoutHandler===null))if(timeout===null){this.timeout=null;clearTimeout(this.timer);this.timer=null;}else{var clear_on_quickling_event=!this._allowCrossPageTransition;this.timeout=timeout;clearTimeout(this.timer);this.timer=this._handleTimeout.bind(this).defer(this.timeout,clear_on_quickling_event);}return this;},_handleTimeout:function(){this.abandon();this.timeoutHandler(this);},setNewSerial:function(){this.id=++AsyncRequest._last_id;return this;},setFinallyHandler:function(fn){this.finallyHandler=fn;return this;},setServerDialogCancelHandler:function(fn){this.serverDialogCancelHandler=fn;return this;},setPreBootloadHandler:function(fn){this.preBootloadHandler=fn;return this;},setReadOnly:function(readOnly){if(!(typeof(readOnly)!='boolean'))this.readOnly=readOnly;return this;},setFBMLForm:function(){this.writeRequiredParams=["fb_sig"];return this;},getReadOnly:function(){return this.readOnly;},setRelativeTo:function(element){this.relativeTo=element;return this;},getRelativeTo:function(){return this.relativeTo;},setStatusClass:function(c){this.statusClass=c;return this;},setStatusElement:function(element){this.statusElement=element;return this;},getStatusElement:function(){return ge(this.statusElement);},isRelevant:function(){if(this._allowCrossPageTransition)return true;if(!this.id)return true;return this.id>AsyncRequest._id_threshold;},clearStatusIndicator:function(){var statusElem=this.getStatusElement();if(statusElem){CSS.removeClass(statusElem,'async_saving');CSS.removeClass(statusElem,this.statusClass);}},addStatusIndicator:function(){var statusElem=this.getStatusElement();if(statusElem){CSS.addClass(statusElem,'async_saving');CSS.addClass(statusElem,this.statusClass);}},specifiesWriteRequiredParams:function(){return this.writeRequiredParams.every(function(param){this.data[param]=this.data[param]||Env[param]||(ge(param)||{}).value;if(this.data[param]!==undefined)return true;return false;},this);},setOption:function(opt,v){if(typeof(this.option[opt])!='undefined')this.option[opt]=v;return this;},getOption:function(opt){typeof(this.option[opt])=='undefined';return this.option[opt];},abort:function(){if(this.transport){var old_handler=this.getTransportErrorHandler();this.setOption('suppressErrorAlerts',true);this.setTransportErrorHandler(bagofholding);this._requestAborted=1;this.transport.abort();this.setTransportErrorHandler(old_handler);}},abandon:function(){clearTimeout(this.timer);this.setOption('suppressErrorAlerts',true).setHandler(bagofholding).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding);if(this.transport){this._requestAborted=1;this.transport.abort();}},setNectarData:function(nctrParams){if(nctrParams){if(this.data.nctr===undefined)this.data.nctr={};copyProperties(this.data.nctr,nctrParams);}return this;},setNectarModuleDataSafe:function(elem){if(this.setNectarModuleData)this.setNectarModuleData(elem);return this;},setNectarImpressionIdSafe:function(){if(this.setNectarImpressionId)this.setNectarImpressionId();return this;},setAllowCrossPageTransition:function(allow){this._allowCrossPageTransition=!!allow;if(this.timer)this.resetTimeout(this.timeout);return this;},send:function(isRetry){isRetry=isRetry||false;if(!this.uri)return false;!this.errorHandler&&!this.getOption('suppressErrorHandlerWarning');if(this.getOption('jsonp')&&this.method!='GET')this.setMethod('GET');if(this.getOption('useIframeTransport')&&this.method!='GET')this.setMethod('GET');this.timeoutHandler!==null&&(this.getOption('jsonp')||this.getOption('useIframeTransport'));if(!this.getReadOnly()){this.specifiesWriteRequiredParams();if(this.method!='POST')return false;}if(this.method=='POST'&&this.getOption('tfbEndpoint')){this.data.fb_dtsg=Env.fb_dtsg;this.data.lsd=Cookie.get('lsd');}if(!isEmpty(this.context)&&this.getOption('tfbEndpoint')){copyProperties(this.data,this.context);this.data.ajax_log=1;}if(window.Env&&Env.force_param)copyProperties(this.data,Env.force_param);if(!this.getReadOnly()&&this.getOption('tfbEndpoint')&&this.method=='POST'&&this.data.post_form_id_source===undefined)this.data.post_form_id_source='AsyncRequest';if(window.Env)this.data.__user=Env.user;this._setUserActionID();if(this.getOption('bundle')&&AsyncRequest._bundleRequest(this))return true;this.setNewSerial();if(this.getOption('tfbEndpoint')){this.uri.addQueryData({__a:1});if(!this.getOption('asynchronous'))this.uri.addQueryData({__s:1});if(Env.fb_isb)this.uri.addQueryData({fb_isb:Env.fb_isb});}this.finallyHandler=async_callback(this.finallyHandler,'final');var uri_str,query;if(this.method=='GET'||this.file){uri_str=this.uri.addQueryData(this.data).toString();query='';}else{uri_str=this.uri.toString();this._setDataHash();query=URI.implodeQuery(this.data);}if(this.getOption('jsonp')||this.getOption('useIframeTransport')){uri_str=this.uri.addQueryData({__a:this.id}).toString();AsyncRequest._JSONPReceivers[this.id]=async_callback(bind(this,'onjsonpresponse'),'json');if(this.getOption('jsonp')){(function(){document.body.appendChild($N('script',{src:uri_str,type:"text/javascript"}));}).bind(this).defer();}else{var style={position:'absolute',top:'-9999999px',width:'80px',height:'80px'};this.transportIframe=$N('iframe',{src:"javascript:''",style:style});document.body.appendChild(this.transportIframe);this.transportIframe.src=uri_str;}return true;}if(this.transport)return false;var transport=null;try{transport=new XMLHttpRequest();}catch(ignored){}if(!transport)try{transport=new ActiveXObject("Msxml2.XMLHTTP");}catch(ignored){}if(!transport)try{transport=new ActiveXObject("Microsoft.XMLHTTP");}catch(ignored){}if(!transport)return false;transport.onreadystatechange=async_callback(bind(this,'onstatechange'),'xhr');if(!isRetry)this.remainingRetries=this.getOption('retries');if(window.send_error_signal||window.ArbiterMonitor)this._sendTimeStamp=this._sendTimeStamp||Date.now();this.transport=transport;try{this.transport.open(this.method,uri_str,this.getOption('asynchronous'));}catch(ex){return false;}var svn_rev=Env.svn_rev;if(svn_rev)this.transport.setRequestHeader('X-SVN-Rev',String(svn_rev));if(this.method=='POST')this.transport.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.addStatusIndicator();query=this.file||query;this.transport.send(query);if(this.timeout!==null)this.resetTimeout(this.timeout);AsyncRequest._inflightAdd(this);return true;},_displayServerDialog:function(model,is_confirmation){Bootloader.loadComponents('dialog',function(){var dialog=new Dialog(model);if(is_confirmation)dialog.setHandler(this._displayConfirmationHandler.bind(this,dialog));dialog.setCancelHandler(function(){this.serverDialogCancelHandler.apply(this,arguments);this.finallyHandler.apply(this,arguments);}.bind(this)).setCausalElement(this.relativeTo).setCloseHandler(this.finallyHandler.bind(this)).show();}.bind(this));},_displayConfirmationHandler:function(dialog){this.data.confirmed=1;copyProperties(this.data,dialog.getFormData());this.send();}});module.exports=AsyncRequest;});
__d("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
__d("legacy:data-store",["DataStore"],function(a,b,c){a.DataStore=a.DataStore||b('DataStore');},3);
function EmuController(a,b){this.impression=b;this.containerId=a;DataStore.set($(a),'emuController',this);return this;}copy_properties(EmuController,{fromContainer:function(a){var b=ge(a);if(!b)return null;return DataStore.get(b,'emuController');},getEventClass:function(a){return "emuEvent"+String(a).trim();}});copy_properties(EmuController.prototype,{EVENT_HANDLER_PATH:'/ajax/emu/end.php',CLICK:1,FAN:"fad_fan",event:function(c,b,d,a){var e={eid:this.impression,f:0,ui:this.containerId,en:c,a:1};if(b)e.ed=JSON.stringify(b);if(!a)var a=bagofholding;var f=new AsyncRequest().setURI(this.EVENT_HANDLER_PATH).setData(e).setErrorHandler(a);if(d)f.setHandler(d);f.send();},redirect:function(){var a={eid:this.impression,f:0,ui:this.containerId,en:this.CLICK,a:0,sig:Math.floor(Math.random()*65535)+65536};var b=new URI(this.EVENT_HANDLER_PATH);b.setQueryData(a);goURI(b);}});
var ShortClickHandlers={EVENT_NAME_CAME_BACK:'cameback',onclicked:function(a){if(this.onsite)return;if(a.button!==0||a.getModifiers().any)return;this.click_ts=(+new Date());if(this.listeners!==undefined)for(var b in this.listeners)this.listeners[b].remove();this.listeners={focus:Event.listen(window,'focus',ShortClickHandlers.oncameback.bind(this))};},oncameback:function(c){var b=(+new Date())-this.click_ts;this.listeners[c.type].remove();var a={click_ts:this.click_ts,length:b,trigger:c.type};this.sendData(ShortClickHandlers.EVENT_NAME_CAME_BACK,a);}};
function EmuTracker(a,c){this.base=EmuController.fromContainer(a);!this.base;this.onsite=c;var b=DOM.scry($(a),"a."+EmuController.getEventClass(EmuTracker.EVENT_CLICK));b.each(function(d){Event.listen(d,'click',ShortClickHandlers.onclicked.bind(this));}.bind(this));return this;}copy_properties(EmuTracker,{EVENT_CLICK:1});copy_properties(EmuTracker.prototype,{sendData:function(b,a){this.base.event(b,a);}});
__d("Keys",[],function(c,e,f,d,b){var a={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188};d.exports=a;});
__d("AjaxRequest",["array-extensions","json","SystemEvents","ua","URI","Keys"],function(h,j,k,i,g){j('array-extensions');j('json');var c=j('SystemEvents');var l=j('ua');var d=j('URI');var b=j('Keys');function a(m,o,n){if(window.XMLHttpRequest){this.xhr=new XMLHttpRequest();}else if(window.ActiveXObject)this.xhr=new ActiveXObject('MSXML2.XMLHTTP.3.0');if(!(o instanceof d))o=new d(o);if(n&&m=='GET'){o.setQueryData(n);}else this._params=n;this.method=m;this.uri=o;this.xhr.open(m,o);}a.corsEnabled=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());a.ERROR='ar:error';a.TIMEOUT='ar:timeout';a.PROXY_ERROR='ar:proxy error';a.TRANSPORT_ERROR='ar:transport error';a.SERVER_ERROR='ar:http error';a.PARSE_ERROR='ar:parse error';a._inflight=[];function e(){var m=a._inflight;a._inflight=[];m.each(function(n){n.abort();});}function f(m){m.onResponse=m.onError=m.onSuccess=null;clearTimeout(m._timer);if(m.xhr&&m.xhr.readyState<4){m.xhr.abort();m.xhr=null;}a._inflight=a._inflight.filter(function(n){return n&&n!=m&&n.xhr&&n.xhr.readyState<4;});}a.prototype={timeout:60000,prelude:/^for \(;;\);/,_call:function(m,n){if(this[m])this[m](this);},_parseStatus:function(){var o,n;try{o=this.xhr.status;n=this.xhr.statusText;}catch(m){this.errorType=a.TRANSPORT_ERROR;this.errorText=m+'';return;}if(o===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=a.TRANSPORT_ERROR;}else if(o>=100&&o<200){this.errorType=a.PROXY_ERROR;}else if(o>=200&&o<300){return;}else if(o>=300&&o<400){this.errorType=a.PROXY_ERROR;}else if(o>=400&&o<500){this.errorType=a.SERVER_ERROR;}else if(o>=500&&o<600){this.errorType=a.PROXY_ERROR;}else if(o==1223){return;}else if(o>=12001&&o<=12156){this.errorType=a.TRANSPORT_ERROR;}else{n='unrecognized status code: '+o;this.errorType=a.ERROR;}if(!this.errorType)this.errorText=n;},_parseContent:function(){var n;try{n=this.xhr.responseText||'';}catch(m){this.errorType=a.ERROR;this.errorText='responseText not available - '+m.message;}try{if(this.prelude){if(!this.prelude.test(n))throw new Error('Missing prelude - possible XSS vulnerability!)');n=n.replace(this.prelude,'');}this.json=JSON.parse(n);}catch(m){this.errorType=a.PARSE_ERROR;this.errorText='exception parsing JSON - '+m.message;}if(!this.errorType&&!this.json){this.errorType=a.PARSE_ERROR;this.errorText='empty JSON';}},_onReadyState:function(){if(!this.xhr||this.xhr.readyState<4)return;this._call('onResponse');this._parseStatus();if(!this.errorType)this._parseContent();this._call(!this.errorType?'onSuccess':'onError',true);f(this);},send:function(m){this.xhr.onreadystatechange=c.trapError(this._onReadyState.bind(this));var n=this.timeout;if(n)this._timer=setTimeout((function(){this.errorType=a.TIMEOUT;this.errorText='timeout after '+n+' ms';this._call('onError',true);f(this);}).bind(this),n,false);a._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.xhr.send(m?d.implodeQuery(m):'');},abort:function(){f(this);},toString:function(){var m='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)m+=' errorType='+this.errorType+' ('+this.errorText+')';return m+']';},toJSON:function(){return {json:this.json,errorType:this.errorType,errorText:this.errorText};}};if(window.addEventListener&&l.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===b.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',e);i.exports=a;});
__d("ChannelConstants",[],function(d,f,g,e,c){var a='presence/';var b={ON_SHUTDOWN:a+'shutdown',ON_INVALID_HISTORY:a+'invalid_history',ON_CONFIG:a+'config',ON_ENTER_STATE:a+'enter_state',ON_EXIT_STATE:a+'exit_state',OK:'ok',ERROR:'error',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_SHUTDOWN:'error_shutdown',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_DISABLED:'shutdown disabled',HINT_INVALID_STATE:'shutdown invalid state',HINT_MAINT:'shutdown maint',HINT_UNSUPPORTED:'shutdown unsupported',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,getArbiterType:function(h){return a+'message:'+h;}};e.exports=b;});
__d("DocRPC",["array-extensions","json"],function(c,e,f,d,b){e('array-extensions');e('json');var a={_apis:{},origin:location.origin||(location+'').replace(/([^:\/])\/.*/,'$1'),originFilter:/\.facebook\.com(:\d+)?$/,_init:function(){var g=function(event){event=event||window.event;var h=event.domain||event.origin;if(a.originFilter.test(h))a._dispatch(event.data);};if(window.postMessage)if(window.addEventListener){window.addEventListener('message',g,false);}else window.onmessage=g;this._init=function(){};},_dispatch:function(h){h=JSON.parse(h);var g=JSON.stringify(h.params);if(a._apis.hasOwnProperty(h.api)){var i=a._apis[h.api];if(i[h.method])i[h.method].apply(i,h.params);}},publish:function(h,g){a._init();a._apis[g]=h;},proxy:function(m,h,j,k){a._init();var l={_proxyId:Math.random().toString(36),_seq:0};function g(n){l[n]=function(){var p={api:h,method:n,params:Array.prototype.slice.call(arguments)};var o=JSON.stringify(p.params);p=JSON.stringify(p);if(m.postMessage){m.postMessage(p,k);}else if(m.DocRPC)m.DocRPC._dispatch(p);};}for(var i=0;i<j.length;i++)g(j[i]);return l;}};d.exports=c.DocRPC=a;},3);
__d("ChannelTransport",["copyProperties","bind","Util","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(q,s,t,r,o){var n=s('copyProperties');var l=s('bind');var j=s('Util');var a=s('AjaxRequest');var i=s('URI');var g=s('JSLogger');var d=s('DocRPC');var c=s('ChannelConstants');var k=g.create('channel');function m(){return (1048576*Math.random()|0).toString(36);}function p(w,x){var y=w.subdomain;y=y===null?'':(y+'-');var z=new i(x).setDomain(y+w.host+'.facebook.com').setPort(w.port).setSecure(i().isSecure());return z;}function u(x,z,y){var zc;var w=function(ze){if(zc){zc=null;return ze?z():y();}};var za={cb:m()};var zd=p(x,'/ping').setQueryData(za);var zb=new Image();zb.onload=w.bind(null,true);zb.onerror=w.bind(null,false);zc=setTimeout(zb.onerror,10000,false);zb.abort=function(){if(zc){clearTimeout(zc);zc=null;}zb.onload=zb.onerror=null;};zb.src=p(x,'/ping');return zb;}function v(w,z,y){var x=(new Date()-w.userActive)/1000|0;var za={channel:w.user_channel,seq:w.seq,clientid:w.sessionID,cb:m(),idle:x};if(x<60)za.state='active';var zc=p(w,'/pull').setQueryData(za);var zb=new a('GET',zc);if(a.corsEnabled)zb.xhr.withCredentials=true;zb.onSuccess=z;zb.onError=y;zb.send();return zb;}function h(w){this.manager=w;(this.init&&this.init());}function b(w){h.apply(this,arguments);}b.prototype={logName:'CORS',enterState:function(y,w){if(this._request){this._request.abort();this._request=null;}if(y=='init')setTimeout(l(this.manager,'exitState',{status:c.OK,stateId:w.stateId}),3000,false);if(!/pull|ping/.test(y))return;var x=this.manager;if(y=='ping'){this._request=u(w,l(x,'exitState',{status:c.OK,stateId:w.stateId}),l(x,'exitState',{status:c.ERROR,stateId:w.stateId}));}else if(y=='pull')this._request=v(w,l(x,'_processTransportData',w.stateId),l(x,'exitState',{status:c.ERROR,stateId:w.stateId}));}};function f(w){k.log('iframe_init_constructor');h.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);d.publish(this,'outerTransport');}f.prototype={logName:'iframe',_initIframe:function(w){k.log('iframe_init_start',w);window.onchanneliframeready=function(){k.log('iframe_resources');return w.resources;};window.onchanneliframeloaded=function(){k.log('iframe_loaded');};if(w){this._iframeURI=p(w,w.path);if(w.bustIframe)this._iframeURI.setQueryData({cb:m()});}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);k.log('iframe_uri_set');}catch(x){k.error('iframe_uri_set_error',x);this.exitState({status:c.ERROR,stateId:w.stateId},x+'');}},enterState:function(x,w){if(x=='init'){this._initIframe(w);}else if(/idle|ping|pull/.test(x)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(x!='idle')this.exitState({status:c.ERROR,stateId:w.stateId},'iframe not yet loaded');}else if(x=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(w){if(this.manager.state=='init'&&w.status==c.OK)this._iframeProxy=d.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}};function e(){this.init=this.init.bind(this);h.apply(this,arguments);}e.prototype={logName:'iframe(inner)',init:function(){d.publish(this,'innerTransport');try{var proxy=d.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);n(this,proxy);this.exitState({status:c.OK,stateId:1e+06});}catch(w){k.error('iframe_inner_init_error',w);}},enterState:function(x,w){if(this._request){this._request.abort();this._request=null;}if(x=='ping'){this._request=u(w,l(this,'exitState',{status:c.OK,stateId:w.stateId}),l(this,'exitState',{status:c.ERROR,stateId:w.stateId}));}else if(x=='pull')this._request=v(w,l(this,'_processTransportData',w.stateId),l(this,'exitState',{status:c.ERROR,stateId:w.stateId}));}};if(window!==window.parent&&/iframe/.test(window.location))q.transport=new e();r.exports={getURI:p,Transport:h,CORSTransport:b,IframeTransport:f,IframeInnerTransport:e};});
__d("FBAjaxRequest",["dom-core","Env","AjaxRequest"],function(f,h,i,g,e){var a=h('dom-core').$;var c=h('Env');var b=h('AjaxRequest');function d(k,n,l){l=l||{};l.__a=1;l.__user=c.user;l.post_form_id=a('post_form_id').value;var m=new b(k,n,l);var j=m._parseContent;m._parseContent=function(){j.apply(this);var o=this.json;if(o){if(o.error){this.errorType=b.SERVER_ERROR;this.errorText='AsyncResponse error: '+o.error;}this.json=o.payload;}};return m;}g.exports=d;});
__d("MovingStat",[],function(c,e,f,d,b){function a(l){l=l||60000;var h={t:new Date(),count:0,v:0};var i=h,k=0,g=0;function j(){var m=new Date()-l;while(i&&i.next&&i.t<m){k-=i.v;g-=i.count;i=i.next;}}this.add=function(n){k+=n;g++;var m=new Date();if(m-h.t<1000){h.v+=n;h.count++;}else{h.next={t:m,v:n,count:1};h=h.next;j();}};this.tally=function(m){m=m||1000;j();return {sum:k,count:g,timeAverage:k*m/l};};}d.exports=a;});
__d("math-extensions",["copyProperties"],function(d,f,g,e,c){var b=f('copyProperties');var a=e.exports={rand32:function(){return Math.floor(Math.random()*4294967295);},verifyNumber:function(h){if(typeof h=='undefined'||isNaN(h)||h==Number.POSITIVE_INFINITY||h==Number.NEGATIVE_INFINITY)h=0;return h;},mod:function(h,i){var j=h%i;if(j*i<0)j+=i;return j;},clip:function(j,i,h){return Math.max(i,Math.min(j,h));}};b(d,a);},3);
__d("UserActivity",["event-extensions","Arbiter","FunctionUtils"],function(f,h,i,g,e){h("event-extensions");var a=h("Arbiter");var b=h("FunctionUtils");var d=Date.now();var c={DEFAULT_IDLE_MS:5000,EVENT_INTERVAL_MS:500,subscribeOnce:function(k){var l=c.subscribe(function(){c.unsubscribe(l);k();});},subscribe:function(k){return a.subscribe('useractivity/activity',k);},unsubscribe:function(k){a.unsubscribe(k);},isActive:function(k){return (new Date()-d<(k||c.DEFAULT_IDLE_MS));}};var j=b.throttle(function(event){var l=Date.now();var k=l-d;d=l;a.inform('useractivity/activity',{event:event,idleness:k});},c.EVENT_INTERVAL_MS,false);Event.listen(document.documentElement,{mouseover:j,keydown:j,click:j});g.exports=c;});
__d("ChannelManager",["array-extensions","function-extensions","json","onload","AjaxRequest","Arbiter","ArrayUtils","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelTransport","Env","FBAjaxRequest","FunctionUtils","JSLogger","MovingStat","PresenceState","PresenceUtil","SystemEvents","URI","UserActivity","copyProperties","presence-cookie-manager"],function(zi,zm,zn,zk,zh){zm('array-extensions');zm('function-extensions');zm('json');zm('onload');var a=zm('AjaxRequest');var b=zm('Arbiter');var c=zm('ArrayUtils');var d=zm('AsyncRequest');var e=zm('ChannelConstants');var g=zm('ChannelInitialData');var h=zm('ChannelTransport');var i=zm('Env');var j=zm('FBAjaxRequest');var k=zm('FunctionUtils');var l=zm('JSLogger');var n=zm('MovingStat');var o=zm('onload');var p=zm('PresenceState');var q=zm('PresenceUtil');var s=zm('SystemEvents');var t=zm('URI');var u=zm('UserActivity');var zg=zm('copyProperties');var zl=zm('presence-cookie-manager');var f;var ze=l.create('channel');var r={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping'},reconnect:{ok:'init!',error:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!'}};var m=6;var y={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16)};var z=1;var za={};var w=0;function zo(zp){return zp.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function zj(zp){ze.log(zo('arbiter_'+zp));b.inform.apply(b,arguments);}var x=false;function zf(){if(y.subdomain==null){var zp=0;var zq=zl.getSubCookie('ch');if(zq&&zq.sub){for(var zr=0;zr<zq.sub.length;zr++)if(!zq.sub[zr]){zp=zr;break;}if(zr==zq.sub.length)if(zr==m&&t().isSecure()){zp=null;l.create('channel_cookie').error('iframe_max_subdomains_reached');}else zp=zq.sub.length;}y.subdomain=zp;}}function zb(){var zq={};if(f.getConfig('host')){if(y._subdomain!=null){var zp=zl.getSubCookie('ch');var zs=(zp&&zp.sub)?zp.sub:[];var zr=zs.length;zs[y._subdomain]=x?0:1;zq.sub=zs.map(function(zt){return zt?1:0;});}zq[f.getConfig('user_channel')]=f.getConfig('seq',0);}return zq;}function zd(){var zp=Date.now();var zt=Date.now();var zr={total:0};var zs='idle';var zq=null;var zu=false;s.subscribe([s.USER,s.ONLINE,s.TIME_TRAVEL],function(){zt=null;zq=Date.now();f.enterState(f.shouldIdle()?'idle!':'ping!');});var zw=function(zy,zx){var zz=Date.now(),zza;if(zx){zp=zz;zza=zx.nextState||zx.state;}else zza=zs;s.checkTimeTravel();if(zt){var zzb=Math.round((zz-zt)/1000);if(zzb>0){zr[zs]=(zr[zs]||0)+zzb;zr.total+=zzb;}}zs=zza;zt=zz;if(!zy)ze.log('rollup',zr);};b.subscribe(e.ON_ENTER_STATE,zw);setInterval(zw,60000,false);b.subscribe(e.ON_EXIT_STATE,function(zy,zx){if(zx.state=='pull'&&zx.status==e.OK)zq=Date.now();});b.subscribe(l.DUMP_EVENT,function(zy,zx){zx.channelRollup=zr;});var zv=function(){if(f.isShutdown()||f.shouldIdle())return;s.checkTimeTravel();var zz=Date.now()-(zq||i.start);if(!zu&&zz>120000){var zy=d.lastSuccessTime?Date.now()-d.lastSuccessTime:-1;ze.error('stall',{lastSuccessTime:zy,rollupState:zs});zu=true;}var zx=Date.now()-zp;if(f.state=='pull'&&zx>90000){zp=null;ze.warn('jumpstart',{state:f.state,dormant:zx});f.enterState('init');}};setInterval(zv,10000,false);}function zc(){var zu=new Date();var zp=1;function zt(){setTimeout(zt,zp*1000,false);var zw=f.state;if(zw=='idle'&&f.shouldIdle())return;ze.bump('conn_t',zp);if(zw=='pull')ze.bump('conn_t_pull',zp);}zt();var zv=[15,30,60,120,240];var zr=false,zs=false;function zq(zw){setTimeout(function(){ze.rate('pullenter_'+zw,zr);ze.rate('pullexit_'+zw,zs);},zw*1000,false);}while(zv.length)zq(zv.shift());b.subscribe(e.ON_ENTER_STATE,function(zx,zw){if(zw.state=='pull')zr=true;zu=new Date();});b.subscribe(e.ON_EXIT_STATE,function(zx,zw){if(zw.state!='pull'||!zu)return;var zy=zw.status==e.OK?e.OK:(zw&&zw.errorType);switch(zy){case e.OK:zs=true;zy='ok';break;case a.ERROR:zy='error';break;case a.TIMEOUT:zy='timeout';break;case a.PROXY_ERROR:zy='proxy';break;case a.TRANSPORT_ERROR:zy='transport';break;case a.SERVER_ERROR:zy='http';break;case a.PARSE_ERROR:zy='parse';break;default:zy='other';break;}var zz=(new Date()-zu)/1000;if(zz<0){return;}else if(zz>3600)zz=3600;ze.bump('conn_num');ze.bump('conn_exit',zz);ze.bump('conn_num_'+zy);ze.bump('conn_exit_'+zy,zz);});}function v(zp){if(zp){w=0;za={};}else w++;}f={state:'idle',init:function(zp){this.init=function(){};if(typeof(u)!='undefined')u.subscribe(function(){y.userActive=Date.now();}.bind(this));zl.register('ch',zb);var zr=function(){x=true;p.doSync(true);};if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',zr);}else o.runOnload(zr);this._transportRate=new n(30000);var zq=(a.corsEnabled&&!y.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new h[zq](this);if(zp)this.enterState.apply(this,arguments);p.doSync();b.subscribe(l.DUMP_EVENT,function(event,zs){zs.transportRate=this._transportRate.tally();zs.transportType=zq;zs.transportVersion=2;}.bind(this));zd();zc();},configure:function(){c.createFrom(arguments).each(zg.bind(null,y));b.inform(e.ON_CONFIG,this);},getConfig:function(zq,zp){return zq in y?y[zq]:zp;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !s.isPageOwner()||!navigator.onLine;},_sendIframeError:function(zq){var zp=new d().setURI('/ajax/presence/reconnect.php').setData({reason:zq,iframe_loaded:this.iframeEverLoaded}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);zp.specifiesWriteRequiredParams()&&zp.send();},_getDelay:function(){var zr=f.getConfig('MIN_RETRY_INTERVAL',10000);var zq=f.getConfig('MAX_RETRY_INTERVAL',60000);var zp=Math.min(zr*Math.pow(2,Math.max(0,w-1)),zq);return zp*(.75+Math.random()/2)|0;},enterState:function(){this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(zp){this._inEnterState=false;throw zp;}},_enterState:function(zw){var zq=0;var zt=null;var zp=c.createFrom(arguments);if(this.isShutdown())return;if(zw!='idle!'&&this.shouldIdle())return;z++;y.stateId=z;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';if(/!$/.test(zw)){var zv=this._transportRate.tally().timeAverage;var zu=f.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(zv>=zu)zq=1000/zu;}else if(!(/#$/.test(zw)))zq=this._getDelay();zw=zw.replace(/\W*$/,'');if(!r[zw])throw new Error('invalid state:'+zw);var zr;if(zq<=0){zr={state:zw};this._transportRate.add(1);this.state=zw;var zs=this['_enter_'+this.state];if(zs){zp.shift();zs.apply(this,zp);}if(/init|idle|pull|ping/.test(this.state)){zf();this.transport.enterState(this.state,y);}}else{this.state='idle';zr={state:this.state,delay:zq,nextState:zw};zp[0]=zw+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,zp);}).bind(this).defer(zq,false);}ze.log('enter_'+this.state,zr);b.inform(e.ON_ENTER_STATE,zr);},exitState:function(zt,zs){var zx=zt.stateId;var zy=zt.status;if(this.isShutdown()||zx<z)return;var zp=c.createFrom(arguments),zw=this.state;zp[0]=zt.status;var zq={state:zw,status:zy};if(zs&&zs.errorType){zq.errorType=zs.errorType;zq.errorText=zs.errorText;}if(zs&&zs.json){if(zs.json.t)zq.t=zs.json.t;if(zs.json.reason)zq.reason=zs.json.reason;if(zs.json.seq)zq.seq=zs.json.seq;}ze.log('exit_'+zw,zq);b.inform(e.ON_EXIT_STATE,zq);var zr=this['_exit_'+zw];if(zr)zy=zr.apply(this,zp)||zy;if(zy!=e.OK){v();za[zw]=(za[zw]||0)+1;}var zv=r[zw][zy]||r._all[zy];var zu=zv&&zv.replace(/!*$/,'');if(!zu){ze.error('terminal_transition',zq);this._shutdownHint=e.HINT_INVALID_STATE;zv='shutdown!';}this._lastState=zw;this._lastStatus=zy;this.enterState(zv);},_processTransportData:function(zx,zv){var zq=zv.json,zy=zq.t;if('s' in zq){zq.seq=zq.s;delete zq.s;}var zs=y.seq;if('seq' in zq){y.seq=zq.seq;p.doSync();}if(zy=='continue'){v(true);return this.exitState({status:e.OK,stateId:zx});}else if(zy=='refresh'||zy=='refreshDelay'){return this.exitState({status:'refresh_'+(zq.reason||0),stateId:zx},zv);}else if(zy=='fullReload'){zl.clear();ze.log(zo('arbiter_'+e.ON_INVALID_HISTORY));zj(e.ON_INVALID_HISTORY);return this.exitState({status:e.ERROR_MISSING,stateId:zx},zv);}else if(zy=='msg'){var zr,zt,zw,zp;if(zq.msgs){zt=zq.msgs;var zu=0;for(zr=0;zr<zt.length;zr++)if(zt[zr].seq!==-1)zu++;zw=y.seq-zu;for(zr=0;zr<zt.length;zr++){if(zw>=zs){zp=zt[zr].msg;if(zp.type)zj(e.getArbiterType(zp.type),{obj:zp});}else ze.warn('seq_regression',{seq:zw,last_seq:zs,non_transient:zu,messages:zt.length});if(zt[zr].seq!==-1)zw++;}}else{zt=zq.ms;zw=y.seq-zt.length;for(zr=0;zr<zt.length;zr++,zw++)if(zw>=zs){zp=zt[zr];if(zp.type)zj(e.getArbiterType(zp.type),{obj:zp});}else ze.warn('seq_regression',{seq:zw,last_seq:zs,messages:zt.length});}v(true);return this.exitState({status:e.OK,stateId:zx});}return this.exitState({status:e.ERROR_MSG_TYPE,stateId:zx},'type = '+zy);},_enter_init:function(){if(za.init>=2)return this.exitState.bind(this,{status:e.ERROR_MAX,stateId:z}).defer();this._initTimer=this.exitState.bind(this,{status:e.ERROR,stateId:z},'timeout').defer(f.getConfig('IFRAME_LOAD_TIMEOUT',30000),false);},_enter_reconnect:function(zp){var zr=z;if(!q.hasUserCookie()){ze.warn('no_user_cookie');(function(){f._shutdownHint=e.HINT_AUTH;f.exitState({status:e.ERROR_SHUTDOWN,stateId:zr});}).defer();return;}var zq=new j('GET','/ajax/presence/reconnect.php',{reason:zp,iframe_loaded:this.iframeEverLoaded});zq.onSuccess=(function(){f.configure(null,zq.json);zl.store();this.exitState({status:e.OK,stateId:zr});}).bind(this);zq.onError=(function(){var zs=zq.json&&zq.json.error;if(zq.errorType==a.TRANSPORT_ERROR||zq.errorType==a.PROXY_ERROR)this._shutdownHint=e.HINT_CONN;if(zs&&zs==1356007){this._shutdownHint=e.HINT_MAINT;}else if(zs==1357001||zs==1357004||zs==1348009){this._shutdownHint=e.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?e.ERROR_SHUTDOWN:e.ERROR,stateId:zr},zq);}).bind(this);zq.send();},_enter_shutdown:function(){zj(e.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(zp){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(zp==e.OK){this.iframeEverLoaded=true;}else if(zp==e.ERROR_MAX)this._sendIframeError(e.reason_IFrameLoadGiveUp);}};zk.exports=f;if(g.serverInitialized==null){f.configure(g.channelConfig);if(/shutdown/.test(g.state)){f._shutdownHint=e[g.reason];}else g.reconnectReason;f.init(g.state,g.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","SystemEvents","onload","ChannelConstants","ChannelManager","JSLogger"],function(v,x,y,w,u){var a=x('Arbiter');var t=x('copyProperties');var e=x('ChatConfig');var h=x('SystemEvents');var g=x('onload');var c=x('ChannelConstants');var d=x('ChannelManager');var f=x('JSLogger');var m=f.create('channel_connection');var r=null;var p=null;var l=null;var n=null;var b=t(new a(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function j(){if(p){clearTimeout(p);p=null;}}function s(){j();m.log('unmute_warning');b.inform(b.UNMUTE_WARNING);}function o(z){j();p=s.defer(z,false);m.log('mute_warning',{time:z});b.inform(b.MUTE_WARNING);}function i(){if(l){clearTimeout(l);l=null;}}function k(za,z){i();if(za===c.ON_ENTER_STATE&&(z.state==='pull'||z.nextState==='pull')){if(n!==b.CONNECTED){m.log('connected');n=b.CONNECTED;b.inform(b.CONNECTED);}}else if(za===c.ON_ENTER_STATE&&(z.state==='ping'||(z.state==='idle'&&(!z.nextState||z.nextState==='ping')))){l=(function(){var zb=null;if(!(z.state==='idle'&&!z.nextState))zb=(z.delay||0);m.log('reconnecting',{delay:zb});if(b.disconnected())m.log('reconnecting_ui',{delay:zb});n=b.RECONNECTING;b.inform(b.RECONNECTING,zb);}).defer(500,false);}else if(za===c.ON_SHUTDOWN){m.log('shutdown',{reason:z.reason});n=b.SHUTDOWN;b.inform(b.SHUTDOWN,z.reason);}}function q(z){if(d.state==='ping'||d.isShutdown())return;m.log('reconnect',{now:z});b.inform(b.RECONNECTING,0);if(!!z){if(r!==null){clearTimeout(r);r=null;}d.enterState('ping!');}else if(!r)r=setTimeout(function(){d.enterState('ping!');r=null;},e.get('channel_manual_reconnect_defer_msec'),false);}a.subscribe([c.ON_ENTER_STATE,c.ON_SHUTDOWN],k);h.subscribe(h.TIME_TRAVEL,function(){q();o(e.get('mute_warning_time_msec'));});g.runBeforeUnload(i,false);t(b,{disconnected:function(){return n===b.SHUTDOWN||(n===b.RECONNECTING&&!p);},isShutdown:function(){return n===b.SHUTDOWN;},reconnect:q,unmuteWarning:s});w.exports=b;});
__d("Button",["event-extensions","css","DataStore","dom","Parent"],function(g,i,j,h,f){i('event-extensions');var b=i('css');var d=i('DataStore');var c=i('dom');var e=i('Parent');var a=(function(){var l='uiButtonDisabled';var k='uiButtonDepressed';var n='button:blocker';var m='href';function o(t,s){var r=d.get(t,n);if(s){if(r){r.remove();d.remove(t,n);}}else if(!r)d.set(t,n,Event.listen(t,'click',bagof(false),Event.Priority.URGENT));}function p(r){var s=e.byClass(r,'uiButton');if(!s)throw new Error('invalid use case');return s;}function q(r){return c.isNodeOfType(r,'a');}return {getInputElement:function(r){r=p(r);if(q(r))throw new Error('invalid use case');return c.find(r,'input');},isEnabled:function(r){return !b.hasClass(p(r),l);},setEnabled:function(u,r){u=p(u);b.conditionClass(u,l,!r);if(q(u)){var s=u.href;var v=d.get(u,m,'#');if(r){if(!s)u.href=v;}else{if(s&&s!==v)d.set(u,m,s);u.removeAttribute('href');}o(u,r);}else{var t=a.getInputElement(u);t.disabled=!r;o(t,r);}},setDepressed:function(s,r){b.conditionClass(p(s),k,r);},isDepressed:function(r){return b.hasClass(p(r),k);},setLabel:function(s,r){s=p(s);if(q(s)){var t=c.find(s,'span.uiButtonText');c.setContent(t,r);}else a.getInputElement(s).value=r;b.conditionClass(s,'uiButtonNoText',!r);},setIcon:function(s,r){if(!c.isNode(r))return;b.addClass(r,'customimg');s=p(s);var t=c.scry(s,'.img')[0];if(t!=r)if(t){c.replace(t,r);}else c.prependContent(s,r);}};})();g.Button=h.exports=a;},3);
__d("DOMControl",["DataStore","dom-core"],function(e,g,h,f,d){var c=g("DataStore");var a=g("dom-core").$;function b(i){this.root=a(i);this.updating=false;c.set(i,'DOMControl',this);}b.prototype={getRoot:function(){return this.root;},beginUpdate:function(){if(this.updating)return false;this.updating=true;return true;},endUpdate:function(){this.updating=false;},update:function(i){if(!this.beginUpdate())return this;this.onupdate(i);this.endUpdate();},onupdate:function(i){}};b.getInstance=function(i){return c.get(i,'DOMControl');};f.exports=b;});
__d("InputSelection",["dom","Input"],function(e,g,h,f,d){var a=g("dom");var b=g("Input");var c={get:function(j){if(!document.selection)return {start:j.selectionStart,end:j.selectionEnd};var l=document.selection.createRange();if(l.parentElement()!==j)return {start:0,end:0};var k=j.value.length;if(a.isNodeOfType(j,'input')){return {start:-l.moveStart('character',-k),end:-l.moveEnd('character',-k)};}else{var m=l.duplicate();m.moveToElementText(j);m.setEndPoint('StartToEnd',l);var i=k-m.text.length;m.setEndPoint('StartToStart',l);return {start:k-m.text.length,end:i};}},set:function(l,n,k){if(typeof k=='undefined')k=n;if(document.selection){if(l.tagName=='TEXTAREA'){var i=(l.value.slice(0,n).match(/\r/g)||[]).length;var j=(l.value.slice(n,k).match(/\r/g)||[]).length;n-=i;k-=i+j;}var m=l.createTextRange();m.collapse(true);m.moveStart('character',n);m.moveEnd('character',k-n);m.select();}else{l.selectionStart=n;l.selectionEnd=Math.min(k,l.value.length);b.focus(l);}}};f.exports=c;});
__d("enforceMaxLength",["event-extensions","function-extensions","dom","Input","InputSelection"],function(f,i,j,h,e){i("event-extensions");i("function-extensions");var a=i("dom");var b=i("Input");var c=i("InputSelection");var d=function(m,o){var s=b.getValue(m);var n=s.length;var p=n-o;if(p>0){var q;var k;try{q=c.get(m);k=q.end;}catch(l){q=null;k=0;}if(k>=p)n=k;var r=n-p;if(r&&(s.charCodeAt(r-1)&64512)===55296)r--;k=Math.min(k,r);b.setValue(m,s.slice(0,r)+s.slice(n));if(q)c.set(m,Math.min(q.start,k),k);}};var g=function(event){var k=event.getTarget();var l=k.getAttribute&&parseInt(k.getAttribute('maxlength'),10);if(l>0&&a.isNodeOfType(k,['input','textarea']))d.bind(null,k,l).defer();};Event.listen(document.documentElement,{keydown:g,paste:g});h.exports=d;});
__d("Input",["bootloader","css-core","dom","DOMControl"],function(g,j,k,i,f){var a=j("bootloader");var b=j("css-core");var c=j("dom");var d=j("DOMControl");var h=function(l){var m=l.getAttribute('maxlength');if(m&&m>0)k(["enforceMaxLength"],function(n){n(l,m);});};var e={focus:function(l){try{l.focus();}catch(m){}},isEmpty:function(l){return !(/\S/).test(l.value||'')||b.hasClass(l,'DOMControl_placeholder');},getValue:function(l){return e.isEmpty(l)?'':l.value;},setValue:function(m,n){b.removeClass(m,'DOMControl_placeholder');m.value=n||'';h(m);var l=d.getInstance(m);l&&l.resetHeight&&l.resetHeight();},setPlaceholder:function(l,m){l.setAttribute('title',m);l.setAttribute('placeholder',m);if(l==document.activeElement)return;if(e.isEmpty(l)){b.conditionClass(l,'DOMControl_placeholder',m);l.value=m||'';}},reset:function(l){var m=l!==document.activeElement?(l.getAttribute('placeholder')||''):'';l.value=m;b.conditionClass(l,'DOMControl_placeholder',m);l.style.height='';},setSubmitOnEnter:function(l,m){b.conditionClass(l,'enter_submit',m);},getSubmitOnEnter:function(l){return b.hasClass(l,'enter_submit');},setMaxLength:function(l,m){if(m>0){l.setAttribute('maxlength',m);h(l);}else l.removeAttribute('maxlength');}};i.exports=e;});
__d("Vector",["dom","ua","event-extensions","copyProperties"],function(f,h,i,g,e){var b=h("dom");var j=h("ua");var a=h("event-extensions").$E;var d=h("copyProperties");function c(l,m,k){d(this,{x:parseFloat(l),y:parseFloat(m),domain:k||'pure'});}d(c.prototype,{toString:function(){return '('+this.x+', '+this.y+')';},add:function(m,n){if(arguments.length==1){if(m.domain!='pure')m=m.convertTo(this.domain);return this.add(m.x,m.y);}var k=parseFloat(m);var l=parseFloat(n);return new c(this.x+k,this.y+l,this.domain);},mul:function(k,l){if(typeof l=="undefined")l=k;return new c(this.x*k,this.y*l,this.domain);},sub:function(k,l){if(arguments.length==1){return this.add(k.mul(-1));}else return this.add(-k,-l);},distanceTo:function(k){return this.sub(k).magnitude();},magnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y));},convertTo:function(k){if(k!='pure'&&k!='viewport'&&k!='document')return new c(0,0);if(k==this.domain)return new c(this.x,this.y,this.domain);if(k=='pure')return new c(this.x,this.y);if(this.domain=='pure')return new c(0,0);var l=c.getScrollPosition('document');var m=this.x,n=this.y;if(this.domain=='document'){m-=l.x;n-=l.y;}else{m+=l.x;n+=l.y;}return new c(m,n,k);},setElementPosition:function(k){var l=this.convertTo('document');k.style.left=parseInt(l.x)+'px';k.style.top=parseInt(l.y)+'px';return this;},setElementDimensions:function(k){return this.setElementWidth(k).setElementHeight(k);},setElementWidth:function(k){k.style.width=parseInt(this.x,10)+'px';return this;},setElementHeight:function(k){k.style.height=parseInt(this.y,10)+'px';return this;},scrollElementBy:function(k){if(k==document.body){window.scrollBy(this.x,this.y);}else{k.scrollLeft+=this.x;k.scrollTop+=this.y;}return this;}});d(c,{getEventPosition:function(l,k){k=k||'document';l=a(l);var m=b.getDocumentScrollElement();var o=l.pageX||(l.clientX+m.scrollLeft);var p=l.pageY||(l.clientY+m.scrollTop);var n=new c(o,p,'document');return n.convertTo(k);},getScrollPosition:function(k){k=k||'document';var l=b.getDocumentScrollElement();var m=l.scrollLeft;var n=l.scrollTop;return new c(m,n,'document').convertTo(k);},getElementPosition:function(m,l){l=l||'document';if(!m)return;if(!('getBoundingClientRect' in m))return new c(0,0,'document');var o=m.getBoundingClientRect(),k=document.documentElement,n=Math.round(o.left)-k.clientLeft,p=Math.round(o.top)-k.clientTop;return new c(n,p,'viewport').convertTo(l);},getElementDimensions:function(k){return new c(k.offsetWidth||0,k.offsetHeight||0);},getViewportDimensions:function(){var k=(window&&window.innerWidth)||(document&&document.documentElement&&document.documentElement.clientWidth)||(document&&document.body&&document.body.clientWidth)||0;var l=(window&&window.innerHeight)||(document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0;return new c(k,l,'viewport');},getDocumentDimensions:function(k){k=k||document;var l=b.getDocumentScrollElement(k);if(l===k.body&&j.firefox())l=k.documentElement;var m=l.scrollWidth||0;var n=l.scrollHeight||0;return new c(m,n,'document');},deserialize:function(l){var k=l.split(',');return new c(k[0],k[1]);}});g.exports=c;});
__d("Form",["event-extensions","ArrayUtils","AsyncRequest","AsyncResponse","DataStore","dom","Env","Input","Parent","URI","Vector","trackReferrer"],function(m,o,p,n,l){o("event-extensions");var a=o("ArrayUtils");var b=o("AsyncRequest");var c=o("AsyncResponse");var e=o("DataStore");var d=o("dom");var f=o("Env");var h=o("Input");var i=o("Parent");var j=o("URI");var k=o("Vector");var q=o("trackReferrer");var g={getInputs:function(r){r=r||document;return [].concat(a.createFrom(d.scry(r,'input')),a.createFrom(d.scry(r,'select')),a.createFrom(d.scry(r,'textarea')),a.createFrom(d.scry(r,'button')));},getSelectValue:function(r){return r.options[r.selectedIndex].value;},setSelectValue:function(s,t){for(var r=0;r<s.options.length;++r)if(s.options[r].value==t){s.selectedIndex=r;break;}},getRadioValue:function(s){for(var r=0;r<s.length;r++)if(s[r].checked)return s[r].value;return null;},getElements:function(r){return a.createFrom(r.tagName=='FORM'?r.elements:g.getInputs(r));},getAttribute:function(s,r){return (s.getAttributeNode(r)||{}).value||null;},setDisabled:function(s,r){g.getElements(s).forEach(function(t){if(t.disabled!=undefined){var u=e.get(t,'origDisabledState');if(r){if(u===undefined)e.set(t,'origDisabledState',t.disabled);t.disabled=r;}else{if(u!==true)t.disabled=false;e.remove(t,'origDisabledState');}}});},bootstrap:function(u,v){var w=(g.getAttribute(u,'method')||'GET').toUpperCase();v=i.byTag(v,'button')||v;var y=i.byClass(v,'stat_elem')||u;if(CSS.hasClass(y,'async_saving'))return;if(v&&(v.form!==u||(v.nodeName!='INPUT'&&v.nodeName!='BUTTON')||v.type!='submit')){var z=d.scry(u,'.enter_submit_target')[0];var s=v;z&&(v=z);}var t=g.serialize(u,v);g.setDisabled(u,true);var r=g.getAttribute(u,'ajaxify')||g.getAttribute(u,'action');q(u,r);var x=new b(r);x.setData(t).setNectarModuleDataSafe(u).setReadOnly(w=='GET').setMethod(w).setRelativeTo(u).setStatusElement(y).setInitialHandler(g.setDisabled.curry(u,false)).setHandler(function(za){Event.fire(u,'success',{response:za});}).setErrorHandler(function(za){if(Event.fire(u,'error',{response:za})!==false)c.defaultErrorHandler(za);}).setFinallyHandler(g.setDisabled.curry(u,false)).send();},serialize:function(s,t){var r={};g.getElements(s).forEach(function(u){if(u.name&&!u.disabled&&u.type!='submit')if(!u.type||((u.type=='radio'||u.type=='checkbox')&&u.checked)||u.type=='text'||u.type=='password'||u.type=='hidden'||u.tagName=='TEXTAREA'){var y;if(u.name=='post_form_id')y=f.post_form_id;g._serializeHelper(r,u.name,y||h.getValue(u));}else if(u.tagName=='SELECT')for(var v=0,w=u.options.length;v<w;++v){var x=u.options[v];if(x.selected)g._serializeHelper(r,u.name,x.value);}});if(t&&t.name&&'submit'==t.type&&d.contains(s,t)&&d.isNodeOfType(t,['input','button']))g._serializeHelper(r,t.name,t.value);return g._serializeFix(r);},_serializeHelper:function(r,u,v){var t=/([^\]]+)\[([^\]]*)\](.*)/.exec(u);if(t){r[t[1]]=r[t[1]]||{};if(t[2]==''){var s=0;while(r[t[1]][s]!=undefined)s++;}else s=t[2];if(t[3]==''){r[t[1]][s]=v;}else g._serializeHelper(r[t[1]],s.concat(t[3]),v);}else r[u]=v;},_serializeFix:function(r){var v=[];for(var s in r){if(r[s] instanceof Object)r[s]=g._serializeFix(r[s]);v.push(s);}if(v.length>0){var u=0,t=true;v.sort().each(function(x){if(x!=u++)t=false;});if(t){var w=[];v.each(function(x){w[x]=r[x];});return w;}}return r;},post:function(u,s,t){var r=document.createElement('form');r.action=u.toString();r.method='POST';r.style.display='none';if(t)r.target=t;if(ge('post_form_id'))s.post_form_id=$('post_form_id').value;s.fb_dtsg=f.fb_dtsg;s.post_form_id_source='dynamic_post';g.createHiddenInputs(s,r);d.getRootElement().appendChild(r);r.submit();return false;},createHiddenInputs:function(x,r,u,w){u=u||{};var t;var y=j.implodeQuery(x,'',false);var z=y.split('&');for(var s=0;s<z.length;s++)if(z[s]){var za=z[s].split('=');var v=za[0];var zb=za[1];if(v===undefined||zb===undefined)continue;zb=j.decodeComponent(zb);if(u[v]&&w){u[v].value=zb;}else{t=$N('input',{type:'hidden',name:v,value:zb});u[v]=t;r.appendChild(t);}}return u;},getFirstElement:function(s,x){x=x||['input[type="text"]','textarea','input[type="password"]','input[type="button"]','input[type="submit"]'];var w=[];for(var u=0;u<x.length;u++){w=d.scry(s,x[u]);for(var t=0;t<w.length;t++){var v=w[t];try{var pos=k.getElementPosition(v,'document');if(pos.y>0&&pos.x>0)return v;}catch(r){}}}return null;},focusFirst:function(s){var r=g.getFirstElement(s);if(r){r.focus();return true;}return false;}};n.exports=g;});
__d("legacy:dom-form",["Form"],function(a,b,c){a.Form=b('Form');},3);
__d("legacy:event-extensions",["event-extensions"],function(a,b,c){b('event-extensions');},3);
__d("legacy:input-methods",["Input","copyProperties"],function(c,d,e){var a=d('Input');var b=d('copyProperties');b(c.Input||(c.Input={}),a);},3);
__d("URLScraper",["event-extensions","Class"],function(i,u,v,n,h){u("event-extensions");var a=u("Class");function b(za){this.input=za;this.enable();}a.mixin(b,'Arbiter',{reset:function(){this.lastMatch=null;},enable:function(){if(this.events)return;var za=function(zb){setTimeout(this.check.bind(this,zb),30);};this.events=Event.listen(this.input,{paste:za.bind(this,false),keydown:za.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(zb){var zc=this.input.value;if(zb&&b.trigger(zc))return;var za=b.match(zc);if(za&&za!=this.lastMatch){this.lastMatch=za;this.inform('match',{url:za});}}});var c='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',y='\u2000-\u206F\u00ab\u00bb';var t='(?:(?:ht|f)tps?)://',k='(?:(?:\\d{1,3}[.]){3}\\d{1,3})',z='(?:\\b)www\\d{0,3}[.]',o='[^\\s'+c+y+']',l='(?:(?:[.:\\-_%@]|'+o+')*'+o+')',w='(?:[.][a-z]{2,4})',s='(?::\\d+){0,1}',f='(?=[\/?#])';var j='(?:'+'(?:'+t+l+s+')|'+'(?:'+k+s+')|'+'(?:'+z+l+w+s+')|'+'(?:'+l+w+s+f+')'+')';var g='[\/#?]',e='\\([^\\s()<>]+\\)',q='[^\\s()<>]+',p='[^\\s'+c+y+']';var r='(?:'+'(?:'+g+')'+'(?:'+'(?:'+e+'|'+q+')*'+'(?:'+e+'|'+p+')'+')*'+')*';var m=new RegExp('('+'(?:'+j+')'+'(?:'+r+')'+')','im');var d=new RegExp('('+'(?:'+t+l+s+')|'+'(?:'+z+l+w+s+')'+')');var x=/[\s'";]/;b.match=function(zb){var za=(m.exec(zb)||[])[1]||null;if(za&&za.indexOf('@')!=-1){return (d.exec(za))?za:null;}else return za;};b.trigger=function(za){return !x.test(za.charAt(za.length-1));};n.exports=b;});
__d("legacy:url-scraper",["URLScraper"],function(a,b,c){a.URLScraper=b('URLScraper');},3);
(function(){var b=1,a=2;var f={};var e=function(){var h=DOM.scry(this.root,'span.linkAttachment')[0];if(!h&&this.isMetaComposer)h=DOM.scry(this.root,'span.attachmentAcceptsLink')[0];if(!h)return;var g=Parent.byTag(h,'form');this.scraper=new URLScraper(this.input);this.scraper.subscribe('match',function(i,j){if(this.isMetaComposer){var k=this.form.xhpc_targetid;var l=new URI('/ajax/metacomposer/attachment/link/scraper.php');l.addQueryData({scrape_url:encodeURIComponent(j.url),targetid:k.value});g.action=l.toString();}else{CSS.show(h);g.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(j.url);}g.xhpc.value=h.id;g.xhpc.disabled=false;g.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();};var d=function(){var h=this.form.xhpc_targetid;var i=h.value;var g=Arbiter.subscribe('ComposerAudienceSelector/group',function(k,l){h.value=l.group;});var j=Arbiter.subscribe('ComposerAudienceSelector/nongroup',function(){h.value=i;});onunloadRegister(Arbiter.unsubscribe.curry(g));onunloadRegister(Arbiter.unsubscribe.curry(j));};var c=function(g){if(this.inform('submit')===false){g.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};window.Composer=function(j,i,h,g){f[j.id]=this;this.root=j;this.resetCfg=i;this.dataSource=g;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;Bootloader.loadComponents('dom',function(){this.focus=DOM.find(j,'div.focus_target');this.form=DOM.find(j,'form.attachmentForm');this.content=DOM.find(j,'div.attachmentContent');this.isMetaComposer=h;if(this.isMetaComposer){this.messageBox=DOM.find(j,'div.uiMetaComposerMessageBox');this.metaArea=DOM.find(j,'div.attachmentMetaArea');this.bottomArea=DOM.find(j,'div.attachmentBottomArea');this.barArea=DOM.find(j,'div.attachmentBarArea');this.blurb=DOM.find(j,'div.uiMetaComposerMessageBox div.textBlurb');this.input=DOM.find(j,'div.uiMetaComposerMessageBox textarea.input');this.button=DOM.find(j,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=DOM.find(j,'div.uiMetaComposerMessageBox li.privacyWidget');}else{this.blurb=DOM.find(j,'div.uiComposerMessageBox div.textBlurb');this.input=DOM.find(j,'div.uiComposerMessageBox textarea.input');this.button=DOM.find(j,'div.uiComposerMessageBox label.submitBtn');this.privacy=DOM.find(j,'div.uiComposerMessageBox li.privacyWidget');}Event.listen(this.form,'submit',c.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(Parent.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}Arbiter.inform('xhpc/construct/'+j.id,this,Arbiter.BEHAVIOR_STATE);}.bind(this));};Class.mixin(Composer,'Arbiter',{init:function(g){this.mentionsInput=g;if(this.mentionsInput){this.mentionsInput.subscribe('init',function(){var h=this.mentionsInput.getTypeahead().getView();h.subscribe(['reset','render'],function(i){CSS.conditionClass(this.root,'uiComposerMention',(i=='render'));}.bind(this));}.bind(this));this.mentionsInput.subscribe('update',function(i,h){Arbiter.inform('Composer/mentions',keys(h.mentioned));});}e.call(this);if(this.isMetaComposer)d.call(this);this.inform('init',null,Arbiter.BEHAVIOR_PERSISTENT);onbeforeunloadRegister(this._handleUnsavedChanges.bind(this));},setBlurb:function(g){DOM.setContent(this.blurb,g);},setEnabled:function(g){Button.setEnabled(this.button,g);},setLoading:function(g){CSS.conditionClass(this.root,'async_saving',!!g);},setContentVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideContent',!g);},setMessageBoxVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideMessageBox',!g);},setInputVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideInput',!g);},setTopicTaggerVisible:function(g){CSS.conditionClass(this.root,'uiTagComposerHidden',!g);},mutate:function(i){var h=ge(i.xhpc);if(h){var j=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];if(i.confirmAugmentation&&j!==h)return;j&&CSS.removeClass(j,'uiComposerAttachmentSelected');CSS.addClass(h,'uiComposerAttachmentSelected');if(!i.disableCache)Event.listen(h,'click',function(k){$E(k).stop();i.disableCache=true;this.mutate(i);}.bind(this));}if(!i.keepContentAreas){this.setContentVisible(false);DOM.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);DOM.empty(this.metaArea);DOM.empty(this.bottomArea);DOM.empty(this.barArea);}}if(i.content){DOM.setContent(this.content,HTML(i.content));this.setContentVisible(true);}if(this.isMetaComposer){i.metaContent&&DOM.setContent(this.metaArea,HTML(i.metaContent));i.bottomContent&&DOM.setContent(this.bottomArea,HTML(i.bottomContent));i.barContent&&DOM.setContent(this.barArea,HTML(i.barContent));}this.setMessageBoxVisible(!i.messageBoxHidden);CSS.conditionClass(this.root,'uiComposerWhiteMessageBox',!i.messageBoxHidden&&!i.inputHidden&&!i.content);this.setInputVisible(!i.inputHidden);CSS.conditionShow(this.privacy,!i.privacyWidgetHidden);Input.setPlaceholder(this.input,i.placeholder);Button.setLabel(this.button,i.buttonLabel);this.setBlurb(HTML(i.blurb));if(i.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!i.disabled);this.setTopicTaggerVisible(!i.hideTopicTagger);this.form.setAttribute('action',i.endpoint);if(i.formType==b){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');if(i.formType==a){this.form.target=i.iframeName;this.form.enctype=this.form.encoding='multipart/form-data';}else{this.form.removeAttribute('target');this.form.removeAttribute('enctype');this.form.removeAttribute('encoding');}this.submitHandler=i.submitHandler;this.lazyEndpoint=i.lazyEndpoint;i.attachmentJS&&(new Function(i.attachmentJS)).apply(this);CSS.addClass(this.root,'uiComposerInteracted');CSS.addClass(this.root,'uiComposerOpen');if(i.messageBoxFocused){var g=document.activeElement;if(g===document.body||Parent.byClass(g,'attachmentLink'))this.focusInput.bind(this).defer();}Arbiter.inform('composer/mutate',this);},subscribeToMutate:function(g){return Arbiter.subscribe('composer/mutate',function(h,i){if(i===this)g();}.bind(this));},reset:function(h,g){if(!h){Input.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();}if(this.isMetaComposer){DOM.empty(this.metaArea);DOM.empty(this.bottomArea);DOM.empty(this.barArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var i=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];if(i)CSS.removeClass(i,'uiComposerAttachmentSelected');}CSS.removeClass(this.root,'uiComposerInteracted');CSS.setClass(this.focus,'focus_target');this.setLoading(false);if(g){var j=DOM.scry(this.root,'.widget')[0];j&&DOM.replace(j,g);}Arbiter.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var g=DOM.find(this.root,'form.attachmentSelectForm');var i=new URI(this.lazyEndpoint);i.setQueryData({isAugmentation:true});g.action=i.toString();var h=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];g.xhpc.value=h&&h.id;g.xhpc.click();CSS.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){Input.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(g){if(this.dataSource)this.dataSource.updateToken(g);},_handleUnsavedChanges:function(){var g=PageTransitions.getNextURI();if(g.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!Input.isEmpty(this.input)&&!(window.Dialog&&Dialog.getCurrent()))return "You haven't finished your post yet. Do you want to leave without finishing?";}});copy_properties(Composer,{publish:function(h,g){g=g||{};g.composer=Composer.getInstance($(h));g.composer.reset(false,g.audienceMarkup);g.audienceMarkup=null;if(g.streamMarkup)g.streamStory=HTML(g.streamMarkup).getRootNode();Arbiter.inform('composer/publish',g);},getInstance:function(g){var h=Parent.byClass($(g),'uiComposer');return h?f[h.id]:null;}});})();
function MetaComposerMessageBox(){}MetaComposerMessageBox.prototype={init:function(b,a){this.inputContainer=DOM.scry(b,'div.inputContainer')[0];this.textInput=DOM.scry(b,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(b,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(b,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(b,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}};
__d("XD",["function-extensions","copyProperties","ua","URI","Arbiter"],function(g,i,j,h,f){i("function-extensions");var e=i("copyProperties");var k=i("ua");var b=i("URI");var a=i("Arbiter");var d={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,newResizeMethod:false,resizeTimeout:100,resizeWidth:false,expectResizeAck:false,resizeAckTimeout:6000},_lastResizeAckId:0,_resizeCount:0,_resizeTimestamp:0,init:function(l){this._opts=e(e({},this._opts),l);if(this._opts.autoResize)this._startResizeMonitor();a.subscribe('Connect.Unsafe.resize.ack',function(n,m){if(!m.id)m.id=this._resizeCount;if(m.id>this._lastResizeAckId)this._lastResizeAckId=m.id;}.bind(this));},send:function(m,l){l=l||this._opts.channelUrl;if(!l)return;if(l.substr(0,4)!='http')return;var t=l+'&'+b.implodeQuery(m),p='f'+(Math.random()*(1<<30)).toString(16).replace('.',''),n=document.body.appendChild(document.createElement('div')),s=false;n.style.position='absolute';n.style.top='-10000px';n.style.width='1px';n.style.height='1px';d._callbacks[p]=function(){if(s){(function(){n.parentNode.removeChild(n);}).defer(3000);delete d._callbacks[p];}};if(k.ie()){var q,o=document.createElement('div');q='<iframe onload="XD._callbacks.'+p+'()"></iframe>';o.innerHTML=q;o.firstChild.setAttribute('src',t);q=o.innerHTML;n.innerHTML='<iframe src="javascript:false"></iframe>';s=true;(function(){n.innerHTML=q;}).defer();}else{var r=document.createElement('iframe');r.onload=d._callbacks[p];n.appendChild(r);s=true;r.src=t;}},_computeSize:function(){return {width:this._opts.resizeWidth?this._calcWidth(d.forced_min_width):0,height:this._calcHeight(this._opts.newResizeMethod)};},_calcHeight:function(o){var l=document.body,m=document.documentElement,n=0;if(o){n=Math.max(Math.max(l.offsetHeight,l.scrollHeight)+l.offsetTop,Math.max(m.offsetHeight,m.scrollHeight)+m.offsetTop);}else{if(k.ie()){n=Math.max(l.offsetHeight,l.scrollHeight)+l.offsetTop;}else n=m.offsetHeight+m.offsetTop;if(window.Dialog)n=Math.max(n,Dialog.max_bottom);}return n;},_calcWidth:function(r){var l=document.body,p=document.documentElement,s=0;if(l.offsetWidth<l.scrollWidth){s=l.scrollWidth+l.offsetLeft;}else{var o=l.childNodes;for(var q=0;q<o.length;q++){var m=o[q];var n=m.offsetWidth+m.offsetLeft;if(n>s)s=n;}}if(r)s=Math.max(s,r);if(p.clientLeft>0)s+=(p.clientLeft*2);if(p.clientTop>0)height+=(p.clientTop*2);return s;},_startResizeMonitor:function(){var m,l=document.documentElement;if(this._opts.hideOverflow){l.style.overflow='hidden';document.body.style.overflow='hidden';}setInterval((function(){var q=this._computeSize();var r=Date.now();var n=this._lastResizeAckId<this._resizeCount&&(r-this._resizeTimestamp)>this._opts.resizeAckTimeout;if(!m||(this._opts.expectResizeAck&&n)||(this._opts.allowShrink&&m.width!=q.width)||(!this._opts.allowShrink&&m.width<q.width)||(this._opts.allowShrink&&m.height!=q.height)||(!this._opts.allowShrink&&m.height<q.height)){m=q;this._resizeCount++;this._resizeTimestamp=r;var p={type:'resize',height:q.height,ackData:{id:this._resizeCount}};if(q.width&&q.width!=0)p.width=q.width;try{if(b(document.referrer).isFacebookURI()&&window.parent!=window&&window.name&&window.parent.location&&window.parent.location.toString&&b(window.parent.location).isFacebookURI()){var iframes=window.parent.document.getElementsByTagName('iframe');for(var i=0;i<iframes.length;i=i+1)if(iframes[i].name==window.name){if(this._opts.resizeWidth)iframes[i].style.width=p.width+'px';iframes[i].style.height=p.height+'px';}}this.send(p);}catch(o){this.send(p);}}}).bind(this),this._opts.resizeTimeout);}};var c=e({},d);h.exports.UnverifiedXD=c;h.exports.XD=d;g.UnverifiedXD=c;g.XD=d;});
__d("legacy:connect-xd",["XD"],function(a,b,c){a.UnverifiedXD=b('XD').UnverifiedXD;a.XD=b('XD').XD;},3);
(function(){var a='facebook.desktopplugin';FbDesktopDetect={mimeType:'application/x-facebook-desktop-1',isPluginInstalled:function(){var e=null;if(window.ActiveXObject){try{e=new ActiveXObject(a);if(e)return true;}catch(b){}}else if(navigator.plugins){navigator.plugins.refresh(false);for(var c=0,d=navigator.plugins.length;c<d;c++){e=navigator.plugins[c];if(e.length&&e[0].type===this.mimeType)return true;}}return false;},patchLoginForm:function(){if(this.isPluginInstalled()){new AsyncRequest('/ajax/desktop/loginmessage').send();var b=$('persist_box');if(b)b.checked=true;}},setContextualDialog:function(b){var d=$('persist_box');if(!d.checked)this.toggleWarning(b);var c=function(){d.checked?b.hide():b.show();};Event.listen(d,'click',c);Event.listen(d,'keydown',c);}};})();
(function(){FbDesktopPlugin={_plugin:'_not_checked',getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(FbDesktopDetect.isPluginInstalled()){var a=DOM.create('div');document.body.appendChild(a);DOM.setContent(a,HTML('<object id="kiwi_plugin" '+'type="'+FbDesktopDetect.mimeType+'" width="0" height="0">'+'</object>'));this._plugin=$('kiwi_plugin');}}return this._plugin;},isAppRunning:function(){var a=this.getPlugin();return a&&'isAppRunning' in a&&a.isAppRunning();},logout:function(b){b=b||"0";var a=this.getPlugin();if(a)a.logout(b);},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressSidebar:function(){var a=this.getPlugin();return a&&'isAppDocked' in a&&a.isAppDocked();},transferAuthToken:function(b,c){if(b&&b.length>0){var a=this.getPlugin();if(a)a.setAccessToken(b,c);}if(this.redirectHome)window.location.href=URI().setPath().toString();}};})();
__d("legacy:cookie",["Cookie"],function(b,c,d){var a=c('Cookie');b.getCookie=a.get;b.setCookie=a.set;b.clearCookie=a.clear;},3);
__d("AsyncSignal",["Env"],function(d,f,g,e,c){var b=f("Env");function a(i,h){this.data=h||{};if(b.tracking_domain&&i.charAt(0)=='/')i=b.tracking_domain+i;this.uri=i;this.handler=null;}a.prototype.setHandler=function(h){this.handler=h;return this;};a.prototype.send=function(){var j=this.handler,i=this.data,n=this.uri,m=[],k=new Image(),h=document.getElementById('post_form_id');i.asyncSignal=Math.floor(Math.random()*10000)+1;if(h)i.post_form_id=h.value;i.__user=b.user;if(b.fb_isb)i.fb_isb=b.fb_isb;for(var l in i)m.push(encodeURIComponent(l)+'='+encodeURIComponent(i[l]));if(n.indexOf('?')==-1)n+='?';n+=m.join('&');if(j)k.onload=k.onerror=(function(p,o){return function(){o((p.height==1));};})(k,j);k.src=n;return this;};e.exports=a;});
__d("legacy:async-signal",["AsyncSignal"],function(a,b,c){a.AsyncSignal=b('AsyncSignal');},3);
__d("legacy:uri",["URI"],function(a,b,c){a.URI=b('URI');},3);
function detect_broken_proxy_cache(d,a){var b=getCookie(a);if((b!=d)&&(b!=null)&&(d!='0')){var c={c:'si_detect_broken_proxy_cache',m:a+' '+d+' '+b};var e=new URI('/common/scribe_endpoint.php').getQualifiedURI().toString();new AsyncSignal(e,c).send();}}
__d("AjaxPipeRequest",["Arbiter","AsyncRequest","BigPipe","dom","Env","JSCC","copyProperties","dom-core"],function(l,n,o,m,j){var b=n("Arbiter");var c=n("AsyncRequest");var d=n("BigPipe");var e=n("dom");var f=n("Env");var g=n("JSCC");var i=n("copyProperties");var k=n("dom-core").ge;function h(q,r){var s=k(q);if(s){if(!r)s.style.minHeight='600px';for(var t in d.pageletIDs)if(q!==t&&e.contains(s,t)){g.clearForPagelet(t);delete d.pageletIDs[t];}e.empty(s);}}function p(q,r){var s=k(q);if(s)if(!r)s.style.minHeight='100px';}function a(r,q){this._uri=r;this._query_data=q;this._request=new c();this._canvas_id=null;this._allow_cross_page_transition=true;}i(a.prototype,{setCanvasId:function(q){this._canvas_id=q;return this;},setURI:function(q){this._uri=q;return this;},setData:function(q){this._query_data=q;return this;},getData:function(q){return this._query_data;},setAllowCrossPageTransition:function(q){this._allow_cross_page_transition=q;return this;},setAppend:function(q){this._append=q;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(i({ajaxpipe:1,ajaxpipe_token:f.ajaxpipe_token},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);a._current_request=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(q){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,b.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,b.BEHAVIOR_STATE);},_isRelevant:function(q){return this._request==a._current_request||this._jsNonBlock;},_preBootloadHandler:function(r){var q=r.getPayload();if(!q||q.redirect||!this._isRelevant(r))return false;var s=false;if(r.is_first){!this._append&&!this._displayCallback&&h(this._canvas_id,this._constHeight);this._arbiter=new b();s=this._preBootloadFirstResponse(r);this.pipe=new d({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,rrEnabled:r.payload.roadrunner_enabled,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',jsNonBlock:this._jsNonBlock,displayCallback:this._displayCallback});}return s;},_redirect:function(r){if(r.redirect){if(r.force||!this.isPageActive(r.redirect)){var q=['ajaxpipe','ajaxpipe_token'].concat(this.getSanitizedParameters());go_or_replace(window.location,URI(r.redirect).removeQueryData(q),true);}else PageTransitions.go(r.redirect,true);return true;}else return false;},isPageActive:function(q){return true;},getSanitizedParameters:function(){return [];},_versionCheck:function(q){return true;},_onInitialResponse:function(r){var q=r.getPayload();if(!this._isRelevant(r))return false;if(!q)return true;if(this._redirect(q)||!this._versionCheck(q))return false;return true;},_processFirstResponse:function(r){var q=r.getPayload();if(k(this._canvas_id)&&q.canvas_class!==null)CSS.setClass(this._canvas_id,q.canvas_class);},setFirstResponseCallback:function(q){this._firstResponseCallback=q;return this;},setFirstResponseHandler:function(q){this._processFirstResponse=q;return this;},_onResponse:function(r){var q=r.payload;if(!this._isRelevant(r))return c.suppressOnloadToken;if(r.is_first){this._processFirstResponse(r);this._firstResponseCallback&&this._firstResponseCallback();q.provides=q.provides||[];q.provides.push('uipage_onload');if(this._append)q.append=this._canvas_id;}if(q){if('content' in q.content&&this._canvas_id!==null&&this._canvas_id!='content'){q.content[this._canvas_id]=q.content.content;delete q.content.content;}this.pipe.onPageletArrive(q);}if(r.is_last)p(this._canvas_id,this._constHeight);return c.suppressOnloadToken;},setNectarModuleDataSafe:function(q){this._request.setNectarModuleDataSafe(q);return this;},setFinallyHandler:function(q){this._request.setFinallyHandler(q);return this;},setErrorHandler:function(q){this._request.setErrorHandler(q);return this;},abort:function(){this._request.abort();if(a._current_request==this._request)a._current_request=null;this._request=null;return this;},setJSNonBlock:function(q){this._jsNonBlock=q;return this;},setDisplayCallback:function(q){this._displayCallback=q;return this;},setConstHeight:function(q){this._constHeight=q;return this;},getAsyncRequest:function(){return this._request;}});i(a,{getCurrentRequest:function(){return a._current_request;},setCurrentRequest:function(q){a._current_request=q;}});m.exports=l.AjaxPipeRequest||a;});
__d("legacy:ajaxpipe",["AjaxPipeRequest"],function(a,b,c){a.AjaxPipeRequest=b('AjaxPipeRequest');},3);
__d("goOrReplace",["URI"],function(c,f,g,e,b){var a=f("URI");function d(h,k,j){var l=new a(k);if(h.pathname=='/'&&l.getPath()!='/'&&l.isQuicklingEnabled()){var i=h.search?{}:{q:''};l=new a().setPath('/').setQueryData(i).setFragment(l.getUnqualifiedURI()).toString();k=l.toString();}if(j&&!(ua.ie()<8)){h.replace(k);}else if(h.href==k){h.reload();}else h.href=k;}e.exports=d;});
__d("computeRelativeURI",["array-extensions","URI","Util","isEmpty"],function(f,i,j,h,e){i("array-extensions");var a=i("URI");var b=i("Util");var g=i("isEmpty");function c(l,k){if(!k)return l;if(k.charAt(0)=='/')return k;var m=l.split('/').slice(0,-1);m[0]!=='';k.split('/').forEach(function(n){if(!(n=='.'))if(n=='..'){if(m.length>1)m=m.slice(0,-1);}else m.push(n);});return m.join('/');}function d(n,l){var o=new a(),m=l;n=new a(n);l=new a(l);if(l.getDomain()&&!l.isFacebookURI())return m;var p=n;var k=['Protocol','Domain','Port','Path','QueryData','Fragment'];k.forEach(function(r){var q=r=='Path'&&p===n;if(q)o.setPath(c(n.getPath(),l.getPath()));if(!g(l['get'+r]()))p=l;if(!q)o['set'+r](p['get'+r]());});return o;}h.exports=d;});
__d("HistoryManager",["event-extensions","function-extensions","Cookie","Env","ua","URI","copyProperties"],function(g,i,j,h,f){i("event-extensions");i("function-extensions");var a=i("Cookie");var b=i("Env");var k=i("ua");var d=i("URI");var e=i("copyProperties");var c={_IFRAME_BASE_URI:'http://static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(m){m=m.toString();var l=c.history.length-1;c.iframe.src=c._IFRAME_BASE_URI+'?|index='+l+'#'+encodeURIComponent(m);return c;},getIframeSrcFragment:function(){return decodeURIComponent(d(c.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(l,m){if(m){c._setIframeSrcFragment(l);return;}if(l!==undefined){c.iframeQueue.push(l);}else{c.iframeQueue.splice(0,1);c.iframeTimeout=null;c.checkURI();}if(c.iframeQueue.length&&!c.iframeTimeout){var n=c.iframeQueue[0];c.iframeTimeout=setTimeout(function(){c._setIframeSrcFragment(n);},100,false);}},isInitialized:function(){return !!c._initialized;},init:function(){if(!b.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(c._initialized)return c;var m=d();var l=m.getFragment()||'';if(l.charAt(0)==='!'){l=l.substr(1);m.setFragment(l);}if(d.getRequestURI(false).getProtocol().toLowerCase()=='https')c._IFRAME_BASE_URI='https://s-static.ak.facebook.com/common/history_manager.php';e(c,{_initialized:true,fragment:l,orig_fragment:l,history:[m],callbacks:[],lastChanged:Date.now(),canonical:d('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(n){if(n&&n.state&&c.lastURI!=n.state){c.lastURI=n.state;c.lastChanged=Date.now();c.notify(d(n.state).getUnqualifiedURI().toString());}}.bind(c));if(k.safari()<534||k.chrome()<=13){setInterval(c.checkURI,42,false);c._updateRefererURI(this.lastURI);}return c;}c._updateRefererURI(d.getRequestURI(false));if(k.safari()<500||k.firefox()<2){c.enabled=false;return c;}if(k.ie()<8){c.iframe=document.createElement('iframe');e(c.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});c._setIframeSrcFragment(l);document.body.insertBefore(c.iframe,document.body.firstChild);}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){c.checkURI.bind(c).defer();});}else setInterval(c.checkURI,42,false);return c;},registerURIHandler:function(l){c.callbacks.push(l);return c;},setCanonicalLocation:function(l){c.canonical=d(l);return c;},notify:function(n){if(n==c.orig_fragment)n=c.canonical.getFragment();for(var m=0;m<c.callbacks.length;m++)try{if(c.callbacks[m](n))return true;}catch(l){}return false;},checkURI:function(){if(Date.now()-c.lastChanged<400)return;if(window.history&&history.pushState){var o=d(document.URL).removeQueryData('ref').toString();var n=d(c.lastURI).removeQueryData('ref').toString();if(o!=n){c.lastChanged=Date.now();c.lastURI=o;if(k.safari()<534)c._updateRefererURI(o);c.notify(d(o).getUnqualifiedURI().toString());}return;}if(k.ie()<8&&c.iframeQueue.length)return;if(k.safari()&&window.history.length==200){if(!c.warned)c.warned=true;return;}var l=d().getFragment();if(l.charAt(0)=='!')l=l.substr(1);if(k.ie()<8)l=c.getIframeSrcFragment();l=l.replace(/%23/g,'#');if(l!=c.fragment.replace(/%23/g,'#')){c.debug([l,' vs ',c.fragment,'whl: ',window.history.length,'QHL: ',c.history.length].join(' '));for(var m=c.history.length-1;m>=0;--m)if(c.history[m].getFragment().replace(/%23/g,'#')==l)break;++c.user;if(m>=0){c.go(m-c.current);}else c.go('#'+l);--c.user;}},_updateRefererURI:function(p){p=p.toString();if(p.charAt(0)!='/'&&p.indexOf('//')==-1)return;var o=new d(window.location);if(o.isFacebookURI()){var l=o.getPath()+window.location.search;}else var l='';var n=d(p).getQualifiedURI().setFragment(l).toString();var m=2048;if(n.length>m)n=n.substring(0,m)+'...';a.set('x-referer',n);},go:function(n,p,q){if(window.history&&history.pushState){p||typeof(n)=='number';var s=d(n).removeQueryData('ref').toString();c.lastChanged=Date.now();this.lastURI=s;if(q){window.history.replaceState(n,null,s);}else window.history.pushState(n,null,s);if(k.safari()<534)c._updateRefererURI(n);return false;}c.debug('go: '+n);if(p===undefined)p=true;if(!c.enabled)if(!p)return false;if(typeof(n)=='number'){if(!n)return false;var m=n+c.current;var o=Math.max(0,Math.min(c.history.length-1,m));c.current=o;m=c.history[o].getFragment()||c.orig_fragment;m=d(m).removeQueryData('ref').getUnqualifiedURI().toString();c.fragment=m;c.lastChanged=Date.now();if(k.ie()<8){if(c.fragmentTimeout)clearTimeout(c.fragmentTimeout);c._temporary_fragment=m;c.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+m;delete c._temporary_fragment;},750,false);if(!c.user)c.nextframe(m,q);}else if(!c.user)go_or_replace(window.location,window.location.href.split('#')[0]+'#!'+m,q);if(p)c.notify(m);c._updateRefererURI(m);return false;}n=d(n);if(n.getDomain()==d().getDomain())n=d('#'+n.getUnqualifiedURI());var l=c.history[c.current].getFragment();var r=n.getFragment();if(r==l||(l==c.orig_fragment&&r==c.canonical.getFragment())){if(p)c.notify(r);c._updateRefererURI(r);return false;}if(q)c.current--;var t=(c.history.length-c.current)-1;c.history.splice(c.current+1,t);c.history.push(d(n));return c.go(1,p,q);},getCurrentFragment:function(){var l=c._temporary_fragment!==undefined?c._temporary_fragment:d.getRequestURI(false).getFragment();return l==c.orig_fragment?c.canonical.getFragment():l;}};h.exports=c;});
__d("animation",["css"],function(d,f,g,e,c){var a=f('css');function b(h){if(h==undefined)return;if(d==this){return new b(h);}else{this.obj=h;this._reset_state();this.queue=[];this.last_attr=null;}}b.resolution=20;b.offset=0;b.prototype._reset_state=function(){this.state={attrs:{},duration:500};};b.prototype.stop=function(){this._reset_state();this.queue=[];return this;};b.prototype._build_container=function(){if(this.container_div){this._refresh_container();return;}if(this.obj.firstChild&&this.obj.firstChild.__animation_refs){this.container_div=this.obj.firstChild;this.container_div.__animation_refs++;this._refresh_container();return;}var i=document.createElement('div');i.style.padding='0px';i.style.margin='0px';i.style.border='0px';i.__animation_refs=1;var h=this.obj.childNodes;while(h.length)i.appendChild(h[0]);this.obj.appendChild(i);this._orig_overflow=this.obj.style.overflow;this.obj.style.overflow='hidden';this.container_div=i;this._refresh_container();};b.prototype._refresh_container=function(){this.container_div.style.height='auto';this.container_div.style.width='auto';this.container_div.style.height=this.container_div.offsetHeight+'px';this.container_div.style.width=this.container_div.offsetWidth+'px';};b.prototype._destroy_container=function(){if(!this.container_div)return;if(!--this.container_div.__animation_refs){var h=this.container_div.childNodes;while(h.length)this.obj.appendChild(h[0]);this.obj.removeChild(this.container_div);}this.container_div=null;this.obj.style.overflow=this._orig_overflow;};b.ATTR_TO=1;b.ATTR_BY=2;b.ATTR_FROM=3;b.prototype._attr=function(h,k,j){h=h.replace(/-[a-z]/gi,function(l){return l.substring(1).toUpperCase();});var i=false;switch(h){case 'background':this._attr('backgroundColor',k,j);return this;case 'margin':k=b.parse_group(k);this._attr('marginBottom',k[0],j);this._attr('marginLeft',k[1],j);this._attr('marginRight',k[2],j);this._attr('marginTop',k[3],j);return this;case 'padding':k=b.parse_group(k);this._attr('paddingBottom',k[0],j);this._attr('paddingLeft',k[1],j);this._attr('paddingRight',k[2],j);this._attr('paddingTop',k[3],j);return this;case 'backgroundColor':case 'borderColor':case 'color':k=b.parse_color(k);break;case 'opacity':k=parseFloat(k,10);break;case 'height':case 'width':if(k=='auto'){i=true;}else k=parseInt(k,10);break;case 'borderWidth':case 'lineHeight':case 'fontSize':case 'marginBottom':case 'marginLeft':case 'marginRight':case 'marginTop':case 'paddingBottom':case 'paddingLeft':case 'paddingRight':case 'paddingTop':case 'bottom':case 'left':case 'right':case 'top':case 'scrollTop':case 'scrollLeft':k=parseInt(k,10);break;default:throw new Error(h+' is not a supported attribute!');}if(this.state.attrs[h]===undefined)this.state.attrs[h]={};if(i)this.state.attrs[h].auto=true;switch(j){case b.ATTR_FROM:this.state.attrs[h].start=k;break;case b.ATTR_BY:this.state.attrs[h].by=true;case b.ATTR_TO:this.state.attrs[h].value=k;break;}};b._get_box_width=function(j){var k=parseInt(a.getStyle(j,'paddingLeft'),10),l=parseInt(a.getStyle(j,'paddingRight'),10),h=parseInt(a.getStyle(j,'borderLeftWidth'),10),i=parseInt(a.getStyle(j,'borderRightWidth'),10);return j.offsetWidth-(k?k:0)-(l?l:0)-(h?h:0)-(i?i:0);};b._get_box_height=function(j){var l=parseInt(a.getStyle(j,'paddingTop'),10),k=parseInt(a.getStyle(j,'paddingBottom'),10),h=parseInt(a.getStyle(j,'borderTopWidth'),10),i=parseInt(a.getStyle(j,'borderBottomWidth'),10);return j.offsetHeight-(l?l:0)-(k?k:0)-(h?h:0)-(i?i:0);};b.prototype.to=function(h,i){if(i===undefined){this._attr(this.last_attr,h,b.ATTR_TO);}else{this._attr(h,i,b.ATTR_TO);this.last_attr=h;}return this;};b.prototype.by=function(h,i){if(i===undefined){this._attr(this.last_attr,h,b.ATTR_BY);}else{this._attr(h,i,b.ATTR_BY);this.last_attr=h;}return this;};b.prototype.from=function(h,i){if(i===undefined){this._attr(this.last_attr,h,b.ATTR_FROM);}else{this._attr(h,i,b.ATTR_FROM);this.last_attr=h;}return this;};b.prototype.duration=function(h){this.state.duration=h?h:0;return this;};b.prototype.checkpoint=function(i,h){if(i===undefined)i=1;this.state.checkpoint=i;this.queue.push(this.state);this._reset_state();this.state.checkpointcb=h;return this;};b.prototype.blind=function(){this.state.blind=true;return this;};b.prototype.hide=function(){this.state.hide=true;return this;};b.prototype.show=function(){this.state.show=true;return this;};b.prototype.ease=function(h){this.state.ease=h;return this;};b.prototype.go=function(){var i=(new Date()).getTime();this.queue.push(this.state);for(var h=0;h<this.queue.length;h++){this.queue[h].start=i-b.offset;if(this.queue[h].checkpoint)i+=this.queue[h].checkpoint*this.queue[h].duration;}b.push(this);return this;};b.prototype._show=function(){a.show(this.obj);};b.prototype._hide=function(){a.hide(this.obj);};b.prototype._frame=function(t){var j=true;var s=false;var v=false;var u;function k(w){return document.documentElement[w]||document.body[w];}for(var l=0;l<this.queue.length;l++){var i=this.queue[l];if(i.start>t){j=false;continue;}if(i.checkpointcb){this._callback(i.checkpointcb,t-i.start);i.checkpointcb=null;}if(i.started===undefined){if(i.show)this._show();for(var h in i.attrs){if(i.attrs[h].start!==undefined)continue;switch(h){case 'backgroundColor':case 'borderColor':case 'color':u=b.parse_color(a.getStyle(this.obj,h=='borderColor'?'borderLeftColor':h));if(i.attrs[h].by){i.attrs[h].value[0]=Math.min(255,Math.max(0,i.attrs[h].value[0]+u[0]));i.attrs[h].value[1]=Math.min(255,Math.max(0,i.attrs[h].value[1]+u[1]));i.attrs[h].value[2]=Math.min(255,Math.max(0,i.attrs[h].value[2]+u[2]));}break;case 'opacity':u=a.getOpacity(this.obj);if(i.attrs[h].by)i.attrs[h].value=Math.min(1,Math.max(0,i.attrs[h].value+u));break;case 'height':u=b._get_box_height(this.obj);if(i.attrs[h].by)i.attrs[h].value+=u;break;case 'width':u=b._get_box_width(this.obj);if(i.attrs[h].by)i.attrs[h].value+=u;break;case 'scrollLeft':case 'scrollTop':u=(this.obj===document.body)?k(h):this.obj[h];if(i.attrs[h].by)i.attrs[h].value+=u;i['last'+h]=u;break;default:u=parseInt(a.getStyle(this.obj,h),10)||0;if(i.attrs[h].by)i.attrs[h].value+=u;break;}i.attrs[h].start=u;}if((i.attrs.height&&i.attrs.height.auto)||(i.attrs.width&&i.attrs.width.auto)){if(ua.firefox()<3)v=true;this._destroy_container();for(var h in {height:1,width:1,fontSize:1,borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderBottomWidth:1,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1})if(i.attrs[h])this.obj.style[h]=i.attrs[h].value+(typeof i.attrs[h].value=='number'?'px':'');if(i.attrs.height&&i.attrs.height.auto)i.attrs.height.value=b._get_box_height(this.obj);if(i.attrs.width&&i.attrs.width.auto)i.attrs.width.value=b._get_box_width(this.obj);}i.started=true;if(i.blind)this._build_container();}var p=(t-i.start)/i.duration;if(p>=1){p=1;if(i.hide)this._hide();}else j=false;var r=i.ease?i.ease(p):p;if(!s&&p!=1&&i.blind)s=true;if(v&&this.obj.parentNode){var q=this.obj.parentNode;var o=this.obj.nextSibling;q.removeChild(this.obj);}for(var h in i.attrs)switch(h){case 'backgroundColor':case 'borderColor':case 'color':this.obj.style[h]='rgb('+b.calc_tween(r,i.attrs[h].start[0],i.attrs[h].value[0],true)+','+b.calc_tween(r,i.attrs[h].start[1],i.attrs[h].value[1],true)+','+b.calc_tween(r,i.attrs[h].start[2],i.attrs[h].value[2],true)+')';break;case 'opacity':a.setStyle(this.obj,'opacity',b.calc_tween(r,i.attrs[h].start,i.attrs[h].value));break;case 'height':case 'width':this.obj.style[h]=r==1&&i.attrs[h].auto?'auto':b.calc_tween(r,i.attrs[h].start,i.attrs[h].value,true)+'px';break;case 'scrollLeft':case 'scrollTop':var m=this.obj===document.body;u=m?k(h):this.obj[h];if(i['last'+h]!==u){delete i.attrs[h];}else{var n=b.calc_tween(r,i.attrs[h].start,i.attrs[h].value,true);if(!m){n=this.obj[h]=n;}else{if(h=='scrollLeft'){d.scrollTo(n,k('scrollTop'));}else d.scrollTo(k('scrollLeft'),n);n=k(h);}i['last'+h]=n;}break;default:this.obj.style[h]=b.calc_tween(r,i.attrs[h].start,i.attrs[h].value,true)+'px';break;}if(p==1){this.queue.splice(l--,1);this._callback(i.ondone,t-i.start-i.duration);}}if(v)q[o?'insertBefore':'appendChild'](this.obj,o);if(!s&&this.container_div)this._destroy_container();return !j;};b.prototype.ondone=function(h){this.state.ondone=h;return this;};b.prototype._callback=function(h,i){if(h){b.offset=i;h.call(this);b.offset=0;}};b.calc_tween=function(h,i,j,k){return (k?parseInt:parseFloat)((j-i)*h+i,10);};b.parse_color=function(h){var i=/^#([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2})$/i.exec(h);if(i){return [parseInt(i[1].length==1?i[1]+i[1]:i[1],16),parseInt(i[2].length==1?i[2]+i[2]:i[2],16),parseInt(i[3].length==1?i[3]+i[3]:i[3],16)];}else{var j=/^rgba? *\(([0-9]+), *([0-9]+), *([0-9]+)(?:, *([0-9]+))?\)$/.exec(h);if(j){if(j[4]==='0'){return [255,255,255];}else return [parseInt(j[1],10),parseInt(j[2],10),parseInt(j[3],10)];}else if(h=='transparent'){return [255,255,255];}else throw 'Named color attributes are not supported.';}};b.parse_group=function(h){h=trim(h).split(/ +/);if(h.length==4){return h;}else if(h.length==3){return [h[0],h[1],h[2],h[1]];}else if(h.length==2){return [h[0],h[1],h[0],h[1]];}else return [h[0],h[0],h[0],h[0]];};b.push=function(h){if(!b.active)b.active=[];b.active.push(h);if(b.active.length===1){if(!b.requestAnimationFrame){var i=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame;if(i)b.requestAnimationFrame=i.bind(d);}if(b.requestAnimationFrame){b.requestAnimationFrame(b._animate);}else b.timeout=setInterval(b._animate,b.resolution,false);}if(b.requestAnimationFrame)b._updateEndingTimer();b._animate(Date.now(),true);};b._updateEndingTimer=function(){if(!b.requestAnimationFrame)throw new Error('Ending timer only valid with requestAnimationFrame');var k=0;for(var h=0;h<b.active.length;h++){var m=b.active[h];for(var l=0;l<m.queue.length;l++){var i=m.queue[l].start+m.queue[l].duration;if(i>k)k=i;}}if(b.timeout){clearTimeout(b.timeout);delete b.timeout;}var j=Date.now();if(k>j)b.timeout=setTimeout(b._animate.shield(),k-j,false);};b._animate=function(k,j){k=k||Date.now();for(var i=(j===true)?b.active.length-1:0;i<b.active.length;i++)try{if(!b.active[i]._frame(k))b.active.splice(i--,1);}catch(h){b.active.splice(i--,1);}if(b.active.length===0){if(b.timeout){if(b.requestAnimationFrame){clearTimeout(b.timeout);}else clearInterval(b.timeout);delete b.timeout;}}else if(b.requestAnimationFrame)b.requestAnimationFrame(b._animate);};b.ease={};b.ease.begin=function(h){return Math.sin(Math.PI/2*(h-1))+1;};b.ease.end=function(h){return Math.sin(.5*Math.PI*h);};b.ease.both=function(h){return .5*Math.sin(Math.PI*(h-.5))+.5;};b.prependInsert=function(i,h){b.insert(i,h,DOM.prependContent);};b.appendInsert=function(i,h){b.insert(i,h,DOM.appendContent);};b.insert=function(j,h,i){a.setStyle(h,'opacity',0);i(j,h);b(h).from('opacity',0).to('opacity',1).duration(400).go();};d.animation=e.exports=b;},3);
__d("css-support",["css-core","copyProperties"],function(d,f,g,e,c){var a=f('css-core');var b=f('copyProperties');b(a,{supportsBorderRadius:function(){var j=['KhtmlBorderRadius','OBorderRadius','MozBorderRadius','WebkitBorderRadius','msBorderRadius','borderRadius'];var k=false,h=document.createElement('div');for(var i=j.length;i>=0;i--)if(k=h.style[j[i]]!==undefined)break;a.supportsBorderRadius=bagof(k);return k;}});e.exports=a;},3);
__d("Locale",["css"],function(d,f,g,e,c){var a=f("css");var b={isRTL:function(){return 'rtl'===a.getStyle(document.body,'direction');}};e.exports=b;});
__d("getOverlayZIndex",["css"],function(d,f,g,e,b){var a=f("css");function c(j,l){l=l||document.body;var i=[];while(j&&j!==l){i.push(j);j=j.parentNode;}if(j!==l)return 0;for(var k=i.length-1;k>=0;k--){var h=i[k];if(a.getStyle(h,'position')!='static'){var m=parseInt(a.getStyle(h,'z-index'),10);if(!isNaN(m))return m;}}return 0;}e.exports=c;});
__d("Dialog",["array-extensions","event-extensions","AjaxPipeRequest","animation","Arbiter","ArrayUtils","AsyncRequest","bootloader","Button","css-support","dom","Form","HTML","Input","Keys","Locale","ObjectUtils","onload","Parent","ua","URI","Vector","bind","copyProperties","getOverlayZIndex","tx"],function(global,require,requireLazy,module,exports){require("array-extensions");require("event-extensions");var AjaxPipeRequest=require("AjaxPipeRequest");var animation=require("animation");var Arbiter=require("Arbiter");var ArrayUtils=require("ArrayUtils");var AsyncRequest=require("AsyncRequest");var Bootloader=require("bootloader");var Button=require("Button");var CSS=require("css-support");var DOM=require("dom");var Form=require("Form");var HTML=require("HTML");var Input=require("Input");var Keys=require("Keys");var Locale=require("Locale");var ObjectUtils=require("ObjectUtils");var Onload=require("onload");var Parent=require("Parent");var ua=require("ua");var URI=require("URI");var Vector=require("Vector");var bind=require("bind");var copyProperties=require("copyProperties");var getOverlayZIndex=require("getOverlayZIndex");global.tx=require("tx");var _supportsPositionFixed=function(){var body=document.body;var test=document.createElement('div');var control=document.createElement('div');body.insertBefore(test,body.firstChild);body.insertBefore(control,body.firstChild);test.style.position='fixed';test.style.top='20px';var result=test.offsetTop!==control.offsetTop;body.removeChild(test);body.removeChild(control);_supportsPositionFixed=bagof(result);return result;};function Dialog(model){this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+Dialog._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._shim=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(model)this._setFromModel(model);Dialog._init();}copyProperties(Dialog,{OK:{name:'ok',label:"Okay"},CANCEL:{name:'cancel',label:"Cancel",className:'inputaux'},CLOSE:{name:'close',label:"Close"},NEXT:{name:'next',label:"Next"},SAVE:{name:'save',label:"Save"},SUBMIT:{name:'submit',label:"Submit"},CONFIRM:{name:'confirm',label:"Confirm"},DELETE:{name:'delete',label:"Delete"},_globalCount:0,_bottoms:[0],max_bottom:0,_updateMaxBottom:function(){Dialog.max_bottom=Math.max.apply(Math,Dialog._bottoms);}});copyProperties(Dialog,{OK_AND_CANCEL:[Dialog.OK,Dialog.CANCEL],_STANDARD_BUTTONS:[Dialog.OK,Dialog.CANCEL,Dialog.CLOSE,Dialog.SAVE,Dialog.SUBMIT,Dialog.CONFIRM,Dialog.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[],_isUsingCSSBorders:function(){return CSS.supportsBorderRadius()||ua.ie()<7;},newButton:function(name,label,className,handler){var button={name:name,label:label};if(className)button.className=className;if(handler)button.handler=handler;return button;},getCurrent:function(){var stack=Dialog._stack;return stack.length?stack[stack.length-1]:null;},bootstrap:function(uri,data,read_only,method,model,elem){data=data||{};var use_pipe=elem&&elem.rel=='dialog-pipe';copyProperties(data,new URI(uri).getQueryData());method=method||(read_only?'GET':'POST');var status_elem=Parent.byClass(elem,'stat_elem')||elem;if(status_elem&&CSS.hasClass(status_elem,'async_saving'))return false;var request;if(use_pipe){request=new AjaxPipeRequest();}else request=new AsyncRequest().setReadOnly(!!read_only).setMethod(method).setRelativeTo(elem).setStatusElement(status_elem);request.setURI(uri).setNectarModuleDataSafe(elem).setData(data);var dialog=new Dialog(model).setCausalElement(elem).setAsync(request,use_pipe);dialog.show();return false;},_init:function(){this._init=bagofholding;Onload.runOnleave(Dialog._tearDown.shield(null,false));Arbiter.subscribe('page_transition',Dialog._tearDown.shield(null,true));Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)==Keys.ESC&&!event.getModifiers().any){if(Dialog._escape())event.kill();}else if(Event.getKeyCode(event)==Keys.RETURN&&!event.getModifiers().any)if(Dialog._enter())event.kill();});Event.listen(window,'resize',function(event){var dialog=Dialog.getCurrent();dialog&&dialog._resetDialogObj();});},_findButton:function(buttons,name){if(buttons)for(var i=0;i<buttons.length;++i)if(buttons[i].name==name)return buttons[i];return null;},_tearDown:function(is_page_transition){var stack=Dialog._stack.slice();for(var ii=stack.length-1;ii>=0;ii--)if(!(is_page_transition&&stack[ii]._cross_transition))stack[ii].hide();},_escape:function(){var dialog=Dialog.getCurrent();if(!dialog)return false;var semi_modal=dialog._semi_modal;var buttons=dialog._buttons;if(!buttons.length&&!semi_modal)return false;if(semi_modal&&!buttons.length){dialog.hide();return true;}var button_to_simulate;var cancel_button=Dialog._findButton(buttons,'cancel');if(dialog._cancelHandler){dialog.cancel();return true;}else if(cancel_button){button_to_simulate=cancel_button;}else if(buttons.length==1){button_to_simulate=buttons[0];}else return false;dialog._handleButton(button_to_simulate);return true;},_enter:function(){var dialog=Dialog.getCurrent();if(!dialog||!dialog._submit_on_enter)return false;if(document.activeElement!=dialog._frame)return false;var buttons=dialog._buttons;if(!buttons)return false;dialog._handleButton(buttons[0]);return true;},call_or_eval:function(obj,func,args){if(!func)return undefined;args=args||{};if(typeof(func)=='string'){var params=ObjectUtils.getKeys(args).join(', ');func=eval('({f: function('+params+') { '+func+'}})').f;}return func.apply(obj,ObjectUtils.getValues(args));}});copyProperties(Dialog.prototype,{_cross_transition:false,_loading:false,_showing:false,show:function(){if(this._async_request&&this._show_loading){this.showLoading();}else{this._showing=true;this._update();}return this;},showLoading:function(){this._loading=true;CSS.addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;},hide:function(){if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&Dialog._stack.length<=1){this._fadeOut();}else this._hide();return this;},cancel:function(){if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();},getRoot:function(){return this._obj;},getBody:function(){return DOM.scry(this._obj,'div.dialog_body')[0];},getButtonElement:function(button){if(typeof button=='string')button=Dialog._findButton(this._buttons,button);if(!button||!button.name)return null;var inputs=DOM.scry(this._popup,'input');var name_filter=function(elem){return elem.name==button.name;};return inputs.filter(name_filter)[0]||null;},getContentNode:function(){return DOM.find(this._content,'div.dialog_content');},getFormData:function(){return Form.serialize(this.getContentNode());},setAllowCrossPageTransition:function(allow){this._cross_transition=allow;return this;},setShowing:function(){this.show();return this;},setHiding:function(){this.hide();return this;},setTitle:function(title){var node=this._nodes.title;var inner_node=this._nodes.title_inner;var content_node=this._nodes.content;DOM.setContent(inner_node,this._format(title||''));CSS.conditionShow(node,!!title);CSS.conditionClass(content_node,'dialog_content_titleless',!title);return this;},setBody:function(body){DOM.setContent(this._nodes.body,this._format(body));return this;},setExtraData:function(data){this._extra_data=data;return this;},setReturnData:function(data){this._return_data=data;return this;},setShowLoading:function(show){this._show_loading=show;return this;},setFullBleed:function(is_full_bleed){this._full_bleed=is_full_bleed;this._updateWidth();CSS.conditionClass(this._obj,'full_bleed',is_full_bleed);return this;},setCausalElement:function(elem){this._causal_elem=elem;return this;},setUserData:function(data){this._user_data=data;return this;},getUserData:function(){return this._user_data;},setAutohide:function(autohide){if(autohide){if(this._showing){this._autohide_timeout=setTimeout(this.hide.shield(this),autohide);}else this._autohide=autohide;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;},setSummary:function(summary){var node=this._nodes.summary;DOM.setContent(node,this._format(summary||''));CSS.conditionShow(node,!!summary);return this;},setButtons:function(b){var buttons,button;if(!(b instanceof Array)){buttons=ArrayUtils.createFrom(arguments);}else buttons=b;for(var i=0;i<buttons.length;++i)if(typeof buttons[i]=='string'){button=Dialog._findButton(Dialog._STANDARD_BUTTONS,buttons[i]);buttons[i]=button;}this._buttons=buttons;var button_content=[];if(buttons&&buttons.length>0)for(var ii=0;ii<buttons.length;ii++){button=buttons[ii];var button_input=DOM.$N('input',{type:'button',name:button.name||'',value:button.label});var button_node=DOM.$N('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},button_input);if(button.className){button.className.split(/\s+/).each(function(e){CSS.addClass(button_node,e);});if(CSS.hasClass(button_node,'inputaux')){CSS.removeClass(button_node,'inputaux');CSS.removeClass(button_node,'uiButtonConfirm');}if(CSS.hasClass(button_node,'uiButtonSpecial'))CSS.removeClass(button_node,'uiButtonConfirm');}if(button.icon)DOM.prependContent(button_node,DOM.$N('img',{src:button.icon,className:'img mrs'}));if(button.disabled)Button.setEnabled(button_node,false);Event.listen(button_input,'click',this._handleButton.bind(this,button.name));for(var attr in button)if(attr.indexOf('data-')===0&&attr.length>5)button_input.setAttribute(attr,button[attr]);button_content.push(button_node);}DOM.setContent(this._nodes.buttons,button_content);this._updateButtonVisibility();return this;},setButtonsMessage:function(message){DOM.setContent(this._nodes.button_message,this._format(message||''));this._has_button_message=!!message;this._updateButtonVisibility();return this;},_updateButtonVisibility:function(){var show=this._buttons.length>0||this._has_button_message;CSS.conditionShow(this._nodes.button_wrapper,show);CSS.conditionClass(this._obj,'omitDialogFooter',!show);},setClickButtonOnEnter:function(input_id,button){this._clickOnEnterTarget=input_id;if(!this._clickOnEnterListener)this._clickOnEnterListener=Event.listen(this._nodes.body,'keypress',function(event){var target=event.getTarget();if(target&&target.id===this._clickOnEnterTarget)if(Event.getKeyCode(event)==Keys.RETURN){this._handleButton(button);event.kill();}return true;}.bind(this));return this;},setStackable:function(stackable,shown){this._is_stackable=stackable;this._shown_while_stacked=stackable&&shown;return this;},setHandler:function(handler){this._handler=handler;return this;},setCancelHandler:function(cancelHandler){this._cancelHandler=Dialog.call_or_eval.bind(null,this,cancelHandler);return this;},setCloseHandler:function(close_handler){this._close_handler=Dialog.call_or_eval.bind(null,this,close_handler);return this;},clearHandler:function(){return this.setHandler(null);},setPostURI:function(post_uri,asynchronous){if(asynchronous===undefined)asynchronous=true;if(asynchronous){this.setHandler(this._submitForm.bind(this,'POST',post_uri));}else this.setHandler(function(){Form.post(post_uri,this.getFormData());this.hide();}.bind(this));return this;},setGetURI:function(get_uri){this.setHandler(this._submitForm.bind(this,'GET',get_uri));return this;},setModal:function(modal){this._modal=modal;CSS.conditionClass(this._obj,'generic_dialog_modal',modal);return this;},setSemiModal:function(clickout){if(clickout){this.setModal(true);this._semiModalListener=Event.listen(this._obj,'click',function(e){if(!DOM.contains(this._popup,e.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=clickout;return this;},setWideDialog:function(is_wide){this._wide_dialog=is_wide;this._updateWidth();return this;},setContentWidth:function(width){this._content_width=width;this._updateWidth();return this;},setTitleLoading:function(loading){if(loading===undefined)loading=true;var header=DOM.find(this._popup,'h2.dialog_title');if(header)CSS.conditionClass(header,'loading',loading);return this;},setSecure:function(is_secure){CSS.conditionClass(this._nodes.title,'secure',is_secure);return this;},setClassName:function(class_name){CSS.addClass(this._obj,class_name);return this;},setFadeEnabled:function(enabled){this._fade_enabled=enabled;return this;},setFooter:function(footer){var node=this._nodes.footer;DOM.setContent(node,this._format(footer||''));CSS.conditionShow(node,!!footer);return this;},setAutoFocus:function(focus){this._auto_focus=focus;return this;},setTop:function(top){this._top=top;this._resetDialogObj();return this;},onloadRegister:function(handler){ArrayUtils.createFrom(handler).forEach(function(i){if(typeof i=='string')i=new Function(i);this._onload_handlers.push(i.bind(this));}.bind(this));return this;},setAsyncURL:function(url){return this.setAsync(new AsyncRequest(url));},setAsync:function(async_request,use_pipe){var handler=function(response){if(this._async_request!=async_request)return;this._async_request=null;var payload=response.getPayload();var dialog=payload;var fn=function(){if(this._loading)this._showing=true;if(typeof dialog=='string'){this.setBody(dialog);}else this._setFromModel(dialog);this._update();}.bind(this);if(use_pipe){dialog=payload.dialog;Bootloader.setResourceMap(payload.resource_map);Bootloader.loadResources(payload.css,fn);}else fn();}.bind(this);var data=async_request.getData();data.__d=1;async_request.setData(data);var request;if(use_pipe){async_request.setFirstResponseHandler(handler);request=async_request.getAsyncRequest();}else{var orig_handler=async_request.getHandler()||bagofholding;async_request.setHandler(function(response){orig_handler(response);handler(response);});request=async_request;}var orig_error_handler=request.getErrorHandler()||bagofholding;var orig_trans_error_handler=request.getTransportErrorHandler()||bagofholding;var handle_error=function(){this._async_request=null;if(this._showing){this._update();}else this._hide();}.bind(this);request.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(response){handle_error();orig_error_handler(response);}).setTransportErrorHandler(function(response){handle_error();orig_trans_error_handler(response);});async_request.send();this._async_request=async_request;this._update();return this;},_format:function(content){if(typeof content=='string'){content=HTML(content);}else content=HTML.replaceJSONWrapper(content);if(content instanceof HTML)content.setDeferred(true);return content;},_update:function(){if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(bind(this,'hide'),this._autohide);if(this._async_request&&this._show_loading){this.showLoading();}else{CSS.removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;Input.focus(this._frame);}},_runOnloads:function(){for(var i=0;i<this._onload_handlers.length;++i)try{this._onload_handlers[i]();}catch(ex){}this._onload_handlers=[];},_updateWidth:function(){var dialog_width=2*Dialog._BORDER_WIDTH;if(Dialog._isUsingCSSBorders())dialog_width+=2*Dialog._HALO_WIDTH;if(this._content_width){dialog_width+=this._content_width;if(!this._full_bleed)dialog_width+=2*Dialog._PADDING_WIDTH;}else if(this._wide_dialog){dialog_width+=Dialog.SIZE.WIDE;}else dialog_width+=Dialog.SIZE.STANDARD;this._popup.style.width=dialog_width+'px';},_renderDialog:function(){this._showDialog();this._submit_on_enter=false;if(this._auto_focus){var input=Form.getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(input){Form.focusFirst.bind(this,this._content).defer();}else this._submit_on_enter=true;}var bottom=Vector.getElementDimensions(this._content).y+Vector.getElementPosition(this._content).y;Dialog._bottoms.push(bottom);this._bottom=bottom;Dialog._updateMaxBottom();return this;},_buildDialog:function(){this._obj=DOM.$N('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';document.body.appendChild(this._obj);if(!this._popup)this._popup=DOM.$N('div',{className:'generic_dialog_popup'});this._popup.style.left=this._popup.style.top='';this._obj.appendChild(this._popup);if(ua.ie()<7&&!this._shim)Bootloader.loadComponents('iframe-shim',function(){this._shim=new IframeShim(this._popup);});this._buildDialogContainer();this._buildDialogContent();},_showDialog:function(){if(!this._hasSetZIndex&&this._causal_elem){var z_index=getOverlayZIndex(this._causal_elem);this._hasSetZIndex=z_index>(this._modal?400:200);CSS.setStyle(this._obj,'z-index',this._hasSetZIndex?z_index:'');}this._pushOntoStack();this._obj.style.height=(this._modal&&ua.ie()<7)?Vector.getDocumentDimensions().y+'px':null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);return this;},_updateShim:function(){return this._shim&&this._shim.show();},_activeResize:function(){if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}},_buildDialogContainer:function(){CSS.addClass(this._obj,'pop_dialog');if(Locale.isRTL())CSS.addClass(this._obj,'pop_dialog_rtl');var markup;if(Dialog._isUsingCSSBorders()){markup='<div class="pop_container_advanced">'+'<div class="pop_content" id="pop_content"></div>'+'</div>';}else markup='<div class="pop_container">'+'<div class="pop_verticalslab"></div>'+'<div class="pop_horizontalslab"></div>'+'<div class="pop_topleft"></div>'+'<div class="pop_topright"></div>'+'<div class="pop_bottomright"></div>'+'<div class="pop_bottomleft"></div>'+'<div class="pop_content pop_content_old" id="pop_content"></div>'+'</div>';DOM.setContent(this._popup,HTML(markup));var frame=DOM.find(this._popup,'div.pop_content');frame.setAttribute('tabIndex','0');frame.setAttribute('role','alertdialog');this._frame=this._content=frame;},_buildDialogContent:function(){var loading=DOM.$N('div',{className:'dialog_loading'},"Loading...");var title_inner=DOM.$N('span');var title=DOM.$N('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},title_inner);var summary=DOM.$N('div',{className:'dialog_summary hidden_elem'});var body=DOM.$N('div',{className:'dialog_body'});var buttons=DOM.$N('div');var button_message=DOM.$N('div',{className:'dialog_buttons_msg'});var button_wrapper=DOM.$N('div',{className:'dialog_buttons clearfix hidden_elem'},[button_message,buttons]);var footer=DOM.$N('div',{className:'dialog_footer hidden_elem'});var content=DOM.$N('div',{className:'dialog_content'},[summary,body,button_wrapper,footer]);this._nodes={summary:summary,body:body,buttons:buttons,button_message:button_message,button_wrapper:button_wrapper,footer:footer,content:content,title:title,title_inner:title_inner};DOM.setContent(this._frame,[title,content,loading]);},resetDialogPosition:function(){if(!this._popup)return;this._resetDialogObj();this._updateShim();},_resetDialogObj:function(){var total_margin=2*Dialog._PAGE_MARGIN;var viewport_dimensions=Vector.getViewportDimensions();var viewport_width=viewport_dimensions.x-total_margin;var viewport_height=viewport_dimensions.y-total_margin;var total_halo_width=2*Dialog._HALO_WIDTH;var content_dimensions=Vector.getElementDimensions(this._content);var content_width=content_dimensions.x+total_halo_width;var content_height=content_dimensions.y+total_halo_width;var top=this._top;var empty_horiz_space=viewport_width-content_width;var empty_vertical_space=viewport_height-content_height;if(empty_vertical_space<0){top=Dialog._PAGE_MARGIN;}else if(top>empty_vertical_space)top=Dialog._PAGE_MARGIN+(Math.max(empty_vertical_space,0)/2);var is_fixed=_supportsPositionFixed();if(!is_fixed)top+=Vector.getScrollPosition().y;CSS.setStyle(this._popup,'top',top+'px');var scroll=is_fixed&&(empty_horiz_space<0||empty_vertical_space<0);CSS.conditionClass(this._obj,'generic_dialog_fixed_overflow',scroll);CSS.conditionClass(document.documentElement,'generic_dialog_overflow_mode',scroll);},_fadeOut:function(temporary){if(!this._popup)return;try{animation(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,temporary)).go();}catch(e){this._hide(temporary);}},_hide:function(temporary){if(this._obj)this._obj.style.display='none';CSS.removeClass(document.documentElement,'generic_dialog_overflow_mode');this._updateShim();clearInterval(this.active_hiding);if(this._bottom){var bs=Dialog._bottoms;bs.splice(bs.indexOf(this._bottom),1);Dialog._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&DOM.contains(this._obj,document.activeElement))Input.focus(this._previous_focus);if(temporary)return;this.destroy();},destroy:function(){this._popFromStack();if(this._obj){DOM.remove(this._obj);this._obj=null;this._shim&&this._shim.hide();this._shim=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});},_handleButton:function(button){if(typeof button=='string')button=Dialog._findButton(this._buttons,button);var value=Dialog.call_or_eval(button,button.handler);if(value===false)return;if(button.name=='cancel'){this.cancel();}else if(Dialog.call_or_eval(this,this._handler,{button:button})!==false)this.hide();},_submitForm:function(method,uri,button){var data=this.getFormData();if(button)data[button.name]=button.label;if(this._extra_data)copyProperties(data,this._extra_data);var async_request=new AsyncRequest().setURI(uri).setData(data).setMethod(method).setNectarModuleDataSafe(this._causal_elem).setReadOnly(method=='GET');this.setAsync(async_request);return false;},_setFromModel:function(original_model){var model={};copyProperties(model,original_model);for(var propertyName in model){if(propertyName=='onloadRegister'){this.onloadRegister(model[propertyName]);continue;}var mutator=this['set'+propertyName.substr(0,1).toUpperCase()+propertyName.substr(1)];mutator.apply(this,ArrayUtils.createFrom(model[propertyName]));}},_updateBottom:function(){var bottom=Vector.getElementDimensions(this._content).y+Vector.getElementPosition(this._content).y;Dialog._bottoms[Dialog._bottoms.length-1]=bottom;Dialog._updateMaxBottom();},_pushOntoStack:function(){var stack=Dialog._stack;if(!stack.length)Arbiter.inform('layer_shown',{type:'Dialog'});stack.remove(this);stack.push(this);for(var i=stack.length-2;i>=0;i--){var prev_dialog=stack[i];if(!prev_dialog._is_stackable&&!prev_dialog._async_request){prev_dialog._hide();}else if(!prev_dialog._shown_while_stacked)prev_dialog._hide(true);}},_popFromStack:function(){var stack=Dialog._stack;var was_top=(stack[stack.length-1]===this);stack.remove(this);if(stack.length){if(was_top)stack[stack.length-1]._showDialog();}else Arbiter.inform('layer_hidden',{type:'Dialog'});}});module.exports=Dialog;});
__d("DOMScroll",["bootloader","css","Vector","dom","dom-core"],function(h,j,k,i,f){var b=j("bootloader");var c=j("css");var e=j("Vector");var a=j("dom").$N;var g=j("dom-core").ge;var d={getScrollState:function(){var o=e.getViewportDimensions();var l=e.getDocumentDimensions();var m=(l.x>o.x);var n=(l.y>o.y);m+=0;n+=0;return new e(m,n);},_scrollbarSize:null,_initScrollbarSize:function(){var l=a('p');l.style.width='100%';l.style.height='200px';var m=a('div');m.style.position='absolute';m.style.top='0px';m.style.left='0px';m.style.visibility='hidden';m.style.width='200px';m.style.height='150px';m.style.overflow='hidden';m.appendChild(l);document.body.appendChild(m);var n=l.offsetWidth;m.style.overflow='scroll';var o=l.offsetWidth;if(n==o)o=m.clientWidth;document.body.removeChild(m);d._scrollbarSize=n-o;},getScrollbarSize:function(){if(d._scrollbarSize===null)d._initScrollbarSize();return d._scrollbarSize;},scrollTo:function(q,l,o,m,n){if(typeof l=='undefined'||l===true)l=750;if(!(q instanceof e)){var r=e.getScrollPosition().x;var s=e.getElementPosition(g(q)).y;q=new e(r,s,'document');if(!m){var p=g('blueBar');if(p&&c.isFixed(p))q.y-=e.getElementDimensions(p).y/(o?2:1);}}if(o){q.y-=e.getViewportDimensions().y/2;}else if(m){q.y-=e.getViewportDimensions().y;q.y+=m;}q=q.convertTo('document');if(l){b.loadComponents('animation',function(){var t=document.body;animation(t).to('scrollTop',q.y).to('scrollLeft',q.x).ease(animation.ease.end).duration(l).ondone(n).go();});}else if(window.scrollTo){window.scrollTo(q.x,q.y);n&&n();}}};i.exports=d;});
__d("LinkController",["event-extensions","DataStore","Parent","trackReferrer"],function(k,m,n,l,j){m("event-extensions");var a=m("DataStore");var c=m("Parent");var o=m("trackReferrer");var d='LinkControllerHandler';var h=[];var f=[];function e(event){var r=c.byTag(event.getTarget(),'a');var p=r&&r.getAttribute('href',2);if(!p||r.rel||!i(p)||a.get(r,d))return;var q=Event.listen(r,'click',function(s){if(p.charAt(p.length-1)=='#'){s.prevent();return;}o(r,p);g(r,s);});a.set(r,d,q);}function g(s,event){if(s.target||event.getModifiers().any||(event.which&&event.which!=1))return;var p=h.concat(f);for(var q=0,r=p.length;q<r;q++)if(p[q](s,event)===false)return event.kill();}function i(p){var q=p.match(/^(\w+):/);return !q||q[1].match(/^http/i);}var b={registerHandler:function(p){h.push(p);},registerFallbackHandler:function(p){f.push(p);}};if(k.LinkController){l.exports=k.LinkController;}else{Event.listen(document.documentElement,'mousedown',e);Event.listen(document.documentElement,'keydown',e);l.exports=b;}});
__d("PageTransitions",["event-extensions","function-extensions","string-extensions","Arbiter","Dialog","dom","DOMScroll","Env","Form","HistoryManager","JSLogger","LinkController","ObjectUtils","ua","URI","Util","Vector","computeRelativeURI","copyProperties","dom-core","goOrReplace","userAction","tx"],function(t,w,x,v,r){w("event-extensions");w("function-extensions");w("string-extensions");var a=w("Arbiter");var d=w("Dialog");var b=w("dom");var c=w("DOMScroll");var e=w("Env");var f=w("Form");var g=w("HistoryManager");var h=w("JSLogger");var i=w("LinkController");var j=w("ObjectUtils");var y=w("ua");var l=w("URI");var m=w("Util");var n=w("Vector");var p=w("computeRelativeURI");var q=w("copyProperties");var s=w("dom-core").ge;var u=w("goOrReplace");var z=w("userAction");t.tx=w("tx");var k={_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!k._initialized;},_init:function(){if(!e.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(k._initialized)return k;k._initialized=true;var zd=l.getRequestURI(false);var za=zd.getUnqualifiedURI();var ze=l(za).setFragment(null);var zc=za.getFragment();if(zc.charAt(0)==='!'&&ze.toString()===zc.substr(1))za=ze;q(k,{_current_uri:za,_most_recent_uri:za,_next_uri:za});var zb;if(zd.getFragment().startsWith('/')){zb=zd.getFragment();}else zb=za;g.init().setCanonicalLocation('#'+zb).registerURIHandler(k._historyManagerHandler);i.registerFallbackHandler(k._rewriteHref);i.registerFallbackHandler(k._onlinkclick);Event.listen(document.documentElement,'submit',k._onformsubmit);Event.listen(window,'scroll',function(){if(!k._scroll_locked)k._scroll_positions[k._current_uri]=n.getScrollPosition();});return k;},registerHandler:function(zb,za){k._init();za=za||5;if(!k._transition_handlers[za])k._transition_handlers[za]=[];k._transition_handlers[za].push(zb);},getCurrentURI:function(za){if(!k._current_uri&&!za)return new l(k._most_recent_uri);return new l(k._current_uri);},getMostRecentURI:function(){return new l(k._most_recent_uri);},getNextURI:function(){return new l(k._next_uri);},_rewriteHref:function(za){var zc=za.getAttribute('href');var zb=p(k._most_recent_uri.getQualifiedURI(),zc).toString();if(zc!=zb)za.setAttribute('href',zb);},_onlinkclick:function(za){o.lookBusy(za);k.go(za.getAttribute('href'));return false;},_onformsubmit:function(event){var zb=event.getTarget();if(f.getAttribute(zb,'rel')||f.getAttribute(zb,'target'))return;var za=z('form',zb,event).set_namespace('page_transition');if(window.ArbiterMonitor)ArbiterMonitor.initUA(za,[zb]);var zd=new l(f.getAttribute(zb,'action')||'');var zc=p(k._most_recent_uri,zd);zb.setAttribute('action',zc.toString());if((f.getAttribute(zb,'method')||'GET').toUpperCase()==='GET'){k.go(zc.addQueryData(f.serialize(zb)));event.kill();}},go:function(zd,zb){var za=new l(zd).removeQueryData('quickling').getQualifiedURI();var zc=za.getUnqualifiedURI();delete k._scroll_positions[zc];!zb&&z('uri',{href:za.toString()},null,'INDIRECT');o.lookBusy();k._loadPage(za,function(ze){if(ze){g.go(za.toString(),false,zb);}else u(window.location,za,zb);});},_historyManagerHandler:function(za){if(za.charAt(0)!='/')return false;z('h',{href:za},null);k._loadPage(new l(za),function(zb){if(!zb)u(window.location,za,true);});return true;},_loadPage:function(ze,zc){if(l(ze).getFragment()&&j.areEqual(l(ze).setFragment(null).getQualifiedURI(),l(k._current_uri).setFragment(null).getQualifiedURI())){k._current_uri=k._most_recent_uri=ze;k.restoreScrollPosition();o.stopLookingBusy();return;}var zd=k._scroll_positions[k._current_uri];k._current_uri=null;k._next_uri=ze;if(zd)c.scrollTo(zd,false);var zb=function(){k._scroll_locked=true;var zf=k._handleTransition(ze);zc&&zc(zf);};var za=_runHooks('onbeforeleavehooks');if(za){o.stopLookingBusy();k._warnBeforeLeaving(za,zb);}else zb();},_handleTransition:function(zg){window.onbeforeleavehooks=undefined;o.lookBusy();if(!zg.isSameOrigin())return false;var zf=window.AsyncRequest&&window.AsyncRequest.getLastId();a.inform("pre_page_transition",{from:k.getMostRecentURI(),to:zg});for(var zc=k._transition_handlers.length-1;zc>=0;--zc){var zb=k._transition_handlers[zc];if(!zb)continue;for(var zd=zb.length-1;zd>=0;--zd)if(zb[zd](zg)===true){var ze={sender:this,uri:zg,id:zf};try{a.inform("page_transition",ze);}catch(za){}return true;}else zb.splice(zd,1);}return false;},unifyURI:function(){k._current_uri=k._most_recent_uri=k._next_uri;},transitionComplete:function(za){k._executeCompletionCallback();o.stopLookingBusy();k.unifyURI();if(!za)k.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(zb){}},_executeCompletionCallback:function(){if(k._completionCallback)k._completionCallback();k._completionCallback=null;},setCompletionCallback:function(za){k._completionCallback=za;},rewriteCurrentURI:function(zb,za){k.registerHandler(function(){if(zb==k.getMostRecentURI().getUnqualifiedURI().toString()){k.transitionComplete();return true;}});k.go(za,true);},_warnBeforeLeaving:function(zb,za){new d().setTitle("Are you sure you want to leave this page?").setBody(htmlize(zb)).setButtons([{name:'leave_page',label:"Leave this Page",handler:za},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).setModal(true).show();},restoreScrollPosition:function(){k._scroll_locked=false;var zc=k._current_uri;var ze=k._scroll_positions[zc];if(ze){c.scrollTo(ze,false);return;}function zd(zf){return (zf||null)&&(b.scry(document.body,"a[name='"+escape_js_quotes(zf)+"']")[0]||s(zf));}var za=zd(l(zc).getFragment());if(za){var zb=n.getElementPosition(za);zb.x=0;c.scrollTo(zb);}}};var o=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(za){if(za)o._giveProgressCursor(za);if(o._looking_busy)return;o._looking_busy=true;o._giveProgressCursor(document.documentElement);},stopLookingBusy:function(){if(!o._looking_busy)return;o._looking_busy=false;while(o._original_cursors.length){var zc=o._original_cursors.pop();var zb=zc[0];var za=zc[1];if(zb.style)zb.style.cursor=za||'';}},_giveProgressCursor:function(za){if(!y.safari()){o._original_cursors.push([za,za.style.cursor]);za.style.cursor='progress';}}};v.exports=k;});
__d("legacy:page-transitions",["goOrReplace","computeRelativeURI","HistoryManager","PageTransitions"],function(a,b,c){a.go_or_replace=b('goOrReplace');a.computeRelativeURI=b('computeRelativeURI');a.HistoryManager=a.HistoryManager||b('HistoryManager');a.PageTransitions=a.PageTransitions||b('PageTransitions');},3);
var NavigationMessage={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_FIRST_RESPONSE:'NavigationMessage/navigationFirstResponse',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',NAVIGATION_FAVORITE_UPDATE:'NavigationMessage/navigationFavoriteUpdate',NAVIGATION_ITEM_REMOVED:'NavigationMessage/navigationItemRemoved',NAVIGATION_ITEM_HIDDEN:'NavigationMessage/navigationItemHidden',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};
function AsyncLayout(){}AsyncLayout.prototype={init:function(a){this.canvas_id=a;if(ge('rightCol'))this.auxiliary_id='rightCol';if(ge('headerArea'))this.header_id='headerArea';if(ge('toolbarContainer'))this.toolbar_id='toolbarContainer';this.waitingForAux=false;PageTransitions.registerHandler(this.catchPageTransition.bind(this));this.subscription=Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this.onNavigate.bind(this));return this;},catchPageTransition:function(a){Arbiter.unsubscribe(this.subscription);return false;},getCanvasID:function(a){return this.customCanvasID?this.customCanvasID:(a.sidecol?'contentCol':'contentArea');},onNavigate:function(c,a){var d=a.useAjaxPipe;a=a.params;if(a.endpoint){if(this.request){this.request.setFinallyHandler(bagofholding);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(d){this.request=new AjaxPipeRequest().setURI(a.endpoint).setData(a).setCanvasId(this.getCanvasID(a)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{a.handled=true;this.waitingForAux=a.sidecol;var e=!!a.iframe;var b=new AsyncRequest().setOption('useIframeTransport',e).setURI(new URI(a.endpoint)).setReadOnly(true).setMethod('GET').setData(a).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=b;b.send();}}},onSideResponse:function(b){var a=b.getPayload();if(a&&this.auxiliary_id)this.receivedAux(a);},receivedAux:function(a){!this.waitingForAux;this.waitingForAux=false;DOM.setContent($(this.auxiliary_id),HTML(a));},onResponse:function(e){var d=e.getPayload();if(d.redirect){goURI(d.redirect);}else{var c=d.html||d;DOM.setContent($(this.canvas_id),HTML(c));if(d.side_html&&this.auxiliary_id)this.receivedAux(d.side_html);if(this.header_id&&!d.keep_header){var b=$(this.header_id);DOM.setContent(b,HTML(d.header_html||''));CSS.conditionShow(b,d.header_html);}if(d.toolbar_html&&this.toolbar_id)DOM.setContent($(this.toolbar_id),HTML(d.toolbar_html));if(d.js)(new Function(d.js))();CSS.conditionClass('contentCol','hasRightCol',this.auxiliary_id&&!d.noRightSide);var f=ge('rightCol');if(f&&d.noRightSide)DOM.empty(f);}var a=e.getRequest().getData();Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED,a.key);},errorHandler:function(a){AsyncResponse.verboseErrorHandler(a);Arbiter.inform(NavigationMessage.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(a){window.scrollTo(0,0);Arbiter.inform(NavigationMessage.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(a){this.request=null;PageTransitions.transitionComplete(true);Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED);}};
__d("legacy:vector",["Vector"],function(a,b,c){a.Vector2=b('Vector');},3);
function FutureSideNav(){FutureSideNav.instance&&FutureSideNav.instance.uninstall();FutureSideNav.instance=this;}FutureSideNav.instance=null;FutureSideNav.getInstance=function(){return FutureSideNav.instance||new FutureSideNav();};FutureSideNav.prototype={init:function(c,b,a){this.root=c;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=b;this.uri=URI.getRequestURI();this.ajaxPipe=a;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;PageTransitions.registerHandler(function(d){return this._handlePageTransitions&&this.handlePageTransition(d);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAILED,this.navigationFailed.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_SELECT,this.navigationSelect.bind(this)),Arbiter.subscribe(PresenceMessage.getArbiterMessageType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(Selector.subscribe(['open','close'],function(f,d){var e=Parent.byClass(d.selector,'sideNavItem');e&&CSS.conditionClass(e,'editMenuOpened',f==='open');}));onleaveRegister(this.uninstall.bind(this));},_handleResize:(function(){var a;return function(){a&&clearTimeout(a);a=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){CSS.conditionClass(this.root,'uiNarrowSideNav',Vector2.getElementPosition(this.root).x<20);},_ensureHover:function(a){if(ua.ie()<8)Bootloader.loadComponents('explicit-hover',function(){this._explicitHover.push(new ExplicitHover(this.root,a));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(Arbiter.unsubscribe);this._selectorSubscriptions.forEach(Selector.unsubscribe.bind(Selector));this._eventHandlers.forEach(function(a){a.remove();});this._explicitHover.forEach(function(a){a.uninstall();});}},initSection:function(b,a){this._initItems(a);this._initSection(b);},addItem:function(a,b){this._initItem(a,b);},_initItems:function(b){var a=function(c,e){var d=this._initItem(c,e);$(c.children).forEach(function(f){a(f,d);});}.bind(this);$A(b).forEach(function(c){a(c,null);});},_initItem:function(a,d){var b=this.items[a.id]=this._constructItem(a,d);if(b.equals(this.selected)||a.selected)this.setSelected(b);var c=b.getLinkNode();c&&this._eventHandlers.push(Event.listen(c,'click',function(event){return !this.editing;}.bind(this)));return b;},_initSection:function(a){var b=this.sections[a.id]=this._constructSection(a);this._eventHandlers.push(Event.listen(b.node,'click',this.handleSectionClick.bind(this,b)));DOM.scry(b.node,'div.bookmarksMenuButton').forEach(CSS.show);return b;},_constructItem:function(a,b){return new FutureSideNavItem(a,b);},_constructSection:function(a){return new FutureSideNavSection(a);},handleSectionClick:function(c,event){var b=this._getEventTarget(event,'a');var a=this._getItemForNode(b);if(!b){return;}else if(CSS.hasClass(b.parentNode,'uiMenuItem')){this._handleMenuClick(c,a,b.parentNode,event);}else this._handleLinkClick(c,b,event);},_getEventTarget:function(event,a){var b=event.getTarget();if(b.tagName!==a.toUpperCase()){return Parent.byTag(b,a);}else return b;},_handleMenuClick:function(c,a,b,event){if(CSS.hasClass(b,'rearrange'))this.beginEdit(c);},_handleLinkClick:function(b,a,event){if(CSS.hasClass(a,'navEditDone')){this.editing?this.endEdit():this.beginEdit(b);event.kill();}},getItem:function(a){if(this._isCurrentPath(a)){return this._getItemForKey(this._getKey(a.getQueryData())||this.defaultKey);}else return this._getItemForPath(a.getPath());},getNodeForKey:function(b){var a=this._getItemForKey(b);if(a)return a.node;},_isCurrentPath:function(a){return a.getDomain()===this.uri.getDomain()&&a.getPath()===this.uri.getPath();},_getKey:function(a){return a[this.keyParam];},_getItemForNode:function(a){a=Parent.byClass(a,'sideNavItem');return a&&this.items[a.id];},_getItemForKey:function(a){return this._findItem(function(b){return b.matchKey(a);});},_getItemForPath:function(a){return this._findItem(function(b){return b.matchPath(a);});},_findItem:function(a){for(var b in this.items)if(a(this.items[b]))return this.items[b];},removeItem:function(a){if(a&&this.items[a.id]){DOM.remove(a.node);delete this.items[a.id];}},removeItemByKey:function(a){this.removeItem(this._getItemForKey(a));},moveItem:function(d,b,c){var a=DOM.find(d.node,'ul.uiSideNav');(c?DOM.prependContent:DOM.appendContent)(a,b.node);},setLoading:function(a){this.loading&&this.loading.hideLoading();this.loading=a;this.loading&&this.loading.showLoading();},setSelected:function(a){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=a;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(c){var a=this.getItem(c);var b=a&&a.endpoint&&this._doPageTransition(a,c);return b;},_doPageTransition:function(a,b){this.setLoading(a);this._sendPageTransition(a.endpoint,copy_properties(this._getTransitionData(a,b),b.getQueryData()));return true;},_sendPageTransition:function(b,a){a.endpoint=b;Arbiter.inform(NavigationMessage.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(b),params:a});},_getTransitionData:function(b,c){var a={};a.sidecol=this.sidecol;a.path=c.getPath();a[this.keyParam]=b.textKey;a.key=b.textKey;return a;},_useAjaxPipe:function(a){return this.ajaxPipe||this.ajaxPipeEndpoints[a];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(c,a){var b=this._getItemForKey(this._getKey(a));if(a.asLoading){this.setLoading(b);}else this.setSelected(b);},navigationCountUpdate:function(c,a){var b=this._getItemForKey(a&&a.key);if(b)if(typeof a.count!=="undefined"){b.setCount(a.count,a.hide);}else if(typeof a.increment!=="undefined")b.incrementCount(a.increment,a.hide);},navigationCountUpdateFromPresence:function(c,a){a=a.obj;if(a)if(!a.class_name||a.class_name&&CSS.hasClass(this.root,a.class_name))if(a.items)for(var b=0;b<a.items.length;b++)this.navigationCountUpdate(c,a.items[b]);},beginEdit:function(a){if(!this.editing){this.editing=true;CSS.addClass(this.root,'editMode');this._updateTrackingData();Bootloader.loadComponents('sortable-side-nav-js',this._initEditor.bind(this,a));}},endEdit:function(){if(this.editing){CSS.removeClass(this.root,'editMode');this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(a){var c=this.root.getAttribute('data-gt')||"{}";try{c=JSON.parse(c);if(this.editing){c.editing=true;}else delete c.editing;this.root.setAttribute('data-gt',JSON.stringify(c));}catch(b){}},_initEditor:function(a){this.editor=a.getEditor();this.editor.beginEdit();}};function FutureSideNavSection(a){this.id=a.id;this.node=this.node||$(a.id);this.editEndpoint=a.editEndpoint;}FutureSideNavSection.prototype={equals:function(a){return a&&a.id===this.id;},getEditor:function(){return new SortableSideNav(DOM.find(this.node,'ul.uiSideNav'),this.editEndpoint);}};function FutureSideNavItem(a,c){this.id=a.id;this.up=c;this.endpoint=a.endpoint;this.type=a.type;this.node=a.node||$(a.id);this.paths=a.path?$A(a.path):[];this.keys=a.key?$A(a.key):[];var b=this._findKeys(this.keys);this.numericKey=b.numeric||this.keys[0];this.textKey=b.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}FutureSideNavItem.prototype={equals:function(a){return a&&a.id===this.id;},getLinkNode:function(){return (DOM.scry(this.node,'a.item')[0]||DOM.scry(this.node,'a.subitem')[0]);},matchPath:function(a){return this._matchInput(this._pathPattern,a);},matchKey:function(a){return this._matchInput(this._keyPattern,a);},_matchInput:function(c,a){var b=c&&c.exec(a);return b&&b.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(a){return !this.up;},setCount:function(a,b){return this._updateCount(a,true);},incrementCount:function(a,b){return this._updateCount(a,false);},_updateCount:function(a,h,e){var c=DOM.scry(this.node,'span.count')[0];var d=c&&DOM.scry(c,'span.countValue')[0];if(d){var b=h?0:parseInt(DOM.getText(d),10);var i=Math.max(0,b+a);var f=this.isTop()?'hidden':'hiddenSubitem';DOM.setContent(d,i);e&&CSS.conditionClass(this.node,f,!i);CSS.conditionClass(c,'hidden_elem',!i);if(this.isTop()){var g=DOM.scry(this.node,'div.linkWrap')[0];if(g){CSS.conditionClass(g,'noCount',!i);CSS.conditionClass(g,'hasCount',i);}}}Arbiter.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){CSS.addClass(this.node,'loading');},hideLoading:function(){CSS.removeClass(this.node,'loading');},showSelected:function(){CSS.addClass(this.node,'selectedItem');CSS.hasClass(this.node,'hider')&&CSS.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){CSS.removeClass(this.node,'selectedItem');},showChildren:function(){CSS.addClass(this.node,'open');},hideChildren:function(){CSS.removeClass(this.node,'open');},_getExpanderParent:function(){return Parent.byClass(this.node,'expandableSideNav');},_buildRegex:function(a){if(a.length){var b=a.map(function(c){if(typeof c==="string"){return c.replace(/([^a-z0-9_])/ig,'\\$1');}else if(c&&c.regex)return c.regex;});return new RegExp('^(?:'+b.join('|')+')$');}},_findKeys:function(c){var e=/^(app|group|fl)_/;var a={};for(var b=0;b<c.length;b++){var d=e.test(c[b]);if(d&&!a.numeric){a.numeric=c[b];}else if(!d&&!a.text)a.text=c[b];if(a.numeric&&a.text)break;}return a;}};
function FutureProfileSideNav(){this.parent.construct(this);}Class.extend(FutureProfileSideNav,'FutureSideNav');FutureProfileSideNav.prototype={init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.altKeyParam='v';this.sidecol=false;},_constructItem:function(a,b){return new FutureProfileSideNavItem(a,b);},_doPageTransition:function(a,b){if(!this._profileChanged(b)&&!this._scopeChanged(a))return this.parent._doPageTransition(a,b);},_profileChanged:function(c){var b=c.getQueryData();var a=this.uri.getQueryData();return (b.id!==a.id||b.viewas!==a.viewas||b.and!==a.and);},_scopeChanged:function(a){return (!this.selected||a.layoutType!==this.selected.layoutType);},_getKey:function(a){return this.parent._getKey(a)||a[this.altKeyParam];}};function FutureProfileSideNavItem(a,b){this.parent.construct(this,a,b);this.layoutType=a.layouttype;}Class.extend(FutureProfileSideNavItem,'FutureSideNavItem');
function useFacebookReferer(b,a,f){var d=false;function e(){if(d)return;d=true;b.contentWindow.document.body.style.margin=0;a();}var c=(URI().isSecure()?'https://s-static.ak.facebook.com':'http://static.ak.facebook.com')+'/common/referer_frame.php';if(f)c+='?fb_source='+f;Event.listen(b,'load',e);b.src=c;}function useFacebookRefererHtml(b,a,c){useFacebookReferer(b,function(){b.contentWindow.document.body.innerHTML=a;},c);}
__d("legacy:htmlspecialchars-global",["htmlspecialchars"],function(a,b,c){a.htmlspecialchars=b('htmlspecialchars');},3);
function htmlize(a){return htmlspecialchars(a).replace(/\r\n/g,'<br />').replace(/[\r\n]/g,'<br />');}function escape_js_quotes(a){if(typeof(a)=='undefined'||!a.toString)return '';return a.toString().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/"/g,'\\x22').replace(/'/g,'\\\'').replace(/</g,'\\x3c').replace(/>/g,'\\x3e').replace(/&/g,'\\x26');}
if(typeof deconcept=="undefined")var deconcept={};if(typeof deconcept.util=="undefined")deconcept.util={};if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil={};deconcept.SWFObject=function(h,d,j,c,i,a,f,l,g,b){if(!document.getElementById)return;this.DETECT_KEY=b?b:'detectflash';this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(h)this.setAttribute('swf',h);if(d)this.setAttribute('id',d);if(j)this.setAttribute('width',j);if(c)this.setAttribute('height',c);this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(i){if(!(i instanceof Array))i=[i];var k;i.each(function(n){k=new deconcept.PlayerVersion(n.toString().split('.'));if(k.major==this.installedVer.major){this.setAttribute('version',k);return;}else if(!this.getAttribute('version')||k.major<this.getAttribute('version').major)this.setAttribute('version',k);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}if(a)this.addParam('bgcolor',a);var e=f?f:'high';this.addParam('quality',e);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var m=(l)?l:window.location;this.setAttribute('xiRedirectUrl',m);this.setAttribute('redirectUrl','');if(g)this.setAttribute('redirectUrl',g);this.setAttribute('useIframe',false);};deconcept.SWFObject.ieWorkaroundApplied=false;deconcept.SWFObject.ensureIEWorkaroundAttached=function(){if(!deconcept.SWFObject.ieWorkaroundApplied&&document.attachEvent){deconcept.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',deconcept.SWFObject.onDocumentPropertyChange);}};deconcept.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var a=document.title;if(a!=null&&a.indexOf('#!')!=-1){a=a.substring(0,a.indexOf('#!'));document.title=a;}}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"/swf/expressinstall.swf":a;this.setAttribute('useExpressInstall',true);},setAttribute:function(a,b){this.attributes[a]=b;},getAttribute:function(a){return this.attributes[a]||"";},addParam:function(a,b){this.params[a]=b;},getParams:function(){return this.params;},addVariable:function(a,b){this.variables[a]=b;},getVariable:function(a){return this.variables[a]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var b=[];var a;var c=this.getVariables();for(a in c)b[b.length]=a+"="+c[a];return b.join('&');},getSWFHTML:function(){var f,d,a;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}d={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'',id:this.getAttribute('id'),name:this.getAttribute('id')};var c=this.getParams();for(var b in c)d[b]=c[b];a=this.getVariablePairs();if(a)d.flashvars=a;f=render_tag_as_htmlstring('embed',d,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}d={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||''};var e=render_tag_as_htmlstring('param',{name:'movie',value:this.getAttribute('swf')},null);var c=this.getParams();for(var b in c)e+=render_tag_as_htmlstring('param',{name:b,value:c[b]},null);a=this.getVariablePairs();if(a)e+=render_tag_as_htmlstring('param',{name:'flashvars',value:a},null);f=render_tag_as_htmlstring('object',d,e);}return f;},write:function(a){if(this.getAttribute('useExpressInstall')){var b=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(b)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var c=(typeof a=='string')?document.getElementById(a):a;if(!c)return false;CSS.addClass(c,'swfObject');c.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){deconcept.SWFObject.ensureIEWorkaroundAttached();c.innerHTML=this.getSWFHTML();}else this._createIframe(c);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));need_version=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').rev;have_version=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.rev;this.fallback_js_fcn(have_version,need_version);c.innerHTML=this.fallback_html;}return false;},_createIframe:function(b){var a=$N('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});DOM.empty(b);b.appendChild(a);useFacebookRefererHtml.bind(null,a,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var a=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){for(var g=0;g<navigator.plugins.length;g++)try{var x=navigator.plugins[g];if(x.name=='Shockwave Flash'){PlayerVersion_tmp=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof a=='undefined'||PlayerVersion_tmp.major>a.major||(PlayerVersion_tmp.major==a.major&&(PlayerVersion_tmp.minor>a.minor||(PlayerVersion_tmp.minor==a.minor&&PlayerVersion_tmp.rev>a.rev))))a=PlayerVersion_tmp;}}catch(f){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var b=1;var c=3;while(b)try{c++;b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);a=new deconcept.PlayerVersion([c,0,0]);}catch(d){b=null;}}else{try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a=new deconcept.PlayerVersion([6,0,21]);b.AllowScriptAccess="always";}catch(e2){if(a.major==6)return a;}try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e3){}}if(b!=null)a=new deconcept.PlayerVersion(b.GetVariable("$version").split(" ")[1].split(","));}return a;};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major)return false;if(this.major>a.major)return true;if(this.minor<a.minor)return false;if(this.minor>a.minor)return true;if(this.rev<a.rev)return false;return true;};deconcept.util={getRequestParameter:function(c){var d=document.location.search||document.location.hash;if(c==null)return d;if(d){var b=d.substring(1).split("&");for(var a=0;a<b.length;a++)if(b[a].substring(0,b[a].indexOf("="))==c)return b[a].substring((b[a].indexOf("=")+1));}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var b=document.getElementsByTagName("OBJECT");for(var a=b.length-1;a>=0;a--){b[a].style.display='none';for(var c in b[a])if(typeof b[a][c]=='function')b[a][c]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(a){return document.all[a];};var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;function spawn_flash_update_dialog(){new AsyncRequest().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();}function setFlashFallback(d,g){var b=ge(d);var a=deconcept.SWFObjectUtil.getPlayerVersion();var e;g.each(function(h){h=new deconcept.PlayerVersion(h.toString().split('.'));if(h.major==a.major){e=h;return;}else if(typeof e=='undefined'||h.major<e.major)e=h;}.bind(this));if(b&&a.major>0){var c=a.major+'.'+a.minor+'.'+a.rev;var f=e.major+'.'+e.minor+'.'+e.rev;b.innerHTML=_tx("Flash {required-version} is required to view this content. Your current version is {current-version}. Please download the latest Flash Player.",{'required-version':f,'current-version':c});}}function showFlashErrorDialog(b,a){Bootloader.loadComponents('error-dialog',function(){ErrorDialog.show(b,a);});}function render_tag_as_htmlstring(f,b,c){var a=/^[A-Za-z0-9\-]+$/;if(!f.match(a))throw new Error('Invalid tag '+f);var e='<'+f;for(var d in b){if(!d.match(a))throw new Error('Invalid attr '+d);e+=' '+d+'="'+htmlspecialchars(b[d])+'"';}if(c===null){return e+'/>';}else return e+'>'+c+'</'+f+'>';}
function Flash(){}copy_properties(Flash,{INIT:'flash/init',READY:'flash/ready',FAILED:'flash/failed'});
window.SubscriptionLevels={ALL:'162318810514679',DEFAULT:'271670892858696',TOP:'266156873403755'};window.EditSubscriptions=window.EditSubscriptions||(function(){var b=13;var a=45;var c=[SubscriptionLevels.ALL,SubscriptionLevels.DEFAULT,SubscriptionLevels.TOP];var e={};var h={};var v={};var u={};var g={};var f={};var t="/ajax/follow/follow_profile.php";var y="/ajax/follow/unfollow_profile.php";function p(za){return c.contains(za);}function l(za,zd,zb,ze){var zc=Parent.byClass(ze,'uiMenuItem');if(!zc||!DOM.contains(za,zc)){return;}else if(CSS.hasClass(zc,'SubscribeMenuToggle')){CSS.toggleClass(za,'showSubscriptionMenu');return false;}else if(CSS.hasClass(zc,'SubscribeMenuSubscribe')){n(za,zd);return false;}else if(CSS.hasClass(zc,'SubscribeMenuUnsubscribe')){o(za,zd);return false;}else if(CSS.hasClass(zc,'SubscriptionMenuItem')){m(za,zd,zb,zc);return false;}}function m(za,zd,zb,zc){if(CSS.hasClass(zc,'SubscriptionMenuLevel')){if(Menu.isItemChecked(zc))return;q(za,zd,k(zc),true,zb);}else if(CSS.hasClass(zc,'SubscriptionMenuCategory'))z(zd,zc,!Menu.isItemChecked(zc),true,zb);}function n(za,zc){var zb={profile_id:zc};Arbiter.inform('FollowingUser',zb);new AsyncRequest().setURI(t).setMethod('POST').setData({profile_id:zc,location:i(za)}).setErrorHandler(Arbiter.inform.curry('FollowUserFail',zb)).send();}function o(za,zc){var zb={profile_id:zc};Arbiter.inform('UnfollowingUser',zb);new AsyncRequest().setURI(y).setMethod('POST').setData({profile_id:zc,location:i(za)}).setErrorHandler(Arbiter.inform.curry('UnfollowUserFail',zb)).send();}function i(za){if(CSS.hasClass(za,'followButtonFlyout')){return b;}else return a;}function r(zc,zd,zb){var za={profile_id:zc,level:v[zc],custom_categories:u[zc],location:zb};new AsyncRequest().setURI('/ajax/follow/manage_subscriptions.php').setData(za).send();}function w(zb,zd){var za=u[zd]||[];var zc=Menu.getItems(zb);zc.forEach(function(zf){if(CSS.hasClass(zf,'SubscriptionMenuCategory')){var ze=k(zf);if(za.contains(ze)){d(zf);}else x(zf);}});q(zb,zd,v[zd],false);}function k(zb){var za=DOM.scry(zb,'input')[0];return za&&za.value;}function j(za){return DOM.find(za,'a.itemAnchor');}function d(za){CSS.addClass(za,'checked');j(za).setAttribute('aria-checked',true);}function x(za){CSS.removeClass(za,'checked');j(za).setAttribute('aria-checked',false);}function z(ze,zc,za,zf,zd){if(za){d(zc);}else x(zc);var zg=k(zc);if(p(zg)){za&&s(ze,zg);}else if(za){if(!u[ze].contains(zg))u[ze].push(zg);}else{var zb=u[ze].indexOf(zg);if(zb!==-1)u[ze].splice(zb,1);}if(zf)r(ze,zg,zd);}function s(zb,za){v[zb]=za;Arbiter.inform('SubscriptionLevelUpdated',{profile_id:zb,level:za});}function q(za,ze,zb,zg,zd){var zc=DOM.scry(za,'.SubscriptionMenuLevel');var zf=null;zc.forEach(function(zh){if(k(zh)==zb){zf=zh;}else if(Menu.isItemChecked(zh))z(ze,zh,false,false);});zf&&z(ze,zf,true,zg,zd);}Arbiter.subscribe('UnfollowUser',function(za,zb){if(g[zb.profile_id]){s(zb.profile_id,g[zb.profile_id]);u[zb.profile_id]=f[zb.profile_id].slice();}});Arbiter.subscribe('UpdateSubscriptionLevel',function(za,zd){var zf=zd.profile_id+'';var ze=zd.level+'';s(zf,ze);var zc;for(zc in e)if(e[zc]===zf){var zb=ge(zc);zb&&q(zb,zf,ze,false);}});return {init:function(za,zd,zc){var zb=za.id;if(!e[zb])Event.listen(za,'click',function(ze){return l(za,e[zb],zc,ze.getTarget());});if(v[zd])w(za,zd);e[zb]=zd;CSS.conditionClass(za,'NonFriendSubscriptionMenu',!h[zd]);Arbiter.subscribe(['FollowUser','FollowingUser'],function(zf,ze){CSS.conditionClass(za,'isUnsubscribed',false);CSS.conditionClass(za,'showSubscriptionMenu',zf=='FollowingUser');}.bind(this));Arbiter.subscribe(['UnfollowUser','UnfollowingUser'],function(zf,ze){CSS.conditionClass(za,'isUnsubscribed',true);CSS.removeClass(za,'showSubscriptionMenu');}.bind(this));},getSubscriptions:function(za){return {level:v[za],custom_categories:u[za]};},setSubscriptions:function(zd,zc,zf,ze,zb,za){s(zd,zf+'');h[zd]=zc;g[zd]=zb+'';u[zd]=ze.map(String);f[zd]=za.map(String);}};})();
function HoverFlyout(){}Class.mixin(HoverFlyout,'Arbiter',{init:function(a){this._flyout=a;this._showDelay=0;this._hideDelay=100;this._showTimeout=null;this._hideTimeout=null;this._flyoutSubscriptions=[this._flyout.subscribe('mouseenter',this._onFlyoutMouseEnter.bind(this)),this._flyout.subscribe('mouseleave',this.hideFlyout.shield(this))];this._nodes=[];this._dataStoreUnique='HoverFlyout_'+Date.now();return this;},initNode:function(a){this._nodes.push(a);DataStore.set(a,this._dataStoreUnique+'_listeners',[Event.listen(a,'mouseenter',this._onNodeMouseEnter.bind(this,a)),Event.listen(a,'mouseleave',this.hideFlyout.shield(this))]);return this;},deactivateNode:function(a){var b=DataStore.get(a,this._dataStoreUnique+'_listeners');if(b)while(b.length)b.pop().remove();this._nodes.remove(a);},setShowDelay:function(a){this._showDelay=a;return this;},setHideDelay:function(a){this._hideDelay=a;return this;},showFlyout:function(a,b){this.setActiveNode(a);if(b){this._flyout.setContext(a).show();this.inform('show',a);}else this._showTimeout=this.showFlyout.bind(this,a,true).defer(this._showDelay);return this;},hideFlyout:function(a){clearTimeout(this._showTimeout);if(a){this._flyout.hide();this.inform('hide',this._activeNode);this._activeNode=null;}else this._hideTimeout=this.hideFlyout.bind(this,true).defer(this._hideDelay);},getActiveNode:function(){return this._activeNode;},setActiveNode:function(a){clearTimeout(this._hideTimeout);if(this._activeNode&&this._activeNode!==a)this.hideFlyout(true);this._activeNode=a;return this;},destroy:function(){while(this._flyoutSubscriptions.length)this._flyout.unsubscribe(this._flyoutSubscriptions.pop());for(var a=0;a<this._nodes.length;a++){var b=DataStore.get(this._nodes[a],this._dataStoreUnique+'_listeners');if(b)while(b.length)b.pop().remove();}},_onNodeMouseEnter:function(a){if(this._activeNode===a){clearTimeout(this._hideTimeout);}else this.showFlyout(a);},_onFlyoutMouseEnter:function(){clearTimeout(this._hideTimeout);}});
var SubscriptionFlyoutController=(function(){var d=null;var c;var e;var b;function a(){var i=EditSubscriptions.getSubscriptions(b);if(i){var h=i.custom_categories;if(h&&h.length===0)Arbiter.inform('UnfollowUser',{profile_id:b,from_hide_flyout:true});}}function g(h,j){b=DataStore.get(j,'profile_id');var i=DataStore.get(j,'loc');EditSubscriptions.init(e,b,i);CSS.addClass(j,'selected');CSS.addClass(j,'uiButtonHover');if(DataStore.get(j,'onclose'))clearTimeout(DataStore.remove(j,'onclosetimeout'));}function f(h,i){b=null;CSS.removeClass(i,'selected');CSS.removeClass(i,'uiButtonHover');if(DataStore.get(i,'onclose'))DataStore.set(i,'onclosetimeout',function(){var j=DataStore.remove(i,'onclose');j&&j();}.defer(1500));}return {init:function(h,i){SubscriptionFlyoutController.init=bagofholding;c=h;e=i;d=new HoverFlyout();d.init(h);d.setShowDelay(100).setHideDelay(150);d.subscribe('show',g);d.subscribe('hide',f);Arbiter.subscribe(['UnfollowUser','UnfollowingUser'],function(j,k){if(!k.from_hide_flyout&&k.profile_id==b){if(window.Hovercard&&Hovercard.contains&&c)if(Hovercard.contains(c.getContext()))Hovercard.hide();d.hideFlyout(true);}});},initNode:function(i,j,h){DataStore.set(i,'profile_id',j);DataStore.set(i,'loc',h);d.initNode(i);},setActiveNode:function(h){d.setActiveNode(h);},show:function(h){d.showFlyout(h,true);},setCloseListener:function(i,h){if(d.getActiveNode()!==i){h();}else DataStore.set(i,'onclose',h);}};})();
FriendRequestMessage={STATUS:'FriendRequest/change',UNFRIEND:'FriendRequest/unfriend',CANCEL:'FriendRequest/cancel',CANCELLING:'FriendRequest/cancelling',CANCEL_FAIL:'FriendRequest/cancelFail',SENT:'FriendRequest/sent',SENDING:'FriendRequest/sending',SEND_FAIL:'FriendRequest/sendFail',CONFIRM:'FriendRequest/confirm',CONFIRMING:'FriendRequest/confirming',CONFIRM_FAIL:'FriendRequest/confirmFail'};function FriendStatus(a,c,b){this.id=a;this.update(c,b);}FriendStatus.prototype={update:function(b,a){b&&(this.status=b);if(a){this.lists=$A(a).map(String);this._informListChange();}},isComplete:function(){return !!this.lists;},addToList:function(a){if(this.lists&&!this.lists.contains(a))this.lists.push(a);this._informListChange();},removeFromList:function(b){if(this.lists){var a=this.lists.indexOf(b);a!==-1&&this.lists.splice(a,1);}this._informListChange();},updateList:function(b,a){a?this.addToList(b):this.removeFromList(b);},_informListChange:function(){Arbiter.inform('FriendListMembershipChange',{uid:this.id,lists:this.lists});}};copy_properties(FriendStatus,{ARE_FRIENDS:1,INCOMING_REQUEST:2,OUTGOING_REQUEST:3,CAN_REQUEST:4});(function(){var a={};var b={};function c(f,d,e){if(!a[e.uid]){a[e.uid]=new FriendStatus(e.uid,f);}else a[e.uid].update(f);Arbiter.inform(FriendRequestMessage.STATUS,{uid:e.uid,status:f});}onloadRegister(function(){Arbiter.subscribe([FriendRequestMessage.CANCEL,FriendRequestMessage.UNFRIEND,FriendRequestMessage.SEND_FAIL],c.curry(FriendStatus.CAN_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM_FAIL],c.curry(FriendStatus.INCOMING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CANCEL_FAIL,FriendRequestMessage.SENT,FriendRequestMessage.SENDING],c.curry(FriendStatus.OUTGOING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM,FriendRequestMessage.CONFIRMING],c.curry(FriendStatus.ARE_FRIENDS));});copy_properties(FriendStatus,{CLOSE_FRIENDS:null,ACQUAINTANCES:null,getFriend:function(d,e){if(a[d]&&a[d].isComplete()){e(a[d]);}else if(b[d]){b[d].push(e);}else{b[d]=[e];new AsyncRequest().setURI("/ajax/friends/status.php").setData({friend:d}).setHandler(function(g){var f=g.getPayload();FriendStatus.initFriend(d,f.status,f.lists);}).send();}},initFriend:function(e,g,f){var d=a[e]||new FriendStatus(e);d.update(d.status||g,d.lists||f);a[e]=d;b[e]&&b[e].forEach(function(h){h(d);});b[e]=null;},setSpecialLists:function(d){FriendStatus.CLOSE_FRIENDS=d.close+'';FriendStatus.ACQUAINTANCES=d.acq+'';}});})();
__d("AsyncRequestNectarLogging",["string-extensions","AsyncRequest","Env","copyProperties"],function(e,g,h,f,d){g("string-extensions");var a=g("AsyncRequest");var b=g("Env");var c=g("copyProperties");c(a.prototype,{setNectarModuleData:function(k){if(this.method=='POST'){var l=b.module;if(k&&l===undefined){var j={fbpage_fan_confirm:1};var m=null;for(var i=k;i&&i!=document.body;i=i.parentNode){if(!i.id||typeof i.id!=='string')continue;if(i.id.startsWith('pagelet_')){l=i.id;break;}if(!m&&j[i.id])m=i.id;}if(l===undefined&&m)l=m;}if(l!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._mod=l;}}},setNectarImpressionId:function(){if(this.method=='POST'){var i=b.impid;if(i!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._impid=i;}}}});});
__d("legacy:async-postlude",["AsyncRequestNectarLogging"],function(a,b,c){b('AsyncRequestNectarLogging');},3);
__d("legacy:dialog",["Dialog"],function(b,c,d){var a=c('Dialog');b.Dialog=a;},3);
function fbpage_set_fan_status(c,f,a,h,g,d,e){g=g?g:function(j){_fbpage_show_change_status_feedback(c,j.getPayload());};var b={fbpage_id:f,add:a,reload:h};if(e!=null)copy_properties(b,e);var i=new AsyncRequest().setURI('/ajax/pages/fan_status.php').setData(b).setNectarModuleDataSafe(c).setHandler(g);if(d)i.setErrorHandler(d);i.send();return false;}function fbpage_set_favorite_status(d,e,a){var f=function(){_fbpage_show_change_status_feedback(d,this.getUserData());};var c={fbpage_id:e,add:a};var b=new AsyncRequest().setMethod('POST').setURI('/ajax/pages/favorite_status.php').setData(c);new Dialog().setAsync(b).setCloseHandler(f).show();return false;}function _fbpage_show_change_status_feedback(b,a){if(!a||!b)return;if(a.reload){fbpage_reload_on_fan_status_changed(a.preserve_tab);}else fbpage_redraw_on_fan_status_changed(b,a.feedback);}function fbpage_reload_on_fan_status_changed(a){var c=URI.getRequestURI();if(a){var b=FutureSideNav.getInstance().selected.textKey;if(!c.getQueryData().sk&&b)c.addQueryData({sk:b});}window.location.href=c;}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;var d=document.createElement('span');d.innerHTML=b;CSS.setClass(d,'fan_status_inactive');a.parentNode.replaceChild(d,a);var c=function(){if(data.can_repeat_action)d.parentNode.replaceChild(a,d);};animation(d).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(c).go();}
function SimpleDrag(a){Event.listen(a,'mousedown',this._start.bind(this));}Class.mixin(SimpleDrag,'Arbiter',{_start:function(event){this.inform('start',event);var b=ua.ie()<9?document.documentElement:window;var a=Event.listen(b,{selectstart:Event.prevent,mousemove:this.inform.bind(this,'update'),mouseup:function(event){for(var c in a)a[c].remove();this.inform('end',event);}.bind(this)});return false;}});
function ScrollableArea(){}copy_properties(ScrollableArea,{fromNative:function(b,c){if(!CSS.hasClass(b,'uiScrollableArea')||!CSS.hasClass(b,'native'))return;c=c||{};CSS.removeClass(b,'native');var d=$N('div',{className:'uiScrollableAreaTrack'},$N('div',{className:'uiScrollableAreaGripper'}));if(c.fade!==false){CSS.addClass(b,'fade');CSS.addClass(d,'invisible_elem');}else CSS.addClass(b,'nofade');DOM.appendContent(b,d);var a=new ScrollableArea();a.init(b,c);a.resize();return a;},getInstance:function(a){var b=Parent.byClass(a,'uiScrollableArea');return b?DataStore.get(b,'ScrollableArea'):null;},poke:function(b){var a=ScrollableArea.getInstance(b);a&&a.poke();}});ScrollableArea.prototype={init:function(a,b){b=b||{};this._elem=a;this._wrap=DOM.find(a,'div.uiScrollableAreaWrap');this._body=DOM.find(this._wrap,'div.uiScrollableAreaBody');this._track=DOM.find(a,'div.uiScrollableAreaTrack');this._gripper=DOM.find(this._track,'div.uiScrollableAreaGripper');this._options=b;this.adjustGripper();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(b.fade!==false)this._listeners.push(Event.listen(a,'mouseenter',this.adjustGripper.shield(this)),Event.listen(a,'mouseenter',this.showScrollbar.shield(this)),Event.listen(a,'mousemove',this._handleMousemove.bind(this)),Event.listen(a,'mouseout',this.hideScrollbar.shield(this)));this.initDrag();DataStore.set(this._elem,'ScrollableArea',this);if(!b.persistent)onleaveRegister(this.destroy.bind(this));},initDrag:function(){var a=new SimpleDrag(this._gripper);a.subscribe('start',function(b,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var d=Vector2.getEventPosition(event).y;var e=this._gripper.offsetTop;var f=a.subscribe('update',function(g,event){var j=Vector2.getEventPosition(event).y-d;var i=this._elem.clientHeight;var h=this._body.offsetHeight;var p=this._track.offsetHeight;var k=i/h*p;var m=h-this._wrap.offsetHeight;var l=e+j;var n=p-k;l=Math.max(Math.min(l,n),0);var o=l/n*m;this._wrap.scrollTop=o;}.bind(this));var c=a.subscribe('end',function(){a.unsubscribe(f);a.unsubscribe(c);});}.bind(this));},adjustGripper:function(){var b=this._elem.clientHeight;var a=this._body.offsetHeight;var e=this._track.offsetHeight;var c=b/a*e;if(c<e){CSS.setStyle(this._gripper,'height',c+'px');var d=this._wrap.scrollTop/a*e;CSS.setStyle(this._gripper,'top',d+'px');CSS.show(this._gripper);}else CSS.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){CSS.conditionClass(this._elem,'contentBefore',this._wrap.scrollTop>0);CSS.conditionClass(this._elem,'contentAfter',!this.isScrolledToBottom());},destroy:function(){this._listeners.forEach(function(a){a.remove();});this._listeners.length=0;},_handleMousemove:function(event){var a=Vector2.getElementPosition(this._track).x;var b=Vector2.getElementDimensions(this._track).x;if(Math.abs(a+b/2-Vector2.getEventPosition(event).x)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=animation(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(CSS.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},resize:function(){var a=Vector2.getElementDimensions(this._elem).x;if(!this._options.fade)a-=10;CSS.setStyle(this._body,'width',a+'px');},showScrollbar:function(a){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}CSS.setStyle(this._track,'opacity',1);CSS.removeClass(this._track,'invisible_elem');if(a!==false)this.hideScrollbar();return this;},isScrolledToBottom:function(){return this._wrap.scrollTop>=this._wrap.scrollHeight-this._wrap.clientHeight;},scrollToBottom:function(a){if(a!==false){animation(this._wrap).to('scrollTop',this._wrap.scrollHeight).ease(animation.ease.end).go();}else this._wrap.scrollTop=this._wrap.scrollHeight;},poke:function(){var a=this._wrap.scrollTop;this._wrap.scrollTop+=1;this._wrap.scrollTop-=1;this._wrap.scrollTop=a;return this.showScrollbar(false);}};
var DynamicFriendListEducation=(function(){var h;var e;var d;var c;var a;var i;var g=function(){d&&d.hide();c&&c.hide();};var f=function(j){e.remove(j);g();a({accept_tag_education:true});};var b=function(){g();a({nux_cancel:true});};return {init:function(k,j){h=k;e=$A(j).map(String);PageTransitions.registerHandler(function(){g();h=false;a=undefined;e=[];});},showDialog:function(k,l,j){if(h&&e.contains(k)){g();Arbiter.inform('DynamicFriendListEducation/dialogOpen',{uid:l,flid:k});a=j;d=new Dialog().setAsync(new AsyncRequest('/ajax/friends/lists/smart_list_education.php').setMethod('GET').setData({flid:k,uid:l}).setReadOnly(true)).setHandler(f.bind(this,k)).setCloseHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogClosed',{uid:l,flid:k});}).setCancelHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogCancel',{uid:l,flid:k});}).show();}else j();},showContextualDialog:function(k,m,l,j){if(h&&e.contains(k)){g();i=l;a=j;new AsyncRequest('/ajax/friends/lists/smart_list_contextual_education.php').setMethod('GET').setData({flid:k,uid:m}).setReadOnly(true).send();}else j();},setContextualDialog:function(l,j,k,m){c=l;c.setContext(i);c.show();Event.listen(j,'click',f.bind(this,m));Event.listen(k,'click',b);}};})();
var FriendEditLists=(function(){var a=7;var c={};var m="/ajax/profile/removefriendconfirm.php";var b="/friends/ajax/remove_friend.php?type=friend&fbx=1";var h;function j(p,q,o){var r=c[p.id];var n=function(u){var t={action:o?'add_list':'del_list',to_friend:r.id,friendlists:[q],source:h};if(u)copy_properties(t,u);r.updateList(q,o);var v;if(o&&q==FriendStatus.CLOSE_FRIENDS){v=e(p,FriendStatus.ACQUAINTANCES);if(Menu.isItemChecked(v)){Menu.toggleItem(v);j(p,FriendStatus.ACQUAINTANCES,false);}}else if(o&&q==FriendStatus.ACQUAINTANCES){v=e(p,FriendStatus.CLOSE_FRIENDS);if(Menu.isItemChecked(v)){Menu.toggleItem(v);j(p,FriendStatus.CLOSE_FRIENDS,false);}}var w={flid:q,uid:r.id};var s=o?'FriendListHovercard/add':'FriendListHovercard/remove';Arbiter.inform(s,w);new AsyncRequest().setURI('/ajax/add_friend/action.php').setData(t).send();};if(o){DynamicFriendListEducation.showDialog(q,r.id,n);}else n();}function d(o){var n=DOM.scry(o,'input')[0];return n&&n.value;}function f(n,p,q){var o={uid:p.id};new AsyncRequest().setURI(b).setMethod('POST').setData({friend:p.id}).setHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL,o)).setErrorHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL_FAIL,o)).setStatusElement(q).send();}function e(n,o){var q=Menu.getItems(n);for(var p=0;p<q.length;p++)if(d(q[p])==o)return q[p];return null;}function k(n,o){var p=Menu.getItems(n);p.forEach(function(s){var r=d(s);var q=o.lists.contains(r);if(Menu.isItemChecked(s)!==q)Menu.toggleItem(s);});}function i(o){var p=Menu.getItems(o);var r=!CSS.hasClass(o,'followButtonFlyout')&&!CSS.hasClass(o,'likeButtonFlyout');var n=[];var t=[];var v=0;var u=0;p.forEach(function(y){if(CSS.hasClass(y,'neverHide')){CSS.removeClass(y,'underShowMore');v++;}else if(Menu.isItemChecked(y)){n.push(y);}else if(CSS.hasClass(y,'neverShow')||CSS.hasClass(y,'FriendListCreateTrigger')||(!r&&CSS.hasClass(y,'friendOptionsOnly'))){CSS.addClass(y,'underShowMore');u++;}else t.push(y);});var x=a-v;var s=n.concat(t);var q=u;s.forEach(function(y){if(CSS.hasClass(y,'ShowMoreItem')){x--;return;}if(x){CSS.removeClass(y,'underShowMore');x--;}else{CSS.addClass(y,'underShowMore');q=true;}});CSS.conditionClass(o,'hasMoreFriendListItems',q);var w=DOM.scry(o,'.FriendListMenuShowMore');w.forEach(function(y){CSS.removeClass(y,'FriendListMenuShowMore');});}function l(o,p){var q=DOM.scry(o,'.FriendListUnfriend')[0];var n=DOM.scry(o,'.FriendListCancel')[0];if(n)CSS.conditionShow(n,p.status==FriendStatus.OUTGOING_REQUEST);if(q){CSS.conditionShow(q,p.status==FriendStatus.ARE_FRIENDS);DOM.find(q,'a').setAttribute('ajaxify',URI(m).addQueryData({uid:p.id}).toString());}}var g=function(){g=bagofholding;Arbiter.subscribe(FriendRequestMessage.STATUS,function(r,q){for(var p in c){var n=ge(p);var o=c[p];if(n&&o&&o.id==q.uid){k(n,o);l(n,o);i(n);}}});Menu.subscribe('select',function(n,o){if(CSS.hasClass(o.item,'ShowMoreItem')&&CSS.hasClass(o.menu,'FriendListMenu')){CSS.addClass(o.menu,'FriendListMenuShowMore');ScrollableArea.poke(o.item);}});};return {init:function(n,o,p){n=$(n);h=p;g();if(!c[n.id])Menu.subscribe('select',function(q,r){if(DOM.contains(n,r.item))if(Parent.byClass(r.item,'FriendListItem')){Menu.toggleItem(r.item);var s=d(r.item);j(n,s,Menu.isItemChecked(r.item));}else if(Parent.byClass(r.item,'FriendListCancel')){f(n,c[n.id],r.item);}else if(Parent.byClass(r.item,'FriendListUnfriend'))FriendListFlyoutController.hide(false);});CSS.addClass(n,'async_saving');FriendStatus.getFriend(o,function(q){k(n,q);l(n,q);c[n.id]=q;i(n);CSS.removeClass(n,'async_saving');}.bind(this));}};})();
var PageLikeButton=window.PageLikeButton||(function(){function a(h,g,d,f,e){fbpage_set_fan_status(e?d:f,h,e,false,null,(function(){c(d,f,!e);}).bind(this),{fan_origin:g});}function c(d,f,e){CSS.conditionShow(d,!e);CSS.conditionShow(f,e);}function b(d){if(CSS.hasClass(d,'enableFriendListFlyout')){FriendListFlyoutController.show(d);}else FriendListFlyoutController.hide();}return {LIKED:'liked',UNLIKED:'unliked',init:function(h,d,e,g,f){Arbiter.subscribe(PageLikeButton.LIKED,function(i,j){if(g===j.profile_id){c(d,e,true);a(g,f,d,e,true);}});Arbiter.subscribe(PageLikeButton.UNLIKED,function(i,j){if(g===j.profile_id){c(d,e,false);a(g,f,d,e,false);}});Event.listen(d,'click',function(){Arbiter.inform(PageLikeButton.LIKED,{profile_id:g});b(e);});},initMenu:function(d,f,e){Event.listen(d,'click',function(g){var h=Parent.byClass(g.getTarget(),'uiMenuItem');if(CSS.hasClass(h,'PageMenuUnlike'))Arbiter.inform(PageLikeButton.UNLIKED,{profile_id:f});});}};})();
var FriendListFlyoutController=(function(){var d;var e;var m=null;var o=null;var a;var n;var v;var k;var s;var f;var c=1500;function q(){clearTimeout(k);}function p(){if(a){CSS.removeClass(a,'selected');CSS.removeClass(a,'uiButtonHover');if(DataStore.get(a,'flfcloselistener')){var x=a;DataStore.set(a,'flfcloselistenertimeout',g.curry(x).defer(c));}}e=false;b();a=null;}function h(x){if(DOM.isNodeOfType(x,'label')&&CSS.hasClass(x,'uiButton'))x=Button.getInputElement(x);return DataStore.get(x,'profileid');}function b(){n&&n.remove();n=null;s&&Arbiter.unsubscribe(s);s=null;k&&clearTimeout(k);k=null;}function l(y){var z=h(y);var x=DataStore.get(y,'flloc');FriendEditLists.init(m,z,x);EditSubscriptions.init(m,z,x);PageLikeButton.initMenu(m,z,x);CSS.conditionClass(m,'followButtonFlyout',CSS.hasClass(y,'profileFollowButton'));CSS.conditionClass(m,'friendButtonFlyout',CSS.hasClass(y,'FriendRequestFriends')||CSS.hasClass(y,'FriendRequestIncoming')||CSS.hasClass(y,'FriendRequestOutgoing'));CSS.conditionClass(m,'likeButtonFlyout',CSS.hasClass(y,'profileLikeButton'));var za=DOM.scry(m,'div.uiScrollableArea')[0];za&&ScrollableArea.poke(za);}function u(x){if(!d||e)return;d.setContext(x);CSS.addClass(x,'selected');CSS.addClass(x,'uiButtonHover');d.setFixed(CSS.isFixed(x)).show();a=x;e=true;if(m){l(x);}else new AsyncRequest().setURI('/ajax/friends/lists/flyout_content.php').setStatusElement(d.getOverlay()).send();b();n=Event.listen(x,'mouseleave',i);s=Arbiter.subscribe('Overlay/show',j);if(DataStore.get(x,'flfcloselistener'))clearTimeout(DataStore.remove(x,'flfcloselistenertimeout'));var y=h(x);FriendStatus.getFriend(y,function(z){if(!o)return;if(z.status==FriendStatus.OUTGOING_REQUEST){CSS.show(o);AsyncRequest.bootstrap('/ajax/friends/lists/nux_flyout.php',null,true);}else CSS.hide(o);});}function t(x){a=x;v=u.curry(x).defer(350);n=Event.listen(x,'mouseleave',function(){clearTimeout(v);a=null;n&&n.remove();});}function i(){k=j.defer(150);}function w(){var y=Dialog.getCurrent();var x=y&&y.getBody();return !!(x&&DOM.scry(x,'.friendListDialogTourCarousel')[0]);}function j(){if(f||w())return;ua.ie()<8&&document.documentElement.focus();d&&d.hide();}function r(event){var x=Parent.byTag(event.getTarget(),'a');if(x&&CSS.hasClass(x,'FriendListActionItem'))i();}function g(y){var x=DataStore.remove(y,'flfcloselistener');x&&x();}return {init:function(x){FriendListFlyoutController.init=bagofholding;d=x;d.subscribe('mouseenter',q);d.subscribe('mouseleave',i);d.subscribe('hide',p);if(m)DOM.setContent(d.getContent(),[m,o]);Event.listen(document.documentElement,'mouseover',function(y){var z=Parent.byClass(y.getTarget(),'enableFriendListFlyout');if(z)if(a===z){clearTimeout(k);}else{e&&j();t(z);}});Arbiter.subscribe('DynamicFriendListEducation/dialogOpen',function(){f=true;});Arbiter.subscribe('DynamicFriendListEducation/dialogClosed',function(){f=false;i();});},initContent:function(y){var x=y.getRootNode();DOM.appendContent(document.body,x);(function(){if(!m){m=x;d&&DOM.setContent(d.getContent(),[m,o]);CSS.show(m);Event.listen(m,'click',r);e&&l(a);}else{DOM.remove(x);x=null;}}).defer();},initNux:function(x){if(o)return;o=x.getRootNode();d&&DOM.setContent(d.getContent(),[m,o]);},show:function(x){u(x);},hide:function(x){x===false?j():i();},setActiveNode:function(x){e&&j();a=x;n=Event.listen(x,'mouseleave',function(){a=null;n&&n.remove();});},setCloseListener:function(y,x){DataStore.set(y,'flfcloselistener',x);if(a!=y)DataStore.set(y,'flfcloselistenertimeout',g.curry(y).defer(c));},setCloseListenerTimeout:function(x){c=x;}};})();
var FollowButton=window.FollowButton||(function(){var a=14;function c(e,g,f){CSS.conditionShow(g,f);CSS.conditionShow(e,!f);}function d(e,f){if(f&&CSS.hasClass(e,'enableFriendListFlyout')){FriendListFlyoutController.show(e);}else FriendListFlyoutController.hide();}function b(i,j,h){var f=DOM.scry(i,'.lowIcon')[0];var g=DOM.scry(i,'.medIcon')[0];var e=DOM.scry(i,'.highIcon')[0];if(!f||!g||!e)return;Arbiter.subscribe('SubscriptionLevelUpdated',function(k,l){if(h===l.profile_id)switch(l.level){case SubscriptionLevels.ALL:Button.setIcon(j,e);break;case SubscriptionLevels.DEFAULT:Button.setIcon(j,g);break;case SubscriptionLevels.TOP:Button.setIcon(j,f);break;}});}return {init:function(k,g,l,j,i,h){if(!CSS.hasClass(l,'enableFriendListFlyout'))SubscriptionFlyoutController.initNode(l,j,i);if(i==a&&CSS.shown(l))SubscriptionFlyoutController.show(l);Event.listen(g,'click',function(){c(g,l,true);SubscriptionFlyoutController.setActiveNode(l);var m=new URI(g.getAttribute('ajaxify'));var n={profile_id:j,location:i,source:'follow-button',subscribed_button_id:l.id,xids:m.getQueryData().xids};new AsyncRequest().setURI(h).setData(n).setRelativeTo(l).send();});k&&b(k,l,j);Arbiter.subscribe(['FollowUser','FollowingUser','UnfollowUser','UnfollowingUser'],function(n,m){if(m.profile_id==j)c(g,l,n=='FollowUser'||n=='FollowingUser');d(l,n=='FollowUser');});var f=false;Arbiter.subscribe('UnfollowingUser',function(m,n){if(n.profile_id==j){f=CSS.shown(l);f&&c(g,l,false);}});Arbiter.subscribe('UnfollowUserFail',function(m,n){if(n.profile_id==j&&f)c(g,l,true);});Arbiter.subscribe('FollowUserFail',function(m,n){if(n.profile_id==j&&f)c(g,l,false);});var e=false;Arbiter.subscribe([FriendRequestMessage.SENDING,FriendRequestMessage.CONFIRMING],function(m,n){if(n.uid==j){e=CSS.shown(g);e&&c(g,l,true);}});Arbiter.subscribe([FriendRequestMessage.SEND_FAIL,FriendRequestMessage.CONFIRM_FAIL],function(m,n){if(n.uid==j&&e)c(g,l,false);});Arbiter.subscribe(FriendRequestMessage.UNFRIEND,function(m,n){(n.uid==j)&&c(g,l,false);});}};})();
__d("legacy:dom-collect",["collectDataAttributes"],function(a,b,c){a.collect_data_attribs=b('collectDataAttributes');},3);
var AddFriendButton={ERROR_ALREADY_ADDED:1431005,init:function(t,r,u,k,s,l,o,p,h,j,m){var g=null;var f=DOM.scry(t,'.addButton')[0];var q=DOM.scry(t,'.outgoingButton')[0];var n=DOM.scry(t,'.incomingButton')[0];var i=DOM.scry(t,'.friendButton')[0];function b(v,y,x){var w=new URI(f.getAttribute('ajaxify'));var z='';var za=ge('fbRequestsUnwanted');if(za){z=za.value;za.value='';}link_data=collect_data_attribs(t,['ft','gt']);new AsyncRequest().setURI(l).setData({to_friend:r,action:v,how_found:k,ref_param:s,link_data:link_data,outgoing_id:q.id,xids:w.getQueryData().xids,unwanted:z,logging_location:o,no_flyout_on_click:p,ego_log_data:h,http_referer:m}).setErrorHandler(y).setServerDialogCancelHandler(x).setRelativeTo(q).send();}function e(v,w){f&&CSS.hide(f);q&&CSS.hide(q);n&&CSS.hide(n);i&&CSS.hide(i);if(v)CSS.show(v);if('Outgoing'==w&&g!=w&&j)animation(v).from('backgroundColor','#FFF8CC').to('backgroundColor','#FFFFFF').from('borderColor','#FFE222').to('borderColor','#FFFFFF').duration(2000).go();g&&CSS.removeClass(t,'fStatus'+g);g=w;CSS.addClass(t,'fStatus'+w);}function c(v){if(CSS.hasClass(v,'enableFriendListFlyout')){FriendListFlyoutController.show(v);}else FriendListFlyoutController.hide();}var d=Arbiter.subscribe(FriendRequestMessage.STATUS,function(w,v){if(v.uid!=r)return;switch(v.status){case FriendStatus.ARE_FRIENDS:return e(i,'Friends');case FriendStatus.INCOMING_REQUEST:return e(n,'Incoming');case FriendStatus.OUTGOING_REQUEST:return e(q,'Outgoing');case FriendStatus.CAN_REQUEST:return e(f,'Requestable');}});var a;if(u)a=Arbiter.subscribe(FriendRequestMessage.CONFIRM,function(v,w){w.uid==r&&goURI(u);});f&&Event.listen(f,'click',function(){Arbiter.inform(FriendRequestMessage.SENDING,{uid:r});if(p){FriendListFlyoutController.setActiveNode(q);}else c(q);b("add_friend",function(w){var v=w.error==AddFriendButton.ERROR_ALREADY_ADDED?FriendRequestMessage.SENT:FriendRequestMessage.SEND_FAIL;Arbiter.inform(v,{uid:r});FriendListFlyoutController.hide();AsyncResponse.defaultErrorHandler(w);},function(v){Arbiter.inform(FriendRequestMessage.SEND_FAIL,{uid:r});FriendListFlyoutController.hide();});});PageTransitions.registerHandler(function(){Arbiter.unsubscribe(d);a&&Arbiter.unsubscribe(a);});}};
var FriendButtonIcon={init:function(b,e,f){var d=DOM.find(e,'.defaultIcon');var c=DOM.find(e,'.closeIcon');var a=DOM.find(e,'.acqIcon');Arbiter.subscribe('FriendListMembershipChange',function(g,h){if(h.uid==f){var j=h.lists.contains(FriendStatus.CLOSE_FRIENDS);var i=h.lists.contains(FriendStatus.ACQUAINTANCES);if(j&&!i){Button.setIcon(b,c);}else if(i&&!j){Button.setIcon(b,a);}else Button.setIcon(b,d);}});}};
__d("Menu",["event-extensions","Arbiter","css","DataStore","dom","HTML","Keys","onload","Parent","ua","copyProperties"],function(v,x,y,w,u){x("event-extensions");var a=x("Arbiter");var b=x("css");var d=x("DataStore");var c=x("dom");var e=x("HTML");var f=x("Keys");var h=x("onload");var i=x("Parent");var z=x("ua");var t=x("copyProperties");var g=null;var r='menu:mouseover';var j=null;function k(za){return i.byClass(za,'uiMenu');}function l(za){return i.byClass(za,'uiMenuItem');}function m(za){if(document.activeElement){var zb=l(document.activeElement);return za.indexOf(zb);}return -1;}function n(za){return c.find(za,'a.itemAnchor');}function o(za){return b.hasClass(za,'checked');}function p(za){return !b.hasClass(za,'disabled')&&b.getStyle(za,'display')!=='none';}function q(event){var za=document.activeElement;if(!za||!i.byClass(za,'uiMenu')||!c.isNodeOfType(za,['input','textarea'])){var zb=l(event.getTarget());zb&&g.focusItem(zb);}}function s(za){z.firefox()&&n(za).blur();g.inform('select',{menu:k(za),item:za});}h.runOnload(function(){var za={};za.click=function(event){var zd=l(event.getTarget());if(zd&&p(zd)){s(zd);var zb=n(zd);var zc=zb.href;var ze=zb.getAttribute('rel');return (ze&&ze!=='ignore')||(zc&&zc.charAt(zc.length-1)!=='#');}};za.keydown=function(event){var zk=event.getTarget();if(event.getModifiers().any)return;if(!j||c.isNodeOfType(zk,['input','textarea']))return;var zg=Event.getKeyCode(event);var ze;switch(zg){case f.UP:case f.DOWN:var zc=g.getEnabledItems(j);ze=m(zc);g.focusItem(zc[ze+(zg===f.UP?-1:1)]);return false;case f.SPACE:var zj=l(zk);if(zj){s(zj);event.prevent();}break;default:var zb=String.fromCharCode(zg).toLowerCase();var zf=g.getEnabledItems(j);ze=m(zf);var zd=ze;var zh=zf.length;while((~ze&&(zd=++zd%zh)!==ze)||(!~ze&&++zd<zh)){var zi=g.getItemLabel(zf[zd]);if(zi&&zi.charAt(0).toLowerCase()===zb){g.focusItem(zf[zd]);return false;}}}};Event.listen(document.body,za);});g=w.exports=t(new a(),{focusItem:function(za){if(za&&p(za)){this._removeSelected(k(za));b.addClass(za,'selected');n(za).focus();}},getEnabledItems:function(za){return g.getItems(za).filter(p);},getCheckedItems:function(za){return g.getItems(za).filter(o);},getItems:function(za){return c.scry(za,'li.uiMenuItem');},getItemLabel:function(za){return za.getAttribute('data-label',2)||'';},isItemChecked:function(za){return b.hasClass(za,'checked');},register:function(za,zb){za=k(za);if(!d.get(za,r))d.set(za,r,Event.listen(za,'mouseover',q));if(zb!==false)j=za;},setItemEnabled:function(zb,za){if(!za&&!c.scry(zb,'span.disabledAnchor')[0])c.appendContent(zb,c.$N('span',{className:c.find(zb,'a').className+' disabledAnchor'},e(n(zb).innerHTML)));b.conditionClass(zb,'disabled',!za);},toggleItem:function(zb){var za=!g.isItemChecked(zb);g.setItemChecked(zb,za);},setItemChecked:function(zb,za){b.conditionClass(zb,'checked',za);n(zb).setAttribute('aria-checked',za);},unregister:function(zb){zb=k(zb);var za=d.remove(zb,r);za&&za.remove();j=null;this._removeSelected(zb);},_removeSelected:function(za){g.getItems(za).filter(function(zb){return b.hasClass(zb,'selected');}).each(function(zb){b.removeClass(zb,'selected');});}});});
__d("legacy:menu-legacy",["Menu"],function(a,b,c){a.Menu=b('Menu');},3);
var RespondToRequestButton={init:function(a,c,b){Event.listen(a,'click',function(){CSS.addClass(a,'uiButtonConfirm');CSS.addClass(a,'selected');c.show();});c.subscribe('hide',function(){CSS.removeClass(a,'uiButtonConfirm');CSS.removeClass(a,'selected');});Menu.subscribe('select',function(d,e){if(!CSS.hasClass(e.menu,'requestResponseMenu'))return;if(CSS.hasClass(e.item,'reject')){CSS.hide(a);CSS.show(b);}c.hide();});}};
function RenderManager(a){copy_properties(this,{_isDirty:false,_obj:a});}copy_properties(RenderManager.prototype,{dirty:function(){if(!this._isDirty){this._isDirty=true;bind(this,this.doPaint).defer();}},doPaint:function(){this._isDirty=false;this._obj.paint();}});
function CounterDisplay(a,g,h,e,d,b){copy_properties(this,{_name:a,_valueNode:$(g),_wrapperNode:$(h)||null,_statusClass:d,_rm:new RenderManager(this),_arbiterSubscription:null,_count:0});var c=this._valueNode.firstChild;if(c){var f=parseInt(c.nodeValue,10);if(!isNaN(f))this._count=f;}this._statusNode=e?$(e):null;this._subscribeAll();CounterDisplay.instances.push(this);if(!b)onleaveRegister(this._destroy.bind(this),true);}copy_properties(CounterDisplay,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(a,b){Arbiter.inform(CounterDisplay.EVENT_TYPE_ADJUST+'/'+a,b);},setCount:function(a,b){Arbiter.inform(CounterDisplay.EVENT_TYPE_UPDATE+'/'+a,b);}});Class.mixin(CounterDisplay,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){Arbiter.unsubscribe(this._arbiterSubscription);delete this._arbiterSubscription;}CounterDisplay.instances.remove(this);},adjustCount:function(a){this._count=Math.max(0,this._count+a);this._rm.dirty();return this;},setCount:function(a){this._count=Math.max(0,a);this._rm.dirty();return this;},paint:function(){DOM.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)CSS.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)CSS.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var a=[CounterDisplay.EVENT_TYPE_ADJUST+'/'+this._name,CounterDisplay.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=Arbiter.subscribe(a,this._onInform.bind(this),Arbiter.SUBSCRIBE_NEW);},_onInform:function(a,b){b=parseInt(b);if(isNaN(b))return;if(a.indexOf(CounterDisplay.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(b);}else if(a.indexOf(CounterDisplay.EVENT_TYPE_UPDATE)!=-1){this.setCount(b);}else return;return;}});
function adjustImage(e,g){if(!g){var a=e.parentNode;while(a.parentNode&&(CSS.getStyle(a,'display')!='block'||a.offsetWidth==0))a=a.parentNode;g=a.offsetWidth;}var c=e.offsetWidth;if(c==0){var d=e.nextSibling,f=e.parentNode;document.body.appendChild(e);c=e.offsetWidth;if(d){f.insertBefore(e,d);}else f.appendChild(e);}if(c>g)try{if(ua.ie()<8){var img_div=document.createElement('div');img_div.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e.src.replace('"','%22')+'", sizingMethod="scale")';img_div.style.width=g+'px';img_div.style.height=Math.floor(((g/e.offsetWidth)*e.offsetHeight))+'px';if(e.parentNode.tagName=='A')img_div.style.cursor='pointer';e.parentNode.insertBefore(img_div,e);e.parentNode.removeChild(e);}else throw 1;}catch(b){e.style.width=g+'px';}CSS.removeClass(e,'img_loading');}function imageConstrainSize(e,b,c,d){var a=new Image();a.onload=function(){if(a.width>0&&a.height>0){var k=a.width;var h=a.height;if(k>b||h>c){var g=c/b;var f=h/k;if(f>g){k=k*(c/h);h=c;}else{h=h*(b/k);k=b;}}var j=ge(d);if(j){var i=document.createElement('img');i.src=e;i.width=k;i.height=h;j.parentNode.insertBefore(i,j);j.parentNode.removeChild(j);}}};a.src=e;}function image_has_loaded(a){if(a.naturalWidth!==undefined){return a.complete&&a.width!=0;}else if(a.height==20&&a.width==20&&a.complete){return false;}else if(a.complete===undefined&&ua.safari()<500){var b=new Image();b.src=a.src;return b.complete;}return a.complete;}function image_has_failed(a){if((a.complete==null&&a.width==20&&a.height==20)||(a.mimeType!=null&&a.complete&&a.mimeType=='')||(a.naturalHeight!=null&&a.complete&&a.naturalHeight==0))return true;}
__d("legacy:intl-locale",["Locale"],function(a,b,c){a.intl_locale_is_rtl=b('Locale').isRTL;},3);
__d("legacy:control-dom",["DOMControl"],function(a,b,c){a.DOMControl=b('DOMControl');},3);
function TextInputControl(b){this.parent.construct(this,b);var a=this.getRoot();var c=function(){this.update.bind(this).defer();}.bind(this);Event.listen(a,{keydown:c,paste:c});}Class.extend(TextInputControl,'DOMControl');TextInputControl.prototype={setMaxLength:function(a){Input.setMaxLength(this.getRoot(),a);return this;},getValue:function(){return Input.getValue(this.getRoot());},isEmpty:function(){return Input.isEmpty(this.getRoot());},setValue:function(a){Input.setValue(this.getRoot(),a);this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(a){Input.setPlaceholder(this.getRoot(),a);return this;}};
function TextMetrics(a){this._node=a;var b=this._shadow=$N('textarea',{className:'textMetrics'});var c=['fontSize','fontStyle','fontWeight','fontFamily','lineHeight','wordWrap'];c.each(function(d){CSS.setStyle(b,d,CSS.getStyle(a,d));});document.body.appendChild(b);}TextMetrics.prototype={measure:function(){var a=this._node;var b=this._shadow;var c=a.clientWidth-CSS.getStyleFloat(a,'paddingLeft')-CSS.getStyleFloat(a,'paddingRight');CSS.setStyle(b,'width',c+'px');b.value=a.value+'...';return {width:b.scrollWidth,height:b.scrollHeight};},destroy:function(){DOM.remove(this._shadow);}};
function TextAreaControl(a){this.autogrow=false;this.parent.construct(this,a);this.width=null;Event.listen(a,{focus:this._handleFocus.bind(this)});}Class.extend(TextAreaControl,'TextInputControl');Class.mixin(TextAreaControl,'Arbiter',{setAutogrow:function(a){this.autogrow=a;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var d=this.getRoot();if(!this.metrics)this.metrics=new TextMetrics(d);if(typeof this.minHeight==='undefined'){var c=CSS.getStyleFloat(d,'height');this.minHeight=c>0?c:d.offsetHeight-8;}if(typeof this.isBorderBox==='undefined')if(CSS.getStyle(d,'box-sizing')=='border-box'||CSS.getStyle(d,'-moz-box-sizing')=='border-box'||CSS.getStyle(d,'-webkit-box-sizing')=='border-box'){this.isBorderBox=true;this.borderBoxOffset=CSS.getStyleFloat(d,'padding-top')+CSS.getStyleFloat(d,'padding-bottom')+CSS.getStyleFloat(d,'border-top-width')+CSS.getStyleFloat(d,'border-bottom-width');}else this.isBorderBox=false;var b=this.metrics.measure();var a=Math.max(this.minHeight,b.height);if(this.isBorderBox)a+=this.borderBoxOffset;if(a!=this.height){CSS.setStyle(d,'height',a+'px');this.height=a;Arbiter.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}});TextAreaControl.getInstance=function(b){var a=DOMControl.getInstance(b);if(!a){a=new TextAreaControl(b);CSS.hasClass(b,'uiTextareaAutogrow')&&a.setAutogrow(true);b._has_control=true;}return a;};
__d("legacy:dom-html",["HTML"],function(a,b,c){a.HTML=b('HTML');},3);
function show(){for(var b=0;b<arguments.length;b++){var a=ge(arguments[b]);if(a&&a.style)a.style.display='';}return false;}function hide(){for(var b=0;b<arguments.length;b++){var a=ge(arguments[b]);if(a&&a.style)a.style.display='none';}return false;}function shown(a){a=ge(a);return (a.style.display!='none'&&!(a.style.display==''&&a.offsetWidth==0));}function toggle(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);a.style.display=CSS.getStyle(a,"display")=='block'?'none':'block';}return false;}function toggleDisplayNone(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);if(shown(a)){hide(a);}else show(a);}return false;}
__d("legacy:dom-scroll",["DOMScroll"],function(a,b,c){a.DOMScroll=b('DOMScroll');},3);
__d("UntrustedLink",["copyProperties","event-extensions","URI"],function(f,h,i,g,e){var d=h("copyProperties");var a=h("event-extensions");var b=h("URI");function c(j,m,k,l){this.dom=j;this.url=j.href;this.hash=m;this.func_get_params=l||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(a.$E(k));}c.bootstrap=function(j,m,k,l){if(j.__untrusted)return;j.__untrusted=true;new c(j,m,k,l);};c.prototype.getRewrittenURI=function(){var j=d({u:this.url,h:this.hash},this.func_get_params(this.dom));var k=new b('/l.php');return k.setQueryData(j).setSubdomain('www').setProtocol('http');};c.prototype.onclick=function(){(function(){this.dom.href=this.url;}).bind(this).defer(100);this.dom.href=this.getRewrittenURI();};c.prototype.onmousedown=function(j){if(j.button==2)this.dom.href=this.getRewrittenURI();};c.prototype.onmouseup=function(){this.dom.href=this.getRewrittenURI();};c.prototype.onmouseout=function(){this.dom.href=this.url;};g.exports=c;});
__d("legacy:dom-untrusted",["UntrustedLink"],function(a,b,c){a.UntrustedLink=b('UntrustedLink');},3);
__d("legacy:key-event-constants",["Keys"],function(a,b,c){a.KEYS=b('Keys');},3);
function KeyEventController(){this.handlers={};document.onkeyup=this.onkeyevent.bind(this,'onkeyup');document.onkeydown=this.onkeyevent.bind(this,'onkeydown');document.onkeypress=this.onkeyevent.bind(this,'onkeypress');}copy_properties(KeyEventController,{instance:null,getInstance:function(){return KeyEventController.instance||(KeyEventController.instance=new KeyEventController());},defaultFilter:function(event,a){event=$E(event);return KeyEventController.filterEventTypes(event,a)&&KeyEventController.filterEventTargets(event,a)&&KeyEventController.filterEventModifiers(event,a);},filterEventTypes:function(event,a){if(a==='onkeydown')return true;return false;},filterEventTargets:function(event,b){var a=event.getTarget();return !DOM.isNodeOfType(a,KeyEventController._interactiveElements)||(a.type in KeyEventController._uninterestingTypes)||(DOM.isNodeOfType(a,['input','textarea'])&&a.value.length===0&&event.keyCode in KeyEventController._controlKeys);},filterEventModifiers:function(event,a){if(event.ctrlKey||event.altKey||event.metaKey||event.repeat)return false;return true;},registerKey:function(f,a,d,g){if(d===undefined)d=KeyEventController.defaultFilter;var b=KeyEventController.getInstance();var c=b.mapKey(f);if(is_empty(b.handlers))onleaveRegister(b.resetHandlers.bind(b));for(var e=0;e<c.length;e++){f=c[e];if(!b.handlers[f]||g)b.handlers[f]=[];b.handlers[f].push({callback:a,filter:d});}},keyCodeMap:{BACKSPACE:[8],TAB:[9],RETURN:[13],ESCAPE:[27],LEFT:[37,63234],UP:[38,63232],RIGHT:[39,63235],DOWN:[40,63233],DELETE:[46],COMMA:[188],PERIOD:[190],'`':[192],'[':[219],']':[221]},_interactiveElements:['input','select','textarea','object','embed'],_uninterestingTypes:{checkbox:1,radio:1,submit:1},_controlKeys:{8:1,9:1,13:1,27:1,37:1,63234:1,38:1,63232:1,39:1,63235:1,40:1,63233:1,46:1}});copy_properties(KeyEventController.prototype,{mapKey:function(a){if(a>=0&&a<=9){if(typeof(a)!='number')a=a.charCodeAt(0)-48;return [48+a,96+a];}var b=KeyEventController.keyCodeMap[a.toUpperCase()];if(b)return b;return [a.toUpperCase().charCodeAt(0)];},onkeyevent:function(i,c){c=$E(c);var d=null;var g=this.handlers[c.keyCode];var b,f,a;if(g)for(var h=0;h<g.length;h++){b=g[h].callback;f=g[h].filter;try{if(!f||f(c,i)){a=b(c,i);if(a===false)return Event.kill(c);}}catch(e){}}return true;},resetHandlers:function(){this.handlers={};}});
__d("legacy:link-controller",["LinkController"],function(a,b,c){a.LinkController=b('LinkController');},3);
__d("legacy:input-selection",["InputSelection","copyProperties"],function(c,d,e){var a=d('InputSelection');var b=d('copyProperties');b(c.Input||(c.Input={}),{getSelection:a.get,setSelection:a.set});},3);
__d("Rect",["Vector","copyProperties"],function(e,g,h,f,d){var b=g("Vector");var c=g("copyProperties");function a(m,l,i,k,j){if(arguments.length===1){if(m instanceof a)return m;if(m instanceof b)return new a(m.y,m.x,m.y,m.x,m.domain);return a.getElementBounds($(m));}c(this,{t:m,r:l,b:i,l:k,domain:j||'pure'});}c(a.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(j){j=new a(j).convertTo(this.domain);var i=this;return (i.l<=j.l&&i.r>=j.r&&i.t<=j.t&&i.b>=j.b);},add:function(k,l){if(arguments.length==1){if(k.domain!='pure')k=k.convertTo(this.domain);return this.add(k.x,k.y);}var i=parseFloat(k);var j=parseFloat(l);return new a(this.t+j,this.r+i,this.b+j,this.l+i,this.domain);},sub:function(i,j){if(arguments.length==1){return this.add(i.mul(-1));}else return this.add(-i,-j);},boundWithin:function(i){var j=0,k=0;if(this.l<i.l){j=i.l-this.l;}else if(this.r>i.r)j=i.r-this.r;if(this.t<i.t){k=i.t-this.t;}else if(this.b>i.b)k=i.b-this.b;return this.add(j,k);},getCenter:function(){return new b(this.l+this.w()/2,this.t+this.h()/2,this.domain);},getPositionVector:function(){return new b(this.l,this.t,this.domain);},getDimensionVector:function(){return new b(this.w(),this.h(),'pure');},convertTo:function(i){if(this.domain==i)return this;if(i=='pure')return new a(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new a(0,0,0,0);var j=new b(this.l,this.t,this.domain).convertTo(i);return new a(j.y,j.x+this.w(),j.y+this.h(),j.x,i);}});c(a,{deserialize:function(j){var i=j.split(':');return new a(i[1],i[2],i[3],i[0]);},newFromVectors:function(j,i){return new a(j.y,j.x+i.x,j.y+i.y,j.x,j.domain);},getElementBounds:function(i){return a.newFromVectors(b.getElementPosition(i),b.getElementDimensions(i));},getViewportBounds:function(){return a.newFromVectors(b.getScrollPosition(),b.getViewportDimensions());},minimumBoundingBox:function(l){var i=new a(Math.min(),Math.max(),Math.max(),Math.min());var k;for(var j=0;j<l.length;j++){k=l[j];i.t=Math.min(i.t,k.t);i.r=Math.max(i.r,k.r);i.b=Math.max(i.b,k.b);i.l=Math.min(i.l,k.l);}return i;}});f.exports=a;});
__d("legacy:rect",["Rect"],function(a,b,c){a.Rect=b('Rect');},3);
var Base64=(function(){var c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function d(e){e=(e.charCodeAt(0)<<16)|(e.charCodeAt(1)<<8)|e.charCodeAt(2);return String.fromCharCode(c.charCodeAt(e>>>18),c.charCodeAt((e>>>12)&63),c.charCodeAt((e>>>6)&63),c.charCodeAt(e&63));}var a='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function b(e){e=(a.charCodeAt(e.charCodeAt(0)-43)<<18)|(a.charCodeAt(e.charCodeAt(1)-43)<<12)|(a.charCodeAt(e.charCodeAt(2)-43)<<6)|a.charCodeAt(e.charCodeAt(3)-43);return String.fromCharCode(e>>>16,(e>>>8)&255,e&255);}return {encode:function(f){f=unescape(encodeURI(f));var e=(f.length+2)%3;f=(f+'\0\0'.slice(e)).replace(/[\s\S]{3}/g,d);return f.slice(0,f.length+e-2)+'=='.slice(e);},decode:function(g){g=g.replace(/[^A-Za-z0-9+\/]/g,'');var f=(g.length+3)&3;g=(g+'AAA'.slice(f)).replace(/..../g,b);g=g.slice(0,g.length+f-3);try{return decodeURIComponent(escape(g));}catch(e){throw new Error('Not valid UTF-8');}},encodeObject:function(e){return Base64.encode(JSON.stringify(e));},decodeObject:function(e){return JSON.parse(Base64.decode(e));},encodeNums:function(e){return String.fromCharCode.apply(String,e.map(function(f){return c.charCodeAt((f|-(f>63))&-(f>0)&63);}));}};})();
__d("htmlHyperlink",["Env","UntrustedLink","URLScraper"],function(e,h,i,g,d){var a=h("Env");var c=h("UntrustedLink");var b=h("URLScraper");function f(p,q,r,n){if(typeof p==='undefined'||!p.toString)return '';if(typeof q!=='function')q=htmlize;if(typeof r!=='function')r=htmlize;var p=p.toString();var o=[];var k;while((k=b.match(p))){var m=p.indexOf(k);if(m>=0)o.push(q(p.substring(0,m)));var j=r(k);var l=k.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(k)))l='http://'+l;o.push('<a target="_blank" rel="nofollow" href="'+l+'"');if(n)o.push(' onmousedown="UntrustedLink.bootstrap(this, \''+a.lhsh+'\', event)"');o.push('>'+j+'</a>');p=p.substring(m+k.length);}p&&o.push(q(p));return o.join('');}g.exports=f;});
__d("isEmail",[],function(b,e,f,d,a){function c(g){return (/^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/).test(g);}d.exports=c;});
__d("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
if(window==window.top)!function(){var a=function(){var b=0;return function(){if(!b){b=1;setTimeout(function(){b=0;var c=Vector2.getViewportDimensions();setCookie('wd',c.x+'x'+c.y);if(window.AsyncSignal&&Math.random()<.01)new AsyncSignal('/ajax/dimension_context.php',{'x':c.x,'y':c.y}).send();},100);}};}();onloadRegister(a);onloadRegister(function(){Event.listen(window,'resize',a);});onloadRegister(function(){Event.listen(window,'focus',a);});}();
__d("ErrorDialog",["Dialog"],function(d,f,g,e,c){var a=f("Dialog");var b={showAsyncError:function(i){try{return b.show(i.getErrorSummary(),i.getErrorDescription());}catch(h){alert(i);}},show:function(k,j,i,h){return (new a()).setTitle(k).setBody(j).setButtons([a.OK]).setStackable(true).setModal(true).setHandler(i||bagofholding).setButtonsMessage(h||'').show();}};e.exports=b;});
__d("legacy:error-dialog",["ErrorDialog"],function(b,c,d){var a=c('ErrorDialog');b.ErrorDialog=a;},3);
__d("legacy:array-utils",["ArrayUtils","hasArrayNature"],function(a,b,c){a.$A=b('ArrayUtils').createFrom;a.hasArrayNature=b('hasArrayNature');},3);
__d("ContextualThing",["dom"],function(e,g,h,f,d){var b=g("dom");var c=[];var a={register:function(j,i){a.remove(j);c.push({node:j,context:i});},remove:function(j){for(var i=0;i<c.length;i++)if(c[i].node===j){c.splice(i,1);i--;}},getContext:function(j){var i=null;c.forEach(function(k){if(b.contains(k.node,j))i=k.context;});return i;},containsIncludingLayers:function(j,i){while(i){if(b.contains(j,i))return true;i=a.getContext(i);}return false;}};f.exports=a;});
__d("Layer",["animation","Arbiter","Class","css-core","dom","HTML","getOverlayZIndex"],function(j,l,m,k,h){var g=l("animation");var a=l("Arbiter");var c=l("Class");var b=l("css-core");var d=l("dom");var e=l("HTML");var i=l("getOverlayZIndex");function f(){}c.mixin(f,'Arbiter',{_root:null,_shown:false,_fadeOnShow:false,_fadeOnHide:false,_destroyOnHide:false,_hideOnTransition:true,_transitionSubscription:null,init:function(n){this._behaviors=[];this.setHideOnTransition(this._hideOnTransition);if(n){var p=d.isNode(n);var o=typeof n==='string'||e.isHTML(n);if(o)n=e(n).getRootNode();}this._root=this._buildWrapper(n);return this;},addBehaviors:function(n){for(var o=0;o<n.length;o++)if(!(this._behaviors.indexOf(n[o])!==-1)){this._behaviors.push(n[o]);new n[o](this);}return this;},getInsertParent:function(){return this._insertParent||d.getDocumentBodyElement();},getRoot:function(){return this._root;},_buildWrapper:function(n){return n;},setHideOnTransition:function(n){if(n){if(!this._transitionSubscription)this._transitionSubscription=a.subscribe('page_transition',this.hide.shield(this),a.SUBSCRIBE_NEW);}else if(this._transitionSubscription){a.unsubscribe(this._transitionSubscription);this._transitionSubscription=null;}this._hideOnTransition=n;return this;},setFadeOnShow:function(n){this._fadeOnShow=n;return this;},setFadeOnHide:function(n){this._fadeOnHide=n;return this;},setDestroyOnHide:function(n){this._destroyOnHide=n;return this;},setInsertParent:function(n){if(n){if(this._shown&&n!==this.getInsertParent()){d.appendContent(n,this._root);this.updatePosition();}this._insertParent=n;}return this;},show:function(){if(this._shown)return this;if(this._fadeOnShow)b.setStyle(this._root,'opacity',0);b.addClass(this._root,'invisible_elem');b.show(this._root);d.appendContent(this.getInsertParent(),this._root);if(this.updatePosition()!==false){this._shown=true;this.inform('show');if(this._fadeOnShow)g(this._root).from('opacity',0).to('opacity',1).duration(100).ondone(b.setStyle.curry(this._root,'opacity','')).go();}else d.remove(this._root);b.removeClass(this._root,'invisible_elem');return this;},hide:function(){if(!this._shown||this.inform('beforehide')===false)return this;if(this._fadeOnHide){g(this._root).from('opacity',1).to('opacity',0).duration(250).ondone(this._finishHide.bind(this)).go();}else this._finishHide();return this;},_finishHide:function(){this._shown=false;d.remove(this._root);this.inform('hide');this._destroyOnHide&&this.destroy();},isShown:function(){return this._shown;},updatePosition:function(){return true;},destroy:function(){this.hide();this.inform('destroy');this._root=null;a.unsubscribe(this._transitionSubscription);this._transitionSubscription=null;}});k.exports=f;});
__d("LayerHideOnEscape",["event-extensions","dom","Keys"],function(e,g,h,f,d){g("event-extensions");var a=g("dom");var b=g("Keys");function c(j){var i;var k=j.getRoot();j.subscribe('show',function(){i=Event.listen(document.documentElement,'keydown',function(event){if(event.keyCode==b.ESC&&(document.activeElement==document.body||a.contains(k,document.activeElement)))j.hide();});});j.subscribe('hide',function(){i.remove();i=null;});}f.exports=c;});
__d("Overlay",["event-extensions","animation","Arbiter","Class","ContextualThing","css","DataStore","dom","Form","Keys","Layer","LayerHideOnEscape","Locale","Parent","dom-core","copyProperties"],function(s,v,w,u,r){v("event-extensions");var p=v("animation");var c=v("Arbiter");var e=v("Class");var f=v("ContextualThing");var d=v("css");var h=v("DataStore");var g=v("dom");var i=v("Form");var j=v("Keys");var k=v("Layer");var l=v("LayerHideOnEscape");var m=v("Locale");var o=v("Parent");var a=v("dom-core").$;var b=g.$N;var q=v("copyProperties");var t=null;function n(){this.parent.construct(this);}e.extend(n,k);q(n,{getInstance:function(x){var y=o.byClass(x,'uiOverlay');return y?h.get(y,'overlay'):null;},ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_CLASS:{bottom:'uiOverlayArrowBottom',top:'uiOverlayArrowTop',right:'uiOverlayArrowRight',left:'uiOverlayArrowLeft'}});q(n.prototype,{_shouldBuildWrapper:true,_hideOnSuccess:true,_hasFooter:false,init:function(y){this.parent.init(y);this._arrow=g.scry(this._root,'.uiOverlayArrow')[0]||null;this._overlay=g.scry(this._root,'div.uiOverlay')[0]||this._root;d.hide(this._root);g.appendContent(this.getInsertParent(),this._root);h.set(this._overlay,'overlay',this);var z=h.get(this._overlay,'width');z&&this.setWidth(z);this.setHideOnSuccess(h.get(this._overlay,'hideonsuccess')!='false');this.setFadeOnShow(h.get(this._overlay,'fadeonshow')!='false');this.setFadeOnHide(h.get(this._overlay,'fadeonhide')!='false');this.setHideOnBlur(h.get(this._overlay,'hideonblur')=='true');this.setDestroyOnHide(h.get(this._overlay,'destroyonhide')!='false');this.setFixed(h.get(this._overlay,'fixed')=='true');this._hasFooter=h.get(this._overlay,'hasfooter',false);var x=g.scry(this._root,'.uiOverlayFooterLink')[0]||null;if(x){Event.listen(x,'mouseenter',function(){d.addClass(this._overlay,'uiOverlayHoverFooterArrow');}.bind(this));Event.listen(x,'mouseleave',function(){d.removeClass(this._overlay,'uiOverlayHoverFooterArrow');}.bind(this));}Event.listen(this._overlay,{click:this.click.bind(this),submit:this.submit.bind(this),success:this._onsuccess.bind(this),error:this._onerror.bind(this),mouseenter:this._onMouseEnter.bind(this),mouseleave:this._onMouseLeave.bind(this)});this.subscribe('show',function(){c.inform('layer_shown',{type:'Overlay'});c.inform('Overlay/show',{overlay:this});}.bind(this));this.subscribe('hide',function(){c.inform('layer_hidden',{type:'Overlay'});c.inform('Overlay/hide',{overlay:this});}.bind(this));c.subscribe('Overlay/show',function(za,zb){if(zb.overlay.getContext)this._onLayerShow(zb.overlay.getContext());}.bind(this));c.subscribe('Overlay/hide',function(za,zb){if(zb.overlay.getContext)this._onLayerHide(zb.overlay.getContext());}.bind(this));this.addBehaviors([l]);return this;},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(x){x=this.parent._buildWrapper(x);if(!this._shouldBuildWrapper)return x;var y=b('div',{className:'uiOverlayContent'},x);return b('div',{className:'uiOverlay'},y);},setHideOnBlur:function(x){if(!x&&this._hideOnBlurToken){this._removeHideOnBlurListener();this.unsubscribe(this._hideOnBlurToken);this._hideOnBlurToken=null;}else if(x&&!this._hideOnBlurToken){var y=this;var z=function(){(function(){y._hideOnBlurListener=Event.listen(document.documentElement,'click',function(event){if(!f.containsIncludingLayers(y._overlay,event.getTarget()))y.setFadeOnHide(false).hide();});}).defer();};this.subscribe('hide',this._removeHideOnBlurListener.bind(this));this._hideOnBlurToken=this.subscribe('show',z);this._shown&&z();}return this;},_removeHideOnBlurListener:function(){this._hideOnBlurListener&&this._hideOnBlurListener.remove();this._hideOnBlurListener=null;},setHideOnSuccess:function(x){this._hideOnSuccess=x;return this;},setWidth:function(x){this.width=parseInt(x,10);return this;},setFixed:function(x){this.fixed=x;return this;},getOverlay:function(){return this._overlay;},updatePosition:function(){if(this.width)d.setStyle(this._overlay,'width',this.width+'px');return true;},destroy:function(){h.remove(this._root,'overlay');this.parent.destroy();},click:function(y){var z=y.getTarget();var x=o.byTag(z,'input')||o.byTag(z,'button')||o.byTag(z,'a');if(x){t=x;if(d.hasClass(x,'uiOverlayCancelButton')){if(this.inform('cancel')!==false)this.hide();y.prevent();}}},submit:function(x){var y=x.getTarget();if(this.inform('submit')===false){x.kill();return;}var z=(i.getAttribute(y,'rel')==='async');if(!z)return this._onsuccess(x);},_onsuccess:function(x){if(this.inform('success')!==false&&this._hideOnSuccess)this.hide();},_onerror:function(x){var y=x.getData();if(this.inform('error',{response:y.response})===false)x.kill();},_onMouseEnter:function(){this._fireMouseLeaveOnLayerHide=false;if(!this._layerNode)this.inform('mouseenter');},_onMouseLeave:function(){if(!this._layerNode)this.inform('mouseleave');this._fireMouseLeaveOnLayerHide=!!this._layerNode;},_onLayerShow:function(x){if(x&&g.contains(this._root,x))this._layerNode=x;},_onLayerHide:function(x){if(x&&this._layerNode===x){this._layerNode=null;if(this._fireMouseLeaveOnLayerHide)this._onMouseLeave.bind(this).defer();}}});u.exports=n;});
__d("ContextualDialogX",["event-extensions","Arbiter","bootloader","Class","ContextualThing","css","DataStore","dom","Locale","Overlay","Parent","Vector","copyProperties","getOverlayZIndex"],function(q,s,t,r,o){s("event-extensions");var b=s("Arbiter");var c=s("bootloader");var e=s("Class");var g=s("ContextualThing");var d=s("css");var i=s("DataStore");var h=s("dom");var j=s("Locale");var k=s("Overlay");var l=s("Parent");var m=s("Vector");var n=s("copyProperties");var a=h.$N;var p=s("getOverlayZIndex");function f(){this.parent.construct(this);}e.extend(f,k);n(f,{ARROW_INSET:22,TOP_MARGIN:8,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,HALO_WIDTH:0,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(v){var u=i.get(v,'ContextualDialogX');if(!u){var w=l.byClass(v,'uiContextualDialog');u=w&&k.getInstance(w);}return u;}});n(f.prototype,{_scrollListener:null,_scrollParent:null,init:function(w){this.parent.init(w);var v=i.get.curry(this._root);this.setAlignH(v('alignh','left'));this.setOffsetX(v('offsetx',0));this.setOffsetY(v('offsety',0));this.setPosition(v('position','above'));var u=v('context');if(u){this.setContext($(u));}else{u=v('contextselector');if(u)this.setContext(h.find(document,u));}this._content=h.scry(this._root,'.uiContextualDialogContent')[0];var y=null;var x=null;this.subscribe('show',function(){var z=this.updatePosition.shield(this);y=Event.listen(window,'resize',z);x=b.subscribe('reflow',z);this._setupScrollListener(this._scrollParent);g.register(this._root,this.context);}.bind(this));this.subscribe('hide',function(){y.remove();b.unsubscribe(x);this._teardownScrollListener();g.remove(this._root);}.bind(this));b.subscribe('Hovercard/hide',function(z,za){if(Hovercard.contains(this.getContext()))this.hide();}.bind(this));return this;},_buildWrapper:function(u){var v=this.parent._buildWrapper(u);if(!this._shouldBuildWrapper)return v;d.addClass(v,'uiContextualDialog');return a('div',{className:'uiContextualDialogPositioner'},v);},setAlignH:function(u){this.alignH=u;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(u){u=$(u);if(this.context&&this.context!=u)i.remove(this.context,'ContextualDialogX');this.context=u;var v=l.byClass(u,'fbPhotoSnowbox')||l.byClass(u,'fbPhotoSnowlist');this.setInsertParent(v||h.getDocumentBodyElement());if(this._scrollListener&&this._scrollParent!==v){this._teardownScrollListener();this._setupScrollListener(v);}this._scrollParent=v;var w=p(u,this._insertParent);d.setStyle(this._root,'z-index',w>200?w:'');i.set(this.context,'ContextualDialogX',this);return this;},listen:function(v,u){return Event.listen(this._root,v,u);},setFixed:function(u){d.conditionClass(this._root,'uiContextualDialogFixed',u);return this.parent.setFixed(u);},setOffsetX:function(u){this.offsetX=parseInt(u,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(u){this.offsetY=parseInt(u,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(v){this.position=v;for(var u in f.POSITION_TO_CLASS)d.conditionClass(this._root,f.POSITION_TO_CLASS[u],v==u);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;this.parent.updatePosition();var w=this.fixed?'viewport':'document';var za=m.getElementPosition(this.context,w);var zb=this._scrollParent;if(zb)za=za.sub(m.getElementPosition(zb,'document')).add(zb.scrollLeft,zb.scrollTop);var u=m.getElementDimensions(this.context);var ze=this.position=='above'||this.position=='below';var x=j.isRTL();if((this.position=='right'||(ze&&this.alignH=='right'))!=x)za=za.add(u.x,0);if(this.position=='below')za=za.add(0,u.y);var z=new m(0,0);var v=this.width+2*f.HALO_WIDTH;if(ze&&this.alignH=='center'){z=z.add((u.x-v)/2,0);}else{z=z.sub(ze?f.HALO_WIDTH:0,ze?0:f.HALO_WIDTH);var zd=ze?u.x:u.y;var y=2*(f.ARROW_INSET+f.HALO_WIDTH);if(zd<y){var zc=zd/2-f.ARROW_INSET;z=z.add(ze?zc:0,ze?0:zc);}}z=z.add(this.offsetX,this.offsetY);if(x)z=z.mul(-1,1);za=za.add(z);if(this.fixed)za=new m(za.x,za.y,'document');za.setElementPosition(this._root);this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)c.loadComponents('dom-scroll',function(){DOMScroll.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.context&&i.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){d.setStyle(this._overlay,'top','');return;}var w=m.getElementPosition(this._root,'viewport').y;var u=m.getElementDimensions(this._overlay).y;var y=m.getViewportDimensions().y;var x=f.TOP_MARGIN;var v=Math.min(Math.max(0,w+u+f.BOTTOM_MARGIN-y),Math.max(-x,w-x),u-2*f.ARROW_INSET-2*f.HALO_WIDTH);d.setStyle(this._overlay,'top',(-1*v)+'px');d.setStyle(this._arrow,'top',k.ARROW_OFFSET+'px');d.setStyle(this._arrow,'marginTop',v+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){d.setStyle(this._overlay,'left','');d.setStyle(this._overlay,'right','');return;}var x=m.getElementPosition(this._root,'viewport').x;var u=m.getElementDimensions(this._overlay).x;var y=m.getViewportDimensions().x;var v=j.isRTL();var w;if(!v){w=x+u+f.RIGHT_MARGIN-y;}else w=f.LEFT_MARGIN+u-x;w=Math.min(Math.max(0,w),u-2*f.ARROW_INSET-2*f.HALO_WIDTH);d.setStyle(this._overlay,v?'right':'left',-1*w+'px');d.setStyle(this._arrow,v?'right':'left',k.ARROW_OFFSET+'px');d.setStyle(this._arrow,v?'marginRight':'marginLeft',w+'px');},_updateArrow:function(){var u=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':u=50;break;case 'right':u=100;break;}this._renderArrow(f.POSITION_TO_ARROW[this.position],u);},_renderArrow:function(x,v){for(var w in k.ARROW_CLASS)d.conditionClass(this._overlay,k.ARROW_CLASS[w],x==w);d.conditionClass(this._overlay,'uiOverlayWithFooterArrowBottom',x=='bottom'&&this._hasFooter);if(x=='none')return;if(!this._arrow){this._arrow=a('i',{className:'uiOverlayArrow'});h.appendContent(this._overlay,this._arrow);}d.setStyle(this._arrow,'top','');d.setStyle(this._arrow,'left','');d.setStyle(this._arrow,'right','');d.setStyle(this._arrow,'margin','');var z=x=='top'||x=='bottom';var y=z?(j.isRTL()?'right':'left'):'top';v=v||0;d.setStyle(this._arrow,y,v+'%');var u=k.ARROW_LENGTH+k.ARROW_OFFSET*2;d.setStyle(this._arrow,'margin-'+y,-(u*v/100-k.ARROW_OFFSET)+'px');},_updateAlignmentClass:function(){d.conditionClass(this._root,f.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(u){this._scrollListener=Event.listen(u||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){this._scrollListener.remove();this._scrollListener=null;}});r.exports=f;});
__d("legacy:ContextualDialogX",["ContextualDialogX"],function(a,b,c){a.ContextualDialogX=b('ContextualDialogX');},3);
Hovercard=window.Hovercard||{RESERVED_WIDTH:297,RESERVED_HEIGHT:237,dialogs:{},active:{},contextElem:null,hoverElem:null,showingDialog:null,fetchDelay:150,showDelay:700,loadingDelay:1000,hideDelay:250,fetchTimer:null,showTimer:null,loadingTimer:null,hideTimer:null,init:function(){if(ua.ie()<7)return;Event.listen(document.documentElement,'mouseover',this.handle.bind(this));Event.listen(window,'scroll',bind(this,'hide',true));Arbiter.subscribe('page_transition',function(){this.abort();this.dirtyAll();}.bind(this),Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe('layer_shown',function(a,b){b.type!='Hovercard'&&b.type!='Overlay'&&this.abort();}.bind(this),Arbiter.SUBSCRIBE_NEW);this.init=bagofholding;},handle:function(event){var a=Parent.byTag(event.getTarget(),'a');if(a&&this.setActive(a)){this.process(a);event.stop();}},setActive:function(b){this.hoverElem=b;if(!this.isActive(b)){var a;if(!b||!(a=this.getEndpoint(b))){this.active.moveToken&&this.active.moveToken.remove();this.active={};return false;}if(this.active.node!=b){this.active.moveToken&&this.active.moveToken.remove();this.active={node:b,endpoint:a,pos:null};}}return true;},isActive:function(a){return a&&this.contextElem&&this.active.node==a;},getEndpoint:function(a){return a.getAttribute('data-hovercard');},process:function(b){var d=Event.listen(b,'mouseout',function(){clearTimeout(this.fetchTimer);clearTimeout(this.showTimer);d.remove();this.hoverElem=null;this.hide();}.bind(this));if(!this.active.moveToken)this.active.moveToken=Event.listen(b,'mousemove',function(event){this.active.pos=Vector2.getEventPosition(event);}.bind(this));clearTimeout(this.fetchTimer);clearTimeout(this.showTimer);clearTimeout(this.hideTimer);var a=this.fetchDelay;var c=this.contextElem?this.hideDelay:this.showDelay;if(b.getAttribute('data-hovercard-instant'))a=c=50;this.fetchTimer=setTimeout(this.fetch.bind(this,b),a);this.showTimer=setTimeout(this.show.bind(this,b),c);},show:function(c,b){if(this.active.node!=c)return;var a=this.dialogs[this.getEndpoint(c)];if(a){this.showDialog(a);}else if(b){this.showDialog(this._getLoadingDialog());}else{var d=this.contextElem?this.hideDelay:this.showDelay;this.loadingTimer=setTimeout(this.show.bind(this,c,true),this.loadingDelay-d);}},hide:function(a){if(!this.contextElem)return;if(a){if(this.showingDialog){Arbiter.inform('layer_hidden',{type:'Hovercard'});Arbiter.inform('Hovercard/hide',{node:this.contextElem});this.showingDialog.hide();}this.hoverElem=null;this.contextElem=null;this.showingDialog=null;}else this.hideTimer=setTimeout(this.hide.bind(this,true),this.hideDelay);},abort:function(){this.hide(true);clearTimeout(this.showTimer);},showDialog:function(a){var b=this.active.node;var e=this.contextElem;var c=e!=b;if(this.contextElem){var d=ContextualDialogX.getInstance(this.contextElem);d&&d.hide();}if(!DOM.contains(document.body,b)){this.hide(true);return;}this.contextElem=b;this.showingDialog=a;this.position();a.setContext(b).show();if(c){(function(){new AsyncSignal('/ajax/hovercard/shown.php').send();user_action('himp',this.contextElem,null,'FORCE',{ft:{evt:39}});}.bind(this)).defer();if(e){Arbiter.inform('Hovercard/hide',{node:e});}else Arbiter.inform('layer_shown',{type:'Hovercard'});Arbiter.inform('Hovercard/show',{node:b});}},position:function(){var j=Vector2.getViewportDimensions();var c=Vector2.getElementPosition(this.contextElem,'viewport');var d=c.convertTo('document');var b=this.getBounds(this.contextElem);var i='above';var a='left';var g=this.calcOffsetY(d,b,'above');if(c.y+g<=this.RESERVED_HEIGHT){var h=this.calcOffsetY(d,b,'below');if(c.y+h+this.contextElem.offsetHeight+this.RESERVED_HEIGHT<j.y){i='below';g=h;}}var k=j.x;window.ChatSidebar&&(k-=ChatSidebar.getVisibleWidth());var e=this.calcOffsetX(d,b,'left');if(c.x+e+this.RESERVED_WIDTH>=k){var f=this.calcOffsetX(d,b,'right');if(c.x+f+this.contextElem.offsetWidth>this.RESERVED_WIDTH){a='right';e=f;}}this.showingDialog.setPosition(i).setAlignH(a).setOffsetX(e).setOffsetY(g);},calcOffsetX:function(c,b,a){if(a=='left')return b.l-c.x;return b.r-(c.x+this.contextElem.offsetWidth);},calcOffsetY:function(b,a,c){if(c=='above')return a.t-b.y;return a.b-(b.y+this.contextElem.offsetHeight);},getBounds:function(e){var a=this.active.pos;var h=e.getClientRects();if(!a||h.length===0)return Rect.getElementBounds(e);var b;var c=false;for(var d=0;d<h.length;d++){var g=new Rect(Math.round(h[d].top),Math.round(h[d].right),Math.round(h[d].bottom),Math.round(h[d].left),'viewport').convertTo('document');var f=g.getPositionVector();var i=f.add(g.getDimensionVector());if(!b||(f.x<=b.l&&f.y>b.t)){if(c)break;b=new Rect(f.y,i.x,i.y,f.x,'document');}else{b.t=Math.min(b.t,f.y);b.b=Math.max(b.b,i.y);b.r=i.x;}if(g.contains(a))c=true;}return b;},fetch:function(c){if(c.id&&this.dialogs[c.id]!=null)return;var a=this.getEndpoint(c);if(this.dialogs[a]!=null)return;this.setFetchInProgress(a);var b=function(){this.dirty(a);this.abort();}.bind(this);new AsyncRequest(a).setData({endpoint:a}).setMethod('GET').setReadOnly(true).setErrorHandler(b).setTransportErrorHandler(b).send();},setFetchInProgress:function(a){this.dialogs[a]=false;},_getLoadingDialog:function(){var a=new ContextualDialogX();a.init($N('div',{className:'HovercardLoading'},"Loading...")).setDestroyOnHide(false).setFadeOnShow(false).setFadeOnHide(false);this._initDialogSubscriptions(a);this._getLoadingDialog=bagof(a);return a;},setDialog:function(b,a){this.dialogs[b]=a;this._initDialogSubscriptions(a);if(this.active.endpoint==b&&this.hoverElem==this.active.node)this.showDialog(a);},_initDialogSubscriptions:function(a){a.subscribe('mouseenter',function(){clearTimeout(this.hideTimer);this.hoverElem=this.active.node;}.bind(this));a.subscribe('mouseleave',function(){this.hide(false);this.hoverElem=null;}.bind(this));},contains:function(a){if(this.showingDialog)return DOM.contains(this.showingDialog.getOverlay(),a);return false;},dirty:function(b){var a=this.dialogs[b];if(a){a.destroy();delete this.dialogs[b];}},dirtyAll:function(){for(var b in this.dialogs){var a=this.dialogs[b];a&&this.dirty(b);}}};onloadRegister(Hovercard.init.bind(Hovercard));
__d("StickyController",["event-extensions","css","Vector","FunctionUtils"],function(f,h,i,g,e){h('event-extensions');var a=h('css');var d=h('Vector');var b=h('FunctionUtils');function c(j,k,l,m){this._element=j;this._marginTop=k;this._onchange=l;this._proxy=m||j.parentNode;}c.prototype={handleScroll:function(){var j=d.getElementPosition(this._proxy,'viewport').y<=this._marginTop;if(this.isFixed()!==j){a.setStyle(this._element,'top',j?this._marginTop+'px':'');a.conditionClass(this._element,'fixed_elem',j);this._onchange&&this._onchange(j);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',b.throttle(this.handleScroll.bind(this),100));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return a.hasClass(this._element,'fixed_elem');}};f.StickyController=g.exports=c;},3);
__d("DocumentTitle",["array-extensions","Arbiter"],function(j,l,m,k,i){l('array-extensions');var a=l('Arbiter');var n=document.title;var b=1500;var h=[];var g=0;var e=null;var f=true;function d(){if(h.length>0){if(f){c.set(h[g].title,true);g=++g%h.length;f=false;}else c.reset();}else{clearInterval(e);e=null;c.reset();}}var c={get:function(){return n;},set:function(o,p){document.title=o;if(!p){n=o;a.inform('update_title',o);}},reset:function(){c.set(c.get(),true);f=true;},blink:function(p){var o={title:p};h.push(o);if(e===null)e=setInterval(d,b);return {stop:function(){var q=h.indexOf(o);if(q>=0){h.splice(q,1);if(g>q){g--;}else if(g==q&&g==h.length)g=0;}}};}};j.DocumentTitle=k.exports=c;},3);
__d("Poller",["AsyncRequest","Cookie","copyProperties","Env","Util"],function(h,j,k,i,g){var a=j('AsyncRequest');var b=j('Cookie');var f=j('copyProperties');var c=j('Env');var e=j('Util');function d(n,m,l){this._clearOnQuicklingEvent=!l;this._requestCallback=m;this.setTimePeriod(n);}d.MIN_TIME_PERIOD=2000;f(d.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(l){l=l||null;if(l&&(isNaN(l)||l<d.MIN_TIME_PERIOD))return;if(l&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(l,this._clearOnQuicklingEvents);this._timePeriod=l;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var m=new a();var l=true;m.setInitialHandler(function(){return l;});this._cancelRequest=function(){l=false;};m.setFinallyHandler(this.scheduleRequest.bind(this));m.setInitialHandler=bagofholding;m.setFinallyHandler=bagofholding;this._requestCallback(m);if(l)m.send();},_isLoadUser:function(){return c.user==getCookie('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});h.Poller=i.exports=d;},3);
function XHPTemplate(a){this._model=a;}XHPTemplate.prototype={render:function(){if(HTML.isHTML(this._model))this._model=DOM.setContent(document.createDocumentFragment(),this._model)[0];return this._model.cloneNode(true);},build:function(){return new XHPTemplateInstance(this.render());}};copy_properties(XHPTemplate,{getNode:function(b,a){return XHPTemplate.getNodes(b)[a];},getNodes:function(d){var c=DataStore.get(d,'XHPTemplate:nodes');if(!c){c={};var e=DOM.scry(d,'[data-jsid]');e.push(d);var a=e.length;while(a--){var b=e[a];c[b.getAttribute('data-jsid')]=b;b.removeAttribute('data-jsid');}DataStore.set(d,'XHPTemplate:nodes',c);}return c;}});function XHPTemplateInstance(a){this._root=a;this._populateNodes();}XHPTemplateInstance.prototype={_populateNodes:function(){this._nodes={};this._leaves={};var e=this._root.getElementsByTagName('*');for(var a=0,c=e.length;a<c;a++){var d=e[a];var b=d.getAttribute('data-jsid');if(b){d.removeAttribute('data-jsid');this._nodes[b]=d;this._leaves[b]=!d.childNodes.length;}}},getRoot:function(){return this._root;},getNode:function(a){return this._nodes[a];},setNodeProperty:function(c,a,b){this.getNode(c)[a]=b;return this;},setNodeContent:function(b,a){if(!this._leaves[b])throw new Error("Can't setContent on non-leaf node: "+b);DOM.setContent(this.getNode(b),a);return this;}};
__d("legacy:eval-global",["evalGlobal"],function(a,b,c){a.eval_global=b('evalGlobal');},3);
__d("legacy:onkeypress-flip-direction",["event-extensions","css","dom","Input"],function(d,e,f){e('event-extensions');var a=e('css');var b=e('dom');var c=e('Input');Event.listen(document.documentElement,'keyup',function(event){var i=event.getTarget();if(!b.isNodeOfType(i,['input','textarea']))return;if(b.isNodeOfType(i,'input')&&i.type=='password')return;if(i.getAttribute('data-prevent-auto-flip'))return;var l=c.getValue(i);var h=(i.style&&i.style.direction);if(!h){for(var j=0;j<l.length;j++){var g=l.charCodeAt(j);if(g>=48){var k=(g>=1470&&g<=1920);a.setStyle(i,'direction',k?'rtl':'ltr');return;}}}else if(l.length===0)a.setStyle(i,'direction','');});},3);
onloadRegister(function(){Event.listen(document.documentElement,'submit',function(b){var a=b.getTarget().getElementsByTagName('*');for(var c=0;c<a.length;c++)if(a[c].getAttribute('placeholder')&&Input.isEmpty(a[c]))Input.setValue(a[c],'');});});
onloadRegister(function(){Event.listen(document.documentElement,'submit',function(b){var a=b.getTarget().getElementsByTagName('*');for(var c=0;c<a.length;c++)if(a[c].getAttribute('required')&&Input.isEmpty(a[c])){a[c].focus();return false;}},Event.Priority.URGENT);});
__d("LiveTimer",["css","dom","ua"],function(d,f,g,e,c){var a=f("css");var b=f("dom");var h=f("ua");e.exports=d.LiveTimer||{restart:function(i){this.serverTime=i;this.localStartTime=Date.now()/1000;this.updateTimeStamps();},updateTimeStamps:function(){LiveTimer.timestamps=b.scry(document.body,'abbr.livetimestamp');LiveTimer.startLoop(20000);},addTimeStamps:function(i){if(!i||!LiveTimer.timestamps)return;if(b.isNodeOfType(i,'abbr')&&a.hasClass(i,'livetimestamp')){LiveTimer.timestamps.push(i);}else{var k=b.scry(i,'abbr.livetimestamp');for(var j=0;j<k.length;++j)LiveTimer.timestamps.push(k[j]);}LiveTimer.startLoop(0);},startLoop:function(i){this.stop();this.timeout=setTimeout(function(){LiveTimer.loop();},i);},stop:function(){clearTimeout(this.timeout);},updateNode:function(i,j){LiveTimer.updateNode=(h.ie()<7)?function(k,l){k.nextSibling.nodeValue=l;}:function(k,l){k.firstChild.nodeValue=l;};LiveTimer.updateNode(i,j);},loop:function(l){if(l)LiveTimer.updateTimeStamps();var k=Math.floor(Date.now()/1000-LiveTimer.localStartTime);var i=-1;LiveTimer.timestamps&&LiveTimer.timestamps.each(function(o){var n=o.getAttribute('data-utime');var m=LiveTimer.renderRelativeTime(LiveTimer.serverTime+k,n);if(m.text)LiveTimer.updateNode(o,m.text);if(m.next!=-1&&(m.next<i||i==-1))i=m.next;});if(i!=-1){var j=Math.max(20000,i*1000);LiveTimer.timeout=setTimeout(function(){LiveTimer.loop();},j);}},renderRelativeTime:function(k,l){var m={text:"",next:-1};if(k-l>(12*3600)||(new Date(k*1000).getDay()!=new Date(l*1000).getDay()))return m;var n=k-l,j=Math.floor(n/60),i=Math.floor(j/60);if(j<1){m.text="a few seconds ago";m.next=60-n%60;return m;}if(i<1){if(j==1){m.text="about a minute ago";}else m.text=_tx("{number} minutes ago",{number:j});m.next=60-n%60;return m;}if(i!=11)m.next=3600-n%3600;if(i==1){m.text="about an hour ago";return m;}m.text=_tx("{number} hours ago",{number:i});return m;}};});
__d("legacy:live-timer",["LiveTimer"],function(a,b,c){a.LiveTimer=b('LiveTimer');},3);
__d("MessagingEvents",["array-extensions","Arbiter","copyProperties","isEmpty"],function(g,j,k,i,f){j('array-extensions');var a=j('Arbiter');var e=j('copyProperties');var h=j('isEmpty');var d={};var b=new a();function c(l){if(!h(d))return;for(var m in l)b.inform('count/'+m,l[m]);}b.subscribe('mark-as-read',function(l,m){(m.tids||m.chat_ids||[]).forEach(function(o){o=''+o;if(!(o in d)){d[o]=true;var p=function(){b.unsubscribe(q);clearTimeout(n);delete d[o];};var q=b.subscribe('read',function(r,s){if((s.tids||[]).contains(o)||(s.chat_ids||[]).contains(o))p();});var n=p.defer(60000);}});});a.subscribe('presence/message:messaging',function(l,n){var o=e({},n.obj);var event=o.event||'';delete o.type;delete o.event;b.inform(event,o);if('unread_counts' in o){var m=o.unread_counts;c({unread:m.inbox,other_unseen:m.other});}});a.subscribe('presence/message:inbox',function(l,m){var n=e(m.obj);delete n.type;c(n);});g.MessagingEvents=i.exports=b;},3);
var MessagingConst={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'}};
onloadRegister(function(){add_properties('__behaviors',{});if(__behaviors.TinyViewport)return;__behaviors.TinyViewport=true;var c=document.documentElement;var a=DOM.getDocumentScrollElement();var b=debounce(function(){var d=c.clientHeight<400||a.clientWidth<a.scrollWidth;CSS.conditionClass(c,'tinyViewport',d);CSS.conditionClass(c,'canHaveFixedElements',!d);});Event.listen(window,'resize',b);b();});
__d("ContextualLayer",["event-extensions","Class","ContextualThing","css","dom","Layer","Locale","Parent","Rect","Vector","copyProperties","dom-core","getOverlayZIndex"],function(r,t,u,s,o){t("event-extensions");var c=t("Class");var e=t("ContextualThing");var b=t("css");var f=t("dom");var g=t("Layer");var h=t("Locale");var i=t("Parent");var j=t("Rect");var k=t("Vector");var a=f.$N;var n=t("copyProperties");var p=t("dom-core").ge;var q=t("getOverlayZIndex");function d(){return this.parent.construct(this);}c.extend(d,g);n(d,{OPPOSITE:{above:'below',below:'above',left:'right',right:'left'}});var m=function(){var v=p('blueBar');var w=v?v.offsetHeight:0;m=bagof(w);return w;};function l(){return document.body.offsetWidth-(window.ChatSidebar&&ChatSidebar.getVisibleWidth()||0);}n(d.prototype,{_contentWrapper:null,_content:null,_context:null,_preferredPosition:'above',_preferredAlignment:'left',_position:'above',_alignment:'left',_offsetX:0,_offsetY:0,_autoFlip:true,init:function(v){this._content=v;this.parent.init(this._content);this._updateWrapperPosition();return this;},_buildWrapper:function(v){var w=this._generatePositionClass(this._position,this._alignment);this._contentWrapper=a('div',{className:'uiContextualLayer '+w},v);return a('div',{className:'uiContextualLayerPositioner'},this._contentWrapper);},getInsertParent:function(){var v=this._insertParent;if(!v&&this._context)v=i.byClass(this._context,'uiContextualLayerParent');return v||this.parent.getInsertParent();},setContent:function(v){this._content=v;f.setContent(this._contentWrapper,this._content);this._shown&&this.updatePosition();return this;},setContext:function(v){this._context=v;this._contextScrollParent=null;if(this._shown){e.register(this._root,this._context);this.updatePosition();}return this;},setPosition:function(v){this._preferredPosition=v||'above';this._shown&&this.updatePosition();return this;},setAlignment:function(v){this._preferredAlignment=v||'left';this._shown&&this.updatePosition();return this;},setOffsetX:function(v){this._offsetX=v||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(v){this._offsetY=v||0;this._shown&&this.updatePosition();return this;},setAutoFlip:function(v){this._autoFlip=!!v;this._shown&&this.updatePosition();return this;},getContextScrollParent:function(){if(!this._contextScrollParent)this._contextScrollParent=b.getScrollParent(this._context);return this._contextScrollParent;},show:function(){this.parent.show();if(this._shown){e.register(this._root,this._context);this._resizeListener=this._resizeListener||Event.listen(window,'resize',this.updatePosition.bind(this));}return this;},hide:function(){e.remove(this._root);this._resizeListener&&this._resizeListener.remove();this._resizeListener=null;return this.parent.hide();},updatePosition:function(){if(!this._context)return false;if(this._autoFlip){this._adjustPosition();}else this._position=this._preferredPosition;if(!this._position)return false;this._updateWrapperPosition();var x=b.isFixed(this._context)&&!b.isFixed(this.getInsertParent());b.conditionClass(this._root,'uiContextualLayerPositionerFixed',x);var w,zc;if(x){w='viewport';zc=new k(0,0);}else{w='document';var za=this._root.offsetParent;if(!za)return false;zc=k.getElementPosition(za,w);if(za!==f.getDocumentBodyElement())zc=zc.sub(new k(za.scrollLeft,za.scrollTop));}var v=k.getElementPosition(this._context,w);var z=v.x-zc.x;var zd=v.y-zc.y;var zb=this._getOffsetX(this._position,this._alignment);if(this._position=='below')zd+=this._context.offsetHeight;var y=this._position=='above'||this._position=='below';if((this._position=='right'||(y&&this._alignment=='right'))!=h.isRTL())z+=this._context.offsetWidth;if(y&&this._alignment=='center')zb+=(this._context.offsetWidth-this._content.offsetWidth)/2;b.setStyle(this._root,'left',(z+(h.isRTL()?-1:1)*zb)+'px');b.setStyle(this._root,'top',(zd+this._getOffsetY(this._position,this._alignment))+'px');var ze=q(this._context,this.getInsertParent());b.setStyle(this._root,'z-index',ze>200?ze:'');return true;},destroy:function(){this.parent.destroy();this._contentWrapper=null;this._content=null;return this;},_updateWrapperPosition:function(){if(this._position=='above'){b.setStyle(this._contentWrapper,'bottom','0');}else b.setStyle(this._contentWrapper,'bottom','');var v=h.isRTL()?'left':'right';var w=this._position=='above'||this._position=='below';if(this._position=='left'||(w&&this._alignment=='right')){b.setStyle(this._contentWrapper,v,'0');}else b.setStyle(this._contentWrapper,v,'');this._addPositionClass(this._position,this._alignment);},_adjustPosition:function(){this._removePositionClass(this._position,this._alignment);this._position=null;var w=p('globalContainer');var v=(w&&f.contains(w,this._context))||q(this._context)<300;var z=new j(v?m():0,v?l():document.body.offsetWidth,k.getViewportDimensions().y,0);var y=function(zb,za){if(this._canSeeContextEdge(zb)){this._position=zb;if(this._willElementFit(z,zb,za)){this._alignment=za;return true;}}return false;}.bind(this);if(y(this._preferredPosition,this._preferredAlignment))return;if(y(d.OPPOSITE[this._preferredPosition],this._preferredAlignment))return;if(this._preferredPosition=='above'||this._preferredPosition=='below'){var x=this._preferredAlignment=='left'?'right':'left';if(y(this._preferredPosition,x))return;}},_canSeeContextEdge:function(x){var y=this.getContextScrollParent();var za;if(y===window){za=m();}else za=k.getElementPosition(y,'viewport').y;var w=k.getElementPosition(this._context,'viewport').y;if(x!='below'){return w>=za;}else{var z;if(y===window){z=k.getViewportDimensions().y;}else z=za+y.offsetHeight;var v=w+this._context.offsetHeight;return v<=z;}},_willElementFit:function(zb,z,v){var x=k.getElementPosition(this._context,'viewport');var za=x.y+this._getOffsetY(z,v);if(z=='above'){za-=this._content.offsetHeight;}else if(z=='below')za+=this._context.offsetHeight;var w=za+this._content.offsetHeight;var y=x.x+this._getOffsetX(z,v);if(z=='right'){y+=this._context.offsetWidth;}else if(z=='left'){y-=this._content.offsetWidth;}else if(v=='right')y+=this._context.offsetWidth-this._content.offsetWidth;right=y+this._content.offsetWidth;return zb.contains(new j(za,right,w,y));},_getOffsetX:function(w,v){if(w=='left'||w=='right'){if(this._preferredPosition!=w)return -this._offsetX;}else if(this._preferredAlignment!=v)return -this._offsetX;return this._offsetX;},_getOffsetY:function(v){if((v=='above'||v=='below')&&this._preferredPosition!=v)return -this._offsetY;return this._offsetY;},_generatePositionClass:function(w,v){if(w=='above'||w=='below')return w+v;return w;},_removePositionClass:function(w,v){b.removeClass(this._contentWrapper,this._generatePositionClass(w,v));},_addPositionClass:function(w,v){b.addClass(this._contentWrapper,this._generatePositionClass(w,v));}});s.exports=d;});
__d("ContextualLayerHideOnScroll",["event-extensions"],function(c,e,f,d,b){e("event-extensions");function a(g){this.layer=g;g.subscribe('contextchange',this._handleContextChange.bind(this));g.subscribe('show',this.attach.bind(this));g.subscribe('hide',this.detach.bind(this));}a.prototype={attach:function(){if(this._listener)return;var g=this.layer.getContextScrollParent();if(g===window)return;this._listener=Event.listen(g,'scroll',this.layer.hide.bind(this.layer));},detach:function(){this._listener&&this._listener.remove();this._listener=null;},_handleContextChange:function(){this.detach();if(this.layer.isShown())this.attach();}};d.exports=a;});
__d("PopupWindow",["copyProperties","ua","Vector"],function(e,g,h,f,d){var c=g("copyProperties");var i=g("ua");var b=g("Vector");var a={_opts:{allowShrink:true,timeout:100},init:function(j){copy_properties(a._opts,j);setInterval(a._resizeCheck,a._opts.timeout);},_resizeCheck:function(){var n=b.getViewportDimensions(),j=a._getDocumentSize(),l=j.y-n.y,m=j.x-n.x;if(m<0)m=0;if(!a._opts.allowShrink&&l<0)l=0;if(l||m)try{if(window.console&&window.console.firebug)console.log('Resizing will not work in firefox with firebug enabled. '+'See https://bugzilla.mozilla.org/show_bug.cgi?id=691693');window.resizeBy(m,l);if(m)window.moveBy(m/-2,0);}catch(k){}},_getDocumentSize:function(){var j=b.getDocumentDimensions();if(window.Dialog&&Dialog.max_bottom&&Dialog.max_bottom>j.y)j.y=Dialog.max_bottom;return j;},open:function(r,k,s){var o=typeof window.screenX!='undefined'?window.screenX:window.screenLeft,p=typeof window.screenY!='undefined'?window.screenY:window.screenTop,n=typeof window.outerWidth!='undefined'?window.outerWidth:document.body.clientWidth,m=typeof window.outerHeight!='undefined'?window.outerHeight:(document.body.clientHeight-22),l=parseInt(o+((n-s)/2),10),q=parseInt(p+((m-k)/2.5),10),j=('width='+s+',height='+k+',left='+l+',top='+q);return window.open(r,'_blank',j);}};f.exports=a;});
var MusicEvents=new Arbiter();var MusicProviders={SPOTIFY:'open.spotify.com'};var MusicConstants=window.MusicConstants||{DEBUG:false,sameURLs:function(a,b){var c=/\/$/;if(a&&b){a=URI(a);b=URI(b);return a.getDomain()==b.getDomain()&&a.getPath()==b.getPath();}return false;},greaterOrEqualToMinimumVersion:function(a,d){var f=/(?:\d+\.)+/;var b=a.match(f)[0].split('.').slice(0,-1);var e=d.match(f)[0].split('.').slice(0,-1);if(b.length!==e.length)return false;for(var c=0;c<e.length;c++)if(+b[c]<+e[c]){return false;}else if(+b[c]>+e[c])return true;return true;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};
__d("legacy:contextual-layer",["ContextualLayer"],function(a,b,c){a.ContextualLayer=b('ContextualLayer');},3);
var Tooltip=window.Tooltip||(function(){var a=null;var f=null;var b=null;var e=[];onloadRegister(function(){Event.listen(window,'scroll',Tooltip.hide);});function d(){if(!f){b=$N('div',{className:'tooltipContent'});var g=$N('i',{className:'arrow'});var h=$N('div',{className:'uiTooltipX'},[b,g]);f=new ContextualLayer();f.init(h);}}function c(g){return copy_properties({position:g.getAttribute('tooltip-position')||'above',alignH:g.getAttribute('tooltip-alignh')||'left'},DataStore.get(g,'tooltip'));}return {process:function(g,h){if(!DOM.contains(g,h))return;if(g!==a){var k=g.getAttribute('tooltip-uri');if(k){g.removeAttribute('tooltip-uri');new AsyncRequest(k).setHandler(function(l){Tooltip.set(g,l.getPayload());}).setErrorHandler(bagofholding).send();}var j=g.getAttribute('title');if(j){g.setAttribute('title','');var i=c(g);!i.content&&Tooltip.set(g,j);}Tooltip.show(g);}},remove:function(g){DataStore.remove(g,'tooltip');g.removeAttribute('data-hover');g.removeAttribute('tooltip-position');g.removeAttribute('tooltip-alignh');g===a&&Tooltip.hide();},hide:function(){if(a){f.hide();a=null;while(e.length)e.pop().remove();}},set:function(i,h,j,g){var k=c(i);DataStore.set(i,'tooltip',copy_properties(k,{content:h,position:j||k.position,alignH:g||k.alignH}));i.setAttribute('data-hover','tooltip');i===a&&Tooltip.show(i);},show:function(g){d();Tooltip.hide();var l=c(g);if(!l.content)return;var i=0;var j=0;if(l.position==='left'||l.position==='right'){j=(g.offsetHeight-20)/2;}else if(l.alignH!=='center'){var n=g.offsetWidth;if(n<18)i=(n-18)/2*(l.alignH==='right'?-1:1);}f.setContext(g).setOffsetX(i).setOffsetY(j).setPosition(l.position).setAlignment(l.alignH);if(typeof l.content==='string'){CSS.addClass(f,'invisible_elem');var h=$N('span',HTML(htmlize(l.content)));var k=$N('div',{className:'tooltipText'},h);DOM.setContent(b,k);f.show();if(k.offsetWidth<h.offsetWidth){CSS.addClass(k,'tooltipWrap');f.updatePosition();}CSS.removeClass(f,'invisible_elem');}else{DOM.setContent(b,l.content);f.show();}e.push(Event.listen(document.documentElement,'mouseover',function(o){if(!DOM.contains(a,o.getTarget()))Tooltip.hide();}));var m=CSS.getScrollParent(g);if(m!==window)e.push(Event.listen(m,'scroll',Tooltip.hide));e.push(Event.listen(g,'click',Tooltip.hide));a=g;}};})();
var MusicButton=function(d,a,f,b,c,e){this.provider=d;this.buttonElem=a;this.url=f;this.context=b||{};this.mediaType=c;this.setState(this.STATES.OFFLINE);this.tooltip=e||'';MusicEvents.subscribe(MusicConstants.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};copy_properties(MusicButton,{tracksetableTypes:[]});copy_properties(MusicButton.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:4000,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(a){if(a!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||a;}if(a===this.STATES.PLAYING){Tooltip.set(this.buttonElem,this.tooltip);}else Tooltip.set(this.buttonElem,'');var b=this.buttonElem.parentNode;this.state&&CSS.removeClass(b,this.state);this.state=a;CSS.addClass(b,this.state);},isTracksetable:function(a){return MusicButton.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(d,b){clearTimeout(this._showLoadingTimer);if(b&&b.provider&&b.provider!=this.provider)return;switch(d){case MusicConstants.DIAGNOSTIC_EVENT.ONLINE:case MusicConstants.STATUS_CHANGE_EVENT.track:case MusicConstants.STATUS_CHANGE_EVENT.playing:var c=b&&b.track&&b.track.uri;var a=b&&b.context&&b.context.uri;if(b&&b.playing&&(MusicConstants.sameURLs(c,this.url)||MusicConstants.sameURLs(a,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=this.setState.bind(this,this.STATES.PAUSED).defer(this.RECENTLY_ONLINE_TIMEOUT,false);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case MusicConstants.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case MusicConstants.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(a,g){if(g!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}var d=this.isTracksetable()&&Parent.byClass(this.buttonElem,'music_trackset_container');var k=[];if(d){var j=d.getAttribute('data-trackset-title');var f=this.provider;var e=DOM.scry(d,'.music_button');for(var h=0;h<e.length;h++){var c=MusicButtonManager.getButton([e[h].id]);if(c&&c.provider==f&&c.isTracksetable())k.push(c.url);}}var i=function(){return (d&&k.length>1)?Music.playPauseSongList(this.provider,this.url,k,j,this.context):Music.playPauseSong(this.provider,this.url,this.context);}.bind(this);if(!window.Music){this.showLoading(true);Bootloader.loadComponents('Music',i);return;}var b=i();this.showLoading(!b);},showLoading:function(a){this.resetLoadingTimers();this._hideLoadingTimer=this._timeout.bind(this,a).defer(this.HIDE_LOADING_TIMEOUT,false);this._showLoadingTimer=this.setState.bind(this,this.STATES.LOADING).defer(this.SHOW_LOADING_TIMEOUT,false);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(a){window.Music&&Music.reInform([this.provider]);if(!a&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});
__d("legacy:Overlay",["Overlay"],function(a,b,c){a.Overlay=b('Overlay');},3);
var MusicButtonManager=(function(){var g=null;var b={};var a={};function c(event){var j=$E(event).getTarget();var i=Parent.byClass(j,'music_button');i=i||(!event.getModifiers().any&&d(j));if(!i)return;return f(i,event);}function d(k){var j=Parent.byClass(k,'music_button_trigger')&&Parent.byClass(k,'music_button_trigger_group');if(j){var i=DOM.scry(j,'.music_button');if(i.length)return i[0];}return null;}function f(i,event){event&&$E(event).stop();MusicEvents.inform(MusicConstants.MUSIC_BUTTON.ACTIVATE,i);return false;}function h(i){window.Music&&Music.reInform(i);}function e(k,j){for(var i in b)if(b[i].noGC||ge(i)){b[i].handleIncomingEvent(k,j);}else MusicButtonManager.removeButton(i);}return {init:function(i){if(g)return;g=true;MusicButton.tracksetableTypes=i||[];Event.listen(document.body,'click',c);MusicEvents.subscribe([MusicConstants.STATUS_CHANGE_EVENT.playing,MusicConstants.STATUS_CHANGE_EVENT.track,MusicConstants.DIAGNOSTIC_EVENT.OFFLINE,MusicConstants.DIAGNOSTIC_EVENT.ALL_OFFLINE,MusicConstants.DIAGNOSTIC_EVENT.ONLINE],e);},getButton:function(i){return b[i];},addButton:function(m,i,n,j,l,o){g||MusicButtonManager.init();if(!ge(i))return;b[i];b[i]=new MusicButton(m,$(i),n,copy_properties({button_id:i},j),l,o);var k=Parent.byClass($(i),'uiOverlay');if(k){b[i].noGC=true;Overlay.getInstance(k).subscribe('destroy',MusicButtonManager.removeButton.curry(i));}if(m&&!a[m])a[m]=function(){var p=keys(a);p.length&&h(p);a={};}.defer();return b[i];},removeButton:function(i){b[i]&&b[i].resetLoadingTimers();delete b[i];}};})();
function OnVisible(b,c,e,a,d){this.element=b;this.handler=c;this.strict=e;this.buffer=coalesce(a,300);this.options=d||{};this.lastY=Vector2.getScrollPosition().y;this.lastTime=Date.now();this.reset();onleaveRegister(this.remove.bind(this));}copy_properties(OnVisible.prototype,{reset:function(){if(this.scrollListener)return;var a=throttle(function(){var c=Vector2.getElementPosition(this.element);if(!c){this.remove();return;}this.targetY=c.y;var h=Vector2.getScrollPosition().y;var f=Vector2.getViewportDimensions().y;var g=h+f+this.buffer;if(g>this.targetY){var e=!this.strict||(h-this.buffer<(this.targetY+Vector2.getElementDimensions(this.element).y));if(e){this.remove();if(this.options.detect_speed){var b=(h-this.lastY);var d=b/(Date.now()-this.lastTime+1);if((d>f/100)||(g>=Vector2.getDocumentDimensions().y&&b>1000))return true;}this.handler();}}if(this.options.detect_speed){this.lastY=h;this.lastTime=Date.now();}return true;}.bind(this),100);this.scrollListener=Event.listen(window,'scroll',a);this.resizeListener=Event.listen(window,'resize',a);a();},remove:function(){if(this.scrollListener){this.scrollListener.remove();this.resizeListener.remove();this.scrollListener=this.resizeListener=null;}}});
var PhotosConst={VIEWER_PERMALINK:0,VIEWER_SNOWBOX:2,VIEWER_SNOWLIFT:6,BULK_EDITOR:3,FLASH_UPLOADER:4,inCenterStage:function(a){return a==PhotosConst.VIEWER_SNOWLIFT||a==PhotosConst.VIEWER_SNOWBOX;},SIZE_NORMAL:'n'};
var PhotoInlineCaptionEditor=function(a){this.instanceId=a;PhotoInlineCaptionEditor.instances[a]=this;};copy_properties(PhotoInlineCaptionEditor,{instances:{},getInstance:function(a){return this.instances[a];}});PhotoInlineCaptionEditor.prototype={init:function(a){this.element=a;Event.listen(a,'click',this.handleClick.bind(this));var b=DOM.scry(a,'input[name="caption_id"]');if(b.length)b[0].value=this.instanceId;this.inputStr='';var c=DOM.scry(this.element,'textarea.fbPhotoCaptionInput')[0];if(c)this.inputStr=Input.getValue(c);},handleClick:function(event){var a=event.getTarget();if(Parent.byClass(a,'editIcon')||Parent.byClass(a,'noCaption')){this.toggleEditDescription(true);}else if(Parent.byClass(a,'cancelEdit')){Input.setValue(DOM.find(this.element,'textarea.fbPhotoCaptionInput'),this.inputStr);this.toggleEditDescription(false);}},setCaption:function(a){DOM.setContent(DOM.find(this.element,'.fbPhotoCaptionText'),a);this.toggleEditDescription(false);this.inputStr=Input.getValue(DOM.find(this.element,'textarea.fbPhotoCaptionInput'));},getCaption:function(){return DOM.getText(DOM.find(this.element,'.fbPhotoCaptionText'));},toggleEditDescription:function(c){if(!c)DOM.find(this.element,'textarea.fbPhotoCaptionInput').blur();CSS.conditionClass(this.element,'fbPhotoInlineCaptionEditorEditMode',!!c);if(c){var b=DOM.find(this.element,'textarea.fbPhotoCaptionInput');var a=DOMControl.getInstance(b);a&&a.update();b.focus();}else{CSS.conditionClass(DOM.find(this.element,'.noCaption'),'hidden_elem',this.getCaption().length);CSS.conditionClass(DOM.find(this.element,'.withCaption'),'hidden_elem',!this.getCaption().length);}}};
var TypeaheadUtil=(function(){var b=/[ ]+/g;var c=/[^ ]+/g;var a=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb]/g;var d={};var r={a:"\u0430 \u00e0 \u00e1 \u00e2 \u00e3 \u00e4 \u00e5",b:"\u0431",c:"\u0446 \u00e7 \u010d",d:"\u0434 \u00f0 \u010f \u0111",e:"\u044d \u0435 \u00e8 \u00e9 \u00ea \u00eb \u011b",f:"\u0444",g:"\u0433 \u011f",h:"\u0445 \u0127",i:"\u0438 \u00ec \u00ed \u00ee \u00ef \u0131",j:"\u0439",k:"\u043a \u0138",l:"\u043b \u013e \u013a \u0140 \u0142",m:"\u043c",n:"\u043d \u00f1 \u0148 \u0149 \u014b",o:"\u043e \u00f8 \u00f6 \u00f5 \u00f4 \u00f3 \u00f2",p:"\u043f",r:"\u0440 \u0159 \u0155",s:"\u0441 \u015f \u0161 \u017f",t:"\u0442 \u0165 \u0167 \u00fe",u:"\u0443 \u044e \u00fc \u00fb \u00fa \u00f9 \u016f",v:"\u0432",y:"\u044b \u00ff \u00fd",z:"\u0437 \u017e",ae:"\u00e6",oe:"\u0153",ts:"\u0446",ch:"\u0447",ij:"\u0133",sh:"\u0448",ss:"\u00df",ya:"\u044f"};for(var m in r){var f=r[m].split(' ');for(var h=0;h<f.length;h++)d[f[h]]=m;}var p={};function e(s){return s?s.replace(a,' '):'';}function g(v){v=(''+v).toLowerCase();var u='';var s='';for(var t=v.length;t--;){s=v.charAt(t);u=(d[s]||s)+u;}return u.replace(b,' ');}function q(t){var u=[];var s=c.exec(t);while(s){s=s[0];u.push(s);s=c.exec(t);}return u;}function o(v,u){v=''+v;if(!p.hasOwnProperty(v)){var t=g(v);var s=e(t);p[v]={value:v,flatValue:t,tokens:q(s),isPrefixQuery:s&&s[s.length-1]!=' '};}if(u&&typeof p[v].sortedTokens=='undefined'){p[v].sortedTokens=copy_properties([],p[v].tokens);p[v].sortedTokens.sort(function(w,x){return x.length-w.length;});}return p[v];}function j(t,z,v){var y=o(z,t=='prefix');var za=t=='prefix'?y.sortedTokens:y.tokens;var w=o(v).tokens;var u={};var x=y.isPrefixQuery&&t=='query'?za.length-1:null;var s=function(zd,zc){for(var zb=0;zb<w.length;++zb){var ze=w[zb];if(!u[zb]&&(ze==zd||((t=='query'&&zc===x||t=='prefix')&&ze.indexOf(zd)===0)))return (u[zb]=true);}return false;};return za.length&&za.every(s);}var i=j.curry('exact');var l=j.curry('query');var k=j.curry('prefix');var n={parse:o,isExactMatch:i,isQueryMatch:l,isPrefixMatch:k};return n;})();
function DataSource(a){this._maxResults=a.maxResults||10;this.token=a.token;this.queryData=a.queryData||{};this.queryEndpoint=a.queryEndpoint||'';this.bootstrapData=a.bootstrapData||{};this.bootstrapEndpoint=a.bootstrapEndpoint||'';this._exclusions=a.exclusions||[];this._indexedFields=a.indexedFields||['text','tokens'];this._alwaysPrefixMatch=a.alwaysPrefixMatch||false;this._deduplicationKey=a.deduplicationKey||null;this._minExactMatchLength=4;}Class.mixin(DataSource,'Arbiter',{events:['activity','bootstrap','query','respond'],init:function(){this.init=bagofholding;this._fields=Object.from(this._indexedFields);this._activeQueries=0;this.dirty();},dirty:function(){this.value='';this._bootstrapped=false;this._bootstrapping=false;this._data={};this.localCache={};this.queryCache={};this.inform('dirty',{});},bootstrap:function(){if(this._bootstrapped)return;this.bootstrapWithoutToken();this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},bootstrapWithoutToken:function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:true,token:this.token});},bootstrapWithToken:function(){var a=copy_properties({},this.bootstrapData);a.token=this.token;this.fetch(this.bootstrapEndpoint,a,{bootstrap:true,replaceCache:true});},query:function(f,c,a){this.inform('beforeQuery',{value:f});var e=this.buildUids(f,[],a);var d=this.respond(f,e);this.value=f;this.inform('query',{value:f,results:d});var b=TypeaheadUtil.parse(f).flatValue;if(c||!b||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(b)||!this.shouldFetchMoreResults(d))return false;this.inform('queryEndpoint',{value:f});this.fetch(this.queryEndpoint,this.getQueryData(f,e),{value:f,exclusions:a});return true;},shouldFetchMoreResults:function(a){return a.length<this._maxResults;},getQueryData:function(c,b){var a=copy_properties({value:c},this.queryData||{});b=b||[];if(b.length)a.existing_ids=b.join(',');if(this._bootstrapping)a.bsp=true;return a;},setQueryData:function(a,b){if(b)this.queryData={};copy_properties(this.queryData,a);return this;},setBootstrapData:function(a,b){if(b)this.bootstrapData={};copy_properties(this.bootstrapData,a);return this;},getExclusions:function(){return $A(this._exclusions);},setExclusions:function(a){this._exclusions=a||[];},setFilter:function(a){this.filter=a;},respond:function(d,c,a){var b=this.buildData(c);this.inform('respond',{value:d,results:b,isAsync:!!a});return b;},asyncErrorHandler:bagofholding,fetch:function(c,b,d){if(!c)return;var a=new AsyncRequest().setURI(c).setData(b).setMethod('GET').setReadOnly(true).setHandler(function(e){this.fetchHandler(e,d||{});}.bind(this));if(c===this.queryEndpoint)a.setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));a.setErrorHandler(this.asyncErrorHandler);this.inform('beforeFetch',{request:a,fetch_context:d});a.send();if(c===this.queryEndpoint){if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;}},fetchHandler:function(d,b){var e=b.value;var a=b.exclusions;if(!e&&b.replaceCache)this.localCache={};this.addEntries(d.getPayload().entries,e);this.inform('fetchComplete',{response:d,value:e,fetch_context:b});var c=(!e&&this.value)?this.value:e;this.respond(c,this.buildUids(c,[],a),true);if(!e){if(this._bootstrapping){this._bootstrapping=false;this.inform('bootstrap',{bootstrapping:false});}if(b.token&&d.getPayload().token!==b.token)this.bootstrapWithToken();}},addEntries:function(b,e){var c=this.processEntries($A(b||[]),e);var a=this.buildUids(e,c);if(e){var d=this.getQueryCache();d[TypeaheadUtil.parse(e).flatValue]=a;}else this.fillCache(a);},processEntries:function(a,b){return a.map(function(e,d){var f=(e.uid=e.uid+'');var c=this.getEntry(f);if(!c){c=e;c.query=b;this.setEntry(f,c);}else copy_properties(c,e);c.index===undefined&&(c.index=d);return f;},this);},getAllEntries:function(){return this._data||{};},getEntry:function(a){return this._data[a]||null;},setEntry:function(b,a){this._data[b]=a;},fillCache:function(b){var a=this.localCache;b.each(function(g){var d=this.getEntry(g);if(!d)return;d.bootstrapped=true;var f=TypeaheadUtil.parse(this.getTextToIndex(d)).tokens;for(var c=0,e=f.length;c<e;++c){var h=f[c];if(!a.hasOwnProperty(h))a[h]={};a[h][g]=true;}},this);},getTextToIndex:function(c){if(c.textToIndex)return c.textToIndex;var d=[];for(var b in this._fields){var a=c[b];if(a)d.push(a.join?a.join(' '):a);}return (c.textToIndex=d.join(' '));},mergeUids:function(a,c,b,e){var d=function(f,g){var h=this.getEntry(f);var i=this.getEntry(g);if(h.extended_match!==i.extended_match)return h.extended_match?1:-1;if(h.index!==i.index)return h.index-i.index;if(h.text.length!==i.text.length)return h.text.length-i.text.length;return h.uid<i.uid;}.bind(this);this._checkExtendedMatch(e,a);return this._deduplicateByKey(a.sort(d).concat(c,b));},_checkExtendedMatch:function(e,d){var b=this._alwaysPrefixMatch?TypeaheadUtil.isPrefixMatch:TypeaheadUtil.isQueryMatch;for(var a=0;a<d.length;++a){var c=this.getEntry(d[a]);c.extended_match=c.tokens?!b(e,c.text):false;}},buildUids:function(h,d,a){if(!d)d=[];if(!h)return d;if(!a)a=[];var b=this.buildCacheResults(h,this.localCache);var f=this.buildQueryResults(h);var e=this.mergeUids(b,f,d,h);var g=Object.from(a.concat(this._exclusions));var c=e.filter(function(i){if(g.hasOwnProperty(i)||!this.getEntry(i))return false;if(this.filter&&!this.filter(this.getEntry(i)))return false;return (g[i]=true);},this);return this.uidsIncludingExact(h,c,g);},uidsIncludingExact:function(g,d,f){var e=d.length;if(g.length<this._minExactMatchLength||e<=this._maxResults)return d;for(var c=0;c<e;++c){var a=this.getEntry(d[c]);a.text_lower||(a.text_lower=a.text.toLowerCase());if(a.text_lower===TypeaheadUtil.parse(g).flatValue){if(c>=this._maxResults){var b=d.splice(c,1);d.splice(this._maxResults-1,0,b);}break;}}return d;},buildData:function(d){var c=[];var b=Math.min(d.length,this._maxResults);for(var a=0;a<b;++a)c.push(this.getEntry(d[a]));return c;},findQueryCache:function(e){var b=0;var a=null;var d=this.getQueryCache();for(var c in d)if(e.indexOf(c)==0&&c.length>b){b=c.length;a=c;}return d[a]||[];},buildQueryResults:function(c){var a=TypeaheadUtil.parse(c).flatValue;var b=this.findQueryCache(a);if(this.getQueryCache().hasOwnProperty(a))return b;return this.filterQueryResults(c,b);},filterQueryResults:function(c,b){var a=this._alwaysPrefixMatch?TypeaheadUtil.isPrefixMatch:TypeaheadUtil.isQueryMatch;return b.filter(function(d){return a(c,this.getTextToIndex(this.getEntry(d)));},this);},buildCacheResults:function(r,a){var k=TypeaheadUtil.parse(r,this._alwaysPrefixMatch);var l=this._alwaysPrefixMatch?k.sortedTokens:k.tokens;var h=l.length;var i=k.isPrefixQuery?h-1:null;var e={};var j={};var o={};var f=[];var c=false;var q={};var p=0;for(var d=0;d<h;++d){var m=l[d];if(!q.hasOwnProperty(m)){p++;q[m]=true;}else continue;for(var g in a)if((!e.hasOwnProperty(g)&&g===m)||((this._alwaysPrefixMatch||i===d)&&g.indexOf(m)===0)){if(g===m){if(j.hasOwnProperty(g))c=true;e[g]=true;}else{if(e.hasOwnProperty(g)||j.hasOwnProperty(g))c=true;j[g]=true;}for(var n in a[g])if(d===0||(o.hasOwnProperty(n)&&o[n]==p-1))o[n]=p;}}for(var b in o)if(o[b]==p)f.push(b);if(c||p<h)f=this.filterQueryResults(r,f);return f;},_deduplicateByKey:function(b){if(!this._deduplicationKey)return b;var a=Object.from(b.map(this._getDeduplicationKey.bind(this)),b);return b.filter(function(c){return a[this._getDeduplicationKey(c)]==c;}.bind(this));},_getDeduplicationKey:function(b){var a=this.getEntry(b);return a[this._deduplicationKey]||'__'+b+'__';},getQueryCache:function(){return this.queryCache;},setMaxResults:function(a){this._maxResults=a;this.value&&this.respond(this.value,this.buildUids(this.value));},updateToken:function(a){this.token=a;this.dirty();return this;}});
function PhotosTaggingWaterfall(a){PhotosTaggingWaterfall._queueName=a||PhotosTaggingWaterfall._queueName;}copy_properties(PhotosTaggingWaterfall,{BEGIN:"begin",TAG_FACE:"tag_face",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(b,a){new AsyncSignal('/ajax/photos/tag_waterfall.php',{data:JSON.stringify(b)}).setHandler(a).send();}});
function photos_viewer_version(){if(CSS.hasClass(document.documentElement,'theaterMode')){return PhotosConst.VIEWER_SNOWBOX;}else return PhotosConst.VIEWER_PERMALINK;}
function Typeahead(b,d,a,c){this.args={data:b,view:d,core:a};DataStore.set(c,'Typeahead',this);this.element=c;}Typeahead.getInstance=function(a){var b=Parent.byClass(a,'uiTypeahead');return b?DataStore.get(b,'Typeahead'):null;};Class.mixin(Typeahead,'Arbiter',{init:function(a){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(a||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var a=this.args.data;this.data=a;this.data.init();}return this.data;},getView:function(){if(!this.view){var a=this.args.view;var b=ge(a.node_id);if(!b){b=$N('div',{className:'uiTypeaheadView'});DOM.appendContent(this.element,b);}this.view=new window[a.ctor](b,a.options||{});this.view.init();}return this.view;},getCore:function(){if(!this.core){var a=this.args.core;this.core=new window[a.ctor](a.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(b){var a=this.core;this.data=this.args.data=b;b.init();if(a){a.data=b;a.initData();a.reset();}b.bootstrap();return b;},proxyEvents:function(){[this.data,this.view,this.core].each(function(a){a.subscribe(a.events,this.inform.bind(this));},this);},initBehaviors:function(a){if(window.TypeaheadBehaviors)a.each(function(b){(TypeaheadBehaviors[b]||bagofholding)(this);},this);}});
function PhotoTagger(a){this.version=a;PhotoTagger.instances[a]=this;}PhotoTagger.instances={};PhotoTagger.ACTIVATE_TAGGING='PhotoTagger.ACTIVATE_TAGGING';PhotoTagger.getInstance=function(a){return PhotoTagger.instances[a];};copy_properties(PhotoTagger.prototype,{TAG_BOX_SIZE:100,datasources:{},photoData:{},elemNames:{2:{tagger:'div.snowboxTagger',addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons',tagAction:'fbPhotosPhotoActionsTag',image:'div.stage img.spotlight'},6:{tagger:'div.snowliftTagger',addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons',tagAction:'fbPhotosPhotoActionsTag',image:'div.stage img.spotlight'}},userActionData:{action:'tagging',namespace:'snowbox'},init:function(a,b){this.setupUserActionLogging();this.root=a;this.tokenizer=b;this._qn=null;this.typeahead=b.getTypeahead();this.clickState=DOM.find(this.root,'div.stageActions');this.tagger=DOM.find(this.clickState,this.elemNames[this.version].tagger);this.faceBox=DOM.find(this.tagger,'div.faceBox');this.newTagBox=DOM.find(this.clickState,'div.newTagBox');this.addTagLink=DOM.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=DOM.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());return this;},setupUserActionLogging:function(){this.ua=user_action(this.userActionData.action).set_namespace(this.userActionData.namespace).set_ua_id('tagging').add_event('init');},logUserActionEvent:function(a){this.ua.add_event(a);},fetchTaggingSuggestions:function(b){this.logUserActionEvent('sugg_fetch');new AsyncRequest().setURI('/ajax/photos/photo/tags/tags_init.php').setData(b).setOption('retries',1).setHandler(function(c){this.typeahead.getView().setSuggestions(c.getPayload().taggees);this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();var a=this.typeahead.subscribe('bootstrap',function(c,d){if(d&&!d.bootstrapping){this.updateWithSuggestions();this.typeahead.unsubscribe(a);this.typeahead.subscribe('focus',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',function(e,f){if(f&&!f.results.length)this.updateWithSuggestions();}.bind(this));}}.bind(this));},setupHandlers:function(){this.handlers=[Event.listen(this.clickState,'click',this.addTag.bind(this)),Event.listen(window,'resize',this.hideTagger.bind(this)),Event.listen(this.addTagLink,'click',this.checkActions.bind(this)),Event.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[Arbiter.subscribe(this.getPhotoViewerObj().PAGE,this.restartTagging.bind(this)),Arbiter.subscribe(this.getPhotoViewerObj().DATA_CHANGE,this.setPhotoData.bind(this)),Arbiter.subscribe(this.getPhotoViewerObj().CLOSE,this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));},getTaggingSource:function(){switch(this.version){case PhotosConst.VIEWER_SNOWBOX:return 'snowbox';case PhotosConst.VIEWER_SNOWLIFT:return 'snowlift';default:return null;}},updateWithSuggestions:function(a,c){var e=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!e.length)return;var d=this.typeahead.getData().respond('',e);for(var b=0;b<d.length;b++)d[b].index=-1000+b;},addSuggestion:function(a,b){var c=b.info&&b.info.uid;if(c)this.typeahead.getView().addSuggestion(c);},setQueueName:function(a){this._qn=a;return this;},_sendWaterfallLogSignal:function(a){PhotosTaggingWaterfall.sendSignal({qn:this._qn,source:this.getTaggingSource(),step:a,pid:this.photoData.pid});},_bumpQueueName:function(){if(this._qn)this._qn+=1;},activateTagging:function(){this.logUserActionEvent('activate');Arbiter.inform(PhotoTagger.ACTIVATE_TAGGING);if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new AsyncRequest('/ajax/photos/photo/tags/fetch_datasource.php').setData({fbid:this.photoData.fbid,version:this.version}).send();},restartTagging:function(){this.hideNewTag();this.hideTagger();if(this.taggingMode===true)this.activateTagging();},getDataSource:function(){return this.datasources[this.getDataSourceKey()];},getDataSourceKey:function(){if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;},setDataSource:function(a){if(this.typeahead.getData()!=a)this.typeahead.swapData(a);this.datasources[this.getDataSourceKey()]=a;},dataSourceFetched:function(a){this.taggingMode=true;CSS.addClass(this.root,'taggingMode');this._bumpQueueName();this._sendWaterfallLogSignal(PhotosTaggingWaterfall.BEGIN);this.setDataSource(a);},deactivateTagging:function(){this.logUserActionEvent('deactivate');if(this.taggingMode===true)this._sendWaterfallLogSignal(PhotosTaggingWaterfall.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();CSS.removeClass(this.root,'taggingMode');},checkActions:function(event){var a=event.getTarget();if(Parent.byClass(a,this.elemNames[this.version].tagAction))this.taggingMode?this.deactivateTagging():this.activateTagging();},hideTagger:function(){CSS.hide(this.tagger);},showTagger:function(){CSS.show(this.tagger);var a=DOM.find(this.tagger,'input.textInput');Input.reset(a);a.focus();this.updateWithSuggestions();this.hideNewTag();},showNewTag:function(a){if(!this.newTagBox)return;DOM.setContent(DOM.find(this.newTagBox,'div.tagName'),$N('span',null,a));CSS.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);},hideNewTag:function(){if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}CSS.hide(this.newTagBox);},getTaggerPositioningOrigin:function(){return Vector2.getElementPosition(this.clickState,'document');},addTag:function(event){var e=event.getTarget();var a=Parent.byClass(e,'fbPhotosPhotoButtons');if(!this.taggingMode||(a&&e!==a)||Parent.byClass(e,'photoTagTypeahead'))return;var c=this.getPhotoOnStage();var b=Vector2.getEventPosition(event);var d=this.calcTaggerPosition(c,b);this.calcClickPoint(c,b);if(!d){this.hideTagger();return;}d.setElementPosition(this.tagger);if(this.newTagBox)d.setElementPosition(this.newTagBox);this.showTagger();this._sendWaterfallLogSignal(PhotosTaggingWaterfall.TAG_FACE);},getPhotoOnStage:function(){return DOM.find(this.root,this.elemNames[this.version].image);},calcTaggerPosition:function(h,b){var e=Vector2.getElementPosition(h);var d=Vector2.getElementDimensions(h);var a=new Vector2(this.TAG_BOX_SIZE/2,this.TAG_BOX_SIZE/2);var g=b.sub(e);for(var c in g){if(b[c]<e[c]||b[c]>e[c]+d[c])return null;if(g[c]<(this.TAG_BOX_SIZE/2)){a[c]=g[c];}else if(d[c]<g[c]+(this.TAG_BOX_SIZE/2))a[c]=this.TAG_BOX_SIZE-(d[c]-g[c]);}var f=b.sub(this.getTaggerPositioningOrigin());return f.sub(a.x,a.y);},calcClickPoint:function(d,b){var c=Vector2.getElementDimensions(d);var a=Vector2.getElementPosition(d);var e=b.sub(a);this.clickPoint={x:e.x/c.x,y:e.y/c.y};},saveTag:function(a,c){var b=this.getTaggingData('add',c.isFreeform()?'':c.getValue(),c.getText());b.x=this.clickPoint.x*100;b.y=this.clickPoint.y*100;this.logUserActionEvent('save');new AsyncRequest().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(b).setAllowCrossPageTransition(true).setHandler(function(d){this.tagsChangeHandler(d);this.logUserActionEvent('save_done');}.bind(this)).setErrorHandler(this.checkError.bind(this,c)).send();this.showNewTag(c.getText());this.hideTagger();},getTaggingData:function(a,c,b){return {cs_ver:this.version,pid:this.photoData.pid,id:this.photoData.owner,subject:c,name:b,action:a,source:this.getTaggingSource(),qn:this._qn,position:this.getPosition()};},getPosition:function(){var a=this.getPhotoViewerObj();return a&&a.position;},getPhotoViewerObj:function(){switch(this.version){case PhotosConst.VIEWER_SNOWBOX:return window.PhotoSnowbox;case PhotosConst.VIEWER_SNOWLIFT:return window.PhotoSnowlift;default:return null;}},tagsChangeHandler:function(b){var a=this.getPhotoViewerObj();if(a&&a.isOpen)a.saveTagComplete(b);},checkError:function(b,a){if(a.getPayload()&&a.getPayload().clear_tag){b.already_untagged=true;this.tokenizer.removeToken(b);}ErrorDialog.showAsyncError(a);},removeTag:function(a,c){if(c.already_untagged)return;var b='remove';if(DOM.scry(c.element,'a.pending')[0])b='retract';if(c.blockUser)b='remove_block';this.logUserActionEvent('save');new AsyncRequest().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData(b,c.isFreeform()?'':c.getInfo().uid,c.getInfo().text)).setHandler(function(d){this.tagsChangeHandler(d);this.logUserActionEvent('save_done');}.bind(this)).setAllowCrossPageTransition(true).send();},removeTagByID:function(b,c){var d=this.tokenizer.tokens;for(var a=0;a<d.length;a++)if(d[a].info.uid==c)return this.removeTag(null,d[a]);},setPhotoData:function(a,b){this.photoData=b;return this;},markTagAsSpam:function(a,b){new AsyncRequest().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData('mark_as_spam',b,null)).send();}});
function PhotoInlineEditor(a){this.version=a;PhotoInlineEditor.instances[a]=this;}PhotoInlineEditor.CANCEL_INLINE_EDITING='CANCEL_INLINE_EDITING';PhotoInlineEditor.instances={};PhotoInlineEditor.getInstance=function(a){return PhotoInlineEditor.instances[a];};copy_properties(PhotoInlineEditor.prototype,{toggleEditMode:function(a,c){var b=Parent.byClass($(a),'photoUfiContainer');if(!b)return;CSS.conditionClass(b,'inlineEditMode',c);if(this.version==PhotosConst.VIEWER_SNOWLIFT){var d=this.getViewerObject();CSS.conditionClass($('fbPhotoSnowlift'),'fbPhotoSnowliftEditMode',c);d&&d.adjustScroller();}},activate:function(a){this.toggleEditMode(a,true);},deactivate:function(a){this.toggleEditMode(a,false);if(this.arbiterToken)Arbiter.unsubscribe(this.arbiterToken);},cancel:function(a){this.deactivate(a);Arbiter.inform(PhotoInlineEditor.CANCEL_INLINE_EDITING);},attachForm:function(a){this._form=a;return this;},getForm:function(){return this._form;},getViewerObject:function(){switch(this.version){case PhotosConst.VIEWER_PERMALINK:return window.PhotoPermalink;case PhotosConst.VIEWER_SNOWBOX:return window.PhotoSnowbox;case PhotosConst.VIEWER_SNOWLIFT:return window.PhotoSnowlift;}return null;},subscribeCancel:function(a){var c=this.getViewerObject();if(!c){this.arbiterToken=null;return;}var b=[c.PAGE,PhotoTagger.ACTIVATE_TAGGING];if(PhotosConst.inCenterStage(this.version))b.push(c.CLOSE);this.arbiterToken=Arbiter.subscribe(b,this.cancel.bind(this,a),Arbiter.SUBSCRIBE_NEW);}});
function PhotoSessionLog(){}copy_properties(PhotoSessionLog,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWBOX:2,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,pagingAction:'',initLogging:function(b){this.set=null;this.time=new Date();this.views=0;this.first=true;this.last=false;this.logIds=false;this.version=b;this.pagingAction='';if(b===PhotoSessionLog.SNOWBOX||b===PhotoSessionLog.SNOWLIFT){var a=Vector2.getViewportDimensions();this.width=a.x;this.height=a.y;}},setLogFbids:function(a){this.logIds=a;},setPhotoSet:function(a){this.set=a;},setPagingAction:function(a){this.pagingAction=a;},addPhotoView:function(a){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(a)this.fbidList.push([a.fbid,a.owner,Date.now()]);},addDetailData:function(b,a){if(!this.details[b])this.details[b]={t:a.num_tags,l:a.has_location,c:a.has_caption,cm:a.comment_count,lk:a.like_count,w:a.width,h:a.height,ad:'{}',p:this.pagingAction};},updateAdData:function(b,a){if(this.details[b])this.details[b].ad=JSON.stringify(a);},logPhotoViews:function(a){if((!this.views)||((this.version===PhotoSessionLog.SNOWBOX||this.version===PhotoSessionLog.SNOWLIFT)&&(a==PhotoSessionLog.LEAVE)))return;if(a!=this.AGGREGATE)this.last=true;var b={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:a?a:this.UNKNOWN,version:this.version};if(this.version===PhotoSessionLog.SNOWBOX||this.version===PhotoSessionLog.SNOWLIFT){var c=Vector2.getViewportDimensions();b.width=c.x||this.width;b.height=c.y||this.height;}new AsyncRequest().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(a!=PhotoSessionLog.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(b).send();this.views=0;this.fbidList=[];this.details={};this.first=false;if(this.last){this.set=null;this.logIds=false;}}});onunloadRegister(function(){PhotoSessionLog.logPhotoViews(PhotoSessionLog.UNLOAD);});onleaveRegister(function(){PhotoSessionLog.logPhotoViews(PhotoSessionLog.LEAVE);});
__d("UIPagelet",["json","dom","AjaxPipeRequest","AsyncRequest","copyProperties"],function(g,i,j,h,f){i('json');var c=i('dom');var a=i('AjaxPipeRequest');var b=i('AsyncRequest');var e=i('copyProperties');function d(m,n,k,l){this._id=m||null;this._element=ge(m||c.$N('div'));this._src=n||null;this._context_data=k||{};this._data=l||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}d.loadFromEndpoint=function(m,q,k,n){n=n||{};var l='/ajax/pagelet/generic.php/';if(n.intern)l='/intern'+l;var p=(l+m).replace(/\/+/g,'/');if(n.subdomain)p=URI(p).setSubdomain(n.subdomain);var o=new d(q,p,k).setUseAjaxPipe(n.usePipe).setBundleOption(m.substring(0,8)!='/intern/'&&n.bundle!==false).setAppend(n.append).setJSNonBlock(n.jsNonblock).setDisplayCallback(n.displayCallback).setConstHeight(n.constHeight).setAllowCrossPageTransition(n.crossPage);n.handler&&o.setHandler(n.handler);o.go();return o;};e(d.prototype,{getElement:function(k){k=k||false;if(k)this._element=ge(this._id);return this._element;},setHandler:function(k){this._handler=k;return this;},go:function(l,k){if(arguments.length>=2||typeof l=='string'){this._src=l;this._data=k||{};}else if(arguments.length==1)this._data=l;this.refresh();return this;},setAllowCrossPageTransition:function(k){this._allow_cross_page_transition=k;return this;},setBundleOption:function(k){this._is_bundle=k;return this;},refresh:function(m){var l=function(o){this._request=null;if(m&&this._id)this._element=ge(this._id);var n=HTML(o.getPayload());if(this._append){c.appendContent(this._element,n);}else c.setContent(this._element,n);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new a();this._request.setCanvasId(this._id).setAppend(this._append).setConstHeight(this._constHeight).setJSNonBlock(this._jsNonblock).setDisplayCallback(this._displayCallback);}else{var k=this._displayCallback;this._request=new b().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(function(n){if(k){k(l.curry(n));}else l(n);});}this._request.setURI(this._src).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(merge(this._context_data,this._data))}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(k){this._use_ajaxpipe=!!k;return this;},setAppend:function(k){this._append=!!k;return this;},setJSNonBlock:function(k){this._jsNonblock=!!k;return this;},setDisplayCallback:function(k){this._displayCallback=k;return this;},setConstHeight:function(k){this._constHeight=!!k;return this;}});g.UIPagelet=h.exports=d;},3);
function PhotoStreamCache(){}copy_properties(PhotoStreamCache,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1});copy_properties(PhotoStreamCache.prototype,{init:function(a){this.version=a;this.bufferSize=PhotoStreamCache.BUFFER_SIZE;this.fullBucketSize=PhotoStreamCache.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.leftLock=false;this.rightLock=false;this.reset();},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(this.totalCount!==null)return this.totalCount>1;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getImageData:function(a){return this.getCacheContent(a,PhotoStreamCache.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),PhotoStreamCache.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),PhotoStreamCache.EXTRA);},getCacheContent:function(a,b){if(!a||a===PhotoStreamCache.ERROR_ID)return null;return this.cache[b][a];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(a){return this.permalinkMap[a];},calculatePositionForMovement:function(a){var b=this.position+a;if(this.allLoaded){var c=this.getLength();b=(c+b%c)%c;}return b;},isValidMovement:function(a){if(!this.isLoaded()||!this.canPage())return false;var b=this.calculatePositionForMovement(a);return this.getCursor()>0||(b>=0&&b<this.getLength());},moveCursor:function(a){if(!this.isValidMovement(a))return;this.position=this.calculatePositionForMovement(a);if(a!==0)this.loadMoreIfNeccessary(a>0);},checkErrorAt:function(a){if(!this.isLoaded())return false;if(a===PhotoStreamCache.ERROR_ID)return true;return false;},getRelativeMovement:function(a){for(var b=0;b<this.getLength();b++)if(this.fbidList[b]==a)return b-this.position;return null;},preloadImages:function(){var e,c;var f=this.getLength();var b=this.cache.image;var a=PhotoStreamCache.BUFFER_SIZE;if(f>a*2){e=(this.position+f-a%f)%f;c=(this.position+a)%f;}else{e=0;c=f-1;}while(e!=c){var d=this.fbidList[e];if(b[d]&&!b[d].resource&&b[d].url){b[d].resource=new Image();b[d].resource.src=b[d].url;}e=(e+1)%f;}},loadMoreIfNeccessary:function(c){if(this.allLoaded||(c&&this.rightLock)||(!c&&this.leftLock))return;var d=c?1:-1;var a=this.fullBucketSize*d;var b=this.position+this.bufferSize*d;if(b<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(b>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(a){return a?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(c,a,d){if(!this.totalCount)return null;var b=this.fbidList.indexOf(a);var e=this.fbidList.indexOf(d);if(b===-1||e===-1)return null;var f=e-b;return (c+f+this.totalCount)%this.totalCount;},fetch:function(a,d){var c=this.getEndCursor(d);var b=copy_properties({cursor:c,version:this.version,end:this.getEndCursor(!d),fetchSize:d?a:-1*a},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){b.total=this.totalCount;b.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,c);}UIPagelet.loadFromEndpoint('PhotoViewerPagelet',null,b,{usePipe:true,jsNonblock:true,crossPage:true});},storeToCache:function(a){var b={};if(!this.isActive)return b;if('error' in a){this.processErrorResult(a.error);b.error=true;return b;}if('init' in a){this.processInitResult(a.init);b.init={logids:a.init.logids,fbid:a.init.fbid,loggedin:a.init.loggedin,fromad:a.init.fromad};}if('image' in a){this.processImageResult(a.image);b.image=true;}if('data' in a){this.processDataResult(a.data);b.data=true;}return b;},processInitResult:function(a){if(this.loaded)return;this.loaded=true;this.photoSetQuery=a.query;if(a.bufferSize)this.bufferSize=a.bufferSize;if(a.fullBucketSize)this.fullBucketSize=a.fullBucketSize;this.fbidList.push(a.fbid);this.firstCursor=a.fbid;if('initIndex' in a&&'totalCount' in a){this.firstCursorIndex=a.initIndex;this.totalCount=a.totalCount;}this.rightLock=true;if(this.version==PhotosConst.VIEWER_PERMALINK)this.fetch(PhotoStreamCache.INIT_BUCKET_SIZE,true);},processImageResult:function(b){for(var a in b){this.cache.image[a]=b[a];if(b[a].dimensions)this.cache.image[a].dimensions=Vector2.deserialize(b[a].dimensions);this.permalinkMap[URI(b[a].info.permalink).getUnqualifiedURI().toString()]=a;}},attachToFbidsList:function(d,e,a){if(this.allLoaded)return;if(e===-1){for(var b=d.length-1;b>=0;b--){this.fbidList.unshift(d[b]);this.position++;}this.leftLock=false;}else{for(var c=0;c<d.length;c++)this.fbidList.push(d[c]);this.rightLock=false;}if(a)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(a){for(var b in a){if(!this.cache.html[b])this.cache.html[b]={};for(var d in a[b].html){var c=HTML(a[b].html[d]).getRootNode();this.cache.html[b][d]=$A(c.childNodes);}if(!('extra' in a[b])){this.cache.extra[b]=null;continue;}this.cache.extra[b]={tagRects:{}};if(a[b].extra.tagRects)for(var e in a[b].extra.tagRects)if(a[b].extra.tagRects[e])this.cache.extra[b].tagRects[e]=Rect.deserialize(a[b].extra.tagRects[e]);}},processErrorResult:function(b){if(!this.isLoaded()){this.initError=true;return;}var c=b.side;var a=[PhotoStreamCache.ERROR_ID];this.attachToFbidsList(a,c);},setTotalCount:function(a){this.totalCount=a;},setFirstCursorIndex:function(a){this.firstCursorIndex=a;}});
function PhotosUtils(){}PhotosUtils.getNearestBox=function(e,l,k,j,c,a){var f=e.sub(l);var d=k.magnitude();var g=null;for(var b in a){var h=a[b];var i=new Rect(h.t/100*k.y*j,h.r/100*k.x*j,h.b/100*k.y*j,h.l/100*k.x*j);var m=i.getCenter().sub(f);if(Math.abs(m.x)<=c&&Math.abs(m.y)<=c&&m.magnitude()<=d){d=m.magnitude();g=b;if(0===d)break;}}return g;};
var PhotoSnowbox=window.PhotoSnowbox||{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',CLOSE:'PhotoSnowbox.CLOSE',DATA_CHANGE:'PhotoSnowbox.DATA_CHANGE',GO:'PhotoSnowbox.GO',OPEN:'PhotoSnowbox.OPEN',PAGE:'PhotoSnowbox.PAGE',RESET_HELP:'PhotoSnowbox.RESET_HELP',LOADING_TIMEOUT:2000,STAGE_MAX:{x:960,y:960},STAGE_MIN:{x:720,y:402},STAGE_CHROME:{x:225,y:117},TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,WIDE_ADS:855,MIN_TAG_DISTANCE:83,ADS_REFRESH_RATE:30000,switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,normalSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,ua:null,bootstrap:function(b,a){this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=user_action('snowbox',a,null).set_namespace('snowbox').set_ua_id('open');this.returningToStart=false;this.loading&&CSS.removeClass(this.loading,'loading');if(a){CSS.addClass((this.loading=a),'loading');this.getThumbAndSize(a);}else this.loading=null;Arbiter.inform(PhotoSnowbox.GO,b,Arbiter.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getThumbAndSize:function(b){this.normalSize=null;this.thumbSrc=null;var e=URI(b.getAttribute('ajaxify')).getQueryData();if(!e.size)return;var a=Vector2.deserialize(e.size);if(!a.x||!a.y)return;this.normalSize=a;if(!CSS.hasClass(b,'uiMediaThumb')&&!CSS.hasClass(b,'uiPhotoThumb')&&!CSS.hasClass(b,'uiScaledThumb'))return;var d=DOM.scry(b,'img')[0];var c=DOM.scry(b,'i')[0];var f=Parent.byAttribute(b,'data-size');this.shouldStretch=f&&this.normalSize&&d&&f.getAttribute('data-size')==="2"&&this.normalSize.x>this.normalSize.y&&this.normalSize.x<=PhotoSnowbox.TIMELINE_STRETCH_WIDTH&&d.offsetWidth===PhotoSnowbox.TIMELINE_STRETCH_WIDTH;if(d){thumbSrc=d.src;}else if(c){thumbSrc=CSS.getStyle(c,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=thumbSrc;},loadFrameIfUninitialized:function(){if(this.root)return;new AsyncRequest('/ajax/photos/snowbox/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(a){var b=ge('fbPhotoSnowbox');if(!b){b=DOM.appendContent(DOM.getDocumentBodyElement(),a)[0];this.initialLoad=false;}if(this.root==b)return;this.initializeNodes(b);if(!this.subscription){LinkController.registerHandler(this.handleNavigateAway.bind(this));this.subscription=Arbiter.subscribe(PhotoSnowbox.GO,function(c,d){this.openExplicitly=true;this.loading&&CSS.removeClass(this.loading,'loading');this.open(d);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;Arbiter.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));Arbiter.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));},initializeNodes:function(a){this.root=a;this.closeTheater=DOM.find(a,'a.closeTheater');this.container=DOM.find(a,'div.container');this.infoWrapper=DOM.find(a,'div.photoInfoWrapper');this.stageWrapper=DOM.find(a,'div.stageWrapper');this.errorBox=DOM.find(this.stageWrapper,'div.stageError');this.image=DOM.find(this.stageWrapper,'img.spotlight');this.pivotBar=DOM.find(this.stageWrapper,'div.pivotWrapper');this.stage=DOM.find(this.stageWrapper,'div.stage');this.videoStage=DOM.find(this.stageWrapper,'div.videoStage');this.stagePagers=DOM.find(a,'div.stagePagers');this.stageActions=DOM.find(a,'div.stageActions');this.buttonActions=DOM.find(this.stageActions,'div.fbPhotosPhotoButtons');this.actionList=$('fbPhotoSnowboxActions');this.sideAdUnit=$('fbPhotoSnowboxAdsSide');this.bottomAdUnit=$('fbPhotoSnowboxAdsBottom');this.sideAdDiv=DOM.find(a,'div.fbPhotoSnowboxAdsSide');this.bottomAdDiv=DOM.find(a,'div.fbPhotoSnowboxAdsBottom');},getRoot:function(){return this.root;},openHandler:function(a){if(this.isOpen||a.getPath()!='/photo.php'||this.returningToStart||a.getQueryData().closeTheater||a.getQueryData().permPage||a.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}if(window.PhotoSnowlift&&PhotoSnowlift.isOpen)return false;this.open(a);this._uriStack.push(URI(a).getQualifiedURI().toString());PageTransitions.transitionComplete();return true;},open:function(c){var a=URI(c).getQueryData();var b=a.src;if(b)delete a.src;if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){a.firstLoad=true;this.initialLoad=true;}this.loadQuery=a;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.lastAdsLoad=0;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.stream=new PhotoStreamCache();this.stream.init(PhotosConst.VIEWER_SNOWBOX);this.fetchInitialData();this.setLoadingState(PhotoSnowbox.STATE_HTML,true);KeyEventController.registerKey('ESCAPE',this.closeListener.bind(this));Bootloader.loadComponents(['fb-photos-photo-css','fb-photos-snowbox-css'],function(){this._open(c,b);}.bind(this));},_open:function(d,c){this.createLoader(c);CSS.show(this.root);(function(){var e=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.addClass(document.documentElement,'theaterMode');var f=DOMScroll.getScrollbarSize();if(f===0){this.extraClass='zeroScrollbar';}else if(f===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';CSS.addClass(document.body,this.extraClass);}DOMScroll.scrollTo(e,0);}).defer();this.ua&&this.ua.add_event('frame');Arbiter.inform('layer_shown',{type:'PhotoSnowbox'});Arbiter.inform(PhotoSnowbox.OPEN);Bootloader.loadComponents(['Hovercard','live-js','photocrop2','PhotoTag','PhotoTagger','TagToken','TagTokenizer','ui-ufi-css']);this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.actionList,'click',this.rotateListener.bind(this))];var a=ge('fbPhotoSnowboxFeedback');if(a)this.stageHandlers.push(Event.listen(a,'click',function(event){if(Parent.byClass(event.getTarget(),'like_link'))CSS.toggleClass(DOM.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this)));var b=ge('fbPhotoSnowboxOnProfile');if(b)this.stageHandlers.push(Event.listen(b,'click',function(event){if(Parent.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!c)this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){PageTransitions.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}PhotoSessionLog.initLogging(PhotoSessionLog.SNOWBOX);if(ua.firefox()&&!CSS.hasClass(document.documentElement,'wrapped'))this.turnFlashAutoplayOff.defer();(function(){this.adjustForResize();if(ua.ie()){this.container.focus();}else this.root.focus();}).bind(this).defer();},getStream:function(){return this.stream;},fetchInitialData:function(){this.ua&&this.ua.add_event('init_data');UIPagelet.loadFromEndpoint('PhotoViewerInitPagelet',null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){DOM.scry(document,'div.swfObject').each(function(d){var b=d.getAttribute('data-swfid');if(b&&window[b]){var c=window[b];c.addParam('autostart','false');c.addParam('autoplay','false');c.addParam('play','false');c.addVariable('video_autoplay','0');c.addVariable('autoplay','0');c.addVariable('play','0');var a=URI(c.getAttribute('swf'));a.addQueryData({autoplay:'0'});a.setPath(a.getPath().replace('autoplay=1','autoplay=0'));c.setAttribute('swf',a.toString());c.write(d);}});},closeHandler:function(){if(!this.isOpen)return;if(URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(d,b){if(!d)if(b){this.squashNextTransition(goURI.curry(b));}else this.squashNextTransition();this.returningToStart=true;var e=Arbiter.subscribe('page_transition',function(){this.returningToStart=false;Arbiter.unsubscribe(e);});var a=d||isNaN(ua.opera());var g=this._uriStack.length;if(a&&g<window.history.length){window.history.go(-g);}else{var f=PhotoSnowbox.startingURI;var c=new URI(f).removeQueryData('closeTheater');if(f.getQueryData().sk=='approve'&&f.getPath()=='/profile.php'){c.removeQueryData('highlight');c.removeQueryData('notif_t');}goURI(c);}},squashNextTransition:function(a){PhotoSnowbox.squashNext=true;PageTransitions.registerHandler(function _squash(){if(PhotoSnowbox.squashNext){PhotoSnowbox.squashNext=false;if(a)a.defer();PageTransitions.transitionComplete();return true;}return false;});},handleNavigateAway:function(b){var a=computeRelativeURI(window.PageTransitions._most_recent_uri.getQualifiedURI(),b.getAttribute('href'));if(this.isOpen&&(a instanceof URI)&&a.getUnqualifiedURI().toString()!=this.startingURI.toString()&&a.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=PhotoSessionLog.NAVIGATE;this.close();this.returnToStartingURI(false,a);return false;}return true;},closeListener:function(event){if(this.isOpen&&!(window.Dialog&&Dialog.getCurrent())){var c=event.getTarget();var a=Parent.byClass(c,'closeTheater');var b=(a||c==this.root||c==this.infoWrapper);if(b){if(a){this.closingAction=PhotoSessionLog.X;}else this.closingAction=PhotoSessionLog.OUTSIDE;Event.kill(event);this.closeHandler();}else if(Event.getKeyCode(event)==KEYS.ESC){this.closingAction=PhotoSessionLog.ESC;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;CSS.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){var b=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.removeClass(document.documentElement,'theaterMode');CSS.removeClass(document.body,this.extraClass);}CSS.removeClass(this.root,'dataLoaded');DOMScroll.scrollTo(b,0);KeyEventController.getInstance().resetHandlers();PhotoSessionLog.logPhotoViews(this.closingAction);this.destroy();CSS.hide(this.errorBox);CSS.hide(this.image);this.normalSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;CSS.removeClass(this.stageWrapper,'showVideo');DOM.empty(this.videoStage);this.currentMinSize=null;this.pinPagers=false;CSS.removeClass(this.stagePagers,'pagingReady');this.recacheData();DOM.empty(this.sideAdUnit);DOM.empty(this.bottomAdUnit);this.stream.destroy();var a=this.closingAction===PhotoSessionLog.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}Arbiter.inform('layer_hidden',{type:'PhotoSnowbox'});Arbiter.inform(PhotoSnowbox.CLOSE,a);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(b){if(this.thumbSrc!==null&&this.normalSize!==null){var a=this.getMaxImageSize(this.normalSize);this.useImage($N('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:a.x+'px',height:a.y+'px'}}),a,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(b)(function(){var c=new Image();c.onload=async_callback(function(){if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(b,this.normalSize);this.ua&&this.ua.add_event('image');}}.bind(this),'photo_theater');c.src=b;}).bind(this).defer();CSS.hide(this.stageActions);CSS.addClass(this.stagePagers,'pagingDisabled');},initDataFetched:function(a){PhotoSessionLog.setPhotoSet(this.stream.getPhotoSet());PhotoSessionLog.setLogFbids(a.logids);PhotoSessionLog.addPhotoView(this.stream.getCurrentImageData().info);this.position=this.stream.getCursor();var b={click:this.pageListener.bind(this),mouseleave:this.mouseLeaveListener.bind(this),mousemove:this.mouseMoveListener.bind(this)};if(!this.pageHandlers){this.pageHandlers=values(Event.listen(this.root,b));KeyEventController.registerKey('LEFT',this.pageListener.bind(this));KeyEventController.registerKey('RIGHT',this.pageListener.bind(this));}CSS.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=a.loggedin;this.disableAds=!this.isLoggedInViewer||a.fromad;this.loadAds();},adjustForResize:function(){this.currentMinSize=null;this.pinPagers=false;this.adjustStageSize();this.adjustForNewData();},getMaxImageSize:function(c){var f=Vector2.getViewportDimensions();var e=f.sub(new Vector2(PhotoSnowbox.STAGE_CHROME.x,PhotoSnowbox.STAGE_CHROME.y));var a=new Vector2(Math.min(c.x,e.x,PhotoSnowbox.STAGE_MAX.x),Math.min(c.y,e.y,PhotoSnowbox.STAGE_MAX.y));if(a.x===0&&a.y===0)return new Vector2(0,0);var d=c.x/c.y;var b=a.x/a.y;if(b<d)return new Vector2(a.x,Math.round(a.x/d));return new Vector2(Math.round(a.y*d),a.y);},adjustStageSize:function(c){var a;var b=this.stream&&this.stream.getCurrentImageData();if(c){a=c;}else if(b&&b.dimensions){a=b.dimensions;}else if(this.image&&this.image.src&&image_has_loaded(this.image)){a=Vector2.getElementDimensions(this.image);}else return;if(this.shouldStretch&&!this.getVideoOnStage()&&a.x>a.y&&a.x<=PhotoSnowbox.TIMELINE_STRETCH_WIDTH&&a.x>=PhotoSnowbox.TIMELINE_STRETCH_MIN){a.y=Math.round(a.y*PhotoSnowbox.TIMELINE_STRETCH_WIDTH/a.x);a.x=PhotoSnowbox.TIMELINE_STRETCH_WIDTH;CSS.setStyle(this.image,'height',a.y+'px');CSS.setStyle(this.image,'width','auto');}var d=this.getMaxImageSize(a);if(!this.currentMinSize){this.currentMinSize=new Vector2(Math.max(d.x,PhotoSnowbox.STAGE_MIN.x),Math.max(d.y,PhotoSnowbox.STAGE_MIN.y));}else this.currentMinSize=new Vector2(Math.max(d.x,this.currentMinSize.x),Math.max(d.y,PhotoSnowbox.STAGE_MIN.y));CSS.setStyle(this.container,'width',this.currentMinSize.x+'px');CSS.setStyle(this.stageWrapper,'height',this.currentMinSize.y+'px');CSS.setStyle(this.stage,'lineHeight',this.currentMinSize.y+'px');CSS.setStyle(this.videoStage,'lineHeight',this.currentMinSize.y+'px');CSS.conditionClass(this.container,'adsOnSide',this.currentMinSize.x>=PhotoSnowbox.WIDE_ADS);this.adjustForAdUnit();if(!this.pinPagers)CSS.setStyle(this.stagePagers,'height',this.currentMinSize.y/2+'px');this.pinPagers=true;},adjustForNewData:function(){if(!this.image)return;var c=DOM.scry(this.stage,'div.tagsWrapper')[0];var a=Vector2.getElementDimensions(this.image);if(c){CSS.setStyle(c,'width',a.x+'px');CSS.setStyle(c,'height',a.y+'px');if(ua.ie()<=7){var b=DOM.scry(this.root,'div.tagContainer')[0];if(b)CSS.conditionClass(c,'ie7VerticalFix',Vector2.getElementDimensions(b).y>a.y);}}},setLoadingState:function(b,a){switch(b){case PhotoSnowbox.STATE_IMAGE_PIXELS:CSS.conditionClass(this.root,'imagePixelsLoading',a);break;case PhotoSnowbox.STATE_IMAGE_DATA:this.loadingStates[b]=a;CSS.conditionClass(this.root,'imageLoading',a);break;case PhotoSnowbox.STATE_HTML:this.loadingStates[b]=a;CSS.conditionClass(this.root,'dataLoading',a);CSS.conditionClass(this.root,'dataLoaded',!a);this.infoWrapper.setAttribute('aria-busy',a?'true':'false');break;}},destroy:function(){this.stageHandlers.each(function(a){a.remove();});if(this.pageHandlers){this.pageHandlers.each(function(a){a.remove();});this.pageHandlers=null;}},checkState:function(b){if(b!=PhotoSnowbox.STATE_ERROR&&!this.loadingStates[b])return;switch(b){case PhotoSnowbox.STATE_IMAGE_DATA:var a=this.stream.getCurrentImageData();if(a){if(a.url){this.switchImage(a.url,null,true);}else if(a.video)this.switchVideo(a.video,true);this.setLoadingState(b,false);}break;case PhotoSnowbox.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(b,false);}break;default:if(this.stream.errorInCurrent()){CSS.hide(this.image);CSS.show(this.errorBox);}break;}},buttonListener:function(event){var b=event.getTarget();var a=Date.now();if(Parent.byClass(b,'fbPhotoTagApprovalBox'))return;if(a-this.lastPage<350)return;if(Parent.byClass(b,'likeButton')){DOM.find($('fbPhotoSnowboxFeedback'),'button.like_link').click();}else if(Parent.byClass(b,'commentButton')){DOM.find(this.root,'div.commentBox textarea').focus();this.root.scrollTop=this.root.scrollHeight;}else if(Parent.byClass(b,'tagApproveIgnore'))this.updateTagBox(event,b);},rotateListener:function(event){var a=event.getTarget();if(Parent.byClass(a,'rotateRight')){this.rotate('right');}else if(Parent.byClass(a,'rotateLeft'))this.rotate('left');},updateTagBox:function(b,a){this.unhiliteAllTags();var c=ge(b);if(!c)return;CSS.addClass(c,'tagBox');CSS.addClass(c,'tagBoxPendingResponse');CSS.removeClass(c,'tagBoxPending');CSS.hide(DOM.find(c,'span.tagForm'));if(a){CSS.show(DOM.find(c,'span.tagApproved'));}else CSS.show(DOM.find(c,'span.tagIgnored'));},rotate:function(c){var d=this.stream.getCursor();if(this.getVideoOnStage()){var b=(c=='left')?270:90;Bootloader.loadComponents(['video-rotate-viewer'],new VideoRotate(d,this.actionList).motionRotate(b));return;}var a={fbid:d,cs_ver:PhotosConst.VIEWER_SNOWBOX};a[c]=1;this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);CSS.hide(this.image);new AsyncRequest('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(a).setErrorHandler(this.rotationError.bind(this,d)).setHandler(this.rotationComplete.bind(this,d)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(a,b){this.storeResponseForRotate(a,b);if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}},storeResponseForRotate:function(a,c){this.storeFromResponse(c);var b=this.stream.getImageData(a);b.url=c.getPayload().new_urls[PhotosConst.SIZE_NORMAL];b.dimensions=Vector2.deserialize(c.getPayload().dimensions);},rotationError:function(a,b){if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);AsyncResponse.defaultErrorHandler(b);}},saveTagComplete:function(a){this.saveTagsFromPayload(a.getPayload());},saveTagsFromPayload:function(a){this.storeFromData(a);if('data' in a&&this.stream.getCursor() in a.data)this.swapData();},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},mouseMoveListener:function(event){var b=event.getTarget();var a=(Parent.byClass(b,'stageActions')||Parent.byClass(b,'stageWrapper'));if(!a)CSS.hide(this.pivotBar);if(this.hasPivotData()&&!this.loadingStates.html)CSS.show(this.pivotBar);this.hiliteTagsOnMouseMove(event);},hasPivotData:function(){var a=this.stream.getCurrentHtml();return a&&a.fbPhotoSnowboxPivots;},unhiliteAllTags:function(){DOM.scry(this.stage,'div.tagsWrapper div.hover').each(function(a){CSS.removeClass(a,'hover');});this.hilitedTag=null;},switchHilitedTags:function(b,c){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var a=ge(b);if(a){this.hilitedTag=b;CSS.addClass(a,'hover');if(CSS.hasClass(a,'tagBoxPending')&&!CSS.hasClass(a,'showPendingTagName')&&c===true){DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName').each(function(d){CSS.removeClass(d,'showPendingTagName');});CSS.addClass(a,'showPendingTagName');}}},reHilitePendingTag:function(){var a=ge(this.hilitedTag);if(a&&CSS.hasClass(a,'showPendingTagName'))return;var b=DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(b)this.switchHilitedTags(b.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var m=event.getTarget();if(Parent.byClass(m,'fbPhotoSnowboxTagApproval'))return;var i=Parent.byClass(m,'tagBoxPending');var d=(this.hilitedTag&&CSS.hasClass($(this.hilitedTag),'tagBoxPending'));var l=((!this.hilitedTag&&i)||(!d&&i));if(l){this.switchHilitedTags(i.id);return;}if(i&&(i.id==this.hilitedTag))return;var a=250;var h=Vector2.getEventPosition(event);var f=Vector2.getElementPosition(this.image);var e=Vector2.getElementDimensions(this.image);var j=this.stream.getCurrentImageData().dimensions;var k=e.x/j.x;var g=PhotosUtils.getNearestBox(h,f,j,k,PhotoSnowbox.MIN_TAG_DISTANCE*k,this.stream.getCurrentExtraData().tagRects);if(!g){if(!d){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var b=null;if(d){var c={};c[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];b=PhotosUtils.getNearestBox(h,f,j,k,PhotoSnowbox.MIN_TAG_DISTANCE*k,c);}if(b!==null&&d)return;if(this.hilitedTag!=g)if(d){this.switchTimer=this.switchHilitedTags.bind(this,g).defer(a);}else this.switchHilitedTags(g);},getVideoOnStage:function(){var a=this.stream&&this.stream.getCurrentImageData();return a&&a.video;},shouldGoForward:function(b){var a=(this.getVideoOnStage()||CSS.hasClass(this.root,'taggingMode')||Parent.byClass(b,'tagBoxPending')||Parent.byClass(b,'tagBoxPendingResponse')||Parent.byClass(b,'fbPhotoTagApprovalBox'));if(a)return false;return DOM.isNode(b)&&Parent.byClass(b,'stage');},pageListener:function(event){var a=Event.getKeyCode(event);var c=event.getTarget();var b=0;if(a==KEYS.RIGHT){b=1;PhotoSessionLog.setPagingAction('key_right');}else if(a==KEYS.LEFT){b=-1;PhotoSessionLog.setPagingAction('key_left');}else if(Parent.byClass(c,'next')){b=1;PhotoSessionLog.setPagingAction('click_next');}else if(Parent.byClass(c,'prev')){b=-1;PhotoSessionLog.setPagingAction('click_prev');}else if(this.shouldGoForward(c)){b=1;PhotoSessionLog.setPagingAction('click_stage');}if(b){this.page(b,false);user_action('a',c,event);}},page:function(c,b){if(!this.stream.isValidMovement(c))return;this.lastPage=Date.now();this.unhiliteAllTags();var d=this.getVideoOnStage();if(d)this.switchVideo(d,false);Arbiter.inform(PhotoSnowbox.PAGE);this.recacheData();this.stream.moveCursor(c);CSS.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(PhotoSnowbox.STATE_HTML,true);CSS.show(this.errorBox);return;}var a=this.stream.getCurrentImageData();if(a){if(a.url){this.switchImage(a.url,null,true);}else if(a.video)this.switchVideo(a.video,true);if(!b){this.replaceUrl=true;goURI(a.info.permalink);}}else{this.setLoadingState(PhotoSnowbox.STATE_IMAGE_PIXELS,true);this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(PhotoSnowbox.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();},logImpressionDetailsForPhoto:function(){var b=[].concat(DOM.scry($('fbPhotoSnowboxTagList'),'input.photoImpressionDetails'),DOM.scry($('fbPhotoSnowboxFeedback'),'input.photoImpressionDetails'));if(b.length===0)return;var a={};for(var c=0;c<b.length;c++)a[b[c].name]=b[c].value;if(this.getVideoOnStage()){a.width=0;a.height=0;}else{a.width=this.stream.getCurrentImageData().dimensions.x;a.height=this.stream.getCurrentImageData().dimensions.y;}PhotoSessionLog.addDetailData(this.stream.getCursor(),a);},loadAds:function(){if(this.disableAds)return;var a=Date.now();if(a-this.lastAdsLoad>PhotoSnowbox.ADS_REFRESH_RATE){UIPagelet.loadFromEndpoint('WebEgoPane','fbPhotoSnowboxAdsSide',{pid:34,data:[this.loadQuery.set]},{crossPage:true});this.lastAdsLoad=a;}},adjustForAdUnit:function(){var b=this.sideAdUnit.childNodes;var a=this.bottomAdUnit.childNodes;if(CSS.hasClass(this.container,'adsOnSide')){if(a.length>0&&b.length===0)DOM.setContent(this.sideAdUnit,$A(a));DOM.empty(this.bottomAdUnit);}else if(b.length>0){DOM.setContent(this.bottomAdUnit,$A(b));DOM.empty(this.sideAdUnit);}CSS.conditionClass(this.sideAdDiv,'fbPhotoSnowboxAdsNone',b.length===0);CSS.conditionClass(this.bottomAdDiv,'fbPhotoSnowboxAdsNone',a.length===0);},transitionHandler:function(c){if(c.getQueryData().closeTheater||c.getQueryData().permPage||c.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(c.getQualifiedURI().toString());PageTransitions.transitionComplete();return true;}var d=this._uriStack.length;if(d>=2&&this._uriStack[d-2]==c.getQualifiedURI().toString())this._uriStack.pop();var a=this.stream.getCursorForURI(c.getUnqualifiedURI().toString());if(a){var b=this.stream.getRelativeMovement(a);this.page(b,true);PageTransitions.transitionComplete();return true;}if(this.isOpen){this.close();PageTransitions.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var a=this.stream.getCurrentHtml();for(var b in a){a[b]=$A($(b).childNodes);DOM.empty($(b));}}},reloadIfTimeout:function(){if(!image_has_loaded(this.image)){var a=this.makeNewImage(this.image.src,true);Event.listen(a,'load',this.useImage.bind(this,a,null,true));}},useImage:function(c,a,b){if(b&&image_has_loaded(this.image))return;DOM.replace(this.image,c);this.image=c;this.adjustStageSize(a);},makeNewImage:function(c,a){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!a)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),PhotoSnowbox.LOADING_TIMEOUT);var b=$N('img',{className:'spotlight',alt:''});b.setAttribute('aria-describedby','fbPhotosSnowboxCaption');b.setAttribute('aria-busy','true');Event.listen(b,'load',async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){this.adjustStageSize();this.adjustForNewData();}).bind(this).defer();}.bind(this),'photo_theater'));b.src=c;return b;},switchImage:function(d,b,c){CSS.hide(this.image);CSS.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var a=this.stream&&this.stream.getCurrentImageData();if(a)PhotoSessionLog.addPhotoView(a.info);this.useImage(this.makeNewImage(d,false),b,false);if(c)this.stream.preloadImages();},switchVideo:function(c,a){var b='swf_'+c;if(a){CSS.addClass(this.stageWrapper,'showVideo');this.videoStage.id=c;if(window[b]&&!ge(b))window[b].write(c);this.adjustStageSizeForVideo.bind(this,b).defer();}else{this.videoStage.id='fbVideoStage';window[b]&&window[b].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);DOM.empty(this.videoStage);CSS.removeClass(this.stageWrapper,'showVideo');}},checkVideoStatus:function(a){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);video=this.getVideoOnStage();if(!video){return;}else{currentSwfID='swf_'+video;if(a!==currentSwfID)return;this.adjustStageSizeForVideo(a);}},adjustStageSizeForVideo:function(a){var b=ge(a);if(!b){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,a),200);}else this.adjustStageSize(new Vector2(b.width,b.height));},setErrorBoxContent:function(a){DOM.setContent(this.errorBox,a);},swapData:function(){var b,c=this.stream.getCurrentHtml();if(c){this.setLoadingState(PhotoSnowbox.STATE_HTML,false);for(var d in c){b=ge(d);b&&DOM.setContent(b,c[d]);}var a=DOM.scry($('fbPhotoSnowboxCaption'),'div.fbPhotoInlineCaptionEditor');if(a.length)new PhotoInlineCaptionEditor('snowbox').init(a[0]);Arbiter.inform(PhotoSnowbox.DATA_CHANGE,this.stream.getCurrentImageData().info,Arbiter.BEHAVIOR_STATE);this.position=this.stream.getCursor();}this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(c,b,a){element=ge('fbPhotoSnowboxPositionAndCount');element&&DOM.setContent(element,a);this.stream.setTotalCount(c);this.stream.setFirstCursorIndex(b);},addPhotoFbids:function(b,c,a){var d=this.stream.getCursor()===null;this.stream.attachToFbidsList(b,c,a);if(a&&d)this.page(0,true);if(!this.pagersShown&&this.stream.canPage())this.setStagePagersReady();},storeFromResponse:function(a){window.ArbiterMonitor&&ArbiterMonitor.stopTtiMeasurement();this.storeFromData(a.getPayload());},storeFromData:function(a){if(!this.isOpen)return;var b=this.stream.storeToCache(a);if('error' in b){this.checkState(PhotoSnowbox.STATE_ERROR);return;}if('init' in b){this.initDataFetched(b.init);if(this.openExplicitly){this.replaceUrl=true;goURI(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersReady();this.ua&&this.ua.add_event('ufi');}if('image' in b)this.checkState(PhotoSnowbox.STATE_IMAGE_DATA);if('data' in b)this.checkState(PhotoSnowbox.STATE_HTML);},setStagePagersReady:function(){CSS.removeClass(this.stagePagers,'pagingDisabled');CSS.addClass(this.stagePagers,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');},deletePhoto:function(a){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(a,b){if(b.version!=PhotosConst.VIEWER_SNOWBOX)return;id=b.tag;if(id){this.switchHilitedTags(id,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(a,b){if(b.version==PhotosConst.VIEWER_SNOWBOX)this.updateTagBox(b.id,b.approve);}};
var UFIOptimistic={COMMENT_SEND_EVENT:'ufi/comment',_commentSeqNo:0,init:function(a){this._commentTemplate=a;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var i=event.getTarget();var l=i.name=='comment'&&i.parentNode&&Parent.byClass(i,'optimistic_submit');if(!l)return true;var e=i.form;var k=DOM.find(e,'textarea');if(Input.isEmpty(k))return true;fc_uncollapse(e);var a=this._commentTemplate.render();var j=XHPTemplate.getNode(a,'text');DOM.setContent(j,HTML(htmlize(trim(k.value))));var c=DOM.scry(e,'ul.commentList')[0];if(!c)return true;CSS.show(c.parentNode);c.appendChild(a);var b=c.lastChild;var g=rand32();b.id='optimistic_comment_'+g+'_'+this._commentSeqNo++;var d=Form.serialize(e);d.comment_replace=b.id;d.comment=1;function h(){new AsyncRequest(Form.getAttribute(e,'action')).setData(d).setRelativeTo(e).setErrorHandler(function(m){CSS.addClass(b,'uiUfiCommentFailed');AsyncResponse.defaultErrorHandler(m);}).send();}Event.listen(XHPTemplate.getNode(a,'retry_link'),'click',h);h();k.value=k.style.height='';k.focus();var f=window.MentionsInput&&MentionsInput.getInstance(k);f&&f.reset();Arbiter.inform(UFIOptimistic.COMMENT_SEND_EVENT,{form:e});return false;}};
var PhotoSnowlift=window.PhotoSnowlift||{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',CLOSE:'PhotoSnowlift.CLOSE',DATA_CHANGE:'PhotoSnowlift.DATA_CHANGE',GO:'PhotoSnowlift.GO',OPEN:'PhotoSnowlift.OPEN',PAGE:'PhotoSnowlift.PAGE',RESET_HELP:'PhotoSnowlift.RESET_HELP',LOADING_TIMEOUT:2000,PAGER_FADE:3000,STAGE_MAX:{x:960,y:960},STAGE_MIN:{x:480,y:480},SIDEBAR_SIZE_MAX:340,SIDEBAR_SIZE_MIN:285,STAGE_CHROME:{x:50,y:70},TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,ADS_REFRESH_RATE:30000,switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,normalSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stagePagerPrev:null,ua:null,bootstrap:function(b,a){PhotoSnowliftAds.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=user_action('snowlift',a,null).set_namespace('snowlift').set_ua_id('open');this.returningToStart=false;this.loading&&CSS.removeClass(this.loading,'loading');if(a){CSS.addClass((this.loading=a),'loading');this.getThumbAndSize(a);}else this.loading=null;Arbiter.inform(PhotoSnowlift.GO,b,Arbiter.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getImage:function(){return this.image;},getImageId:function(){return this.stream.getCursor();},getInfoGridHeader:function(){return this.infoGridHeader;},getInfoGridBody:function(){return this.infoGridBody;},getInfoGridFooter:function(){return this.infoGridFooter;},getLoadQuerySet:function(){return this.loadQuery.set;},getThumbAndSize:function(b){this.normalSize=null;this.thumbSrc=null;var e=URI(b.getAttribute('ajaxify')).getQueryData();if(!e.size)return;var a=Vector2.deserialize(e.size);if(!a.x||!a.y)return;this.normalSize=a;if(!CSS.hasClass(b,'uiMediaThumb')&&!CSS.hasClass(b,'uiPhotoThumb')&&!CSS.hasClass(b,'uiScaledThumb'))return;var d=DOM.scry(b,'img')[0];var c=DOM.scry(b,'i')[0];var f=Parent.byAttribute(b,'data-size');this.shouldStretch=f&&this.normalSize&&d&&f.getAttribute('data-size')==="2"&&this.normalSize.x>this.normalSize.y&&this.normalSize.x<=PhotoSnowlift.TIMELINE_STRETCH_WIDTH&&d.offsetWidth===PhotoSnowlift.TIMELINE_STRETCH_WIDTH;if(d){thumbSrc=d.src;}else if(c){thumbSrc=CSS.getStyle(c,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=thumbSrc;},loadFrameIfUninitialized:function(){if(this.root)return;new AsyncRequest('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(a){var b=ge('fbPhotoSnowlift');if(!b){b=DOM.appendContent(DOM.getDocumentBodyElement(),a)[0];this.initialLoad=false;}if(this.root==b)return;this.initializeNodes(b);PhotoSnowliftAds.init(this.sideAdUnit);if(!this.subscription){LinkController.registerHandler(this.handleNavigateAway.bind(this));this.subscription=Arbiter.subscribe(PhotoSnowlift.GO,function(c,d){this.openExplicitly=true;this.loading&&CSS.removeClass(this.loading,'loading');this.open(d);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;Arbiter.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));Arbiter.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));},initializeNodes:function(a){this.root=a;this.container=DOM.find(a,'div.container');this.stagePopup=DOM.find(a,'div.fbPhotoSnowliftPopup');this.topbar=DOM.find(this.container,'div.fbPhotoSnowliftTopbar');this.infoWrapper=DOM.find(this.stagePopup,'div.photoInfoWrapper');this.infoGrid=DOM.find(this.infoWrapper,'table.photoInfoGrid');this.infoGridHeader=DOM.find(this.infoGrid,'td.photoInfoHeader');this.infoGridBody=DOM.find(this.infoGrid,'td.photoInfoBody');this.infoScroller=DOM.find(this.infoGridBody,'div.photoInfoScroller');this.infoScrollerBody=DOM.find(this.infoScroller,'div.uiScrollableAreaBody');this.infoGridFooter=DOM.find(this.infoGrid,'td.photoInfoFooter');this.stageWrapper=DOM.find(this.stagePopup,'.stageWrapper');this.errorBox=DOM.find(this.stageWrapper,'div.stageError');this.image=DOM.find(this.stageWrapper,'img.spotlight');this.stage=DOM.find(this.stageWrapper,'div.stage');this.videoStage=DOM.find(this.stageWrapper,'div.videoStage');this.prevPager=DOM.scry(this.stageWrapper,'.snowliftPager.prev')[0];this.nextPager=DOM.scry(this.stageWrapper,'.snowliftPager.next')[0];this.stageActions=DOM.find(a,'div.stageActions');this.buttonActions=DOM.find(this.stageActions,'div.fbPhotosPhotoButtons');this.actionList=$('fbPhotoSnowliftActions');this.sideAdUnit=$('fbPhotoSnowliftAdsSide');this.ufiForm=DOM.find(this.infoGridBody,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=$('fbPhotoSnowliftFeedbackInput');},initializeScroller:function(){this.initializeScroller=bagofholding;this.scrollableArea=ScrollableArea.fromNative(this.infoScroller,{fade:true,persistent:true});var a=function(event){var e=$E(event).getTarget();if(DOM.contains(this.ufiInputContainer,e)){var c=TextAreaControl.getInstance(e);if(c){this.scrollableArea.scrollToBottom();var d=c.subscribe('resize',function(){var f=this.scrollableArea.isScrolledToBottom();this.adjustScroller();f&&this.scrollableArea.scrollToBottom();}.bind(this));var b=Event.listen(e,'blur',function(){c.unsubscribe(d);b.remove();});}}}.bind(this);Arbiter.subscribe(UFIOptimistic.COMMENT_SEND_EVENT,function(b,c){if(this.ufiForm===c.form){this.adjustScroller();this.scrollableArea.scrollToBottom();}}.bind(this));if(this.ufiForm.attachEvent){this.ufiForm.attachEvent('focusin',a);}else this.ufiForm.addEventListener('focus',a,true);},getRoot:function(){return this.root;},getInfoGridFooter:function(){return this.infoGridFooter;},getLoadQuerySet:function(){return this.loadQuery.set;},openHandler:function(a){if(this.isOpen||a.getPath()!='/photo.php'||this.returningToStart||a.getQueryData().closeTheater||a.getQueryData().permPage||a.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(a);this._uriStack.push(URI(a).getQualifiedURI().toString());PageTransitions.transitionComplete();return true;},open:function(c){var a=URI(c).getQueryData();var b=a.src;if(b)delete a.src;if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){a.firstLoad=true;this.initialLoad=true;}this.loadQuery=a;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.stream=new PhotoStreamCache();this.stream.init(PhotosConst.VIEWER_SNOWLIFT);this.fetchInitialData();this.setLoadingState(PhotoSnowlift.STATE_HTML,true);KeyEventController.registerKey('ESCAPE',this.closeListener.bind(this));Bootloader.loadComponents(['fb-photos-photo-css','fb-photos-snowlift-css'],function(){this._open(c,b);}.bind(this));},_open:function(d,c){this.createLoader(c);CSS.show(this.root);(function(){var e=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.addClass(document.documentElement,'theaterMode');var f=DOMScroll.getScrollbarSize();if(f===0){this.extraClass='zeroScrollbar';}else if(f===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';CSS.addClass(document.body,this.extraClass);}DOMScroll.scrollTo(e,0);}).defer();this.ua&&this.ua.add_event('frame');Arbiter.inform('layer_shown',{type:'PhotoSnowlift'});Arbiter.inform(PhotoSnowlift.OPEN);Bootloader.loadComponents(['Hovercard','live-js','photocrop2','PhotoTag','PhotoTagger','TagToken','TagTokenizer','ui-ufi-css']);this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.actionList,'click',this.rotateListener.bind(this))];var a=ge('fbPhotoSnowliftFeedback');if(a)this.stageHandlers.push(Event.listen(a,'click',function(event){if(Parent.byClass(event.getTarget(),'like_link')){var e=DOM.scry(this.buttonActions,'div.fbPhotosPhotoLike')[0];e&&CSS.toggleClass(e,'viewerLikesThis');}}.bind(this)));var b=ge('fbPhotoSnowliftOnProfile');if(b)this.stageHandlers.push(Event.listen(b,'click',function(event){if(Parent.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!c)this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){PageTransitions.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}PhotoSessionLog.initLogging(PhotoSessionLog.SNOWLIFT);if(ua.firefox()&&!CSS.hasClass(document.documentElement,'wrapped'))this.turnFlashAutoplayOff.defer();(function(){this.adjustForResize();if(ua.ie()){this.container.focus();}else this.root.focus();}).bind(this).defer();},getStream:function(){return this.stream;},fetchInitialData:function(){this.ua&&this.ua.add_event('init_data');UIPagelet.loadFromEndpoint('PhotoViewerInitPagelet',null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){DOM.scry(document,'div.swfObject').each(function(d){var b=d.getAttribute('data-swfid');if(b&&window[b]){var c=window[b];c.addParam('autostart','false');c.addParam('autoplay','false');c.addParam('play','false');c.addVariable('video_autoplay','0');c.addVariable('autoplay','0');c.addVariable('play','0');var a=URI(c.getAttribute('swf'));a.addQueryData({autoplay:'0'});a.setPath(a.getPath().replace('autoplay=1','autoplay=0'));c.setAttribute('swf',a.toString());c.write(d);}});},closeHandler:function(){if(!this.isOpen)return;if(URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(d,b){if(!d)if(b){this.squashNextTransition(goURI.curry(b));}else this.squashNextTransition();this.returningToStart=true;var e=Arbiter.subscribe('page_transition',function(){this.returningToStart=false;Arbiter.unsubscribe(e);});var a=d||isNaN(ua.opera());var g=this._uriStack.length;if(a&&g<window.history.length){window.history.go(-g);}else{var f=PhotoSnowlift.startingURI;var c=new URI(f).removeQueryData('closeTheater');if(f.getQueryData().sk=='approve'&&f.getPath()=='/profile.php'){c.removeQueryData('highlight');c.removeQueryData('notif_t');}goURI(c);}},squashNextTransition:function(a){PhotoSnowlift.squashNext=true;PageTransitions.registerHandler(function _squash(){if(PhotoSnowlift.squashNext){PhotoSnowlift.squashNext=false;if(a)a.defer();PageTransitions.transitionComplete();return true;}return false;});},handleNavigateAway:function(b){var a=computeRelativeURI(window.PageTransitions._most_recent_uri.getQualifiedURI(),b.getAttribute('href'));if(this.isOpen&&(a instanceof URI)&&a.getUnqualifiedURI().toString()!=this.startingURI.toString()&&a.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=PhotoSessionLog.NAVIGATE;this.close();this.returnToStartingURI(false,a);return false;}return true;},closeListener:function(event){if(this.isOpen&&!(window.Dialog&&Dialog.getCurrent())){var c=event.getTarget();var a=Parent.byClass(c,'closeTheater');var b=(a||c==this.root||c==this.infoWrapper);if(b){if(a){this.closingAction=PhotoSessionLog.X;}else this.closingAction=PhotoSessionLog.OUTSIDE;Event.kill(event);this.closeHandler();}else if(Event.getKeyCode(event)==KEYS.ESC){this.closingAction=PhotoSessionLog.ESC;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;CSS.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){var b=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.removeClass(document.documentElement,'theaterMode');CSS.removeClass(document.body,this.extraClass);}CSS.removeClass(this.root,'dataLoaded');DOMScroll.scrollTo(b,0);KeyEventController.getInstance().resetHandlers();PhotoSessionLog.logPhotoViews(this.closingAction);this.destroy();CSS.hide(this.errorBox);CSS.hide(this.image);this.normalSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;CSS.removeClass(this.stageWrapper,'showVideo');DOM.empty(this.videoStage);this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();DOM.empty(this.sideAdUnit);this.stream.destroy();var a=this.closingAction===PhotoSessionLog.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}Arbiter.inform('layer_hidden',{type:'PhotoSnowlift'});Arbiter.inform(PhotoSnowlift.CLOSE,a);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(b){if(this.thumbSrc!==null&&this.normalSize!==null){var a=this.getMaxImageSize(this.normalSize);this.useImage($N('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:a.x+'px',height:a.y+'px'}}),a,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(b)(function(){var c=new Image();c.onload=async_callback(function(){if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(b,this.normalSize);this.ua&&this.ua.add_event('image');this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater');c.src=b;}).bind(this).defer();CSS.hide(this.stageActions);this.setStagePagersState('disabled');},initDataFetched:function(a){PhotoSessionLog.setPhotoSet(this.stream.getPhotoSet());PhotoSessionLog.setLogFbids(a.logids);PhotoSessionLog.addPhotoView(this.stream.getCurrentImageData().info);this.position=this.stream.getCursor();var b={click:this.pageListener.bind(this),mouseleave:this.mouseLeaveListener.bind(this),mousemove:this.mouseMoveListener.bind(this)};if(!this.pageHandlers){this.pageHandlers=values(Event.listen(this.root,b));KeyEventController.registerKey('LEFT',this.pageListener.bind(this));KeyEventController.registerKey('RIGHT',this.pageListener.bind(this));}CSS.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=a.loggedin;this.disableAds=!this.isLoggedInViewer||a.fromad;this.loadAds();},adjustScroller:function(){if(!this.isOpen)return;this.initializeScroller();CSS.addClass(this.infoGrid,'shrink');this.scrollableArea.resize();var b=[this.infoGridHeader,this.infoGridFooter];$A(this.infoScroller.parentNode.childNodes).filter(function(e){if(e!==this.infoScroller)b.push(e);}.bind(this));var a=this.currentMinSize.y;b.forEach(function(e){a-=Vector2.getElementDimensions(e).y;});var d=Vector2.getElementDimensions(this.infoScrollerBody).y;if(d>=a){CSS.setStyle(this.infoScroller,'height',a+'px');}else CSS.setStyle(this.infoScroller,'height','auto');var c=Vector2.getElementDimensions(this.ufiInputContainer).y;CSS.setStyle(this.ufiForm,'padding-bottom',c+'px');CSS.removeClass(this.infoGrid,'shrink');PhotoSnowliftAds.resize(this);this.scrollableArea.adjustGripper().showScrollbar();},adjustForResize:function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();},getMaxImageSize:function(c){var f=Vector2.getViewportDimensions();var e=f.sub(new Vector2(PhotoSnowlift.SIDEBAR_SIZE_MIN+PhotoSnowlift.STAGE_CHROME.x,PhotoSnowlift.STAGE_CHROME.y));var a=new Vector2(Math.min(c.x,e.x,PhotoSnowlift.STAGE_MAX.x),Math.min(c.y,e.y,PhotoSnowlift.STAGE_MAX.y));if(a.x===0&&a.y===0)return new Vector2(0,0);var d=c.x/c.y;var b=a.x/a.y;if(b<d)return new Vector2(a.x,Math.ceil(a.x/d));return new Vector2(Math.floor(a.y*d),a.y);},getSidebarWidth:function(a){var c=Vector2.getViewportDimensions();var b=c.x-PhotoSnowlift.STAGE_CHROME.x-a.x;return Math.max(PhotoSnowlift.SIDEBAR_SIZE_MIN,Math.min(PhotoSnowlift.SIDEBAR_SIZE_MAX,b));},adjustStageSize:function(c){var a;var b=this.stream&&this.stream.getCurrentImageData();if(c){a=c;}else if(b&&b.dimensions){a=b.dimensions;}else if(this.image&&this.image.src&&image_has_loaded(this.image)){a=Vector2.getElementDimensions(this.image);}else return;if(this.shouldStretch&&!this.getVideoOnStage()&&a.x>a.y&&a.x<=PhotoSnowlift.TIMELINE_STRETCH_WIDTH&&a.x>=PhotoSnowlift.TIMELINE_STRETCH_MIN){a.y=Math.round(a.y*PhotoSnowlift.TIMELINE_STRETCH_WIDTH/a.x);a.x=PhotoSnowlift.TIMELINE_STRETCH_WIDTH;CSS.setStyle(this.image,'height',a.y+'px');CSS.setStyle(this.image,'width','auto');}var d=this.getMaxImageSize(a);if(!this.currentMinSize){this.currentMinSize=new Vector2(Math.max(d.x,PhotoSnowlift.STAGE_MIN.x),Math.max(d.y,PhotoSnowlift.STAGE_MIN.y));}else this.currentMinSize=new Vector2(Math.max(d.x,this.currentMinSize.x),Math.max(d.y,PhotoSnowlift.STAGE_MIN.y));var e=this.getSidebarWidth(this.currentMinSize);CSS.setStyle(this.container,'width',this.currentMinSize.x+e+'px');CSS.setStyle(this.stageWrapper,'width',this.currentMinSize.x+'px');CSS.setStyle(this.infoWrapper,'width',e+'px');CSS.setStyle(this.infoWrapper,'height',this.currentMinSize.y+'px');CSS.setStyle(this.stage,'height',this.currentMinSize.y+'px');CSS.setStyle(this.stage,'line-height',this.currentMinSize.y+'px');CSS.setStyle(this.videoStage,'height',this.currentMinSize.y+'px');CSS.setStyle(this.videoStage,'line-height',this.currentMinSize.y+'px');this.adjustScroller();},adjustForNewData:function(){if(!this.image)return;var c=DOM.scry(this.stage,'div.tagsWrapper')[0];var a=Vector2.getElementDimensions(this.image);if(c){CSS.setStyle(c,'width',a.x+'px');CSS.setStyle(c,'height',a.y+'px');if(ua.ie()<=7){var b=DOM.scry(this.root,'div.tagContainer')[0];if(b)CSS.conditionClass(c,'ie7VerticalFix',Vector2.getElementDimensions(b).y>a.y);}}},setLoadingState:function(b,a){switch(b){case PhotoSnowlift.STATE_IMAGE_PIXELS:CSS.conditionClass(this.root,'imagePixelsLoading',a);break;case PhotoSnowlift.STATE_IMAGE_DATA:this.loadingStates[b]=a;CSS.conditionClass(this.root,'imageLoading',a);break;case PhotoSnowlift.STATE_HTML:this.loadingStates[b]=a;CSS.conditionClass(this.root,'dataLoading',a);CSS.conditionClass(this.root,'dataLoaded',!a);this.infoWrapper.setAttribute('aria-busy',a?'true':'false');break;}},destroy:function(){this.stageHandlers.each(function(a){a.remove();});if(this.pageHandlers){this.pageHandlers.each(function(a){a.remove();});this.pageHandlers=null;}},checkState:function(b){if(b!=PhotoSnowlift.STATE_ERROR&&!this.loadingStates[b])return;switch(b){case PhotoSnowlift.STATE_IMAGE_DATA:var a=this.stream.getCurrentImageData();if(a){if(a.url){this.switchImage(a.url,null,true);}else if(a.video)this.switchVideo(a.video,true);this.setLoadingState(b,false);}break;case PhotoSnowlift.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(b,false);}break;default:if(this.stream.errorInCurrent()){CSS.hide(this.image);CSS.show(this.errorBox);}break;}},buttonListener:function(event){var b=event.getTarget();var a=Date.now();if(Parent.byClass(b,'fbPhotoTagApprovalBox'))return;if(a-this.lastPage<350)return;if(Parent.byClass(b,'fbPhotosPhotoLike')){DOM.find($('fbPhotoSnowliftFeedback'),'button.like_link').click();}else if(Parent.byClass(b,'tagApproveIgnore'))this.updateTagBox(event,b);},rotateListener:function(event){var a=event.getTarget();if(Parent.byClass(a,'rotateRight')){this.rotate('right');}else if(Parent.byClass(a,'rotateLeft'))this.rotate('left');},updateTagBox:function(b,a){this.unhiliteAllTags();var c=ge(b);if(!c)return;CSS.addClass(c,'tagBox');CSS.addClass(c,'tagBoxPendingResponse');CSS.removeClass(c,'tagBoxPending');CSS.hide(DOM.find(c,'span.tagForm'));if(a){CSS.show(DOM.find(c,'span.tagApproved'));}else CSS.show(DOM.find(c,'span.tagIgnored'));},rotate:function(c){var d=this.stream.getCursor();if(this.getVideoOnStage()){var b=(c=='left')?270:90;Bootloader.loadComponents(['video-rotate-viewer'],new VideoRotate(d,this.actionList).motionRotate(b));return;}var a={fbid:d,cs_ver:PhotosConst.VIEWER_SNOWLIFT};a[c]=1;this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);CSS.hide(this.image);new AsyncRequest('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(a).setErrorHandler(this.rotationError.bind(this,d)).setHandler(this.rotationComplete.bind(this,d)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(a,b){this.storeResponseForRotate(a,b);if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}},storeResponseForRotate:function(a,c){this.storeFromResponse(c);var b=this.stream.getImageData(a);b.url=c.getPayload().new_urls[PhotosConst.SIZE_NORMAL];b.dimensions=Vector2.deserialize(c.getPayload().dimensions);},rotationError:function(a,b){if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);AsyncResponse.defaultErrorHandler(b);}},saveTagComplete:function(a){this.saveTagsFromPayload(a.getPayload());},saveTagsFromPayload:function(a){this.storeFromData(a);if('data' in a&&this.stream.getCursor() in a.data)this.swapData();},saveEdit:function(){if(!CSS.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;var a=PhotoInlineEditor.getInstance(PhotosConst.VIEWER_SNOWLIFT);a&&Form.bootstrap(a.getForm().controller);},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},mouseMoveListener:function(event){var b=event.getTarget();var a=(Parent.byClass(b,'stageActions')||Parent.byClass(b,'stageWrapper'));if(a){this.hilitePagerOnMouseMove(event);this.hiliteTagsOnMouseMove(event);}else this.setStagePagersState('inactive');},hilitePagerOnMouseMove:function(event){if(!this.prevPager)return;var a=Vector2.getEventPosition(event);var b=Vector2.getElementPosition(this.prevPager);this.stagePagerPrev=Math.abs(a.x-b.x)<160;CSS.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);CSS.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);this.setStagePagersState('active');clearTimeout(this.fadePagerTimer);this.fadePagerTimer=function(d){var c=Parent.byClass(d,'tagButton')||Parent.byClass(d,'fbPhotosPhotoLike')||Parent.byClass(d,'snowliftPager');if(!c)this.setStagePagersState('inactive');this.fadePagerTimer=null;}.bind(this,event.getTarget()).defer(PhotoSnowlift.PAGER_FADE);},unhiliteAllTags:function(){DOM.scry(this.stage,'div.tagsWrapper div.hover').each(function(a){CSS.removeClass(a,'hover');});this.hilitedTag=null;},switchHilitedTags:function(b,c){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var a=ge(b);if(a){this.hilitedTag=b;CSS.addClass(a,'hover');if(CSS.hasClass(a,'tagBoxPending')&&!CSS.hasClass(a,'showPendingTagName')&&c===true){DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName').each(function(d){CSS.removeClass(d,'showPendingTagName');});CSS.addClass(a,'showPendingTagName');}}},reHilitePendingTag:function(){var a=ge(this.hilitedTag);if(a&&CSS.hasClass(a,'showPendingTagName'))return;var b=DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(b)this.switchHilitedTags(b.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var m=event.getTarget();if(Parent.byClass(m,'fbPhotoSnowliftTagApproval'))return;var i=Parent.byClass(m,'tagBoxPending');var d=(this.hilitedTag&&CSS.hasClass($(this.hilitedTag),'tagBoxPending'));var l=((!this.hilitedTag&&i)||(!d&&i));if(l){this.switchHilitedTags(i.id);return;}if(i&&(i.id==this.hilitedTag))return;var a=250;var h=Vector2.getEventPosition(event);var f=Vector2.getElementPosition(this.image);var e=Vector2.getElementDimensions(this.image);var j=this.stream.getCurrentImageData().dimensions;var k=e.x/j.x;var g=PhotosUtils.getNearestBox(h,f,j,k,PhotoSnowlift.MIN_TAG_DISTANCE*k,this.stream.getCurrentExtraData().tagRects);if(!g){if(!d){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var b=null;if(d){var c={};c[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];b=PhotosUtils.getNearestBox(h,f,j,k,PhotoSnowlift.MIN_TAG_DISTANCE*k,c);}if(b!==null&&d)return;if(this.hilitedTag!=g)if(d){this.switchTimer=this.switchHilitedTags.bind(this,g).defer(a);}else this.switchHilitedTags(g);},getVideoOnStage:function(){var a=this.stream&&this.stream.getCurrentImageData();return a&&a.video;},shouldPageOnAction:function(a,e){var b=DOM.isNode(e)&&(Parent.byClass(e,'snowliftPager')||Parent.byClass(e,'stagePagers'));var c=DOM.isNode(e)&&Parent.byClass(e,'stage');var d=((c&&CSS.hasClass(this.root,'taggingMode'))||Parent.byClass(e,'tagBoxPending')||Parent.byClass(e,'tagBoxPendingResponse')||Parent.byClass(e,'fbPhotoTagApprovalBox'));if(d)return false;return a==KEYS.LEFT||a==KEYS.RIGHT||b||c;},pageListener:function(event){var a=Event.getKeyCode(event);var c=event.getTarget();if(!this.shouldPageOnAction(a,c))return;var b=0;if(a==KEYS.RIGHT){b=1;PhotoSessionLog.setPagingAction('key_right');}else if(a==KEYS.LEFT){b=-1;PhotoSessionLog.setPagingAction('key_left');}else if(Parent.byClass(c,'next')){b=1;PhotoSessionLog.setPagingAction('click_next');}else if(Parent.byClass(c,'prev')){b=-1;PhotoSessionLog.setPagingAction('click_prev');}else if(!this.stagePagerPrev){b=1;PhotoSessionLog.setPagingAction('click_stage');}else{b=-1;PhotoSessionLog.setPagingAction('click_stage_back');}this.page(b);user_action('a',c,event);},page:function(c,b){if(!this.stream.isValidMovement(c))return;PhotoSnowliftAds.hideAds();this.lastPage=Date.now();this.unhiliteAllTags();var d=this.getVideoOnStage();if(d)this.switchVideo(d,false);Arbiter.inform(PhotoSnowlift.PAGE);this.recacheData();this.stream.moveCursor(c);CSS.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(PhotoSnowlift.STATE_HTML,true);CSS.show(this.errorBox);return;}var a=this.stream.getCurrentImageData();if(a){if(a.url){this.switchImage(a.url,null,true);}else if(a.video)this.switchVideo(a.video,true);if(!b){this.replaceUrl=true;goURI(a.info.permalink);}}else{this.setLoadingState(PhotoSnowlift.STATE_IMAGE_PIXELS,true);this.setLoadingState(PhotoSnowlift.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(PhotoSnowlift.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();},logImpressionDetailsForPhoto:function(){var b=[].concat(DOM.scry($('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),DOM.scry($('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(b.length===0)return;var a={};for(var c=0;c<b.length;c++)a[b[c].name]=b[c].value;if(this.getVideoOnStage()){a.width=0;a.height=0;}else{a.width=this.stream.getCurrentImageData().dimensions.x;a.height=this.stream.getCurrentImageData().dimensions.y;}PhotoSessionLog.addDetailData(this.stream.getCursor(),a);PhotoSnowliftAds.setIsLogAdData(true);},loadAds:function(){if(this.disableAds)return;PhotoSnowliftAds.loadAdsFromUserActivity();},transitionHandler:function(c){if(c.getQueryData().closeTheater||c.getQueryData().permPage||c.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(c.getQualifiedURI().toString());PageTransitions.transitionComplete();return true;}var d=this._uriStack.length;if(d>=2&&this._uriStack[d-2]==c.getQualifiedURI().toString())this._uriStack.pop();var a=this.stream.getCursorForURI(c.getUnqualifiedURI().toString());if(a){var b=this.stream.getRelativeMovement(a);this.page(b,true);PageTransitions.transitionComplete();return true;}if(this.isOpen){this.close();PageTransitions.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var a=this.stream.getCurrentHtml();for(var b in a){a[b]=$A($(b).childNodes);DOM.empty($(b));}}},reloadIfTimeout:function(){if(!image_has_loaded(this.image)){var a=this.makeNewImage(this.image.src,true);Event.listen(a,'load',this.useImage.bind(this,a,null,true));}},useImage:function(c,a,b){if(b&&image_has_loaded(this.image))return;DOM.replace(this.image,c);this.image=c;this.adjustStageSize(a);},makeNewImage:function(c,a){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!a)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),PhotoSnowlift.LOADING_TIMEOUT);var b=$N('img',{className:'spotlight',alt:''});b.setAttribute('aria-describedby','fbPhotosSnowliftCaption');b.setAttribute('aria-busy','true');Event.listen(b,'load',async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){this.adjustStageSize();this.adjustForNewData();}).bind(this).defer();}.bind(this),'photo_theater'));b.src=c;return b;},switchImage:function(d,b,c){CSS.hide(this.image);CSS.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var a=this.stream&&this.stream.getCurrentImageData();if(a)PhotoSessionLog.addPhotoView(a.info);this.useImage(this.makeNewImage(d,false),b,false);if(c)this.stream.preloadImages();},switchVideo:function(c,a){var b='swf_'+c;if(a){CSS.addClass(this.stageWrapper,'showVideo');this.videoStage.id=c;if(window[b]&&!ge(b))window[b].write(c);this.adjustStageSizeForVideo.bind(this,b).defer();}else{this.videoStage.id='fbVideoStage';window[b]&&window[b].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);DOM.empty(this.videoStage);CSS.removeClass(this.stageWrapper,'showVideo');}},checkVideoStatus:function(a){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);video=this.getVideoOnStage();if(!video){return;}else{currentSwfID='swf_'+video;if(a!==currentSwfID)return;this.adjustStageSizeForVideo(a);}},adjustStageSizeForVideo:function(a){var b=ge(a);if(!b){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,a),200);}else this.adjustStageSize(new Vector2(b.width,b.height));},setErrorBoxContent:function(a){DOM.setContent(this.errorBox,a);},swapData:function(){var b,c=this.stream.getCurrentHtml();if(c){this.setLoadingState(PhotoSnowlift.STATE_HTML,false);for(var d in c){b=ge(d);b&&DOM.setContent(b,c[d]);}var a=DOM.scry($('fbPhotoSnowliftCaption'),'div.fbPhotoInlineCaptionEditor');if(a.length)new PhotoInlineCaptionEditor('snowlift').init(a[0]);Arbiter.inform(PhotoSnowlift.DATA_CHANGE,this.stream.getCurrentImageData().info,Arbiter.BEHAVIOR_STATE);this.position=this.stream.getCursor();}this.adjustScroller();this.scrollableArea&&this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(e,c,a){var d=$('fbPhotoSnowliftPositionAndCount');DOM.replace(d,a);d=$(d.id);var b=this.stream.getCurrentHtml();b[d.id]=$A(d.childNodes);this.stream.setTotalCount(e);this.stream.setFirstCursorIndex(c);},addPhotoFbids:function(b,c,a){var d=this.stream.getCursor()===null;this.stream.attachToFbidsList(b,c,a);if(a&&d)this.page(0,true);if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');},storeFromResponse:function(a){window.ArbiterMonitor&&ArbiterMonitor.stopTtiMeasurement();this.storeFromData(a.getPayload());},storeFromData:function(a){if(!this.isOpen)return;var b=this.stream.storeToCache(a);if('error' in b){this.checkState(PhotoSnowlift.STATE_ERROR);return;}if('init' in b){this.initDataFetched(b.init);if(this.openExplicitly){this.replaceUrl=true;goURI(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.ua&&this.ua.add_event('ufi');}if('image' in b)this.checkState(PhotoSnowlift.STATE_IMAGE_DATA);if('data' in b)this.checkState(PhotoSnowlift.STATE_HTML);},setStagePagersState:function(a){switch(a){case 'ready':CSS.addClass(this.stageWrapper,'pagingReady');CSS.addClass(this.topbar,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':CSS.addClass(this.stageWrapper,'pagingActivated');return;case 'inactive':CSS.removeClass(this.stageWrapper,'pagingActivated');return;case 'disabled':case 'reset':CSS.removeClass(this.stageWrapper,'pagingReady');CSS.removeClass(this.topbar,'pagingReady');return;}},deletePhoto:function(a){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(a,b){if(b.version!=PhotosConst.VIEWER_SNOWLIFT)return;id=b.tag;if(id){this.switchHilitedTags(id,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(a,b){if(b.version==PhotosConst.VIEWER_SNOWLIFT)this.updateTagBox(b.id,b.approve);}};
__d("legacy:popup-resizer",["PopupWindow"],function(a,b,c){a.PopupResizer=b('PopupWindow');},3);
__d("legacy:Toggler",["Toggler"],function(a,b,c){a.Toggler=b('Toggler');},3);
var TooltipLink={setTooltipText:function(a,b){a=Parent.byTag(a,'a');a&&Tooltip.set(a,b);}};
var Selector=function(){var a;var k=false;var l;var m=[];var b;function c(o){return Parent.byClass(o,'uiSelector');}function d(o){return Parent.byClass(o,'uiSelectorButton');}function e(){if(!l)l=new ContextualLayer().init().setPosition('below');return l;}function g(o){return DOM.scry(o,'select')[0];}function f(o){return DOM.find(o,'div.uiSelectorMenuWrapper');}function h(){h=bagofholding;Menu.subscribe('select',function(o,q){if(!a||!q||q.menu!==Selector.getSelectorMenu(a))return;var r=i(a);var t=j(q.item);if(t){var p=a;var s=Selector.isOptionSelected(q.item);var u=Selector.inform('select',{selector:p,option:q.item});if(u===false)return;if(r||!s){Selector.setSelected(p,Selector.getOptionValue(q.item),!s);Selector.inform('toggle',{selector:p,option:q.item});Selector.inform('change',{selector:p});Arbiter.inform('Form/change',{node:p});if(n(p))DataStore.set(p,'dirty',true);}}if(!r||!t)a&&Selector.toggle(a);});}function i(o){return !!o.getAttribute('data-multiple');}function j(o){return CSS.hasClass(o,'uiSelectorOption');}function n(o){return !!o.getAttribute('data-autosubmit');}requireLazy(['Toggler'],function(o){var p={};p.keydown=function(event){var r=event.getTarget();if(DOM.isNodeOfType(r,['input','textarea']))return;switch(Event.getKeyCode(event)){case KEYS.DOWN:case KEYS.SPACE:case KEYS.UP:k=true;if(d(r)){var q=c(r);Selector.toggle(q);return false;}break;case KEYS.ESC:k=true;if(a){Selector.toggle(a);return false;}break;case KEYS.RETURN:k=true;break;}};p.keyup=function(){!function(){k=false;}.defer();};Event.listen(document.documentElement,p);o.subscribe(['show','hide'],function(za,z){var w=c(z.getActive());if(w){h();var q=Selector.getSelectorButton(w);var r=Selector.getSelectorMenu(w);var x=za==='show';if(x){a=w;if(CSS.hasClass(q,'uiButtonDisabled')){Selector.setEnabled(w,false);return false;}r=r||Selector.loadMenu(w);var u=CSS.getScrollParent(w);var v=u!==window&&u!==DOM.getDocumentScrollElement();if(v||CSS.hasClass(w,'uiSelectorUseLayer')){if(v)m.push(Event.listen(u,'scroll',function(){z.hide();}));b=$N('div',{className:w.className});CSS.addClass(b,'invisible_elem');Vector2.getElementDimensions(w).setElementDimensions(b);DOM.replace(w,b);var t=CSS.hasClass(w,'uiSelectorRight');e().setContext(b).setContent(w).setAlignment(t?'right':'left').show();}Menu.register(r);if(k){var s=Menu.getCheckedItems(r);if(!s.length)s=Menu.getEnabledItems(r);Menu.focusItem(s[0]);}}else{a=null;if(b){while(m.length)m.pop().remove();DOM.replace(b,w);e().hide();b=null;}r&&Menu.unregister(r);k&&Input.focus(q);if(n(w)&&DataStore.get(w,'dirty')){var y=DOM.scry(w,'input.submitButton')[0];y&&y.click();DataStore.remove(w,'dirty');}}CSS.conditionClass(Selector.getSelectorButton(w),'selected',x);Selector.inform(x?'open':'close',{selector:w});}});});return copy_properties(new Arbiter(),{attachMenu:function(s,o,q){s=c(s);if(s){a&&Menu.unregister(Selector.getSelectorMenu(a));DOM.setContent(f(s),o);a&&Menu.register(Selector.getSelectorMenu(s));b&&e().updatePosition();if(q){var p=s.getAttribute('data-name');p&&q.setAttribute('name',p);if(!i(s))q.setAttribute('multiple',false);var r=g(s);if(r){DOM.replace(r,q);}else DOM.insertAfter(s.firstChild,q);}return true;}},getOption:function(q,r){var p=Selector.getOptions(q),o=p.length;while(o--)if(r===Selector.getOptionValue(p[o]))return p[o];return null;},getOptions:function(p){var o=Menu.getItems(Selector.getSelectorMenu(p));return o.filter(j);},getEnabledOptions:function(p){var o=Menu.getEnabledItems(Selector.getSelectorMenu(p));return o.filter(j);},getSelectedOptions:function(o){return Menu.getCheckedItems(Selector.getSelectorMenu(o));},getOptionText:function(o){return Menu.getItemLabel(o);},getOptionValue:function(p){var r=c(p);var q=g(r);var o=Selector.getOptions(r).indexOf(p);return o>=0?q.options[o+1].value:'';},getSelectorButton:function(o){return DOM.find(o,'a.uiSelectorButton');},getSelectorMenu:function(o){return DOM.scry(o,'div.uiSelectorMenu')[0];},getValue:function(s){var q=g(s);if(!q)return null;if(!i(s))return q.value;var t=[];var p=q.options;for(var o=1,r=p.length;o<r;o++)if(p[o].selected)t.push(p[o].value);return t;},isOptionSelected:function(o){return Menu.isItemChecked(o);},listen:function(p,q,o){return this.subscribe(q,function(s,r){if(r.selector===p)return o(r,s);});},loadMenu:function(r){var q=Selector.getSelectorMenu(r);if(!q){var p=Selector.getSelectorButton(r);var o=p.getAttribute('ajaxify');if(o){Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(o,p);});var s=HTML('<div class="uiSelectorMenuWrapper uiToggleFlyout">'+'<div class="uiMenu uiSelectorMenu loading">'+'<ul class="uiMenuInner">'+'<li><span></span></li>'+'</ul>'+'</div>'+'</div>');DOM.appendContent(p.parentNode,s);q=Selector.getSelectorMenu(r);p.removeAttribute('onmouseover');}}return q;},setButtonLabel:function(r,p){var o=Selector.getSelectorButton(r);var q=parseInt(o.getAttribute('data-length'),10);p=p||o.getAttribute('data-label')||'';Button.setLabel(o,p);if(typeof p==='string'){CSS.conditionClass(o,'uiSelectorBigButtonLabel',p.length>q);if(q&&p.length>q){o.setAttribute('title',p);}else o.removeAttribute('title');}},setButtonTooltip:function(q,p){var o=Selector.getSelectorButton(q);TooltipLink.setTooltipText(o,p||o.getAttribute('data-tooltip')||'');},setEnabled:function(p,o){if(!o&&a&&c(p)===a)Selector.toggle(p);Button.setEnabled(Selector.getSelectorButton(p),o);},setOptionEnabled:function(p,o){Menu.setItemEnabled(p,o);},setSelected:function(s,t,q){q=q!==false;var p=Selector.getOption(s,t);if(!p)return;var o=Selector.isOptionSelected(p);if(q!==o){if(!i(s)&&!o){var r=Selector.getSelectedOptions(s)[0];r&&Menu.toggleItem(r);}Menu.toggleItem(p);Selector.updateSelector(s);}},toggle:function(o){Toggler.toggle(DOM.scry(c(o),'div.wrap')[0]);},updateSelector:function(z){var w=Selector.getOptions(z);var y=Selector.getSelectedOptions(z);var t=g(z).options;var v=[];var zb=[];for(var s=0,u=w.length;s<u;s++){var x=y.contains(w[s]);t[s+1].selected=x;if(x){var za=Selector.getOptionText(w[s]);v.push(za);zb.push(w[s].getAttribute('data-tooltip')||za);}}t[0].selected=!y.length;var q=CSS.hasClass(z,'uiSelectorDynamicLabel');var r=CSS.hasClass(z,'uiSelectorDynamicTooltip');if(q||r){var p='';if(i(z)){var o=Selector.getSelectorButton(z);p=o.getAttribute('data-delimiter')||', ';}v=v.join(p);zb=zb.join(p);q&&Selector.setButtonLabel(z,v);r&&Selector.setButtonTooltip(z,zb);}}});}();
var DynamicIconSelector=function(){onloadRegister(function(){Selector.subscribe('change',function(a,b){var c=b.selector;if(CSS.hasClass(c,'dynamicIconSelector'))DynamicIconSelector.swapIcon(c);});});return {swapIcon:function(e){var d=Selector.getSelectedOptions(e)[0];var c=d&&DOM.scry(d,'.itemIcon')[0];var a=Selector.getSelectorButton(e);if(c){Button.setIcon(a,c.cloneNode(true));}else{var b=DOM.scry(a,'.img')[0];b&&DOM.remove(b);}CSS.conditionClass(a,'uiSelectorChevronOnly',!c);}};}();
var PrivacyBaseValue={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0};var PrivacyFriendsValue={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0};var PrivacySpecialPreset={ONLY_CORP_NETWORK:200,COLLEGE_NETWORK_FRIENDS_OF_FRIENDS:201,COLLEGE_NETWORK_FRIENDS:202};var PrivacyNetworkTypes={TYPE_COLLEGE:1,TYPE_HS:2,TYPE_CORP:3,TYPE_GEO:4,TYPE_MANAGED:14,TYPE_TEST:50};var PrivacyNetworksAll=1;copy_properties(PrivacyBaseValue,PrivacySpecialPreset);function PrivacyModel(){this.value=PrivacyBaseValue.ALL_FRIENDS;this.friends=PrivacyFriendsValue.NO_FRIENDS;this.networks=[];this.objects=[];this.lists=[];this.lists_x=[];this.list_anon=0;this.ids_anon=[];this.list_x_anon=0;this.ids_x_anon=[];this.tdata={};return this;}copy_properties(PrivacyModel.prototype,{init:function(k,a,h,i,f,g,d,b,e,c,j){this.value=k;this.friends=a;this.networks=h.slice();this.objects=i.slice();this.lists=f.slice();this.lists_x=g.slice();this.list_anon=d;this.ids_anon=b.slice();this.list_x_anon=e;this.ids_x_anon=c.slice();j=j||{};copy_properties(this.tdata,j);},clone:function(){var a=new PrivacyModel();a.init(this.value,this.friends,this.networks,this.objects,this.lists,this.lists_x,this.list_anon,this.ids_anon,this.list_x_anon,this.ids_x_anon,this.tdata);return a;},getData:function(){var b=['value','friends','networks','objects','lists','lists_x','list_anon','ids_anon','list_x_anon','ids_x_anon'];var d={};for(var c=0;c<b.length;++c){var a=b[c];d[a]=this[a];}return d;}});
var AudienceSelector=function(){onloadRegister(function(){Selector.subscribe('select',function(a,b){if(!CSS.hasClass(b.selector,'audienceSelector'))return;var e=Selector.getOptionValue(b.option);if(e==PrivacyBaseValue.CUSTOM){Selector.toggle(b.selector);return false;}if(CSS.hasClass(b.selector,'dataTooltip')){var c=DOM.find(b.option,'.itemAnchor').getAttribute('data-tooltip');Selector.setButtonTooltip(b.selector,c||null);}if(!CSS.hasClass(b.option,'specialOption'))return;var d=DOM.find(b.option,'a').getAttribute('data-type');if(CSS.hasClass(b.option,'moreOption')){CSS.addClass(b.selector,d);CSS.addClass(b.selector,'showSecondaryOptions');return false;}else if(CSS.hasClass(b.option,'returnOption')){CSS.removeClass(b.selector,'showSecondaryOptions');CSS.removeClass(b.selector,'friendList');return false;}});Arbiter.subscribe('CustomPrivacyOption/update',function(a,b){if(!CSS.hasClass(b.selector,'audienceSelector'))return;Selector.setSelected(b.selector,Selector.getOptionValue(b.option));DynamicIconSelector.swapIcon(b.selector);Selector.setButtonTooltip(b.selector,b.tooltip);Arbiter.inform('AudienceSelector/update',b.selector);});});}();
function ScrollingPager(d,c,a,b){this.scroll_loader_id=d;this.pagelet_src=c;this.data=a;this.options=b||{};if(this.options.target_id){this.target_id=this.options.target_id;this.options.append=true;}else this.target_id=d;this.handler=null;}copy_properties(ScrollingPager,{_instances:{},getInstance:function(a){return ScrollingPager._instances[a];}});ScrollingPager.prototype={register:function(){this.onvisible=new OnVisible($(this.scroll_loader_id),this.getHandler(),false,this.options.buffer,this.options);ScrollingPager._instances[this.scroll_loader_id]=this;},getInstance:function(a){return ScrollingPager._instances[a];},getHandler:function(){if(this.handler)return this.handler;function a(){var c=ge(this.scroll_loader_id);if(!c){this.onvisible.remove();return;}CSS.addClass(c.firstChild,'async_saving');var b=this.options.handler;this.options.handler=function(){Arbiter.inform('ScrollingPager/loadingComplete');b&&b.apply(null,arguments);};UIPagelet.loadFromEndpoint(this.pagelet_src,this.target_id,this.data,this.options);}return a.bind(this);},setHandler:function(a){this.handler=a;},removeOnVisible:function(){this.onvisible.remove();}};
add_properties('TypeaheadBehaviors',{buildBestAvailableNames:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,e){var h=e.value;for(var d=0;d<e.results.length;++d){var g=e.results[d];if(g.alternate_names==null)continue;if(TypeaheadUtil.isQueryMatch(h,g.default_name)){g.text=g.default_name;return;}for(var f=0;f<g.alternate_names.length;f++)if(TypeaheadUtil.isQueryMatch(h,g.alternate_names[f])){g.text=g.alternate_names[f];return;}g.text=g.default_name;}});}});
function StreamProfileComposer(){}StreamProfileComposer.prototype={init:function(a){var b=$(a);Arbiter.subscribe('composer/publish',function(event,c){if(c.streamStory)animation.prependInsert(b,c.streamStory);});}};
function tz_calculate(f){var a=new Date();var b=a.getTimezoneOffset()/30;var e=a.getTime()/1000;var d=Math.round((f-e)/1800);var c=Math.round(b+d)%48;if(c==0){return 0;}else if(c>24){c-=Math.ceil(c/48)*48;}else if(c<-28)c+=Math.ceil(c/-48)*48;return c*30;}function tz_autoset(d,c){if(!d||undefined==c)return;if(window.tz_autoset.calculated)return;window.tz_autoset.calculated=true;var b=-tz_calculate(d);if(b!=c){var a='/ajax/autoset_timezone_ajax.php';new AsyncRequest().setURI(a).setData({gmt_off:b}).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding).setOption('suppressErrorAlerts',true).send();}}
function ufi_add_ft_hidden_node(c){if(c.link_data)return;var a=collect_data_attribs(c,['ft']).ft;if(count(a)){var b=$N('input',{type:'hidden',name:'link_data',value:JSON.stringify(a)});c.appendChild(b);}}function ufi_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.commentable_item').forEach(ufi_add_ft_hidden_node);});}
onloadRegister(function(){Selector.subscribe('close',function(a,b){if(CSS.hasClass(b.selector,'commentHideSelector')){var c=Selector.getValue(b.selector);c&&Selector.setSelected.curry(b.selector,c,false).defer();}});});
function MentionsInput(a){DataStore.set(a,'MentionsInput',this);this._root=a;}MentionsInput.getInstance=function(a){var b=Parent.byClass(a,'uiMentionsInput');return b?DataStore.get(b,'MentionsInput'):null;};(function(){var f=['@','\\uff20','+','\\uff0b'].join('');var d='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;';var c='\\b[A-Z][^ A-Z'+d+']';var e='([^'+f+d+']|['+d+'][^ '+d+'])';var b='(?:^|\\s)(?:['+f+']('+e+'{0,20}))';var a='(?:(?:'+c+'+)|'+b+')';var g='(?:'+c+'{4,})';MentionsInput.prototype={_triggers:new RegExp('['+f+']$'),_matcher:new RegExp(b+'$'),_autoMatcher:new RegExp(a+'$'),_userMatcher:new RegExp(g+'$')};})();Class.mixin(MentionsInput,'Arbiter',{init:function(a,b,c){this.init=bagofholding;this._initialized=true;this._typeahead=Typeahead.getInstance(DOM.find(this._root,'.mentionsTypeahead'));this._highlighter=DOM.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=DOM.find(this._root,'.highlighterContent');this._hiddenInput=DOM.find(this._root,'.mentionsHidden');this._input=this._typeahead.getCore().getElement();this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=a.max||6;this._metrics=c;if(ua.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var d=this._input.name;this._input.name=d+'_text';this._hiddenInput.name=d;}this._initEvents();this._initTypeahead();this.reset(b);this.inform('init',null,Arbiter.BEHAVIOR_STATE);},reset:function(b){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&DOM.empty(this._highlighterContent);this._highlighterAuxContent&&DOM.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;Input.setPlaceholder(this._input,this._placeholder);CSS.setStyle(this._typeahead.getElement(),'height','auto');if(b){Input.setValue(this._input,b.flattened);for(var a in b.mention_data)this._addToken({uid:a,text:b.mention_data[a],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getRawValue:function(){return Input.getValue(this._hiddenInput);},checkValue:function(){var a=this._typeahead.getCore().getValue();if(this._triggers.exec(a)||a==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var a=this._update.bind(this);Event.listen(this._input,{input:a,keyup:a,change:a,focus:this._updateWidth.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(e,f){var g=f.selected;this._addToken({uid:g.uid,text:g.text,type:g.type});this.updateValue();}.bind(this));var b=this._input;var d=null;var a=function(){if(d===null){d=Input.getSubmitOnEnter(b);Input.setSubmitOnEnter(b,false);}};var c=function(){if(d!==null){Input.setSubmitOnEnter(b,d);d=null;}};this._typeahead.subscribe('render',a);this._typeahead.subscribe('reset',c);this._typeahead.subscribe('highlight',function(e,f){f.index>=0?a():c();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().setFilter(this._filterResults.bind(this));},_filterResults:function(d){if(this._filterData===null){var a=Input.getSelection(this._input).start||0;for(var c=0;c<this._offsets.length;c++){var e=this._offsets[c];if(a>e[0]&&a<=e[1]){this._filterData={caretIsInsideMention:true};return false;}}var b=this._typeahead.getCore();this._filterData={value:b.getValue(),rawValue:b.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(this._matcher.test(this._filterData.rawValue))return true;if(d.type!='user')return false;if(this._userMatcher.test(this._filterData.value))return true;return TypeaheadUtil.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(d));},_addToken:function(a){var b=a.uid;if(!this._mentioned.hasOwnProperty(b)){this._mentioned[b]=a;this._orderedUIDs.push(b);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(a){if(this._mentioned.hasOwnProperty(a)){delete this._mentioned[a];this._orderedUIDs.remove(a);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(f,d){var e=d.split(' ');var b=[];for(var a=0;a<e.length;a++)if(f.indexOf(e[a])!=-1)b.push(e[a]);e=b;for(a=1;a<e.length;a++)for(var c=1;c<e[a-1].length+1;c++)if(f.indexOf(e[a-1].substr(0,c)+e[a])!=-1)e.splice(a-1,1);while(f.indexOf(e.join(' '))==-1)e.splice(0,1);return e.join(' ');},_update:function(){var a=Input.getValue(this._input);if(a==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var g=Input.getValue(this._input);var c=false;for(var a=0;a<this._orderedUIDs.length;++a){var f=this._orderedUIDs[a];var b=this._mentioned[f];var e=b.text;var d;if(b.type=='user'&&(d=this._reduceToken(g,e))!==''){if(d==e.substring(0,e.lastIndexOf(' '))&&g==this._value.substring(0,this._value.length-1)){g=g.substring(0,g.lastIndexOf(' '));c=true;}b.text=d;}else if(!e||g.indexOf(e)==-1||typeof e!=='string')this._removeToken(f);}this._value=g;if(c)Input.setValue(this._input,g);},updateValue:function(){var g=Input.getValue(this._input);var f=this._orderedUIDs;var c=[];var a,d,e,b;for(b=0;b<f.length;++b){d=this._mentioned[f[b]].text;g=g.replace(d,function(h,i){c.push([i,i+d.length]);return d;});}for(b=0;b<f.length;++b){e=f[b];d=this._mentioned[e].text;g=g.replace(d,'@['+e+':]');}a=htmlize(g);for(b=0;b<f.length;++b){e=f[b];d=this._mentioned[e].text;a=a.replace('@['+e+':]','<b>'+htmlize(d)+'</b>');d=d.replace(/[\\\]:]/g,function(h){return '\\'+h;});g=g.replace('@['+e+':]','@['+e+':'+d+']');}if(ua.ie())a=a.replace(/ {2}/g,'&nbsp; ');this._offsets=c;this._hiddenInput.value=g;DOM.setContent(this._highlighterContent,HTML(a));this._updateHeight();},_updateDirection:function(){var a=CSS.getStyle(this._input,'direction');if(a==this._dir)return;this._dir=a;CSS.setStyle(this._highlighter,'direction',a);if(a=='rtl'){CSS.setStyle(this._highlighter,'text-align','right');}else CSS.setStyle(this._highlighter,'text-align','left');},_updateWidth:function(){var a=CSS.getStyleFloat.curry(this._input);var b=this._input.offsetWidth-a('paddingLeft')-a('paddingRight')-a('borderLeftWidth')-a('borderRightWidth');if(ua.firefox())b-=2;if(ua.ie()<=7){b-=CSS.getStyleFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(b,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var a=this._highlighter.offsetHeight;var b=this._typeahead.getElement();if(a>b.offsetHeight){CSS.setStyle(b,'height',a+'px');Arbiter.inform('reflow');}}},_updateTypeahead:function(){var a=this._typeahead.getCore();var b=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)b=this._autoMatcher;a.matcher=b;a.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setAuxContent:function(a){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=$N('span',{className:'highlighterAuxContent'});DOM.insertAfter(this._highlighterContent,this._highlighterAuxContent);}DOM.setContent(this._highlighterAuxContent,a);if(a){Input.setPlaceholder(this._input,'');}else Input.setPlaceholder(this._input,this._placeholder);this._updateHeight();}},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(a){var b=Input.getValue(this._input);Input.setValue(this._input,b+" "+a.text);this._addToken(a);this._update();},getMentions:function(){return this._mentioned;}});
__d("legacy:contextual-layer-hide-on-scroll",["ContextualLayerHideOnScroll"],function(a,b,c){a.ContextualLayerHideOnScroll=b('ContextualLayerHideOnScroll');},3);
__d("legacy:contextual-thing",["ContextualThing"],function(a,b,c){a.ContextualThing=a.ContextualThing||b('ContextualThing');},3);
function TypeaheadView(a,b){this.element=this.content=$(a);copy_properties(this,b);}Class.mixin(TypeaheadView,'Arbiter',{events:['highlight','render','reset','select'],renderer:'basic',autoSelect:false,init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.visible)this.highlight(this.getIndex(event));},reset:function(a){if(!a)this.disableAutoSelect=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(Parent.byTag(event.getTarget(),'li'));},getSelection:function(){var a=this.results[this.index]||null;return this.visible?a:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){CSS.show(this.element);this.visible=true;return this;},hide:function(){CSS.hide(this.element);this.visible=false;return this;},refresh:function(){return this;},render:function(h,e,f){this.value=h;if(!e.length){this.reset(true);return;}var c={results:e,value:h};this.inform('beforeRender',c);e=c.results;var d=this.getDefaultIndex(e);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var a=this.results[this.index];for(var b=0,g=e.length;b<g;++b)if(a.uid==e[b].uid){d=b;break;}}this.results=e;DOM.setContent(this.content,this.buildResults(e));this.items=this.getItems();this.highlight(d,false);this.inform('render',e);},getItems:function(){return DOM.scry(this.content,'li');},buildResults:function(d){var c;var a=null;if(typeof this.renderer=='function'){c=this.renderer;}else{c=TypeaheadRenderers[this.renderer];a=this.renderer;}c=c.bind(this);var b=d.map(function(e,f){return e.node||c(e,f);});return $N('ul',{className:a},b);},getDefaultIndex:function(b){var a=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!a?-1:0;},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},highlight:function(a,b){this.selected&&CSS.removeClass(this.selected,'selected');if(a>this.items.length-1){a=-1;}else if(a<-1)a=this.items.length-1;if(a>=0&&a<this.items.length){this.selected=this.items[a];CSS.addClass(this.selected,'selected');}this.index=a;this.disableAutoSelect=(a==-1);if(b!==false)this.inform('highlight',{index:a,selected:this.results[a]});},select:function(a){var b=this.index;var c=this.results[b];if(c){this.inform('select',{index:b,clicked:!!a,selected:c});this.inform('afterSelect');}}});
function ContextualTypeaheadView(a,b){this.parent.construct(this,a,b);}Class.extend(ContextualTypeaheadView,'TypeaheadView');ContextualTypeaheadView.prototype={init:function(){this.parent.init();this.initializeLayer();},initializeLayer:function(){this.context=this.element.parentNode;this.wrapper=$N('div');DOM.appendContent(this.wrapper,this.element);this.layer=new ContextualLayer().init(this.wrapper).addBehaviors([ContextualLayerHideOnScroll]).setContext(this.context).setAutoFlip(false).setPosition('below');},show:function(){this.parent.show();return this.refresh();},hide:function(){this.parent.hide();return this.refresh();},refresh:function(){if(this.layer)if(this.isVisible()){if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();Vector2.getElementDimensions(this.context).setElementWidth(this.wrapper);}else this.layer.hide();return this;}};
function MultiBootstrapDataSource(a){this._bootstrapEndpoints=a.bootstrapEndpoints;this.parent.construct(this,a);}Class.extend(MultiBootstrapDataSource,'DataSource');MultiBootstrapDataSource.prototype={bootstrapWithoutToken:function(){for(var a=0;a<this._bootstrapEndpoints.length;a++)this.fetch(this._bootstrapEndpoints[a].endpoint,this._bootstrapEndpoints[a].data||{});}};
function TypeaheadCore(a){copy_properties(this,a);}Class.mixin(TypeaheadCore,'Arbiter',{events:['blur','focus','unselect'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(a,c,b){this.init=bagofholding;this.data=a;this.view=c;this.root=b;this.initInput();this.inputWrap=DOM.find(b,'div.wrap');this.hiddenInput=DOM.find(b,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&CSS.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=DOM.find(this.root,'.textInput');var a=DOM.scry(this.element,'input')[0];if(a)this.element=a;},initView:function(){this.view.subscribe('highlight',function(){this.element.focus();}.bind(this));this.view.subscribe('select',function(a,b){this.select(b.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(a,b){if(b.forceDisplay||b.value==this.getValue()&&!this.element.disabled)this.view.render(b.value,b.results,b.isAsync);}.bind(this));this.data.subscribe('activity',function(a,b){this.fetching=b.activity;if(!this.fetching)this.nextQuery&&this.performQuery();}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var a={blur:bind(this,'blur'),focus:bind(this,'focus'),click:bind(this,'click'),keyup:bind(this,'keyup'),keydown:bind(this,'keydown')};if(ua.firefox())a.text=a.keyup;if(ua.firefox()<4){a.keypress=a.keydown;delete a.keydown;}Event.listen(this.element,a);Event.listen(this.element,'keypress',bind(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var a=Input.getSelection(this.element);if(a.start==a.end)this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){this.view.refresh();if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case KEYS.TAB:this.handleTab(event);return;case KEYS.UP:this.view.prev();break;case KEYS.DOWN:this.view.next();break;case KEYS.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==KEYS.RETURN){this.view.select();event.kill();}},handleTab:function(event){this.view.select();this.preventFocusChangeOnTab&&event.kill();},select:function(a){if(a&&this.setValueOnSelect){this.setValue(a.text);this.setHiddenValue(a.uid);this.selectedText=a.text;CSS.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?this.element.focus():this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;CSS.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(b){var a=b===false;this.element.disabled=a;CSS.conditionClass(this.root,'uiTypeaheadDisabled',a);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&Input.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(a){this._exclusions=a;},getExclusions:function(){return this._exclusions;},setValue:function(a){this.value=this.nextQuery=a||'';Input.setValue(this.element,this.value);},setHiddenValue:function(a){this.hiddenInput.value=(a||a===0)?a:'';Arbiter.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return Input.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var c=this.getValue();if(c==this.value)return;if(this.selectedText&&this.selectedText!=c)this.unselect();var b=Date.now();var a=b-this.time;this.time=b;this.value=this.nextQuery=c;this.performQuery(a);},performQuery:function(a){if(this.selectedText)return;a=a||0;if(this.fetching&&a<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});
function TypeaheadAreaCore(a){this.parent.construct(this,a);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}Class.extend(TypeaheadAreaCore,'TypeaheadCore');TypeaheadAreaCore.prototype={prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(a){this.parent.select(a);var e=this.element.value;var d=this.prefix+a.text+this.suffix;this.expandBounds(e,d);var b=e.substring(0,this.start);var c=e.substring(this.end);this.element.value=b+d+c;Input.setSelection(this.element,b.length+d.length);},expandBounds:function(g,f){g=g.toLowerCase().trim();f=f.toLowerCase();var b,e,c,d;var a=/\s/;e=g.substring(this.start,this.end);c=f.indexOf(e);b=this.start;while(b>=0&&c>=0){d=g.charAt(b-1);if(!d||a.test(d))this.start=b;e=d+e;c=f.indexOf(e);b--;}e=g.substring(this.start,this.end);c=f.indexOf(e);b=this.end;while(b<=g.length&&c>=0){d=g.charAt(b);if(!d||a.test(d))this.end=b;e=e+d;c=f.indexOf(e);b++;}},getRawValue:function(){var a=Input.getSelection(this.element).start||0;return this.parent.getValue().substring(0,a);},getValue:function(){var a=this.matcher&&this.matcher.exec(this.getRawValue());if(!a)return '';var e=a[0];var d=a.index+e.length;e=e.replace(/^\s/,'');var b=e.length;e=e.replace(/\s$/,'');var c=b-e.length;this.start=d-b;this.end=d+c;return a[1]||a[0];}};
function TypeaheadMetrics(a){this.extraData={};copy_properties(this,a);}TypeaheadMetrics.prototype={endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(a){this.init=bagofholding;this.core=a.getCore();this.view=a.getView();this.data=a.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(a){var b=a.selected;if(b.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',b.uid);this.recordStat('selected_type',b.type);this.recordStat('selected_position',a.index);this.recordStat('selected_with_mouse',a.clicked?1:0);this._sessionEnd();},bindSessionStart:function(c,event,a){if(a)for(var b=0;b<this._sessionStartEvents.length;++b){var d=this._sessionStartEvents[b];d.obj.unsubscribe(d.token);}this._sessionStartEvents.push({obj:c,token:c.subscribe(event,function(e,f){this._sessionStart();}.bind(this))});},bindSessionEnd:function(c,event,a){if(a)for(var b=0;b<this._sessionEndEvents.length;++b){var d=this._sessionEndEvents[b];d.obj.unsubscribe(d.token);}this._sessionEndEvents.push({obj:c,token:c.subscribe(event,function(e,f){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(a,b){this.recordSelect(b);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(a,b){this.results=b;}.bind(this));this.data.subscribe('beforeQuery',function(a,b){if(!b.value)return;this.query=b.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(a,b){if(b.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else b.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(a,b){if(b.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);bootstrap_result={};b.response.payload.entries.each(function(c){if(!bootstrap_result[c.type]){bootstrap_result[c.type]=1;}else bootstrap_result[c.type]++;});this.recordStat('bootstrap_response_types',bootstrap_result);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-b.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(a,b){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(a,b){this.stats[a]=b;},recordCountStat:function(a){var b=this.stats[a];this.stats[a]=b?b+1:1;},recordAvgStat:function(a,b){if(this.avgStats[a]){this.avgStats[a][0]+=b;++this.avgStats[a][1];}else this.avgStats[a]=[b,1];},submit:function(){if(count(this.stats)>0){copy_properties(this.stats,this.extraData);if(this.results){var c=(this.results).map(function(e,d){return e.uid;});this.recordStat('candidate_results',JSON.stringify(c));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var b in this.avgStats){var a=this.avgStats[b];this.stats[b]=a[0]/a[1];}new AsyncRequest().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}};
add_properties('TypeaheadBehaviors',{hoistFriends:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,f){var g=[];var d=[];for(var e=0;e<f.results.length;++e){var h=f.results[e];if(h.type=='user'&&h.bootstrapped){d.push(h);}else g.push(h);}f.results=d.concat(g);});}});
add_properties('TypeaheadBehaviors',{setPhotoOnSelect:function(e){var c=DOM.scry(e.getElement(),'.photo')[0];if(c){if(!DOM.isNodeOfType(c,'img')){var b=DOM.create('img',{className:c.className});DOM.replace(c,b);c=b;}var a=CSS.hide.curry(c);var d=CSS.show.curry(c);Event.listen(c,{load:d,error:a,abort:a});e.subscribe('select',function(f,g){var h=g.selected.photo||e.view.fallbackPhoto;h?c.setAttribute('src',h):a();});}}});
add_properties('TypeaheadBehaviors',{showLoadingIndicator:function(a){a.subscribe('activity',function(b,c){CSS.conditionClass(a.getElement(),'typeaheadLoading',c.activity);CSS.conditionClass(a.getView().getElement(),'typeaheadViewLoading',c.activity);});}});
add_properties('TypeaheadRenderers',{basic:function(a,b){var c=[];if(a.icon)c.push($N('img',{alt:'',src:a.icon}));if(a.text)c.push($N('span',{className:'text'},[a.text]));if(a.subtext)c.push($N('span',{className:'subtext'},[a.subtext]));return $N('li',{className:a.type||''},c);}});
add_properties('TypeaheadRenderers',{compact:function(c,d){var e=[];var f=c.photo;if(f){if(f instanceof Array){var g=[$N('span',{className:'splitpic leftpic'},[$N('img',{alt:'',src:f[0]})]),$N('span',{className:'splitpic'+(f[2]?' toppic':'')},[$N('img',{alt:'',src:f[1]})])];if(f[2])g.push($N('span',{className:'splitpic bottompic'},[$N('img',{alt:'',src:f[2]})]));f=$N('span',{className:'splitpics clearfix'},g);}else f=$N('img',{alt:'',src:f});e.push(f);}if(c.text)e.push($N('span',{className:'text'},[c.text]));var h=c.subtext;var a=c.category;if(h||a){var b=[];h&&b.push(h);h&&a&&b.push(" \u00b7 ");a&&b.push(a);e.push($N('span',{className:'subtext'},b));}return $N('li',{className:c.type||''},e);}});
add_properties('TypeaheadRenderers',{search:function(d,f){var h=[];if(d.photo){h.push($N('img',{className:'photo',alt:'',src:d.photo}));if(d.song){h.push($N('span',{className:'playButton'}));h.push($N('span',{className:'playLoader'}));}}if(d.text){var a=d.alias;var l=this.value;var j=d.text;var k=[j];if(a&&TypeaheadUtil.isQueryMatch(l,a)&&!TypeaheadUtil.isQueryMatch(l,j))k.push($N('span',{className:'alias'},[' \xB7 '+a]));h.push($N('span',{className:'text'},k));}if(d.category){var b=[d.category];if(d.is_external)b.push($N('span',{className:'arrow'}));h.push($N('span',{className:'category'},b));}if(d.subtext)h.push($N('span',{className:'subtext'},[d.subtext]));var c=d.classNames||d.type||'';var i=d.is_external?'_blank':'';var e=!d.song&&d.path||'';if(e){if(!(/^https?\:\/\//).test(e))e=Env.www_base+e.substr(1);e+=(e.indexOf('?')>0?'&':'?')+'ref=ts';}var g=$N('a',{href:e,rel:'ignore',target:i},h);if(d.song){g.id='mb_'+(Math.random()*1e+06|0);MusicButtonManager.addButton.curry(d.song.provider,g.id,d.song.url,d.song.context,d.song.media_type).defer();g.onclick=this.ignoreClick;}return $N('li',{className:c},[g]);}});
WidgetArbiter={_findSiblings:function(){if(WidgetArbiter._siblings)return;WidgetArbiter._siblings=[];for(var b=parent.frames.length-1;b>=0;b--)try{if(parent.frames[b]&&parent.frames[b].Arbiter&&parent.frames[b].Arbiter.inform)WidgetArbiter._siblings.push(parent.frames[b].Arbiter);}catch(a){}},inform:function(){WidgetArbiter._findSiblings();var a=$A(arguments);WidgetArbiter._siblings.each(function(b){b.inform.apply(b,a);});}};
var PlatformOptInPopup=function(){};copy_properties(PlatformOptInPopup,{DIALOG_URL:'/connect/uiserver.php',DIALOG_WIDTH:420,DIALOG_HEIGHT:450,APP_ID:127760087237610,open:function(d,c,a){if(!d)d='generic';if(!c)c='opt.in';var b=new URI(PlatformOptInPopup.DIALOG_URL);b.addQueryData({social_plugin:d,method:c,display:'popup',secure:URI.getRequestURI().isSecure(),app_id:PlatformOptInPopup.APP_ID});if(a)b.addQueryData(a);return PopupResizer.open(b.toString(),PlatformOptInPopup.DIALOG_WIDTH,PlatformOptInPopup.DIALOG_HEIGHT);}});
WindowComm={_callbacks:{},makeHandler:function(a,c){c=c||'opener';var b='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[b]=a;return new URI('/connect/window_comm.php').setQueryData({_id:b,_relation:c}).getQualifiedURI().toString();},_recv:function(b){var a=new URI(b).getQueryData();WindowComm._callbacks[a._id](a);}};